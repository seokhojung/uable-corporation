/*


  Shapespark 3D visualization viewer

  Copyright (C) 2014-present Shapespark

  The viewer uses the following open source libraries:

    Three.js: https://github.com/mrdoob/three.js,
    Copyright 2010-2015 three.js authors, MIT License

    PlayCanvas (GLSL shaders code): https://github.com/playcanvas/engine
    Copyright (C) 2011-2015 PlayCanvas Ltd., MIT License

    WebXR Polyfill: https://github.com/immersive-web/webxr-polyfill,
    Copyright (C) 2017 Google Inc, Apache 2.0 License

    Web Font Loader: https://github.com/typekit/webfontloader
    Copyright (C) 2010-2017 Adobe Systems Incorporated, Google Incorporated, Apache 2.0 License

    Basis Universal GPU Texture Codec: https://github.com/BinomialLLC/basis_universal
    Copyright (C) 2019 Binomial LLC., Apache License

    HTTP Live Streaming: https://github.com/video-dev/hls.js
    Copyright (c) 2017 Dailymotion (http://www.dailymotion.com), Apache 2.0 License

    node-qrcode: https://github.com/soldair/node-qrcode
    Copyright (c) 2012 Ryan Day,  MIT License

    Brotli: https://github.com/google/brotli
    Copyright (c) 2009, 2010, 2013-2016 by the Brotli Authors,  MIT License

    Bezier.js: https://github.com/Pomax/bezierjs
    Copyright (c) Pomax, MIT License

  and the following open fonts:

    Open Sans: https://fonts.google.com/specimen/Open+Sans
    Copyright (C) Google Inc., Apache 2.0 License

    Font Awesome: https://fontawesome.com/
    Copyright (C) 2017 Fonticons Inc, SIL Open Font License
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),e=$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,f){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=$jscomp.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||
e}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(a){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(g){return g instanceof e?g:new e(function(h,k){h(g)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(g){if(null==this.batch_){this.batch_=[];var h=this;this.asyncExecuteFunction(function(){h.executeBatch_()})}this.batch_.push(g)};
var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(g){d(g,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var g=this.batch_;this.batch_=[];for(var h=0;h<g.length;++h){var k=g[h];g[h]=null;try{k()}catch(q){this.asyncThrow_(q)}}}this.batch_=null};b.prototype.asyncThrow_=function(g){this.asyncExecuteFunction(function(){throw g;})};var e=function(g){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var h=this.createResolveAndReject_();
try{g(h.resolve,h.reject)}catch(k){h.reject(k)}};e.prototype.createResolveAndReject_=function(){function g(q){return function(p){k||(k=!0,q.call(h,p))}}var h=this,k=!1;return{resolve:g(this.resolveTo_),reject:g(this.reject_)}};e.prototype.resolveTo_=function(g){if(g===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof e)this.settleSameAsPromise_(g);else{a:switch(typeof g){case "object":var h=null!=g;break a;case "function":h=!0;break a;default:h=!1}h?this.resolveToNonPromiseObj_(g):
this.fulfill_(g)}};e.prototype.resolveToNonPromiseObj_=function(g){var h=void 0;try{h=g.then}catch(k){this.reject_(k);return}"function"==typeof h?this.settleSameAsThenable_(h,g):this.fulfill_(g)};e.prototype.reject_=function(g){this.settle_(2,g)};e.prototype.fulfill_=function(g){this.settle_(1,g)};e.prototype.settle_=function(g,h){if(0!=this.state_)throw Error("Cannot settle("+g+", "+h+"): Promise already settled in state"+this.state_);this.state_=g;this.result_=h;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};e.prototype.scheduleUnhandledRejectionCheck_=function(){var g=this;d(function(){if(g.notifyUnhandledRejection_()){var h=$jscomp.global.console;"undefined"!==typeof h&&h.error(g.result_)}},1)};e.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var g=$jscomp.global.CustomEvent,h=$jscomp.global.Event,k=$jscomp.global.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof g?g=new g("unhandledrejection",{cancelable:!0}):
"function"===typeof h?g=new h("unhandledrejection",{cancelable:!0}):(g=$jscomp.global.document.createEvent("CustomEvent"),g.initCustomEvent("unhandledrejection",!1,!0,g));g.promise=this;g.reason=this.result_;return k(g)};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var g=0;g<this.onSettledCallbacks_.length;++g)f.asyncExecute(this.onSettledCallbacks_[g]);this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(g){var h=this.createResolveAndReject_();
g.callWhenSettled_(h.resolve,h.reject)};e.prototype.settleSameAsThenable_=function(g,h){var k=this.createResolveAndReject_();try{g.call(h,k.resolve,k.reject)}catch(q){k.reject(q)}};e.prototype.then=function(g,h){function k(n,m){return"function"==typeof n?function(l){try{q(n(l))}catch(u){p(u)}}:m}var q,p,r=new e(function(n,m){q=n;p=m});this.callWhenSettled_(k(g,q),k(h,p));return r};e.prototype.catch=function(g){return this.then(void 0,g)};e.prototype.callWhenSettled_=function(g,h){function k(){switch(q.state_){case 1:g(q.result_);
break;case 2:h(q.result_);break;default:throw Error("Unexpected state: "+q.state_);}}var q=this;null==this.onSettledCallbacks_?f.asyncExecute(k):this.onSettledCallbacks_.push(k);this.isRejectionHandled_=!0};e.resolve=c;e.reject=function(g){return new e(function(h,k){k(g)})};e.race=function(g){return new e(function(h,k){for(var q=$jscomp.makeIterator(g),p=q.next();!p.done;p=q.next())c(p.value).callWhenSettled_(h,k)})};e.all=function(g){var h=$jscomp.makeIterator(g),k=h.next();return k.done?c([]):new e(function(q,
p){function r(l){return function(u){n[l]=u;m--;0==m&&q(n)}}var n=[],m=0;do n.push(void 0),m++,c(k.value).callWhenSettled_(r(n.length-1),p),k=h.next();while(!k.done)})};return e},"es6","es3");$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push([d,b[d]]);return c}},"es8","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};
$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var q=Object.seal({}),p=Object.seal({}),r=new a([[q,2],[p,3]]);if(2!=r.get(q)||3!=r.get(p))return!1;r.delete(q);r.set(p,4);return!r.has(q)&&4==r.get(p)}catch(n){return!1}}function c(){}function d(q){var p=typeof q;return"object"===p&&null!==q||"function"===p}function e(q){if(!$jscomp.owns(q,g)){var p=new c;$jscomp.defineProperty(q,g,{value:p})}}function f(q){if(!$jscomp.ISOLATE_POLYFILLS){var p=Object[q];p&&(Object[q]=
function(r){if(r instanceof c)return r;Object.isExtensible(r)&&e(r);return p(r)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var g="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var h=0,k=function(q){this.id_=(h+=Math.random()+1).toString();if(q){q=$jscomp.makeIterator(q);for(var p;!(p=q.next()).done;)p=p.value,this.set(p[0],p[1])}};k.prototype.set=function(q,p){if(!d(q))throw Error("Invalid WeakMap key");
e(q);if(!$jscomp.owns(q,g))throw Error("WeakMap key fail: "+q);q[g][this.id_]=p;return this};k.prototype.get=function(q){return d(q)&&$jscomp.owns(q,g)?q[g][this.id_]:void 0};k.prototype.has=function(q){return d(q)&&$jscomp.owns(q,g)&&$jscomp.owns(q[g],this.id_)};k.prototype.delete=function(q){return d(q)&&$jscomp.owns(q,g)&&$jscomp.owns(q[g],this.id_)?delete q[g][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var k=Object.seal({x:4}),q=new a($jscomp.makeIterator([[k,"s"]]));if("s"!=q.get(k)||1!=q.size||q.get({x:4})||q.set({x:4},"t")!=q||2!=q.size)return!1;var p=q.entries(),r=p.next();if(r.done||r.value[0]!=k||"s"!=r.value[1])return!1;r=p.next();return r.done||4!=r.value[0].x||"t"!=r.value[1]||!p.next().done?!1:!0}catch(n){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,d=function(k){this.data_={};this.head_=g();this.size=0;if(k){k=$jscomp.makeIterator(k);for(var q;!(q=k.next()).done;)q=q.value,this.set(q[0],q[1])}};d.prototype.set=function(k,q){k=0===k?0:k;var p=e(this,k);p.list||(p.list=this.data_[p.id]=[]);p.entry?p.entry.value=q:(p.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:k,value:q},p.list.push(p.entry),
this.head_.previous.next=p.entry,this.head_.previous=p.entry,this.size++);return this};d.prototype.delete=function(k){k=e(this,k);return k.entry&&k.list?(k.list.splice(k.index,1),k.list.length||delete this.data_[k.id],k.entry.previous.next=k.entry.next,k.entry.next.previous=k.entry.previous,k.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};d.prototype.has=function(k){return!!e(this,k).entry};d.prototype.get=function(k){return(k=
e(this,k).entry)&&k.value};d.prototype.entries=function(){return f(this,function(k){return[k.key,k.value]})};d.prototype.keys=function(){return f(this,function(k){return k.key})};d.prototype.values=function(){return f(this,function(k){return k.value})};d.prototype.forEach=function(k,q){for(var p=this.entries(),r;!(r=p.next()).done;)r=r.value,k.call(q,r[1],r[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(k,q){var p=q&&typeof q;"object"==p||"function"==p?c.has(q)?p=c.get(q):
(p=""+ ++h,c.set(q,p)):p="p_"+q;var r=k.data_[p];if(r&&$jscomp.owns(k.data_,p))for(k=0;k<r.length;k++){var n=r[k];if(q!==q&&n.key!==n.key||q===n.key)return{id:p,list:r,index:k,entry:n}}return{id:p,list:r,index:-1,entry:void 0}},f=function(k,q){var p=k.head_;return $jscomp.iteratorPrototype(function(){if(p){for(;p.head!=k.head_;)p=p.previous;for(;p.next!=p.head;)return p=p.next,{done:!1,value:q(p)};p=null}return{done:!0,value:void 0}})},g=function(){var k={};return k.previous=k.next=k.head=k},h=0;
return d},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),e=new a($jscomp.makeIterator([d]));if(!e.has(d)||1!=e.size||e.add(d)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var f=e.entries(),g=f.next();if(g.done||g.value[0]!=d||g.value[1]!=d)return!1;g=f.next();return g.done||g.value[0]==d||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:f.next().done}catch(h){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var e;!(e=d.next()).done;)this.add(e.value)}this.size=this.map_.size};c.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};c.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};c.prototype.clear=function(){this.map_.clear();this.size=0};c.prototype.has=
function(d){return this.map_.has(d)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(d,e){var f=this;this.map_.forEach(function(g){return d.call(e,g,g,f)})};return c},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.polyfill("Object.setPrototypeOf",function(a){return a||$jscomp.setPrototypeOf},"es6","es5");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");$jscomp.polyfill("Number.EPSILON",function(a){return Math.pow(2,-52)},"es6","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");
$jscomp.polyfill("Number.MIN_SAFE_INTEGER",function(){return-9007199254740991},"es6","es3");$jscomp.polyfill("Array.from",function(a){return a?a:function(b,c,d){c=null!=c?c:function(h){return h};var e=[],f="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof f){b=f.call(b);for(var g=0;!(f=b.next()).done;)e.push(c.call(d,f.value,g++))}else for(f=b.length,g=0;g<f;g++)e.push(c.call(d,b[g],g));return e}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");$jscomp.polyfill("Math.sign",function(a){return a?a:function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push(b[d]);return c}},"es8","es3");$jscomp.polyfill("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");
$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}},"es9","es3");(function(){function a(V,ia,za){return V.call.apply(V.bind,arguments)}function b(V,ia,za){if(!V)throw Error();if(2<arguments.length){var ua=Array.prototype.slice.call(arguments,2);return function(){var Ea=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(Ea,ua);return V.apply(ia,Ea)}}return function(){return V.apply(ia,arguments)}}function c(V,ia,za){c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:b;return c.apply(null,arguments)}function d(V,
ia){this.a=V;this.m=ia||V;this.c=this.m.document}function e(V,ia,za,ua){ia=V.c.createElement(ia);if(za)for(var Ea in za)za.hasOwnProperty(Ea)&&("style"==Ea?ia.style.cssText=za[Ea]:ia.setAttribute(Ea,za[Ea]));ua&&ia.appendChild(V.c.createTextNode(ua));return ia}function f(V,ia,za){(V=V.c.getElementsByTagName(ia)[0])||(V=document.documentElement);V.insertBefore(za,V.lastChild)}function g(V){V.parentNode&&V.parentNode.removeChild(V)}function h(V,ia,za){ia=ia||[];za=za||[];for(var ua=V.className.split(/\s+/),
Ea=0;Ea<ia.length;Ea+=1){for(var Na=!1,ea=0;ea<ua.length;ea+=1)if(ia[Ea]===ua[ea]){Na=!0;break}Na||ua.push(ia[Ea])}ia=[];for(Ea=0;Ea<ua.length;Ea+=1){Na=!1;for(ea=0;ea<za.length;ea+=1)if(ua[Ea]===za[ea]){Na=!0;break}Na||ia.push(ua[Ea])}V.className=ia.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function k(V,ia){V=V.className.split(/\s+/);for(var za=0,ua=V.length;za<ua;za++)if(V[za]==ia)return!0;return!1}function q(V){if("string"===typeof V.f)return V.f;var ia=V.m.location.protocol;"about:"==
ia&&(ia=V.a.location.protocol);return"https:"==ia?"https:":"http:"}function p(V){return V.m.location.hostname||V.a.location.hostname}function r(V,ia,za){function ua(){ba&&Ea&&Na&&(ba(ea),ba=null)}ia=e(V,"link",{rel:"stylesheet",href:ia,media:"all"});var Ea=!1,Na=!0,ea=null,ba=za||null;U?(ia.onload=function(){Ea=!0;ua()},ia.onerror=function(){Ea=!0;ea=Error("Stylesheet failed to load");ua()}):setTimeout(function(){Ea=!0;ua()},0);f(V,"head",ia)}function n(V,ia,za,ua){var Ea=V.c.getElementsByTagName("head")[0];
if(Ea){var Na=e(V,"script",{src:ia}),ea=!1;Na.onload=Na.onreadystatechange=function(){ea||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(ea=!0,za&&za(null),Na.onload=Na.onreadystatechange=null,"HEAD"==Na.parentNode.tagName&&Ea.removeChild(Na))};Ea.appendChild(Na);setTimeout(function(){ea||(ea=!0,za&&za(Error("Script load timeout")))},ua||5E3);return Na}return null}function m(){this.a=0;this.c=null}function l(V){V.a++;return function(){V.a--;v(V)}}function u(V,ia){V.c=ia;
v(V)}function v(V){0==V.a&&V.c&&(V.c(),V.c=null)}function t(V){this.a=V||"-"}function B(V,ia){this.c=V;this.f=4;this.a="n";(V=(ia||"n4").match(/^([nio])([1-9])$/i))&&(this.a=V[1],this.f=parseInt(V[2],10))}function D(V){return Q(V)+" "+(V.f+"00 300px ")+I(V.c)}function I(V){var ia=[];V=V.split(/,\s*/);for(var za=0;za<V.length;za++){var ua=V[za].replace(/['"]/g,"");-1!=ua.indexOf(" ")||/^\d/.test(ua)?ia.push("'"+ua+"'"):ia.push(ua)}return ia.join(",")}function J(V){return V.a+V.f}function Q(V){var ia=
"normal";"o"===V.a?ia="oblique":"i"===V.a&&(ia="italic");return ia}function T(V,ia){this.c=V;this.f=V.m.document.documentElement;this.h=ia;this.a=new t("-");this.j=!1!==ia.events;this.g=!1!==ia.classes}function M(V){V.g&&h(V.f,[V.a.c("wf","loading")]);A(V,"loading")}function z(V){if(V.g){var ia=k(V.f,V.a.c("wf","active")),za=[],ua=[V.a.c("wf","loading")];ia||za.push(V.a.c("wf","inactive"));h(V.f,za,ua)}A(V,"inactive")}function A(V,ia,za){if(V.j&&V.h[ia])if(za)V.h[ia](za.c,J(za));else V.h[ia]()}function y(){this.c=
{}}function E(V,ia,za){var ua=[],Ea;for(Ea in ia)if(ia.hasOwnProperty(Ea)){var Na=V.c[Ea];Na&&ua.push(Na(ia[Ea],za))}return ua}function K(V,ia){this.c=V;this.f=ia;this.a=e(this.c,"span",{"aria-hidden":"true"},this.f)}function H(V){f(V.c,"body",V.a)}function G(V){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+I(V.c)+";font-style:"+(Q(V)+";font-weight:"+
(V.f+"00;"))}function O(V,ia,za,ua,Ea,Na){this.g=V;this.j=ia;this.a=ua;this.c=za;this.f=Ea||3E3;this.h=Na||void 0}function Y(V,ia,za,ua,Ea,Na,ea){this.v=V;this.B=ia;this.c=za;this.a=ua;this.s=ea||"BESbswy";this.f={};this.w=Ea||3E3;this.u=Na||null;this.o=this.j=this.h=this.g=null;this.g=new K(this.c,this.s);this.h=new K(this.c,this.s);this.j=new K(this.c,this.s);this.o=new K(this.c,this.s);V=new B(this.a.c+",serif",J(this.a));V=G(V);this.g.a.style.cssText=V;V=new B(this.a.c+",sans-serif",J(this.a));
V=G(V);this.h.a.style.cssText=V;V=new B("serif",J(this.a));V=G(V);this.j.a.style.cssText=V;V=new B("sans-serif",J(this.a));V=G(V);this.o.a.style.cssText=V;H(this.g);H(this.h);H(this.j);H(this.o)}function W(){if(null===Da){var V=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);Da=!!V&&(536>parseInt(V[1],10)||536===parseInt(V[1],10)&&11>=parseInt(V[2],10))}return Da}function ka(V,ia,za){for(var ua in pa)if(pa.hasOwnProperty(ua)&&ia===V.f[pa[ua]]&&za===V.f[pa[ua]])return!0;return!1}
function la(V){var ia=V.g.a.offsetWidth,za=V.h.a.offsetWidth,ua;(ua=ia===V.f.serif&&za===V.f["sans-serif"])||(ua=W()&&ka(V,ia,za));ua?Ta()-V.A>=V.w?W()&&ka(V,ia,za)&&(null===V.u||V.u.hasOwnProperty(V.a.c))?ra(V,V.v):ra(V,V.B):oa(V):ra(V,V.v)}function oa(V){setTimeout(c(function(){la(this)},V),50)}function ra(V,ia){setTimeout(c(function(){g(this.g.a);g(this.h.a);g(this.j.a);g(this.o.a);ia(this.a)},V),0)}function Ba(V,ia,za){this.c=V;this.a=ia;this.f=0;this.o=this.j=!1;this.s=za}function ma(V){0==--V.f&&
V.j&&(V.o?(V=V.a,V.g&&h(V.f,[V.a.c("wf","active")],[V.a.c("wf","loading"),V.a.c("wf","inactive")]),A(V,"active")):z(V.a))}function Ga(V){this.j=V;this.a=new y;this.h=0;this.f=this.g=!0}function aa(V,ia,za,ua,Ea){var Na=0==--V.h;(V.f||V.g)&&setTimeout(function(){var ea=Ea||null,ba=ua||{};if(0===za.length&&Na)z(ia.a);else{ia.f+=za.length;Na&&(ia.j=Na);var Qa,Oa=[];for(Qa=0;Qa<za.length;Qa++){var Sa=za[Qa],db=ba[Sa.c],fb=ia.a,Ra=Sa;fb.g&&h(fb.f,[fb.a.c("wf",Ra.c,J(Ra).toString(),"loading")]);A(fb,"fontloading",
Ra);fb=null;null===wa&&(wa=window.FontFace?(Ra=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(Ra[1],10):!0:!1);wa?fb=new O(c(ia.g,ia),c(ia.h,ia),ia.c,Sa,ia.s,db):fb=new Y(c(ia.g,ia),c(ia.h,ia),ia.c,Sa,ia.s,ea,db);Oa.push(fb)}for(Qa=0;Qa<Oa.length;Qa++)Oa[Qa].start()}},0)}function S(V,ia,za){var ua=[],Ea=za.timeout;M(ia);ua=E(V.a,za,V.c);var Na=new Ba(V.c,ia,Ea);V.h=ua.length;ia=0;for(za=ua.length;ia<za;ia++)ua[ia].load(function(ea,ba,Qa){aa(V,Na,ea,ba,Qa)})}function R(V,ia){this.c=
V;this.a=ia}function Z(V,ia,za){var ua=q(V.c);V=(V.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return ua+"//"+V+"/"+ia+".js"+(za?"?v="+za:"")}function ca(V,ia){this.c=V;this.a=ia}function na(V,ia,za){V?this.c=V:this.c=ia+Ha;this.a=[];this.f=[];this.g=za||""}function Aa(V,ia){for(var za=ia.length,ua=0;ua<za;ua++){var Ea=ia[ua].split(":");3==Ea.length&&V.f.push(Ea.pop());var Na="";2==Ea.length&&""!=Ea[1]&&(Na=":");V.a.push(Ea.join(Na))}}function Ca(V){if(0==V.a.length)throw Error("No fonts to load!");
if(-1!=V.c.indexOf("kit="))return V.c;for(var ia=V.a.length,za=[],ua=0;ua<ia;ua++)za.push(V.a[ua].replace(/ /g,"+"));ia=V.c+"?family="+za.join("%7C");0<V.f.length&&(ia+="&subset="+V.f.join(","));0<V.g.length&&(ia+="&text="+encodeURIComponent(V.g));return ia}function qa(V){this.f=V;this.a=[];this.c={}}function fa(V){for(var ia=V.f.length,za=0;za<ia;za++){var ua=V.f[za].split(":"),Ea=ua[0].replace(/\+/g," "),Na=["n4"];if(2<=ua.length){var ea=ua[1];var ba=[];if(ea){ea=ea.split(",");for(var Qa=ea.length,
Oa=0;Oa<Qa;Oa++){var Sa=ea[Oa];if(Sa.match(/^[\w-]+$/)){var db=gb.exec(Sa.toLowerCase());if(null==db)Sa="";else{Sa=db[2];Sa=null==Sa||""==Sa?"n":Ka[Sa];db=db[1];if(null==db||""==db)db="4";else{var fb=Xa[db];db=fb?fb:isNaN(db)?"4":db.substr(0,1)}Sa=[Sa,db].join("")}}else Sa="";Sa&&ba.push(Sa)}}0<ba.length&&(Na=ba);3==ua.length&&(ua=ua[2],ba=[],ua=ua?ua.split(","):ba,0<ua.length&&(ua=Ia[ua[0]])&&(V.c[Ea]=ua))}V.c[Ea]||(ua=Ia[Ea])&&(V.c[Ea]=ua);for(ua=0;ua<Na.length;ua+=1)V.a.push(new B(Ea,Na[ua]))}}
function va(V,ia){this.c=V;this.a=ia}function sa(V,ia){this.c=V;this.a=ia}function Fa(V,ia){this.c=V;this.f=ia;this.a=[]}var Ta=Date.now||function(){return+new Date},U=!!window.FontFace;t.prototype.c=function(V){for(var ia=[],za=0;za<arguments.length;za++)ia.push(arguments[za].replace(/[\W_]+/g,"").toLowerCase());return ia.join(this.a)};O.prototype.start=function(){var V=this.c.m.document,ia=this,za=Ta(),ua=new Promise(function(Na,ea){function ba(){Ta()-za>=ia.f?ea():V.fonts.load(D(ia.a),ia.h).then(function(Qa){1<=
Qa.length?Na():setTimeout(ba,25)},function(){ea()})}ba()}),Ea=new Promise(function(Na,ea){setTimeout(ea,ia.f)});Promise.race([Ea,ua]).then(function(){ia.g(ia.a)},function(){ia.j(ia.a)})};var pa={D:"serif",C:"sans-serif"},Da=null;Y.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=Ta();la(this)};var wa=null;Ba.prototype.g=function(V){var ia=this.a;ia.g&&h(ia.f,[ia.a.c("wf",V.c,J(V).toString(),"active")],[ia.a.c("wf",V.c,J(V).toString(),"loading"),
ia.a.c("wf",V.c,J(V).toString(),"inactive")]);A(ia,"fontactive",V);this.o=!0;ma(this)};Ba.prototype.h=function(V){var ia=this.a;if(ia.g){var za=k(ia.f,ia.a.c("wf",V.c,J(V).toString(),"active")),ua=[],Ea=[ia.a.c("wf",V.c,J(V).toString(),"loading")];za||ua.push(ia.a.c("wf",V.c,J(V).toString(),"inactive"));h(ia.f,ua,Ea)}A(ia,"fontinactive",V);ma(this)};Ga.prototype.load=function(V){this.c=new d(this.j,V.context||this.j);this.g=!1!==V.events;this.f=!1!==V.classes;S(this,new T(this.c,V),V)};R.prototype.load=
function(V){function ia(){if(Na["__mti_fntLst"+ua]){var ea=Na["__mti_fntLst"+ua](),ba=[],Qa;if(ea)for(var Oa=0;Oa<ea.length;Oa++){var Sa=ea[Oa].fontfamily;void 0!=ea[Oa].fontStyle&&void 0!=ea[Oa].fontWeight?(Qa=ea[Oa].fontStyle+ea[Oa].fontWeight,ba.push(new B(Sa,Qa))):ba.push(new B(Sa))}V(ba)}else setTimeout(function(){ia()},50)}var za=this,ua=za.a.projectId,Ea=za.a.version;if(ua){var Na=za.c.m;n(this.c,Z(za,ua,Ea),function(ea){ea?V([]):(Na["__MonotypeConfiguration__"+ua]=function(){return za.a},
ia())}).id="__MonotypeAPIScript__"+ua}else V([])};ca.prototype.load=function(V){var ia,za=this.a.urls||[],ua=this.a.families||[],Ea=this.a.testStrings||{},Na=new m;var ea=0;for(ia=za.length;ea<ia;ea++)r(this.c,za[ea],l(Na));var ba=[];ea=0;for(ia=ua.length;ea<ia;ea++)if(za=ua[ea].split(":"),za[1])for(var Qa=za[1].split(","),Oa=0;Oa<Qa.length;Oa+=1)ba.push(new B(za[0],Qa[Oa]));else ba.push(new B(za[0]));u(Na,function(){V(ba,Ea)})};var Ha="//fonts.googleapis.com/css",Ia={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",
cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},Xa={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ka={i:"i",italic:"i",n:"n",normal:"n"},gb=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,
bb={Arimo:!0,Cousine:!0,Tinos:!0};va.prototype.load=function(V){var ia=new m,za=this.c,ua=new na(this.a.api,q(za),this.a.text),Ea=this.a.families;Aa(ua,Ea);var Na=new qa(Ea);fa(Na);r(za,Ca(ua),l(ia));u(ia,function(){V(Na.a,Na.c,bb)})};sa.prototype.load=function(V){var ia=this.a.id,za=this.c.m;ia?n(this.c,(this.a.api||"https://use.typekit.net")+"/"+ia+".js",function(ua){if(ua)V([]);else if(za.Typekit&&za.Typekit.config&&za.Typekit.config.fn){ua=za.Typekit.config.fn;for(var Ea=[],Na=0;Na<ua.length;Na+=
2)for(var ea=ua[Na],ba=ua[Na+1],Qa=0;Qa<ba.length;Qa++)Ea.push(new B(ea,ba[Qa]));try{za.Typekit.load({events:!1,classes:!1,async:!0})}catch(Oa){}V(Ea)}},2E3):V([])};Fa.prototype.load=function(V){var ia=this.f.id,za=this.c.m,ua=this;ia?(za.__webfontfontdeckmodule__||(za.__webfontfontdeckmodule__={}),za.__webfontfontdeckmodule__[ia]=function(Ea,Na){Ea=0;for(var ea=Na.fonts.length;Ea<ea;++Ea){var ba=Na.fonts[Ea],Qa=ua.a,Oa=Qa.push,Sa=ba.name;ba="font-weight:"+ba.weight+";font-style:"+ba.style;var db=
4,fb="n",Ra=null;ba&&((Ra=ba.match(/(normal|oblique|italic)/i))&&Ra[1]&&(fb=Ra[1].substr(0,1).toLowerCase()),(Ra=ba.match(/([1-9]00|normal|bold)/i))&&Ra[1]&&(/bold/i.test(Ra[1])?db=7:/[1-9]00/.test(Ra[1])&&(db=parseInt(Ra[1].substr(0,1),10))));Oa.call(Qa,new B(Sa,fb+db))}V(ua.a)},n(this.c,q(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+p(this.c)+"/"+ia+".js",function(Ea){Ea&&V([])})):V([])};var eb=new Ga(window);eb.a.c.custom=function(V,ia){return new ca(ia,V)};eb.a.c.fontdeck=function(V,ia){return new Fa(ia,
V)};eb.a.c.monotype=function(V,ia){return new R(ia,V)};eb.a.c.typekit=function(V,ia){return new sa(ia,V)};eb.a.c.google=function(V,ia){return new va(ia,V)};var ib={load:c(eb.load,eb)};"function"===typeof define&&define.amd?define(function(){return ib}):"undefined"!==typeof module&&module.exports?module.exports=ib:(window.WebFont=ib,window.WebFontConfig&&eb.load(window.WebFontConfig))})();var THREE={REVISION:"71"};"object"===typeof module&&(module.exports=THREE);void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});THREE.log=function(){console.log.apply(console,arguments)};THREE.warn=function(){console.warn.apply(console,arguments)};THREE.error=function(){console.error.apply(console,arguments)};THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;
THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;
THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;
THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(e,f,g){0>g&&(g+=1);1<g&&--g;return g<1/6?e+6*(f-e)*g:
.5>g?f:g<2/3?e+6*(f-e)*(2/3-g):e};b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;this.r=d(c,b,a+1/3);this.g=d(c,b,a);this.b=d(c,b,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))return a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this;if(/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.test(a))return a=/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.exec(a),this.r=Math.min(100,
parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this;if(/^#([0-9a-f]{6})$/i.test(a))return a=/^#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this;if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return a=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this;if(/^(\w+)$/i.test(a))return this.setHex(THREE.ColorKeywords[a]),this},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;
return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);
return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=(f+e)/2;if(f===e)f=g=0;else{var k=e-f;f=.5>=h?k/(e+f):k/(2-e-f);switch(e){case b:g=(c-d)/k+(c<d?6:0);break;case c:g=(d-b)/k+2;break;case d:g=(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+
","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,
b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;
this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2);"XYZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=
c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===a.order&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,
b){b/=2;var c=Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],k=b[6];b=b[10];var q=c+f+b;0<q?(c=.5/Math.sqrt(q+1),this._w=.25/c,this._x=(k-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=
.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z;a=a._w;var f=b._x,g=b._y,h=b._z;b=b._w;this._x=c*b+a*f+d*h-e*g;this._y=d*b+a*g+e*f-c*h;this._z=e*b+a*h+c*g-d*f;this._w=a*b-c*f-d*g-e*h;this.onChangeCallback();return this},multiplyVector3:function(a){THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;a=Math.acos(g);var h=Math.sqrt(1-g*g);if(.001>Math.abs(h))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;g=Math.sin((1-b)*a)/h;b=
Math.sin(b*a)/h;this._w=f*g+this._w*b;this._x=c*g+this._x*b;this._y=d*g+this._y*b;this._z=e*g+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,
b){if(void 0!==b)return THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},
subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);
this.y<a.y&&(this.y=a.y);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=
Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},
distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===
a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=
a;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,
c));return this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*
c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,q=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-q*-f;this.y=k*a+b*-f+q*-e-h*-g;this.z=q*a+b*-g+h*-f-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),
unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=
a):this.z=this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,
b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):
Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);b=this.x;var c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=
d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new THREE.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;
return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setEulerFromRotationMatrix:function(a,b){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},
setEulerFromQuaternion:function(a,b){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,
b){THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;
return this},setFromMatrixColumn:function(a,b){a*=4;b=b.elements;this.x=b[a];this.y=b[a+1];this.z=b[a+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+
2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=
a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>
b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],e=a[1],f=a[5],g=a[9];var h=a[2];var k=a[6];var q=a[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-h)&&.01>Math.abs(g-k)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+h)&&.1>Math.abs(g+k)&&.1>Math.abs(b+f+q-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;f=(f+1)/2;q=(q+1)/2;c=(c+e)/4;d=(d+h)/4;g=(g+k)/4;b>f&&b>q?.01>b?(k=0,c=h=.707106781):
(k=Math.sqrt(b),h=c/k,c=d/k):f>q?.01>f?(k=.707106781,h=0,c=.707106781):(h=Math.sqrt(f),k=c/h,c=g/h):.01>q?(h=k=.707106781,c=0):(c=Math.sqrt(q),k=d/c,h=g/c);this.set(k,h,c,a);return this}a=Math.sqrt((k-g)*(k-g)+(d-h)*(d-h)+(e-c)*(e-c));.001>Math.abs(a)&&(a=1);this.x=(k-g)/a;this.y=(d-h)/a;this.z=(e-c)/a;this.w=Math.acos((b+f+q-1)/2);return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&
(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},
fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};
THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(a){this._x=
a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],k=e[5],q=e[9],p=e[2],r=e[6];e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-q,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(r,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(q,-1,1)),.99999>Math.abs(q)?(this._y=Math.atan2(g,e),this._z=Math.atan2(h,
k)):(this._y=Math.atan2(-p,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(r,-1,1)),.99999>Math.abs(r)?(this._y=Math.atan2(-p,e),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===b?(this._y=Math.asin(-d(p,-1,1)),.99999>Math.abs(p)?(this._x=Math.atan2(r,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,k))):"YZX"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-q,k),this._y=Math.atan2(-p,a)):(this._x=0,this._y=Math.atan2(g,e))):"XZY"===b?(this._z=
Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(r,k),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-q,e),this._y=0)):THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);this.setFromRotationMatrix(a,c,d);return this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,
b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?
a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,
b){b=b||new THREE.Vector3;return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);c=b.dot(b);c=b.dot(a)/c;d&&(c=THREE.Math.clamp(c,0,1));return c}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);
this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,
this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&
this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,
this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};
THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},
center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<
this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<
this.min.z||a.min.z>this.max.z?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);
this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);
a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};
THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,k){var q=this.elements;q[0]=a;q[3]=b;q[6]=c;q[1]=d;q[4]=e;q[7]=f;q[2]=g;q[5]=h;q[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},
multiplyVector3Array:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=
a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7];a=a[8];return b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getInverse:function(a,b){a=a.elements;var c=this.elements;c[0]=a[10]*a[5]-a[6]*a[9];c[1]=-a[10]*a[1]+a[2]*a[9];c[2]=a[6]*a[1]-a[2]*a[5];c[3]=-a[10]*a[4]+a[6]*a[8];c[4]=a[10]*a[0]-a[2]*a[8];c[5]=-a[6]*a[0]+a[2]*a[4];c[6]=a[9]*a[4]-a[5]*a[8];c[7]=-a[9]*a[0]+a[1]*a[8];c[8]=a[5]*a[0]-a[1]*a[4];
a=a[0]*c[0]+a[1]*c[3]+a[2]*c[6];if(0===a){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");THREE.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/a);return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];
a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};
THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,k,q,p,r,n,m,l,u){var v=this.elements;v[0]=a;v[4]=b;v[8]=c;v[12]=d;v[1]=e;v[5]=f;v[9]=g;v[13]=h;v[2]=k;v[6]=q;v[10]=p;v[14]=r;v[3]=n;v[7]=m;v[11]=l;v[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},
copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){var d=this.elements;a.set(d[0],d[1],d[2]);b.set(d[4],d[5],d[6]);c.set(d[8],d[9],d[10]);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a=new THREE.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),
f=1/a.set(b[8],b[9],b[10]).length();c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*e;c[5]=b[5]*e;c[6]=b[6]*e;c[8]=b[8]*f;c[9]=b[9]*f;c[10]=b[10]*f;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);if("XYZ"===a.order){a=f*h;var k=
f*e,q=c*h,p=c*e;b[0]=g*h;b[4]=-g*e;b[8]=d;b[1]=k+q*d;b[5]=a-p*d;b[9]=-c*g;b[2]=p-a*d;b[6]=q+k*d;b[10]=f*g}else"YXZ"===a.order?(a=g*h,k=g*e,q=d*h,p=d*e,b[0]=a+p*c,b[4]=q*c-k,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-q,b[6]=p+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*h,k=g*e,q=d*h,p=d*e,b[0]=a-p*c,b[4]=-f*e,b[8]=q+k*c,b[1]=k+q*c,b[5]=f*h,b[9]=p-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*h,k=f*e,q=c*h,p=c*e,b[0]=g*h,b[4]=q*d-k,b[8]=a*d+p,b[1]=g*e,b[5]=p*d+a,b[9]=k*d-q,b[2]=-d,b[6]=c*g,b[10]=f*
g):"YZX"===a.order?(a=f*g,k=f*d,q=c*g,p=c*d,b[0]=g*h,b[4]=p-a*e,b[8]=q*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+q,b[10]=a-p*e):"XZY"===a.order&&(a=f*g,k=f*d,q=c*g,p=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+p,b[5]=f*h,b[9]=k*e-q,b[2]=q*e-k,b[6]=c*h,b[10]=p*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},setRotationFromQuaternion:function(a){THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},
makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,k=e+e;a=c*g;var q=c*h;c*=k;var p=d*h;d*=k;e*=k;g*=f;h*=f;f*=k;b[0]=1-(p+e);b[4]=q-f;b[8]=c+h;b[1]=q+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+p);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f){var g=this.elements;c.subVectors(d,e).normalize();0===c.length()&&(c.z=1);a.crossVectors(f,
c).normalize();0===a.length()&&(c.x+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],f=
c[8],g=c[12],h=c[1],k=c[5],q=c[9],p=c[13],r=c[2],n=c[6],m=c[10],l=c[14],u=c[3],v=c[7],t=c[11];c=c[15];var B=d[0],D=d[4],I=d[8],J=d[12],Q=d[1],T=d[5],M=d[9],z=d[13],A=d[2],y=d[6],E=d[10],K=d[14],H=d[3],G=d[7],O=d[11];d=d[15];b[0]=a*B+e*Q+f*A+g*H;b[4]=a*D+e*T+f*y+g*G;b[8]=a*I+e*M+f*E+g*O;b[12]=a*J+e*z+f*K+g*d;b[1]=h*B+k*Q+q*A+p*H;b[5]=h*D+k*T+q*y+p*G;b[9]=h*I+k*M+q*E+p*O;b[13]=h*J+k*z+q*K+p*d;b[2]=r*B+n*Q+m*A+l*H;b[6]=r*D+n*T+m*y+l*G;b[10]=r*I+n*M+m*E+l*O;b[14]=r*J+n*z+m*K+l*d;b[3]=u*B+v*Q+t*A+c*H;
b[7]=u*D+v*T+t*y+c*G;b[11]=u*I+v*M+t*E+c*O;b[15]=u*J+v*z+t*K+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=
a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],k=a[13],q=a[2],p=a[6],r=a[10],n=a[14];return a[3]*(+e*h*p-d*k*p-e*g*r+c*k*r+d*g*n-c*h*n)+a[7]*(+b*h*n-b*k*r+e*f*r-d*f*n+d*k*q-e*h*q)+a[11]*(+b*k*p-b*g*n-e*f*p+c*f*n+e*g*q-c*k*q)+a[15]*(-d*g*q-b*h*p+b*g*r+d*f*p-c*f*r+c*h*q)},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=
a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");
var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements;a=d[0];var e=d[4],f=d[8],g=d[12],h=d[1],k=d[5],q=d[9],p=d[13],r=d[2],n=d[6],m=d[10],l=d[14],u=d[3],v=d[7],t=d[11];d=d[15];c[0]=q*l*v-p*m*v+p*n*t-k*l*t-q*n*d+k*m*d;c[4]=g*m*v-f*l*v-g*n*t+e*l*t+f*n*d-e*m*d;c[8]=f*p*v-g*q*v+g*k*t-e*p*t-f*k*d+e*q*d;c[12]=g*q*n-f*p*n-g*k*m+e*p*m+f*k*l-e*q*l;c[1]=p*m*u-q*
l*u-p*r*t+h*l*t+q*r*d-h*m*d;c[5]=f*l*u-g*m*u+g*r*t-a*l*t-f*r*d+a*m*d;c[9]=g*q*u-f*p*u-g*h*t+a*p*t+f*h*d-a*q*d;c[13]=f*p*r-g*q*r+g*h*m-a*p*m-f*h*l+a*q*l;c[2]=k*l*u-p*n*u+p*r*v-h*l*v-k*r*d+h*n*d;c[6]=g*n*u-e*l*u-g*r*v+a*l*v+e*r*d-a*n*d;c[10]=e*p*u-g*k*u+g*h*v-a*p*v-e*h*d+a*k*d;c[14]=g*k*r-e*p*r-g*h*n+a*p*n+e*h*l-a*k*l;c[3]=q*n*u-k*m*u-q*r*v+h*m*v+k*r*t-h*n*t;c[7]=e*m*u-f*n*u+f*r*v-a*m*v-e*r*t+a*n*t;c[11]=f*k*u-e*q*u-f*h*v+a*q*v+e*h*t-a*k*t;c[15]=e*q*r-f*k*r+f*h*n-a*q*n-e*h*m+a*k*m;c=a*c[0]+h*c[4]+r*
c[8]+u*c[12];if(0==c){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");THREE.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(a){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(a,b){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,
c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=a.x,f=a.y;a=a.z;var g=d*e,h=d*f;this.set(g*e+c,g*f-b*a,g*a+b*
f,0,g*f+b*a,h*f+c,h*a-b*e,0,g*a-b*f,h*a+b*e,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new THREE.Vector3,b=new THREE.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=
f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;f=1/h;var q=1/k;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=q;b.elements[9]*=q;b.elements[10]*=q;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=
0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.degToRad(.5*a));var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,k=c-d,q=f-e;g[0]=2/h;g[4]=0;g[8]=0;g[12]=-((b+a)/h);g[1]=0;g[5]=2/k;g[9]=0;g[13]=-((c+d)/k);g[2]=0;g[6]=0;g[10]=-2/q;g[14]=-((f+e)/q);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],
a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};
THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var k=b.dot(b);g=b.dot(c);var q=d*k-e*e;h=h||new THREE.Vector3;if(0==q)return h.set(-2,-1,-1);q=1/q;k=(k*f-e*g)*q;d=(d*g-e*f)*q;return h.set(1-k-d,d,k)}}();
THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||
new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},
clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){b=b||new THREE.Vector3;b.subVectors(a,this.origin);
a=b.dot(this.direction);return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);
b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),k=-this.direction.dot(b),q=c.dot(this.direction),p=-c.dot(b),r=c.lengthSq(),n=Math.abs(1-k*k);if(0<n){d=k*p-q;e=k*q-p;var m=h*n;0<=d?e>=-m?e<=m?(h=1/n,d*=h,e*=h,k=d*(d+k*e+2*q)+e*(k*d+e+2*p)+r):(e=h,d=Math.max(0,-(k*e+q)),k=-d*d+e*(e+2*p)+r):(e=-h,d=Math.max(0,-(k*e+q)),k=-d*d+e*(e+2*p)+r):e<=-m?(d=Math.max(0,-(-k*h+q)),e=0<d?-h:Math.min(Math.max(-h,-p),h),k=-d*d+e*(e+2*p)+r):e<=m?(d=0,e=Math.min(Math.max(-h,-p),h),k=
e*(e+2*p)+r):(d=Math.max(0,-(k*h+q)),e=0<d?h:Math.min(Math.max(-h,-p),h),k=-d*d+e*(e+2*p)+r)}else e=0<k?-h:h,d=Math.max(0,-(k*e+q)),k=-d*d+e*(e+2*p)+r;f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return k}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},intersectSphere:function(){var a=new THREE.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d;b=b.radius*
b.radius;if(e>b)return null;b=Math.sqrt(b-e);e=d-b;d+=b;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,
b)},isIntersectionBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a.min.x-f.x)*c;c*=a.max.x-f.x}else g=(a.max.x-f.x)*c,c*=a.min.x-f.x;if(0<=d){var h=(a.min.y-f.y)*d;d*=a.max.y-f.y}else h=(a.max.y-f.y)*d,d*=a.min.y-f.y;if(g>d||h>c)return null;if(h>g||g!==g)g=h;if(d<c||c!==c)c=d;0<=e?(h=(a.min.z-f.z)*e,a=(a.max.z-f.z)*
e):(h=(a.max.z-f.z)*e,a=(a.min.z-f.z)*e);if(g>a||h>c)return null;if(h>g||g!==g)g=h;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=g?g:c,b)},intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h,k){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>
e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};
THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=c=0,f=b.length;e<f;e++)c=Math.max(c,d.distanceToSquared(b[e]));this.radius=Math.sqrt(c);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);b=b||new THREE.Vector3;b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,
c);return this}}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,
b){a=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(a)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){c=c||new THREE.Vector3;var d=b.delta(a),e=this.normal.dot(d);if(0==e){if(0==this.distanceToPoint(b.start))return c.copy(b.start)}else if(e=-(b.start.dot(this.normal)+this.constant)/e,!(0>e||1<e))return c.copy(d).multiplyScalar(e).add(b.start)}}(),
coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(d,e){e=e||c.getNormalMatrix(d);e=a.copy(this.normal).applyMatrix3(e);var f=this.coplanarPoint(b);f.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(e,f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&
a.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};
THREE.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?b[e]="-":14==e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19==e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=
b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return Math.floor(this.randFloat(a,b))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=
180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();
a=.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};
THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&
c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}};
THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.name="";this.parent=void 0;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},
scale:{enumerable:!0,value:d}});this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);
THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=
new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);
this.position.add(a.multiplyScalar(c));return this}}(),translate:function(a,b){THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,
b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",
a),this;a instanceof THREE.Object3D?(void 0!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getChildByName:function(a){THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
return this.getObjectByName(a)},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=
new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,
b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverseVisible(a)}},traverseAncestors:function(a){this.parent&&(a(this.parent),
this.parent.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},
clone:function(a,b){void 0===a&&(a=new THREE.Object3D);void 0===b&&(b=!0);a.name=this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=
this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(!0===b)for(b=0;b<this.children.length;b++)a.add(this.children[b].clone());return a}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;
THREE.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=void 0!==f?f:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.materialIndex=this.materialIndex;for(var b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();b=0;for(c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();b=0;for(c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};
THREE.BufferAttribute=function(a,b){this.array=a;this.itemSize=b;this.needsUpdate=!1};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},setX:function(a,b){this.array[a*this.itemSize]=b;return this},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},setXY:function(a,
b,c){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};
THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.name="";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,b){this.attributes[a]=b;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),
b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(a));return a},computeBoundingBox:function(){var a=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var b=this.attributes.position.array;if(b){var c=this.boundingBox;c.makeEmpty();for(var d=0,e=b.length;d<
e;d+=3)a.set(b[d],b[d+1],b[d+2]),c.expandByPoint(a)}if(void 0===b||0===b.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&
(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;if(c){a.makeEmpty();for(var d=this.boundingSphere.center,e=0,f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),a.expandByPoint(b);a.center(d);var g=0;e=0;for(f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),g=Math.max(g,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(g);isNaN(this.boundingSphere.radius)&&THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),
computeVertexNormals:function(){var a=this.attributes;if(a.position){var b=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(b.length),3));else for(var c=a.normal.array,d=0,e=c.length;d<e;d++)c[d]=0;c=a.normal.array;var f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,q=new THREE.Vector3;if(a.index)for(var p=a.index.array,r=0<this.offsets.length?this.offsets:[{start:0,count:p.length,index:0}],n=0,m=r.length;n<
m;++n){e=r[n].start;var l=r[n].count;var u=r[n].index;d=e;for(e+=l;d<e;d+=3){l=3*(u+p[d]);var v=3*(u+p[d+1]);var t=3*(u+p[d+2]);f.fromArray(b,l);g.fromArray(b,v);h.fromArray(b,t);k.subVectors(h,g);q.subVectors(f,g);k.cross(q);c[l]+=k.x;c[l+1]+=k.y;c[l+2]+=k.z;c[v]+=k.x;c[v+1]+=k.y;c[v+2]+=k.z;c[t]+=k.x;c[t+1]+=k.y;c[t+2]+=k.z}}else for(d=0,e=b.length;d<e;d+=9)f.fromArray(b,d),g.fromArray(b,d+3),h.fromArray(b,d+6),k.subVectors(h,g),q.subVectors(f,g),k.cross(q),c[d]=k.x,c[d+1]=k.y,c[d+2]=k.z,c[d+3]=
k.x,c[d+4]=k.y,c[d+5]=k.z,c[d+6]=k.x,c[d+7]=k.y,c[d+8]=k.z;this.normalizeNormals();a.normal.needsUpdate=!0}},computeTangents:function(){function a(R,Z,ca){r.fromArray(d,3*R);n.fromArray(d,3*Z);m.fromArray(d,3*ca);l.fromArray(f,2*R);u.fromArray(f,2*Z);v.fromArray(f,2*ca);t=n.x-r.x;B=m.x-r.x;D=n.y-r.y;I=m.y-r.y;J=n.z-r.z;Q=m.z-r.z;T=u.x-l.x;M=v.x-l.x;z=u.y-l.y;A=v.y-l.y;y=1/(T*A-M*z);E.set((A*t-z*B)*y,(A*D-z*I)*y,(A*J-z*Q)*y);K.set((T*B-M*t)*y,(T*I-M*D)*y,(T*Q-M*J)*y);k[R].add(E);k[Z].add(E);k[ca].add(E);
q[R].add(K);q[Z].add(K);q[ca].add(K)}function b(R){Ba.fromArray(e,3*R);ma.copy(Ba);aa=k[R];oa.copy(aa);oa.sub(Ba.multiplyScalar(Ba.dot(aa))).normalize();ra.crossVectors(ma,aa);S=ra.dot(q[R]);Ga=0>S?-1:1;h[4*R]=oa.x;h[4*R+1]=oa.y;h[4*R+2]=oa.z;h[4*R+3]=Ga}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");
else{var c=this.attributes.index.array,d=this.attributes.position.array,e=this.attributes.normal.array,f=this.attributes.uv.array,g=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*g),4));for(var h=this.attributes.tangent.array,k=[],q=[],p=0;p<g;p++)k[p]=new THREE.Vector3,q[p]=new THREE.Vector3;var r=new THREE.Vector3,n=new THREE.Vector3,m=new THREE.Vector3,l=new THREE.Vector2,u=new THREE.Vector2,v=new THREE.Vector2,t,B,D,I,J,Q,
T,M,z,A,y,E=new THREE.Vector3,K=new THREE.Vector3,H;0===this.drawcalls.length&&this.addDrawCall(0,c.length,0);var G=this.drawcalls;p=0;for(H=G.length;p<H;++p){var O=G[p].start;var Y=G[p].count;var W=G[p].index;g=O;for(O+=Y;g<O;g+=3){Y=W+c[g];var ka=W+c[g+1];var la=W+c[g+2];a(Y,ka,la)}}var oa=new THREE.Vector3,ra=new THREE.Vector3,Ba=new THREE.Vector3,ma=new THREE.Vector3,Ga,aa,S;p=0;for(H=G.length;p<H;++p)for(O=G[p].start,Y=G[p].count,W=G[p].index,g=O,O+=Y;g<O;g+=3)Y=W+c[g],ka=W+c[g+1],la=W+c[g+2],
b(Y),b(ka),b(la)}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},clone:function(){var a=new THREE.BufferGeometry;for(b in this.attributes)a.addAttribute(b,this.attributes[b].clone());var b=0;for(var c=this.offsets.length;b<c;b++){var d=this.offsets[b];a.offsets.push({start:d.start,index:d.index,count:d.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();
THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(a){void 0===a&&(a=new THREE.Camera);THREE.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a};
THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.zoom=1;this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=f;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight;a=Math.tan(THREE.Math.degToRad(.5*a))*this.near;var c=-a,d=b*c;b=Math.abs(b*a-d);c=Math.abs(a-c);this.projectionMatrix.makeFrustum(d+this.x*b/this.fullWidth,d+(this.x+this.width)*b/this.fullWidth,a-(this.y+this.height)*c/this.fullHeight,a-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,
this.aspect,this.near,this.far)};THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this);this.zoom=1;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()};
THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)};
THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};
THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;
THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.clone=function(a,b){void 0===a&&(a=new THREE.Mesh(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,a,b);return a};THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=null;this.autoUpdate=!0};
THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(a){void 0===a&&(a=new THREE.Scene);THREE.Object3D.prototype.clone.call(this,a);null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone());a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};
THREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];b[c][d]=e&&void 0!==e.clone?e.clone():e instanceof Array?e.slice():e}}return b}};
THREE.BoxBufferGeometry=function(a,b,c,d,e,f){function g(n,m,l,u,v,t,B,D,I,J){var Q=t/I,T=B/J,M=t/2,z=B/2,A=D/2;B=I+1;var y=J+1;t=0;var E,K,H=new THREE.Vector3;for(K=0;K<y;K++){var G=K*T-z;for(E=0;E<B;E++)H[n]=(E*Q-M)*u,H[m]=G*v,H[l]=A,k.push(H.x,H.y,H.z),H[n]=0,H[m]=0,H[l]=0<D?1:-1,q.push(H.x,H.y,H.z),p.push(E/I),p.push(1-K/J),t+=1}for(K=0;K<J;K++)for(E=0;E<I;E++)n=r+E+B*(K+1),m=r+(E+1)+B*(K+1),l=r+(E+1)+B*K,h.push(r+E+B*K,n,l),h.push(n,m,l);r+=t}THREE.BufferGeometry.call(this);this.parameters={width:a,
height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var h=[],k=[],q=[],p=[],r=0;g("z","y","x",-1,-1,c,b,a,f,e);g("z","y","x",1,-1,c,b,-a,f,e);g("x","z","y",1,1,a,c,b,d,f);g("x","z","y",1,-1,a,c,-b,d,f);g("x","y","z",1,-1,a,b,c,d,e);g("x","y","z",-1,-1,a,b,-c,d,e);console.assert(65536>=k.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(h),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(k),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(q),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(p),2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;
THREE.SphereBufferGeometry=function(a,b,c,d,e,f,g){THREE.BufferGeometry.call(this);this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var h=f+g,k,q,p=0,r=[],n=new THREE.Vector3,m=new THREE.Vector3,l=[],u=[],v=[],t=[];for(q=0;q<=c;q++){var B=[],D=q/c;for(k=0;k<=b;k++){var I=k/b;n.x=-a*Math.cos(d+
I*e)*Math.sin(f+D*g);n.y=a*Math.cos(f+D*g);n.z=a*Math.sin(d+I*e)*Math.sin(f+D*g);u.push(n.x,n.y,n.z);m.set(n.x,n.y,n.z).normalize();v.push(m.x,m.y,m.z);t.push(I,1-D);B.push(p++)}r.push(B)}for(q=0;q<c;q++)for(k=0;k<b;k++)a=r[q][k+1],d=r[q][k],e=r[q+1][k],g=r[q+1][k+1],(0!==q||0<f)&&l.push(a,d,g),(q!==c-1||h<Math.PI)&&l.push(d,e,g);console.assert(65536>=u.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(l),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(u),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(v),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(t),2))};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;
THREE.PlaneBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=c||1;d=d||1;var g=c+1,h=d+1,k=a/c,q=b/d;b=new Float32Array(g*h*3);a=new Float32Array(g*h*3);for(var p=new Float32Array(g*h*2),r=0,n=0,m=0;m<h;m++)for(var l=m*q-f,u=0;u<g;u++)b[r]=u*k-e,b[r+1]=-l,a[r+2]=1,p[n]=u/c,p[n+1]=1-m/d,r+=3,n+=2;r=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(m=0;m<d;m++)for(u=
0;u<c;u++)f=u+g*(m+1),h=u+1+g*(m+1),k=u+1+g*m,e[r]=u+g*m,e[r+1]=f,e[r+2]=k,e[r+3]=f,e[r+4]=h,e[r+5]=k,r+=6;this.addAttribute("index",new THREE.BufferAttribute(e,1));this.addAttribute("position",new THREE.BufferAttribute(b,3));this.addAttribute("normal",new THREE.BufferAttribute(a,3));this.addAttribute("uv",new THREE.BufferAttribute(p,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;
THREE.CylinderBufferGeometry=function(a,b,c,d,e,f,g,h){function k(v){var t,B=new THREE.Vector2,D=new THREE.Vector3,I=!0===v?a:b,J=!0===v?1:-1;var Q=m;for(t=1;t<=d;t++)p.push(0,u*J,0),r.push(0,J,0),n.push(.5,.5),m++;var T=m;for(t=0;t<=d;t++){var M=t/d*h+g,z=Math.cos(M);M=Math.sin(M);D.x=I*M;D.y=u*J;D.z=I*z;p.push(D.x,D.y,D.z);r.push(0,J,0);B.x=.5*z+.5;B.y=.5*M*J+.5;n.push(B.x,B.y);m++}for(t=0;t<d;t++)B=Q+t,D=T+t,!0===v?q.push(D,D+1,B):q.push(D+1,D,B)}THREE.BufferGeometry.call(this);this.parameters=
{radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;var q=[],p=[],r=[],n=[],m=0,l=[],u=c/2;(function(){var v,t,B=new THREE.Vector3,D=new THREE.Vector3,I=(b-a)/c;for(t=0;t<=e;t++){var J=[],Q=t/e,T=Q*(b-a)+a;for(v=0;v<=d;v++){var M=v/d,z=M*h+g,A=Math.sin(z);z=Math.cos(z);D.x=T*A;D.y=-Q*c+u;
D.z=T*z;p.push(D.x,D.y,D.z);B.set(A,I,z).normalize();r.push(B.x,B.y,B.z);n.push(M,1-Q);J.push(m++)}l.push(J)}for(v=0;v<d;v++)for(t=0;t<e;t++)B=l[t+1][v],D=l[t+1][v+1],I=l[t][v+1],q.push(l[t][v],B,I),q.push(B,D,I)})();!1===f&&(0<a&&k(!0),0<b&&k(!1));console.assert(65536>=p.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(q),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(p),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(r),
3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(n),2))};THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;
THREE.TorusBufferGeometry=function(a,b,c,d,e){THREE.BufferGeometry.call(this);this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=[],g=[],h=[],k=[],q=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector3,n,m;for(n=0;n<=c;n++)for(m=0;m<=d;m++){var l=m/d*e,u=n/c*Math.PI*2;p.x=(a+b*Math.cos(u))*Math.cos(l);p.y=(a+b*Math.cos(u))*Math.sin(l);p.z=b*Math.sin(u);g.push(p.x,p.y,p.z);q.x=a*Math.cos(l);q.y=a*
Math.sin(l);r.subVectors(p,q).normalize();h.push(r.x,r.y,r.z);k.push(m/d);k.push(n/c)}for(n=1;n<=c;n++)for(m=1;m<=d;m++)a=(d+1)*(n-1)+m-1,b=(d+1)*(n-1)+m,e=(d+1)*n+m,f.push((d+1)*n+m-1,a,e),f.push(a,b,e);console.assert(65536>=g.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(f),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(g),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(h),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(k),
2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;(function(){function a(c){var d={};c&&c.substring(1).split("&").forEach(function(e){var f=e.indexOf("=");0<=f?d[e.substring(0,f)]=e.substring(f+1):d[e]=void 0});return d}function b(c){return c in a(window.location.hash)}window.WALK={EDIT_MODE:"editor"in a(window.location.search),NO_SCREENSHOTS:b("noscreenshots"),DEBUG:b("debug"),DEBUG_SHARED_BUFFERS:b("debugbuffers"),DEBUG_CAMERA_PATH:b("debugcamerapath"),ALWAYS_RENDER:!1,LOG_INFO:b("log")||b("savelog"),LOG_TO_SERVER:b("savelog"),LOG_TIME:!1,PROGRESSIVE_LOADER_AFTER_SEC:30,
CONTEXT_LOST_RESTORE_LIMIT:4,HEAD_LIGHT:!1,RETRIES_ON_LOAD_ERROR:3,DEFAULT_ANISOTROPY:4,NO_ANISOTROPY:1,FORCE_FXAA:!1,FORCE_WEBGL1:b("webgl1"),FONT_FAMILIES_TO_LOAD:[],MAX_TWO_POINTERS_IN_LINE_DIFF:40,CAMERA_WALK_NEAR:.01,CAMERA_ORBIT_NEAR_FROM_1M:.01,CAMERA_MIN_FAR:100,SKY_DISTANCE_TO_SCENE:100,CAMERA_DEFAULT_FOV:70,CAMERA_DEFAULT_MOVE_MAX_SPEED:1.11,CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:2,CAMERA_LOOK_SPEED:Math.PI/1500,CAMERA_ARROWS_TURN_SPEED:Math.PI/2,CAMERA_SCROLL_SPEED:.5,CAMERA_FULL_ACCELERATION_TIME:.5,
CAMERA_FULL_DECELERATION_TIME:.166,CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE:1,CAMERA_FIXED_HEIGHT:null,MAX_GROUND_SEARCH_DEPTH:5.5,MATERIAL_PICKER_BALL_MAX_SIZE:.1,COVER_JSON_URL:"./cover.json",AUTO_TOUR_IN_VIEW_STILL_TIME_MS:3E3,CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE:.7,CLICK_MOVE_SHOW_TARGET_INDICATOR:!b("nomovetarget"),KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE:.1,MIN_DISTANCE_TO_CEILING:.1,LIGHT_PROBE_MIRROR_SIZE:512,LIGHT_PROBE_MAX_MIP_SIZE:128,LIGHT_PROBE_MIN_MIP_SIZE:4,LIGHT_PROBE_GLOSS_FOR_MIP:[.99,.9,.85,
.7,.4,.25],DEBUG_LIGHT_PROBE_MIPS:!1,ENABLE_AUTO_EXPOSURE_CONTROLS:!1,EDITOR_COVER_WIDTH:1920,EDITOR_COVER_HEIGHT:1080,MAX_PANORAMA_SIZE:8192,OBJECT_VISIBILITY_TARGET_SIZE:128,DEFAULT_SKY_NAME:"default",EDITOR_CONTROLLED_SKY_NAME:"sky0",EDITOR_SELECTION_COLOR:(new THREE.Color(5021401)).convertGammaToLinear(),ALLOW_MOBILE_VR:!0,FALLBACK_CAMERA_HEIGHT:1.6,LOAD_PRIORITY:{CORE_RESOURCE:0,COLORMAP:1,UV0:1,DIFFUSE:2,LIGHTMAP:3,SKY:4,SPECULARITY:5,VIDEO:6},MERGE_TRANSPARENT_DISABLED:b("nomergetransparent"),
urlHashContains:b,urlHashGetArgument:function(c){var d=a(window.location.hash);return c in d&&void 0!==d[c]?decodeURI(d[c]):null},urlHashRemoveArgument:function(c){var d=a(window.location.hash);return Object.keys(d).filter(function(e){return e!==c}).map(function(e){var f=d[e];return e+(void 0===f?"":"="+f)}).join("&")},TELEPORT_TO_VIEW_MAX_TIME:3,TELEPORT_TO_POINT_MAX_TIME:4.5,TELEPORT_PATH_MAX_TIME:6,TELEPORT_TO_VIEW_ACCELERATION:4,TELEPORT_TO_POINT_ACCELERATION:2,TELEPORT_PATH_ACCELERATION:2,GAZE_POINTER_SHOW_LOADING_AFTER_S:2.5,
GAZE_POINTER_ACTIVATE_AFTER_S:4.5,SPRITE_ANCHOR_FONT_SIZE:128,POINTER_PRIORITY:{TRANSFORM_CONTROLS:1,EDITOR_SELECTOR:2,INTERACTION_DISPATCHER:3},AVATAR_COLORS:"#65ffcc #dfe592 #99dd92 #cc96b1 #94c4d3 #93d8b9 #65c4ff #ff6565 #cca499 #b394cc #e29191 #ff65f4 #656bff #ffa560 #6bff63 #949ace #ad65ff #ff6584".split(" "),STRINGS:{},DEFAULT_LANGUAGE:"English",ENABLE_MINIMAP:!0,FLIP_MOUSE:b("flipmouse"),AUTO_PLAY:b("autoplay"),HIDE_PLAY:b("hideplay"),SHOW_HELP_ON_LOAD:b("help"),GAZE_IN_POINTER_LOCK:b("gazeinpointerlock"),
NO_GAZE_TELEPORT:b("nogazeteleport"),VR_LO:b("vrlo"),VR_HI:b("vrhi"),MOBILE_HI:b("mobilehi"),NO_BASIS:b("nobasis")};window.WebXRConfig={cardboardConfig:{ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:null,CARDBOARD_UI_DISABLED:!1,K_FILTER:.98,ROTATE_INSTRUCTIONS_DISABLED:!1,PREDICTION_TIME_S:.04,YAW_ONLY:!1,BUFFER_SCALE:1,DIRTY_SUBMIT_FRAME_BINDINGS:!1}};window.GLC={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,
LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,
DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,HALF_FLOAT_OES:36193,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,
COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4x4_KHR:37808}})();/*
 Copyright (C) 2014-present Shapespark
*/
(function(){function a(c,d,e){return function(){c!==d.length&&(e(d[c]),WALK.defer(a(c+1,d,e)))}}var b=2*Math.PI;WALK.defer=function(c){setTimeout(c,0)};WALK.iterateAsync=function(c,d){WALK.defer(a(0,c,d))};WALK.find=function(c,d){for(var e=0;e<c.length;e+=1){var f=c[e];if(d(f))return f}};WALK.filter=function(c,d){for(var e=c.length,f=[],g=0;g<e;g+=1)d(c[g])&&f.push(c[g]);return f};WALK.indexOfMax=function(c,d){if(0===c.length)return null;for(var e=0,f=d?d(c[0]):c[0],g=1;g<c.length;g+=1){var h=d?d(c[g]):
c[g];h>f&&(e=g,f=h)}return e};WALK.any=function(c,d){for(var e=c.length,f=0;f<e;f+=1)if(d(c[f]))return!0;return!1};WALK.removeFromArray=function(c,d){c=d.indexOf(c);console.assert(-1!==c);return d.splice(c,1)};WALK.shiftItem=function(c,d,e){var f=c.indexOf(d);d=c[f];for(var g=e>f?1:-1;f!==e;f+=g)c[f]=c[f+g];c[e]=d};WALK.copyProperties=function(c,d,e){for(var f=0;f<d.length;f+=1){var g=d[f],h=c[g];void 0!==h&&(e[g]=h)}};WALK.normalizeRotation=function(c){c%=b;return c>Math.PI?-b+c:c<-Math.PI?b+c:c};
WALK.yawRotationToPoint=function(c,d){return Math.atan2(-(d.x-c.x),d.y-c.y)};WALK.setTextContent=function(c,d){void 0!==c.textContent?c.textContent=d:void 0!==c.innerText?c.innerText=d:console.warn("textContent and innerText properties are missing")};WALK.log2=function(c){return Math.log(c)/Math.log(2)};WALK.mipsCount=function(c,d){return WALK.log2(d)-WALK.log2(c)+1};WALK.LIGHT_PROBE_MIPS_COUNT=WALK.mipsCount(WALK.LIGHT_PROBE_MIN_MIP_SIZE,WALK.LIGHT_PROBE_MAX_MIP_SIZE);WALK.isModifierPressed=function(c){return c.ctrlKey||
c.altKey||c.metaKey};WALK.round=function(c,d){void 0===d&&(d=3);return+(Math.round(c+"e+"+d)+"e-"+d)};WALK.preloadImage=function(c){var d=new Image;d.src=c;return d};WALK.onVideoDataReady=function(c,d){function e(){c.readyState>=c.HAVE_CURRENT_DATA&&(c.removeEventListener("playing",e),c.removeEventListener("timeupdate",e),d(c))}c.readyState>=c.HAVE_CURRENT_DATA?d(c):(c.addEventListener("playing",e),c.addEventListener("timeupdate",e))};WALK.cloneObject=function(c){return JSON.parse(JSON.stringify(c))};
WALK.readOnlyCopy=function(c){return"object"===typeof c?Object.freeze(WALK.cloneObject(c)):c};WALK.deepEqual=function(c,d){if(c===d)return!0;if("object"!==typeof c||null===c||"object"!==typeof d||null===d||Object.keys(c).length!==Object.keys(d).length)return!1;for(var e=$jscomp.makeIterator(Object.keys(c)),f=e.next();!f.done;f=e.next())if(f=f.value,!d.hasOwnProperty(f)||!WALK.deepEqual(c[f],d[f]))return!1;return!0};WALK.executableOnlyOnce=function(c){var d=!1,e;return function(){if(d)return e;e=c();
c=null;d=!0;return e}};WALK.preventClosureCompilerDeadCodeRemoval=function(c){WALK.preventClosureCompilerDeadCodeRemoval[" "](c);return c};WALK.preventClosureCompilerDeadCodeRemoval[" "]=function(c){return null}})();(function(){function a(e,f,g){WALK.ICONS[e]={name:e,value:f,fontFamily:g}}function b(e,f){a(e,f,"FontAwesomeSolid")}function c(e,f){a(e,f,"FontAwesomeRegular")}function d(e,f){a(e,f,"FontAwesomeBrands")}WALK.ICONS={};b("address-book","\uf2b9");b("address-card","\uf2bb");b("area-chart","\uf1fe");b("arrows","\uf0b2");b("arrow-up","\uf062");b("arrow-down","\uf063");b("assistive-listening-systems","\uf2a2");b("asterisk","\uf069");b("audio-description","\uf29e");b("at","\uf1fa");b("bars","\uf0c9");b("bell",
"\uf0f3");b("book","\uf02d");b("bookmark","\uf02e");b("bullhorn","\uf0a1");b("calculator","\uf1ec");b("camera","\uf030");b("chart-bar","\uf080");b("chart-pie","\uf200");b("chevron-up","\uf077");b("chevron-down","\uf078");b("cloud","\uf0c2");b("cog","\uf013");b("comment","\uf075");c("compass","\uf14e");c("credit-card","\uf09d");b("crosshairs","\uf05b");b("desktop","\uf108");b("download","\uf019");b("envelope","\uf0e0");b("expand","\uf424");b("external-link","\uf35d");c("eye","\uf06e");b("eye-dropper",
"\uf1fb");b("film","\uf008");b("flag","\uf024");b("folder","\uf07b");b("gift","\uf06b");b("headphones","\uf025");b("highlighter","\uf591");b("home","\uf015");c("image","\uf03e");b("sign-in","\uf2f6");b("info","\uf129");c("lightbulb","\uf0eb");b("magic","\uf0d0");b("magnet","\uf076");b("map-marker","\uf3c5");b("map-pin","\uf276");b("map-signs","\uf277");b("paint-brush","\uf1fc");b("pencil","\uf303");b("pen","\uf304");b("phone","\uf095");b("question","\uf128");b("search","\uf002");b("share","\uf064");
b("share-alt","\uf1e0");b("shopping-cart","\uf07a");b("sliders","\uf1de");b("star","\uf005");c("sticky-note","\uf249");b("sync","\uf2f1");c("edit","\uf044");b("tachometer","\uf3fd");b("tag","\uf02b");b("video","\uf03d");b("wrench","\uf0ad");b("palette","\uf53f");b("paint-roller","\uf5aa");b("play","\uf04b");b("pause","\uf04c");b("plus","\uf067");d("youtube","\uf167");d("vimeo","\uf40a");d("facebook","\uf09a");d("twitter","\uf099");d("instagram","\uf16d");d("linkedin","\uf08c");d("skype","\uf17e");
d("whatsapp","\uf232");d("facebook-messenger","\uf39f");d("telegram","\uf2c6");d("slack","\uf198")})();(function(){function a(n){for(var m=$jscomp.makeIterator(Object.entries({"https://cdn0.shapespark.com/":"https://cdn0-jsbr.shapespark.com/","https://cdn0.dev.shapespark.com/":"https://cdn0-jsbr-dev.shapespark.com/","https://cdn0-shapespark-cn-dev.oss-accelerate.aliyuncs.com/":"https://cdn0-jsbr-cn-dev.shapespark.com.cn/","https://cdn0-shapespark-cn.oss-accelerate.aliyuncs.com/":"https://cdn0-jsbr.shapespark.com.cn/","https://cdncn0-shapespark.oss-accelerate.aliyuncs.com/":"https://cdncn0-jsbr.shapespark.com.cn/"})),
l=m.next();!l.done;l=m.next()){var u=$jscomp.makeIterator(l.value);l=u.next().value;u=u.next().value;if(n.startsWith(l))return n.replace(l,u)}return n}function b(n,m){return function(l){p.finished(n);m(l)}}function c(n){this.method=n;this.binaryResult=!1;this.dataContentType=this.data=null;"GET"===n?(this.retriesLeft=WALK.RETRIES_ON_LOAD_ERROR,this.retryDelayMs=1E3+1E3*Math.random()):this.retryDelayMs=this.retriesLeft=0}function d(n,m,l,u,v,t){setTimeout(function(){e(n,m,l,u,v,t)},m.retryDelayMs);
m.retryScheduled()}function e(n,m,l,u,v,t){function B(Q,T){var M=!0!==WALK.DETECTOR.canForceBrotliBuffers?q.NOT_NEEDED:0<=J.getAllResponseHeaders().toLowerCase().indexOf("js-content-encoding:")?q.NEEDED:"br"===J.getResponseHeader("content-encoding")?q.TEST_NEEDED:q.NOT_NEEDED;M===q.NOT_NEEDED?T(Q):r.decode(Q,M===q.NEEDED,T)}function D(){var Q=J.status||0;Q="GET"===m.method&&(500<=Q||0===Q)?0!==m.retriesLeft:!1;console.warn("Failed to "+m.method+": "+n+" ("+J.status+")"+(Q?", retrying in "+m.retryDelayMs/
1E3+"s":""));if(Q)t&&!k&&(console.warn("Switch to jsbr hosts."),k=!0),d(n,m,l,u,v,t);else if(void 0!==u){try{var T=JSON.parse(J.responseText).message}catch(M){T=void 0}u(J.status,T)}m=J=null}function I(){if(void 0!==l)if(m.binaryResult)B(J.response,l);else{var Q=J.getResponseHeader("content-type"),T=J.responseText;T&&-1!==Q.indexOf("text/plain")?B(T,l):T?B(T,function(M){l(JSON.parse(M))}):l()}m=J=null}var J=new XMLHttpRequest;void 0!==v&&J.addEventListener("progress",v,!1);J.addEventListener("load",
function(){200<=J.status&&300>J.status||0===J.status?I():D()},!1);J.addEventListener("error",D,!1);J.addEventListener("abort",D,!1);t&&k&&(n=a(n));J.open(m.method,n,!0);m.binaryResult&&(J.responseType="arraybuffer");m.dataContentType&&J.setRequestHeader("Content-Type",m.dataContentType);"POST"===m.method&&J.setRequestHeader("X-Requested-By","Shapespark");J.send(m.data)}function f(n,m,l,u,v){function t(){n(m,l,u,v)}return function(){console.warn("Failed to get: "+m+(t?", retrying in "+l.retryDelayMs/
1E3+"s":""));0<l.retriesLeft?(setTimeout(t,l.retryDelayMs),l.retryScheduled()):v()}}function g(n,m,l,u){var v=new Image;v.onload=function(){l(v);v=null};v.onerror=f(g,n,m,l,u);v.crossOrigin="anonymous";v.src=n}function h(n,m,l,u){var v=document.createElement("video");v.autoplay=!0;v.muted=!0;v.loop=!0;v.setAttribute("playsinline","");v.setAttribute("webkit-playsinline","");v.crossOrigin="anonymous";v.onerror=f(h,n,m,l,u);WALK.onVideoDataReady(v,function(){v.onerror=void 0;l(v);v=null});v.src=n;v.play().catch(function(){})}
var k=!1,q={NOT_NEEDED:0,TEST_NEEDED:1,NEEDED:2},p=new function(){function n(){for(u+=1;u<m.length;u+=1){var v=m[u];if(0<v.length){for(var t=0;t<v.length;t+=1)l[u]+=1,WALK.defer(v[t]);v.length=0;break}}}var m=[],l=[],u=Infinity;(function(){var v=0,t;for(t in WALK.LOAD_PRIORITY)WALK.LOAD_PRIORITY.hasOwnProperty(t)&&(v=Math.max(v,WALK.LOAD_PRIORITY[t]));for(t=0;t<=v;t+=1)m[t]=[],l[t]=0})();this.add=function(v,t){v<=u?(l[v]+=1,u=v,WALK.defer(t)):(m[v].push(t),0===l[u]&&n())};this.finished=function(v){--l[v];
var t=l[v];console.assert(0<=t);v===u&&0===t&&n()}},r=new function(){function n(Q){Q=new Int8Array(Q);return(new BrotliDecode(Q)).buffer}function m(Q){D=Q;for(var T=0;T<t.length;T+=1)t[T](Q);t=null}function l(Q){I?Q():(B.push(Q),1===B.length&&WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/brotli.min.js"),function(){I=!0;for(var T=0;T<B.length;T+=1)B[T]();B=null},function(){return WALK.USER_MSG.error("Cannot load required library")}))}function u(){200<=J.status&&300>J.status||0===J.status?m("SSSSSS"===
J.responseText):(console.error("br.buf response",J.status),m(!0))}function v(Q){void 0!==D?Q(D):(t.push(Q),1===t.length&&(J.addEventListener("load",u,!1),J.open("GET",WALK.getViewerAssetUrl("3dassets/br.buf"),!0),J.send()))}var t=[],B=[],D=void 0,I=!1,J=new XMLHttpRequest;this.decode=function(Q,T,M){T?l(function(){M(n(Q))}):v(function(z){z?M(Q):l(function(){M(n(Q))})})}};c.prototype={constructor:c,retryScheduled:function(){console.assert(0<this.retriesLeft);--this.retriesLeft;this.retryDelayMs*=2}};
WALK.ajaxGet=function(n,m,l,u,v,t){var B=new c("GET");B.binaryResult=m;e(n,B,l,u,v,t)};WALK.queueAjaxGet=function(n,m,l,u,v,t,B){B=void 0===B?!1:B;p.add(n,function(){WALK.ajaxGet(m,l,b(n,u),b(n,v),t,B)})};WALK.ajaxPost=function(n,m,l,u,v,t){var B=new c("POST");B.data=l;B.dataContentType=m;e(n,B,u,v,t)};WALK.queueImageGet=function(n,m,l,u){p.add(n,function(){var v=new c("GET");g(m,v,b(n,l),b(n,u))})};WALK.queueVideoGet=function(n,m,l,u){p.add(n,function(){var v=new c("GET");h(m,v,b(n,l),b(n,u))})};
WALK.loadScriptAndExecute=function(){function n(v){l.add(v);var t=u.get(v);u.delete(v);t.forEach(function(B){try{(0,B.onSuccess)()}catch(D){console.log(D)}})}function m(v){var t=u.get(v);u.delete(v);console.error("Can't load script : "+v);t.forEach(function(B){if(void 0!==B.onError){B=B.onError.bind(null,v);try{B()}catch(D){console.log(D)}}})}var l=new Set,u=new Map;return function(v,t,B){if(l.has(v))t();else if(u.has(v))u.get(v).push({onSuccess:t,onError:B});else{u.set(v,[{onSuccess:t,onError:B}]);
t=n.bind(this,v);B=m.bind(this,v);var D=document.createElement("script");D.onload=t;D.onerror=B;D.src=v;D.type="text/javascript";document.body.appendChild(D)}}}();WALK.loadScriptsUrlAndExecute=function(n,m,l){function u(v){return new Promise(function(t,B){WALK.loadScriptAndExecute(v,t,B)})}n=n.map(function(v){return u(v)});Promise.all(n).then(m).catch(function(v){void 0!==l&&l(v)})}})();(function(){function a(d,e){for(d=d.toString();d.length<e;)d="0"+d;return d}function b(d){var e=console[d].bind(console);console[d]=function(){for(var f="",g="",h=0;h<arguments.length;++h)g+=(0===h?"":" ")+arguments[h];WALK.LOG_TIME&&(f=new Date,f=a(f.getHours(),2)+":"+a(f.getMinutes(),2)+":"+a(f.getSeconds(),2)+","+a(f.getMilliseconds(),3)+" ");h=f+d.toUpperCase()+" "+g;WALK.ajaxPost("./logs","application/json",JSON.stringify({logs:[h]}));e(f+g)}}function c(){window.onerror=function(d,e,f,g,h){console.error("Error occured: "+
d+" ("+e+"#"+f.toString()+":"+g.toString()+"/"+h+")");return!1}}WALK.log=function(){};WALK.logInfoMessages=function(){WALK.log=function(d){for(var e=[],f=0;f<arguments.length;++f)e[f-0]=arguments[f];console.log.apply(console,$jscomp.arrayFromIterable(e))}};WALK.initLoggingToServer=function(d){d&&(b("log"),b("info"));b("warn");b("error");c()};WALK.LOG_INFO&&WALK.logInfoMessages();WALK.LOG_TO_SERVER&&WALK.initLoggingToServer(!0)})();/*

 nosleep.js
 Copyright (c) 2017, Rich Tibbett

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 webxr-polyfill
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 cardboard-vr-display
 Copyright (c) 2015-2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 webvr-polyfill-dpdb 
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 wglu-preserve-state
 Copyright (c) 2016, Brandon Jones.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(a,b){"object"===typeof exports&&"undefined"!==typeof module?module.exports=b():"function"===typeof define&&define.amd?define(b):a.WebXRPolyfill=b()})(this,function(){function a(){var w=new O(16);O!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0);w[0]=1;w[5]=1;w[10]=1;w[15]=1;return w}function b(w){w[0]=1;w[1]=0;w[2]=0;w[3]=0;w[4]=0;w[5]=1;w[6]=0;w[7]=0;w[8]=0;w[9]=0;w[10]=1;w[11]=0;w[12]=0;w[13]=0;w[14]=0;w[15]=1;return w}function c(w,
C){var N=C[0],P=C[1],ha=C[2],xa=C[3],ya=C[4],La=C[5],Wa=C[6],Za=C[7],Ya=C[8],kb=C[9],wb=C[10],ob=C[11],pb=C[12],nb=C[13],xb=C[14];C=C[15];var hb=N*La-P*ya,$a=N*Wa-ha*ya,qb=N*Za-xa*ya,rb=P*Wa-ha*La,ab=P*Za-xa*La,Ib=ha*Za-xa*Wa,Pb=Ya*nb-kb*pb,Qb=Ya*xb-wb*pb,Mb=Ya*C-ob*pb,Rb=kb*xb-wb*nb,Sb=kb*C-ob*nb,Nb=wb*C-ob*xb,ub=hb*Nb-$a*Sb+qb*Rb+rb*Mb-ab*Qb+Ib*Pb;if(!ub)return null;ub=1/ub;w[0]=(La*Nb-Wa*Sb+Za*Rb)*ub;w[1]=(ha*Sb-P*Nb-xa*Rb)*ub;w[2]=(nb*Ib-xb*ab+C*rb)*ub;w[3]=(wb*ab-kb*Ib-ob*rb)*ub;w[4]=(Wa*Mb-
ya*Nb-Za*Qb)*ub;w[5]=(N*Nb-ha*Mb+xa*Qb)*ub;w[6]=(xb*qb-pb*Ib-C*$a)*ub;w[7]=(Ya*Ib-wb*qb+ob*$a)*ub;w[8]=(ya*Sb-La*Mb+Za*Pb)*ub;w[9]=(P*Mb-N*Sb-xa*Pb)*ub;w[10]=(pb*ab-nb*qb+C*hb)*ub;w[11]=(kb*qb-Ya*ab-ob*hb)*ub;w[12]=(La*Qb-ya*Rb-Wa*Pb)*ub;w[13]=(N*Rb-P*Qb+ha*Pb)*ub;w[14]=(nb*$a-pb*rb-xb*hb)*ub;w[15]=(Ya*rb-kb*$a+wb*hb)*ub;return w}function d(w,C,N){var P=C[0],ha=C[1],xa=C[2],ya=C[3],La=C[4],Wa=C[5],Za=C[6],Ya=C[7],kb=C[8],wb=C[9],ob=C[10],pb=C[11],nb=C[12],xb=C[13],hb=C[14];C=C[15];var $a=N[0],qb=
N[1],rb=N[2],ab=N[3];w[0]=$a*P+qb*La+rb*kb+ab*nb;w[1]=$a*ha+qb*Wa+rb*wb+ab*xb;w[2]=$a*xa+qb*Za+rb*ob+ab*hb;w[3]=$a*ya+qb*Ya+rb*pb+ab*C;$a=N[4];qb=N[5];rb=N[6];ab=N[7];w[4]=$a*P+qb*La+rb*kb+ab*nb;w[5]=$a*ha+qb*Wa+rb*wb+ab*xb;w[6]=$a*xa+qb*Za+rb*ob+ab*hb;w[7]=$a*ya+qb*Ya+rb*pb+ab*C;$a=N[8];qb=N[9];rb=N[10];ab=N[11];w[8]=$a*P+qb*La+rb*kb+ab*nb;w[9]=$a*ha+qb*Wa+rb*wb+ab*xb;w[10]=$a*xa+qb*Za+rb*ob+ab*hb;w[11]=$a*ya+qb*Ya+rb*pb+ab*C;$a=N[12];qb=N[13];rb=N[14];ab=N[15];w[12]=$a*P+qb*La+rb*kb+ab*nb;w[13]=
$a*ha+qb*Wa+rb*wb+ab*xb;w[14]=$a*xa+qb*Za+rb*ob+ab*hb;w[15]=$a*ya+qb*Ya+rb*pb+ab*C;return w}function e(w,C,N){var P=C[0],ha=C[1],xa=C[2],ya=C[3],La=P+P,Wa=ha+ha,Za=xa+xa;C=P*La;var Ya=P*Wa;P*=Za;var kb=ha*Wa;ha*=Za;xa*=Za;La*=ya;Wa*=ya;ya*=Za;w[0]=1-(kb+xa);w[1]=Ya+ya;w[2]=P-Wa;w[3]=0;w[4]=Ya-ya;w[5]=1-(C+xa);w[6]=ha+La;w[7]=0;w[8]=P+Wa;w[9]=ha-La;w[10]=1-(C+kb);w[11]=0;w[12]=N[0];w[13]=N[1];w[14]=N[2];w[15]=1;return w}function f(w,C){w[0]=C[12];w[1]=C[13];w[2]=C[14];return w}function g(w,C){var N=
C[0]+C[5]+C[10];0<N?(N=2*Math.sqrt(N+1),w[3]=.25*N,w[0]=(C[6]-C[9])/N,w[1]=(C[8]-C[2])/N,w[2]=(C[1]-C[4])/N):C[0]>C[5]&&C[0]>C[10]?(N=2*Math.sqrt(1+C[0]-C[5]-C[10]),w[3]=(C[6]-C[9])/N,w[0]=.25*N,w[1]=(C[1]+C[4])/N,w[2]=(C[8]+C[2])/N):C[5]>C[10]?(N=2*Math.sqrt(1+C[5]-C[0]-C[10]),w[3]=(C[8]-C[2])/N,w[0]=(C[1]+C[4])/N,w[1]=.25*N,w[2]=(C[6]+C[9])/N):(N=2*Math.sqrt(1+C[10]-C[0]-C[5]),w[3]=(C[1]-C[4])/N,w[0]=(C[8]+C[2])/N,w[1]=(C[6]+C[9])/N,w[2]=.25*N);return w}function h(w,C,N,P,ha){C=1/Math.tan(C/2);
w[0]=C/N;w[1]=0;w[2]=0;w[3]=0;w[4]=0;w[5]=C;w[6]=0;w[7]=0;w[8]=0;w[9]=0;w[11]=-1;w[12]=0;w[13]=0;w[15]=0;null!=ha&&Infinity!==ha?(N=1/(P-ha),w[10]=(ha+P)*N,w[14]=2*ha*P*N):(w[10]=-1,w[14]=-2*P);return w}function k(){var w=new O(3);O!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0);return w}function q(w){var C=new O(3);C[0]=w[0];C[1]=w[1];C[2]=w[2];return C}function p(w,C,N){var P=new O(3);P[0]=w;P[1]=C;P[2]=N;return P}function r(w,C){w[0]=C[0];w[1]=C[1];w[2]=C[2];return w}function n(w,C,N){w[0]=C[0]+N[0];w[1]=
C[1]+N[1];w[2]=C[2]+N[2];return w}function m(w,C,N){w[0]=C[0]*N;w[1]=C[1]*N;w[2]=C[2]*N;return w}function l(w,C){var N=C[0],P=C[1],ha=C[2];N=N*N+P*P+ha*ha;0<N&&(N=1/Math.sqrt(N),w[0]=C[0]*N,w[1]=C[1]*N,w[2]=C[2]*N);return w}function u(w,C){return w[0]*C[0]+w[1]*C[1]+w[2]*C[2]}function v(w,C,N){var P=C[0],ha=C[1];C=C[2];var xa=N[0],ya=N[1];N=N[2];w[0]=ha*N-C*ya;w[1]=C*xa-P*N;w[2]=P*ya-ha*xa;return w}function t(w,C,N){var P=N[0],ha=N[1],xa=N[2],ya=C[0],La=C[1];C=C[2];var Wa=ha*C-xa*La,Za=xa*ya-P*C,
Ya=P*La-ha*ya;N=2*N[3];w[0]=ya+Wa*N+2*(ha*Ya-xa*Za);w[1]=La+Za*N+2*(xa*Wa-P*Ya);w[2]=C+Ya*N+2*(P*Za-ha*Wa);return w}function B(){var w=new O(9);O!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[5]=0,w[6]=0,w[7]=0);w[0]=1;w[4]=1;w[8]=1;return w}function D(){var w=new O(4);O!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0,w[3]=0);return w}function I(){var w=new O(4);O!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0);w[3]=1;return w}function J(w,C,N){var P=C[0],ha=C[1],xa=C[2];C=C[3];var ya=N[0],La=N[1],Wa=N[2];N=N[3];w[0]=P*N+C*
ya+ha*Wa-xa*La;w[1]=ha*N+C*La+xa*ya-P*Wa;w[2]=xa*N+C*Wa+P*La-ha*ya;w[3]=C*N-P*ya-ha*La-xa*Wa;return w}function Q(w,C,N,P){var ha=C[0],xa=C[1],ya=C[2];C=C[3];var La=N[0],Wa=N[1],Za=N[2];N=N[3];var Ya=ha*La+xa*Wa+ya*Za+C*N;0>Ya&&(Ya=-Ya,La=-La,Wa=-Wa,Za=-Za,N=-N);if(1E-6<1-Ya){var kb=Math.acos(Ya);var wb=Math.sin(kb);Ya=Math.sin((1-P)*kb)/wb;P=Math.sin(P*kb)/wb}else Ya=1-P;w[0]=Ya*ha+P*La;w[1]=Ya*xa+P*Wa;w[2]=Ya*ya+P*Za;w[3]=Ya*C+P*N;return w}function T(w,C){var N=C[0],P=C[1],ha=C[2];C=C[3];var xa=
N*N+P*P+ha*ha+C*C;xa=xa?1/xa:0;w[0]=-N*xa;w[1]=-P*xa;w[2]=-ha*xa;w[3]=C*xa;return w}function M(w,C){w=new Event(w,C);w[Ea]={frame:C.frame,inputSource:C.inputSource};Object.setPrototypeOf(w,M.prototype);Object.defineProperty(w,"frame",{get:function(){return this[Ea].frame}});Object.defineProperty(w,"inputSource",{get:function(){return this[Ea].inputSource}});return w}function z(w,C){w=new Event(w,C);w[Na]={session:C.session};Object.setPrototypeOf(w,z.prototype);Object.defineProperty(w,"session",{get:function(){return this[Na].session}});
return w}function A(w,C){w=new Event(w,C);w[ea]={session:C.session,added:C.added,removed:C.removed};Object.setPrototypeOf(w,A.prototype);Object.defineProperty(w,"session",{get:function(){return this[ea].session}});Object.defineProperty(w,"added",{get:function(){return this[ea].added}});Object.defineProperty(w,"removed",{get:function(){return this[ea].removed}});return w}function y(w,C){w=new Event(w,C);w[fb]={referenceSpace:C.referenceSpace,transform:C.transform||null};Object.setPrototypeOf(w,y.prototype);
Object.defineProperty(w,"referenceSpace",{get:function(){return this[fb].referenceSpace}});Object.defineProperty(w,"transform",{get:function(){return this[fb].transform}});return w}function E(w,C,N){function P(Wa,Za,Ya){return Wa<Za?Za:Wa>Ya?Ya:Wa}var ha=C[0]*C[0],xa=C[1]*C[1],ya=C[2]*C[2],La=C[3]*C[3];"XYZ"===N?(w[0]=Math.atan2(2*(C[0]*C[3]-C[1]*C[2]),La-ha-xa+ya),w[1]=Math.asin(P(2*(C[0]*C[2]+C[1]*C[3]),-1,1)),w[2]=Math.atan2(2*(C[2]*C[3]-C[0]*C[1]),La+ha-xa-ya)):"YXZ"===N?(w[0]=Math.asin(P(2*(C[0]*
C[3]-C[1]*C[2]),-1,1)),w[1]=Math.atan2(2*(C[0]*C[2]+C[1]*C[3]),La-ha-xa+ya),w[2]=Math.atan2(2*(C[0]*C[1]+C[2]*C[3]),La-ha+xa-ya)):"ZXY"===N?(w[0]=Math.asin(P(2*(C[0]*C[3]+C[1]*C[2]),-1,1)),w[1]=Math.atan2(2*(C[1]*C[3]-C[2]*C[0]),La-ha-xa+ya),w[2]=Math.atan2(2*(C[2]*C[3]-C[0]*C[1]),La-ha+xa-ya)):"ZYX"===N?(w[0]=Math.atan2(2*(C[0]*C[3]+C[2]*C[1]),La-ha-xa+ya),w[1]=Math.asin(P(2*(C[1]*C[3]-C[0]*C[2]),-1,1)),w[2]=Math.atan2(2*(C[0]*C[1]+C[2]*C[3]),La+ha-xa-ya)):"YZX"===N?(w[0]=Math.atan2(2*(C[0]*C[3]-
C[2]*C[1]),La-ha+xa-ya),w[1]=Math.atan2(2*(C[1]*C[3]-C[0]*C[2]),La+ha-xa-ya),w[2]=Math.asin(P(2*(C[0]*C[1]+C[2]*C[3]),-1,1))):"XZY"===N?(w[0]=Math.atan2(2*(C[0]*C[3]+C[1]*C[2]),La-ha+xa-ya),w[1]=Math.atan2(2*(C[0]*C[2]+C[1]*C[3]),La+ha-xa-ya),w[2]=Math.asin(P(2*(C[2]*C[3]-C[0]*C[1]),-1,1))):console.log("No order given for quaternion to euler conversion.")}var K="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{},H=Symbol("@@webxr-polyfill/EventTarget"),
G=function(){this[H]={listeners:new Map}};G.prototype.addEventListener=function(w,C){if("string"!==typeof w)throw Error("`type` must be a string");if("function"!==typeof C)throw Error("`listener` must be a function");var N=this[H].listeners.get(w)||[];N.push(C);this[H].listeners.set(w,N)};G.prototype.removeEventListener=function(w,C){if("string"!==typeof w)throw Error("`type` must be a string");if("function"!==typeof C)throw Error("`listener` must be a function");w=this[H].listeners.get(w)||[];for(var N=
w.length;0<=N;N--)w[N]===C&&w.pop()};G.prototype.dispatchEvent=function(w,C){for(var N=this[H].listeners.get(w)||[],P=[],ha=0;ha<N.length;ha++)P[ha]=N[ha];N=$jscomp.makeIterator(P);for(P=N.next();!P.done;P=N.next())P=P.value,P(C);if("function"===typeof this["on"+w])this["on"+w](C)};var O="undefined"!==typeof Float32Array?Float32Array:Array;(function(){var w=k();return function(C,N,P,ha,xa,ya){N||(N=3);P||(P=0);for(ha=ha?Math.min(ha*N+P,C.length):C.length;P<ha;P+=N)w[0]=C[P],w[1]=C[P+1],w[2]=C[P+2],
xa(w,w,ya),C[P]=w[0],C[P+1]=w[1],C[P+2]=w[2];return C}})();(function(){var w=D();return function(C,N,P,ha,xa,ya){N||(N=4);P||(P=0);for(ha=ha?Math.min(ha*N+P,C.length):C.length;P<ha;P+=N)w[0]=C[P],w[1]=C[P+1],w[2]=C[P+2],w[3]=C[P+3],xa(w,w,ya),C[P]=w[0],C[P+1]=w[1],C[P+2]=w[2],C[P+3]=w[3];return C}})();var Y=function(w){var C=new O(4);C[0]=w[0];C[1]=w[1];C[2]=w[2];C[3]=w[3];return C},W=function(w,C){w[0]=C[0];w[1]=C[1];w[2]=C[2];w[3]=C[3];return w},ka=function(w,C){var N=C[0],P=C[1],ha=C[2];C=C[3];
var xa=N*N+P*P+ha*ha+C*C;0<xa&&(xa=1/Math.sqrt(xa),w[0]=N*xa,w[1]=P*xa,w[2]=ha*xa,w[3]=C*xa);return w};(function(){var w=k(),C=p(1,0,0),N=p(0,1,0);return function(P,ha,xa){var ya=u(ha,xa);if(-.999999>ya){v(w,C,ha);xa=w[0];ya=w[1];var La=w[2];1E-6>Math.sqrt(xa*xa+ya*ya+La*La)&&v(w,N,ha);l(w,w);ha=Math.PI;ha*=.5;xa=Math.sin(ha);P[0]=xa*w[0];P[1]=xa*w[1];P[2]=xa*w[2];P[3]=Math.cos(ha);return P}if(.999999<ya)return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P;v(w,ha,xa);P[0]=w[0];P[1]=w[1];P[2]=w[2];P[3]=1+ya;return ka(P,
P)}})();(function(){var w=I(),C=I();return function(N,P,ha,xa,ya,La){Q(w,P,ya,La);Q(C,ha,xa,La);Q(N,w,C,2*La*(1-La));return N}})();(function(){var w=B();return function(C,N,P,ha){w[0]=P[0];w[3]=P[1];w[6]=P[2];w[1]=ha[0];w[4]=ha[1];w[7]=ha[2];w[2]=-N[0];w[5]=-N[1];w[8]=-N[2];N=w[0]+w[4]+w[8];if(0<N)N=Math.sqrt(N+1),C[3]=.5*N,N=.5/N,C[0]=(w[5]-w[7])*N,C[1]=(w[6]-w[2])*N,C[2]=(w[1]-w[3])*N;else{P=0;w[4]>w[0]&&(P=1);w[8]>w[3*P+P]&&(P=2);ha=(P+1)%3;var xa=(P+2)%3;N=Math.sqrt(w[3*P+P]-w[3*ha+ha]-w[3*xa+
xa]+1);C[P]=.5*N;N=.5/N;C[3]=(w[3*ha+xa]-w[3*xa+ha])*N;C[ha]=(w[3*ha+P]+w[3*P+ha])*N;C[xa]=(w[3*xa+P]+w[3*P+xa])*N}return ka(C,C)}})();if(!("DOMPointReadOnly"in window)){var la=Symbol("@@webxr-polyfill/DOMPointReadOnly"),oa=function(w,C,N,P){if(1===arguments.length)this[la]={x:w.x,y:w.y,z:w.z,w:w.w};else if(4===arguments.length)this[la]={x:w,y:C,z:N,w:P};else throw new TypeError("Must supply either 1 or 4 arguments");};oa.fromPoint=function(w){return new oa(w.x,w.y,w.z,w.w)};$jscomp.global.Object.defineProperties(oa.prototype,
{x:{configurable:!0,enumerable:!0,get:function(){return this[la].x}},y:{configurable:!0,enumerable:!0,get:function(){return this[la].y}},z:{configurable:!0,enumerable:!0,get:function(){return this[la].z}},w:{configurable:!0,enumerable:!0,get:function(){return this[la].w}}});window.DOMPointReadOnly=oa}var ra=Symbol("@@webxr-polyfill/XRRigidTransform"),Ba=function(){this[ra]={matrix:null,position:null,orientation:null,inverse:null};if(0===arguments.length)this[ra].matrix=b(new Float32Array(16));else if(1===
arguments.length)arguments[0]instanceof Float32Array?this[ra].matrix=arguments[0]:(this[ra].position=this._getPoint(arguments[0]),this[ra].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(2===arguments.length)this[ra].position=this._getPoint(arguments[0]),this[ra].orientation=this._getPoint(arguments[1]);else throw Error("Too many arguments!");if(this[ra].matrix){var w=k();f(w,this[ra].matrix);this[ra].position=DOMPointReadOnly.fromPoint({x:w[0],y:w[1],z:w[2]});w=I();g(w,this[ra].matrix);
this[ra].orientation=DOMPointReadOnly.fromPoint({x:w[0],y:w[1],z:w[2],w:w[3]})}else{this[ra].matrix=b(new Float32Array(16));w=this[ra].matrix;var C=this[ra].orientation.x,N=this[ra].orientation.y,P=this[ra].orientation.z,ha=this[ra].orientation.w,xa=new O(4);xa[0]=C;xa[1]=N;xa[2]=P;xa[3]=ha;e(w,xa,p(this[ra].position.x,this[ra].position.y,this[ra].position.z))}};Ba.prototype._getPoint=function(w){return w instanceof DOMPointReadOnly?w:DOMPointReadOnly.fromPoint(w)};$jscomp.global.Object.defineProperties(Ba.prototype,
{matrix:{configurable:!0,enumerable:!0,get:function(){return this[ra].matrix}},position:{configurable:!0,enumerable:!0,get:function(){return this[ra].position}},orientation:{configurable:!0,enumerable:!0,get:function(){return this[ra].orientation}},inverse:{configurable:!0,enumerable:!0,get:function(){if(null===this[ra].inverse){var w=b(new Float32Array(16));c(w,this[ra].matrix);this[ra].inverse=new Ba(w);this[ra].inverse[ra].inverse=this}return this[ra].inverse}}});var ma=Symbol("@@webxr-polyfill/XRSpace"),
Ga=function(w,C){this[ma]={specialType:void 0===w?null:w,inputSource:void 0===C?null:C,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}};Ga.prototype._ensurePoseUpdated=function(w,C){C!=this[ma].lastFrameId&&(this[ma].lastFrameId=C,this._onPoseUpdate(w))};Ga.prototype._onPoseUpdate=function(w){"viewer"==this[ma].specialType&&(this._baseMatrix=w.getBasePoseMatrix())};Ga.prototype._getSpaceRelativeTransform=function(w){if(!this._inverseBaseMatrix||!w._baseMatrix)return null;var C=new Float32Array(16);
d(C,this._inverseBaseMatrix,w._baseMatrix);return new Ba(C)};$jscomp.global.Object.defineProperties(Ga.prototype,{_specialType:{configurable:!0,enumerable:!0,get:function(){return this[ma].specialType}},_inputSource:{configurable:!0,enumerable:!0,get:function(){return this[ma].inputSource}},_baseMatrix:{configurable:!0,enumerable:!0,set:function(w){this[ma].baseMatrix=w;this[ma].inverseBaseMatrix=null},get:function(){!this[ma].baseMatrix&&this[ma].inverseBaseMatrix&&(this[ma].baseMatrix=new Float32Array(16),
c(this[ma].baseMatrix,this[ma].inverseBaseMatrix));return this[ma].baseMatrix}},_inverseBaseMatrix:{configurable:!0,enumerable:!0,set:function(w){this[ma].inverseBaseMatrix=w;this[ma].baseMatrix=null},get:function(){!this[ma].inverseBaseMatrix&&this[ma].baseMatrix&&(this[ma].inverseBaseMatrix=new Float32Array(16),c(this[ma].inverseBaseMatrix,this[ma].baseMatrix));return this[ma].inverseBaseMatrix}}});var aa=Symbol("@@webxr-polyfill/XRReferenceSpace"),S=["viewer","local","local-floor","bounded-floor",
"unbounded"],R=function(w,C){C=void 0===C?null:C;if(!S.includes(w))throw Error("XRReferenceSpaceType must be one of "+S);var N=Ga.call(this,w)||this;if("bounded-floor"===w&&!C)throw Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");"bounded-floor"!==w&&"local-floor"!==w||C||(C=b(new Float32Array(16)),C[13]=1.6);N._inverseBaseMatrix=C||b(new Float32Array(16));N[aa]={type:w,transform:C,originOffset:b(new Float32Array(16))};return N};$jscomp.inherits(R,
Ga);R.prototype._transformBasePoseMatrix=function(w,C){d(w,this._inverseBaseMatrix,C)};R.prototype._originOffsetMatrix=function(){return this[aa].originOffset};R.prototype._adjustForOriginOffset=function(w){var C=new Float32Array(16);c(C,this[aa].originOffset);d(w,C,w)};R.prototype._getSpaceRelativeTransform=function(w){w=Ga.prototype._getSpaceRelativeTransform.call(this,w);this._adjustForOriginOffset(w.matrix);return new XRRigidTransform(w.matrix)};R.prototype.getOffsetReferenceSpace=function(w){var C=
new R(this[aa].type,this[aa].transform,this[aa].bounds);d(C[aa].originOffset,this[aa].originOffset,w.matrix);return C};var Z=Symbol("@@webxr-polyfill/XR"),ca=["inline","immersive-vr","immersive-ar"],na={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},Aa=function(w){var C=G.call(this)||this;C[Z]={device:null,devicePromise:w,immersiveSession:null,
inlineSessions:new Set};w.then(function(N){C[Z].device=N});return C};$jscomp.inherits(Aa,G);Aa.prototype.isSessionSupported=function(w){var C=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){return 1==N.nextAddress?C[Z].device?N.jumpTo(2):N.yield(C[Z].devicePromise,2):"inline"!=w?N.return(Promise.resolve(C[Z].device.isSessionSupported(w))):N.return(Promise.resolve(!0))})};Aa.prototype.requestSession=function(w,C){var N=this,P,ha,xa,ya,La,Wa,Za,Ya,kb,wb,ob,pb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xb){if(1==
xb.nextAddress){if(N[Z].device)return xb.jumpTo(2);if("inline"!=w)throw Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");return xb.yield(N[Z].devicePromise,2)}if(5!=xb.nextAddress){if(!ca.includes(w))throw new TypeError("The provided value '"+w+"' is not a valid enum value of type XRSessionMode");
P=na[w];ha=P.requiredFeatures.concat(C&&C.requiredFeatures?C.requiredFeatures:[]);xa=P.optionalFeatures.concat(C&&C.optionalFeatures?C.optionalFeatures:[]);ya=new Set;La=!1;Wa=$jscomp.makeIterator(ha);for(Za=Wa.next();!Za.done;Za=Wa.next())Ya=Za.value,N[Z].device.isFeatureSupported(Ya)?ya.add(Ya):(console.error("The required feature '"+Ya+"' is not supported"),La=!0);if(La)throw new DOMException("Session does not support some required features","NotSupportedError");kb=$jscomp.makeIterator(xa);for(Za=
kb.next();!Za.done;Za=kb.next())wb=Za.value,N[Z].device.isFeatureSupported(wb)?ya.add(wb):console.log("The optional feature '"+wb+"' is not supported");return xb.yield(N[Z].device.requestSession(w,ya),5)}ob=xb.yieldResult;pb=new XRSession(N[Z].device,w,ob);"inline"==w?N[Z].inlineSessions.add(pb):N[Z].immersiveSession=pb;nb=function(){"inline"==w?N[Z].inlineSessions.delete(pb):N[Z].immersiveSession=null;pb.removeEventListener("end",nb)};pb.addEventListener("end",nb);return xb.return(pb)})};if(!1===
"performance"in K){var Ca=Date.now();var qa=function(){return Date.now()-Ca}}else qa=function(){return performance.now()};var fa=qa,va=Symbol("@@webxr-polyfill/XRPose"),sa=function(w,C){this[va]={transform:w,emulatedPosition:C}};$jscomp.global.Object.defineProperties(sa.prototype,{transform:{configurable:!0,enumerable:!0,get:function(){return this[va].transform}},emulatedPosition:{configurable:!0,enumerable:!0,get:function(){return this[va].emulatedPosition}}});var Fa=Symbol("@@webxr-polyfill/XRViewerPose"),
Ta=function(w,C,N){w=sa.call(this,w,void 0===N?!1:N)||this;w[Fa]={views:C};return w};$jscomp.inherits(Ta,sa);$jscomp.global.Object.defineProperties(Ta.prototype,{views:{configurable:!0,enumerable:!0,get:function(){return this[Fa].views}}});var U=Symbol("@@webxr-polyfill/XRViewport"),pa=function(w){this[U]={target:w}};$jscomp.global.Object.defineProperties(pa.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this[U].target.x}},y:{configurable:!0,enumerable:!0,get:function(){return this[U].target.y}},
width:{configurable:!0,enumerable:!0,get:function(){return this[U].target.width}},height:{configurable:!0,enumerable:!0,get:function(){return this[U].target.height}}});var Da=["left","right","none"],wa=Symbol("@@webxr-polyfill/XRView"),Ha=function(w,C,N,P){if(!Da.includes(N))throw Error("XREye must be one of: "+Da);var ha=Object.create(null),xa=new pa(ha);this[wa]={device:w,eye:N,viewport:xa,temp:ha,sessionId:P,transform:C}};Ha.prototype._getViewport=function(w){if(this[wa].device.getViewport(this[wa].sessionId,
this.eye,w,this[wa].temp))return this[wa].viewport};$jscomp.global.Object.defineProperties(Ha.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this[wa].eye}},projectionMatrix:{configurable:!0,enumerable:!0,get:function(){return this[wa].device.getProjectionMatrix(this.eye)}},transform:{configurable:!0,enumerable:!0,get:function(){return this[wa].transform}}});var Ia=Symbol("@@webxr-polyfill/XRFrame"),Xa=0,Ka=function(w,C,N){this[Ia]={id:++Xa,active:!1,animationFrame:!1,device:w,
session:C,sessionId:N}};Ka.prototype.getViewerPose=function(w){if(!this[Ia].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[Ia].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.","InvalidStateError");var C=this[Ia].device,N=this[Ia].session;N[ba].viewerSpace._ensurePoseUpdated(C,this[Ia].id);w._ensurePoseUpdated(C,this[Ia].id);
var P=w._getSpaceRelativeTransform(N[ba].viewerSpace),ha=[];N=$jscomp.makeIterator(N[ba].viewSpaces);for(var xa=N.next();!xa.done;xa=N.next()){xa=xa.value;xa._ensurePoseUpdated(C,this[Ia].id);var ya=w._getSpaceRelativeTransform(xa);xa=new Ha(C,ya,xa.eye,this[Ia].sessionId);ha.push(xa)}return new Ta(P,ha,!1)};Ka.prototype.getPose=function(w,C){if(!this[Ia].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.","InvalidStateError");var N=this[Ia].device;if("target-ray"===
w._specialType||"grip"===w._specialType)return N.getInputPose(w._inputSource,C,w._specialType);w._ensurePoseUpdated(N,this[Ia].id);C._ensurePoseUpdated(N,this[Ia].id);return(w=C._getSpaceRelativeTransform(w))?new XRPose(w,!1):null};$jscomp.global.Object.defineProperties(Ka.prototype,{session:{configurable:!0,enumerable:!0,get:function(){return this[Ia].session}}});var gb=Symbol("@@webxr-polyfill/XRRenderState"),bb=Object.freeze({depthNear:.1,depthFar:1E3,inlineVerticalFieldOfView:null,baseLayer:null}),
eb=function(w){w=void 0===w?{}:w;w=Object.assign({},bb,w);this[gb]={config:w}};$jscomp.global.Object.defineProperties(eb.prototype,{depthNear:{configurable:!0,enumerable:!0,get:function(){return this[gb].config.depthNear}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this[gb].config.depthFar}},inlineVerticalFieldOfView:{configurable:!0,enumerable:!0,get:function(){return this[gb].config.inlineVerticalFieldOfView}},baseLayer:{configurable:!0,enumerable:!0,get:function(){return this[gb].config.baseLayer}}});
var ib=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),V=Symbol("@@webxr-polyfill/xr-compatible"),ia=Symbol("@@webxr-polyfill/XRWebGLLayer"),za=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),ua=function(w,C,N){N=void 0===N?{}:N;N=Object.assign({},za,N);if(!(w instanceof Oa))throw Error("session must be a XRSession");if(w.ended)throw Error("InvalidStateError");if(C[ib]&&!0!==C[V])throw Error("InvalidStateError");var P=C.getParameter(C.FRAMEBUFFER_BINDING);
this[ia]={context:C,config:N,framebuffer:P,session:w}};ua.prototype.getViewport=function(w){return w._getViewport(this)};ua.getNativeFramebufferScaleFactor=function(w){if(!w)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return w[ba].ended?0:1};$jscomp.global.Object.defineProperties(ua.prototype,{context:{configurable:!0,enumerable:!0,get:function(){return this[ia].context}},antialias:{configurable:!0,enumerable:!0,get:function(){return this[ia].config.antialias}},
ignoreDepthValues:{configurable:!0,enumerable:!0,get:function(){return!0}},framebuffer:{configurable:!0,enumerable:!0,get:function(){return this[ia].framebuffer}},framebufferWidth:{configurable:!0,enumerable:!0,get:function(){return this[ia].context.drawingBufferWidth}},framebufferHeight:{configurable:!0,enumerable:!0,get:function(){return this[ia].context.drawingBufferHeight}},_session:{configurable:!0,enumerable:!0,get:function(){return this[ia].session}}});var Ea=Symbol("@@webxr-polyfill/XRInputSourceEvent"),
Na=Symbol("@@webxr-polyfill/XRSessionEvent"),ea=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),ba=Symbol("@@webxr-polyfill/XRSession"),Qa=function(w){return Ga.call(this,w)||this};$jscomp.inherits(Qa,Ga);Qa.prototype._onPoseUpdate=function(w){this._inverseBaseMatrix=w.getBaseViewMatrix(this._specialType)};$jscomp.global.Object.defineProperties(Qa.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this._specialType}}});var Oa=function(w,C,N){var P=G.call(this)||this;var ha="inline"!=
C,xa=new eb({inlineVerticalFieldOfView:ha?null:.5*Math.PI});P[ba]={device:w,mode:C,immersive:ha,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:N,activeRenderState:xa,pendingRenderState:null,viewerSpace:new R("viewer"),viewSpaces:[],currentInputSources:[]};ha?P[ba].viewSpaces.push(new Qa("left"),new Qa("right")):P[ba].viewSpaces.push(new Qa("none"));P[ba].onDeviceFrame=function(){if(!P[ba].ended&&!P[ba].suspended){P[ba].deviceFrameHandle=
null;P[ba].startDeviceFrameLoop();if(null!==P[ba].pendingRenderState&&(P[ba].activeRenderState=new eb(P[ba].pendingRenderState),P[ba].pendingRenderState=null,P[ba].activeRenderState.baseLayer))P[ba].device.onBaseLayerSet(P[ba].id,P[ba].activeRenderState.baseLayer);if(null!==P[ba].activeRenderState.baseLayer){var ya=new Ka(w,P,P[ba].id),La=P[ba].currentFrameCallbacks=P[ba].frameCallbacks;P[ba].frameCallbacks=[];ya[Ia].active=!0;ya[Ia].animationFrame=!0;P[ba].device.onFrameStart(P[ba].id,P[ba].activeRenderState);
P._checkInputSourcesChange();for(var Wa=fa(),Za=0;Za<La.length;Za++)try{La[Za].cancelled||"function"!==typeof La[Za].callback||La[Za].callback(Wa,ya)}catch(Ya){console.error(Ya)}P[ba].currentFrameCallbacks=null;ya[Ia].active=!1;P[ba].device.onFrameEnd(P[ba].id)}}};P[ba].startDeviceFrameLoop=function(){null===P[ba].deviceFrameHandle&&(P[ba].deviceFrameHandle=P[ba].device.requestAnimationFrame(P[ba].onDeviceFrame))};P[ba].stopDeviceFrameLoop=function(){var ya=P[ba].deviceFrameHandle;null!==ya&&(P[ba].device.cancelAnimationFrame(ya),
P[ba].deviceFrameHandle=null)};P[ba].onPresentationEnd=function(ya){ya!==P[ba].id?(P[ba].suspended=!1,P[ba].startDeviceFrameLoop(),P.dispatchEvent("focus",{session:P})):(P[ba].ended=!0,P[ba].stopDeviceFrameLoop(),w.removeEventListener("@@webxr-polyfill/vr-present-end",P[ba].onPresentationEnd),w.removeEventListener("@@webxr-polyfill/vr-present-start",P[ba].onPresentationStart),w.removeEventListener("@@webxr-polyfill/input-select-start",P[ba].onSelectStart),w.removeEventListener("@@webxr-polyfill/input-select-end",
P[ba].onSelectEnd),P.dispatchEvent("end",z("end",{session:P})))};w.addEventListener("@@webxr-polyfill/vr-present-end",P[ba].onPresentationEnd);P[ba].onPresentationStart=function(ya){ya!==P[ba].id&&(P[ba].suspended=!0,P[ba].stopDeviceFrameLoop(),P.dispatchEvent("blur",{session:P}))};w.addEventListener("@@webxr-polyfill/vr-present-start",P[ba].onPresentationStart);P[ba].onSelectStart=function(ya){ya.sessionId===P[ba].id&&P[ba].dispatchInputSourceEvent("selectstart",ya.inputSource)};w.addEventListener("@@webxr-polyfill/input-select-start",
P[ba].onSelectStart);P[ba].onSelectEnd=function(ya){ya.sessionId===P[ba].id&&(P[ba].dispatchInputSourceEvent("selectend",ya.inputSource),P[ba].dispatchInputSourceEvent("select",ya.inputSource))};w.addEventListener("@@webxr-polyfill/input-select-end",P[ba].onSelectEnd);P[ba].onSqueezeStart=function(ya){ya.sessionId===P[ba].id&&P[ba].dispatchInputSourceEvent("squeezestart",ya.inputSource)};w.addEventListener("@@webxr-polyfill/input-squeeze-start",P[ba].onSqueezeStart);P[ba].onSqueezeEnd=function(ya){ya.sessionId===
P[ba].id&&(P[ba].dispatchInputSourceEvent("squeezeend",ya.inputSource),P[ba].dispatchInputSourceEvent("squeeze",ya.inputSource))};w.addEventListener("@@webxr-polyfill/input-squeeze-end",P[ba].onSqueezeEnd);P[ba].dispatchInputSourceEvent=function(ya,La){var Wa=new Ka(w,P,P[ba].id);La=M(ya,{frame:Wa,inputSource:La});Wa[Ia].active=!0;P.dispatchEvent(ya,La);Wa[Ia].active=!1};P[ba].startDeviceFrameLoop();P.onblur=void 0;P.onfocus=void 0;P.onresetpose=void 0;P.onend=void 0;P.onselect=void 0;P.onselectstart=
void 0;P.onselectend=void 0;return P};$jscomp.inherits(Oa,G);Oa.prototype.requestReferenceSpace=function(w){var C=this,N,P;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){if(1==ha.nextAddress){if(C[ba].ended)return ha.return();if(!S.includes(w))throw new TypeError("XRReferenceSpaceType must be one of "+S);if(!C[ba].device.doesSessionSupportReferenceSpace(C[ba].id,w))throw new DOMException("The "+w+" reference space is not supported by this session.","NotSupportedError");return"viewer"===
w?ha.return(C[ba].viewerSpace):ha.yield(C[ba].device.requestFrameOfReferenceTransform(w),2)}N=ha.yieldResult;if("bounded-floor"===w){if(!N)throw new DOMException(w+" XRReferenceSpace not supported by this device.","NotSupportedError");P=C[ba].device.requestStageBounds();if(!P)throw new DOMException(w+" XRReferenceSpace not supported by this device.","NotSupportedError");throw new DOMException("The WebXR polyfill does not support the "+w+" reference space yet.","NotSupportedError");}return ha.return(new R(w,
N))})};Oa.prototype.requestAnimationFrame=function(w){if(!this[ba].ended){var C=++this[ba].frameHandle;this[ba].frameCallbacks.push({handle:C,callback:w,cancelled:!1});return C}};Oa.prototype.cancelAnimationFrame=function(w){var C=this[ba].frameCallbacks,N=C.findIndex(function(P){return P&&P.handle===w});-1<N&&(C[N].cancelled=!0,C.splice(N,1));if(C=this[ba].currentFrameCallbacks)N=C.findIndex(function(P){return P&&P.handle===w}),-1<N&&(C[N].cancelled=!0)};Oa.prototype.end=function(){var w=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(C){if(w[ba].ended)return C.return();
w[ba].immersive&&(w[ba].ended=!0,w[ba].device.removeEventListener("@@webxr-polyfill/vr-present-start",w[ba].onPresentationStart),w[ba].device.removeEventListener("@@webxr-polyfill/vr-present-end",w[ba].onPresentationEnd),w[ba].device.removeEventListener("@@webxr-polyfill/input-select-start",w[ba].onSelectStart),w[ba].device.removeEventListener("@@webxr-polyfill/input-select-end",w[ba].onSelectEnd),w.dispatchEvent("end",z("end",{session:w})));w[ba].stopDeviceFrameLoop();return C.return(w[ba].device.endSession(w[ba].id))})};
Oa.prototype.updateRenderState=function(w){if(this[ba].ended)throw Error("Can't call updateRenderState on an XRSession that has already ended.");if(w.baseLayer&&w.baseLayer._session!==this)throw Error("Called updateRenderState with a base layer that was created by a different session.");if(null!==w.inlineVerticalFieldOfView&&void 0!==w.inlineVerticalFieldOfView){if(this[ba].immersive)throw Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.");
w.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,w.inlineVerticalFieldOfView))}if(null===this[ba].pendingRenderState){var C=this[ba].activeRenderState;this[ba].pendingRenderState={depthNear:C.depthNear,depthFar:C.depthFar,inlineVerticalFieldOfView:C.inlineVerticalFieldOfView,baseLayer:C.baseLayer}}Object.assign(this[ba].pendingRenderState,w)};Oa.prototype._checkInputSourcesChange=function(){for(var w=[],C=[],N=this.inputSources,P=this[ba].currentInputSources,ha=$jscomp.makeIterator(N),xa=ha.next();!xa.done;xa=
ha.next())xa=xa.value,P.includes(xa)||w.push(xa);P=$jscomp.makeIterator(P);for(ha=P.next();!ha.done;ha=P.next())ha=ha.value,N.includes(ha)||C.push(ha);(0<w.length||0<C.length)&&this.dispatchEvent("inputsourceschange",A("inputsourceschange",{session:this,added:w,removed:C}));this[ba].currentInputSources.length=0;w=$jscomp.makeIterator(N);for(xa=w.next();!xa.done;xa=w.next())this[ba].currentInputSources.push(xa.value)};$jscomp.global.Object.defineProperties(Oa.prototype,{renderState:{configurable:!0,
enumerable:!0,get:function(){return this[ba].activeRenderState}},environmentBlendMode:{configurable:!0,enumerable:!0,get:function(){return this[ba].device.environmentBlendMode||"opaque"}},inputSources:{configurable:!0,enumerable:!0,get:function(){return this[ba].device.getInputSources()}}});var Sa=Symbol("@@webxr-polyfill/XRInputSource"),db=function(w){this[Sa]={impl:w,gripSpace:new Ga("grip",this),targetRaySpace:new Ga("target-ray",this)}};$jscomp.global.Object.defineProperties(db.prototype,{handedness:{configurable:!0,
enumerable:!0,get:function(){return this[Sa].impl.handedness}},targetRayMode:{configurable:!0,enumerable:!0,get:function(){return this[Sa].impl.targetRayMode}},gripSpace:{configurable:!0,enumerable:!0,get:function(){var w=this[Sa].impl.targetRayMode;return"gaze"===w||"screen"===w?null:this[Sa].gripSpace}},targetRaySpace:{configurable:!0,enumerable:!0,get:function(){return this[Sa].targetRaySpace}},profiles:{configurable:!0,enumerable:!0,get:function(){return this[Sa].impl.profiles}},gamepad:{configurable:!0,
enumerable:!0,get:function(){return this[Sa].impl.gamepad}}});var fb=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Ra={XRSystem:Aa,XRSession:Oa,XRSessionEvent:z,XRFrame:Ka,XRView:Ha,XRViewport:pa,XRViewerPose:Ta,XRWebGLLayer:ua,XRSpace:Ga,XRReferenceSpace:R,XRReferenceSpaceEvent:y,XRInputSource:db,XRInputSourceEvent:M,XRInputSourcesChangeEvent:A,XRRenderState:eb,XRRigidTransform:Ba,XRPose:sa},Cb=function(w){if("function"===typeof w.prototype.makeXRCompatible)return!1;w.prototype.makeXRCompatible=
function(){this[V]=!0;return Promise.resolve()};return!0},Fb=function(w){var C=w.prototype.getContext;w.prototype.getContext=function(N,P){if(N=C.call(this,N,P))N[ib]=!0,P&&"xrCompatible"in P&&(N[V]=P.xrCompatible);return N}},Vb=function(w){var C=!1;w=w.navigator.userAgent||w.navigator.vendor||w.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(w)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(w.substr(0,
4)))C=!0;return C},Ob="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},mc=function(w){return w&&w.__esModule&&Object.prototype.hasOwnProperty.call(w,"default")?w["default"]:w}(function(w,C){return C={exports:{}},w(C,C.exports),C.exports}(function(w,C){(function(N,P){w.exports=P()})(Ob,function(){function N(x,F,L,X){this.gl=x;this.cardboardUI=F;this.bufferScale=L;this.dirtySubmitFrameBindings=X;this.ctxAttribs=x.getContextAttributes();this.instanceExt=
x.getExtension("ANGLE_instanced_arrays");this.meshHeight=this.meshWidth=20;this.bufferWidth=x.drawingBufferWidth;this.bufferHeight=x.drawingBufferHeight;this.realBindFramebuffer=x.bindFramebuffer;this.realEnable=x.enable;this.realDisable=x.disable;this.realColorMask=x.colorMask;this.realClearColor=x.clearColor;this.realViewport=x.viewport;ab()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(x.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(x.canvas.__proto__,
"height"));this.isPatched=!1;this.lastBoundFramebuffer=null;this.stencilTest=this.scissorTest=this.blend=this.depthTest=this.cullFace=!1;this.viewport=[0,0,0,0];this.colorMask=[!0,!0,!0,!0];this.clearColor=[0,0,0,0];this.attribs={position:0,texCoord:1};this.program=xc(x,"attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}",
"precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}",this.attribs);this.uniforms=yc(x,this.program);this.viewportOffsetScale=new Float32Array(8);this.setTextureBounds();this.vertexBuffer=x.createBuffer();this.indexBuffer=x.createBuffer();this.indexCount=0;this.renderTarget=x.createTexture();this.framebuffer=x.createFramebuffer();this.stencilBuffer=this.depthBuffer=this.depthStencilBuffer=null;this.ctxAttribs.depth&&
this.ctxAttribs.stencil?this.depthStencilBuffer=x.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=x.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=x.createRenderbuffer());this.patch();this.onResize()}function P(x){this.gl=x;this.attribs={position:0};this.program=xc(x,"attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",
this.attribs);this.uniforms=yc(x,this.program);this.vertexBuffer=x.createBuffer();this.arrowVertexCount=this.arrowOffset=this.gearVertexCount=this.gearOffset=0;this.projMat=new Float32Array(16);this.listener=null;this.onResize()}function ha(x){this.coefficients=x}function xa(x){this.width=x.width||Xb();this.height=x.height||Yb();this.widthMeters=x.widthMeters;this.heightMeters=x.heightMeters;this.bevelMeters=x.bevelMeters}function ya(x,F){this.viewer=qc.CardboardV2;this.updateDeviceParams(x);this.distortion=
new ha(this.viewer.distortionCoefficients);for(x=0;x<F.length;x++){var L=F[x];qc[L.id]=new La(L)}}function La(x){this.id=x.id;this.label=x.label;this.fov=x.fov;this.interLensDistance=x.interLensDistance;this.baselineLensDistance=x.baselineLensDistance;this.screenLensDistance=x.screenLensDistance;this.distortionCoefficients=x.distortionCoefficients;this.inverseCoefficients=x.inverseCoefficients}function Wa(x,F){this.dpdb=Kc;this.recalculateDeviceParams_();if(x){this.onDeviceParamsUpdated=F;var L=new XMLHttpRequest,
X=this;L.open("GET",x,!0);L.addEventListener("load",function(){X.loading=!1;200<=L.status&&299>=L.status?(X.dpdb=JSON.parse(L.response),X.recalculateDeviceParams_()):console.error("Error loading online DPDB!")});L.send()}}function Za(x){this.xdpi=x.xdpi;this.ydpi=x.ydpi;this.bevelMm=x.bevelMm}function Ya(x,F){this.set(x,F)}function kb(x,F){this.kFilter=x;this.isDebug=F;this.currentAccelMeasurement=new Ya;this.currentGyroMeasurement=new Ya;this.previousGyroMeasurement=new Ya;ab()?this.filterQ=new lb(-1,
0,0,1):this.filterQ=new lb(1,0,0,1);this.previousFilterQ=new lb;this.previousFilterQ.copy(this.filterQ);this.accelQ=new lb;this.isOrientationInitialized=!1;this.estimatedGravity=new yb;this.measuredGravity=new yb;this.gyroIntegralQ=new lb}function wb(x,F){this.predictionTimeS=x;this.isDebug=F;this.previousQ=new lb;this.previousTimestampS=null;this.deltaQ=new lb;this.outQ=new lb}function ob(x,F,L,X){this.yawOnly=L;this.accelerometer=new yb;this.gyroscope=new yb;this.filter=new kb(x,X);this.posePredictor=
new wb(F,X);this.isFirefoxAndroid=Qb();this.isIOS=ab();x=Mb();this.isDeviceMotionInRadians=!this.isIOS&&x&&66>x;this.isWithoutDeviceMotion=Sb()||Rb();this.filterToWorldQ=new lb;ab()?this.filterToWorldQ.setFromAxisAngle(new yb(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new yb(1,0,0),-Math.PI/2);this.inverseWorldToScreenQ=new lb;this.worldToScreenQ=new lb;this.originalPoseAdjustQ=new lb;this.originalPoseAdjustQ.setFromAxisAngle(new yb(0,0,1),-window.orientation*Math.PI/180);this.setScreenTransform_();
ub()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);this.resetQ=new lb;this.orientationOut_=new Float32Array(4);this.start()}function pb(){this.loadIcon_();var x=document.createElement("div"),F=x.style;F.position="fixed";F.top=0;F.right=0;F.bottom=0;F.left=0;F.backgroundColor="gray";F.fontFamily="sans-serif";F.zIndex=1E6;var L=document.createElement("img");L.src=this.icon;F=L.style;F.marginLeft="25%";F.marginTop="25%";F.width="50%";x.appendChild(L);L=document.createElement("div");F=L.style;
F.textAlign="center";F.fontSize="16px";F.lineHeight="24px";F.margin="24px 25%";F.width="50%";L.innerHTML="Place your phone into your Cardboard viewer.";x.appendChild(L);var X=document.createElement("div");F=X.style;F.backgroundColor="#CFD8DC";F.position="fixed";F.bottom=0;F.width="100%";F.height="48px";F.padding="14px 24px";F.boxSizing="border-box";F.color="#656A6B";x.appendChild(X);var ta=document.createElement("div");ta.style.float="left";ta.innerHTML="No Cardboard viewer?";var da=document.createElement("a");
da.href="https://www.google.com/get/cardboard/get-cardboard/";da.innerHTML="get one";da.target="_blank";F=da.style;F.float="right";F.fontWeight=600;F.textTransform="uppercase";F.borderLeft="1px solid gray";F.paddingLeft="24px";F.textDecoration="none";F.color="#656A6B";X.appendChild(ta);X.appendChild(da);this.overlay=x;this.text=L;this.hide()}function nb(x){try{this.selectedKey=localStorage.getItem("WEBVR_CARDBOARD_VIEWER")}catch(F){console.error("Failed to load viewer profile: %s",F)}this.selectedKey||
(this.selectedKey=x||"CardboardV1");this.dialog=this.createDialog_(ya.Viewers);this.root=null;this.onChangeCallbacks_=[]}function xb(x){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:x.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:x.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:x.canPresent},maxLayers:{writable:!1,enumerable:!0,value:x.maxLayers},hasOrientation:{enumerable:!0,get:function(){Tb("VRDisplayCapabilities.prototype.hasOrientation",
"VRDisplay.prototype.getFrameData");return x.hasOrientation}}})}function hb(x){x=x||{};x="wakelock"in x?x.wakelock:!0;this.isPolyfilled=!0;this.displayId=Lc++;this.displayName="";this.depthNear=.01;this.depthFar=1E4;this.isPresenting=!1;Object.defineProperty(this,"isConnected",{get:function(){Tb("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay");return!1}});this.capabilities=new xb({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1});
this.stageParameters=null;this.waitingForPresent_=!1;this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=this.fullscreenElementCachedStyle_=this.fullscreenWrapper_=this.fullscreenElement_=this.originalParent_=this.layer_=null;x&&rc()&&(this.wakelock_=new Mc)}function $a(x){var F=zc({},Nc);x=zc(F,x||{});hb.call(this,{wakelock:x.MOBILE_WAKE_LOCK});this.config=x;this.displayName="Cardboard VRDisplay";this.capabilities=new xb({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,
canPresent:!0,maxLayers:1});this.stageParameters=null;this.bufferScale_=this.config.BUFFER_SCALE;this.poseSensor_=new Oc(this.config);this.cardboardUI_=this.distorter_=null;this.dpdb_=new Wa(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this));this.deviceInfo_=new ya(this.dpdb_.getDeviceParams(),x.ADDITIONAL_VIEWERS);this.viewerSelector_=new nb(x.DEFAULT_VIEWER);this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());
this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new pb);ab()&&window.addEventListener("resize",this.onResize_.bind(this))}var qb=function(){function x(F,L){for(var X=0;X<L.length;X++){var ta=L[X];ta.enumerable=ta.enumerable||!1;ta.configurable=!0;"value"in ta&&(ta.writable=!0);Object.defineProperty(F,ta.key,ta)}}return function(F,L,X){L&&x(F.prototype,L);X&&x(F,X);return F}}(),rb=function(){return function(x,F){if(Array.isArray(x))return x;if(Symbol.iterator in Object(x)){var L=
[],X=!0,ta=!1,da=void 0;try{for(var ja=x[Symbol.iterator](),Ja;!(X=(Ja=ja.next()).done)&&(L.push(Ja.value),!F||L.length!==F);X=!0);}catch(Pa){ta=!0,da=Pa}finally{try{if(!X&&ja["return"])ja["return"]()}finally{if(ta)throw da;}}return L}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),ab=function(){var x=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return x}}(),Ib=function(){var x=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&
-1!==navigator.userAgent.indexOf("Chrome");return function(){return x}}(),Pb=function(){var x=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return x}}(),Qb=function(){var x=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return x}}(),Mb=function(){var x=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),F=x?parseInt(x[1],10):null;return function(){return F}}(),Rb=function(){var x=!1;x=ab()&&Pb()&&-1!==navigator.userAgent.indexOf("13_4");
return function(){return x}}(),Sb=function(){var x=!1;if(65===Mb()){var F=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(F){F=F[1].split(".");F=rb(F,4);var L=F[3];x=3325===parseInt(F[2],10)&&148>parseInt(L,10)}}return function(){return x}}(),Nb=function(){var x=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return x}}(),ub=function(){var x=90==window.orientation||-90==window.orientation;return Nb()?!x:x},Xb=function(){return Math.max(window.screen.width,window.screen.height)*
window.devicePixelRatio},Yb=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},Pc=function(x){if(Ib())return!1;if(x.requestFullscreen)x.requestFullscreen();else if(x.webkitRequestFullscreen)x.webkitRequestFullscreen();else if(x.mozRequestFullScreen)x.mozRequestFullScreen();else if(x.msRequestFullscreen)x.msRequestFullscreen();else return!1;return!0},Ac=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();
else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},xc=function(x,F,L,X){var ta=x.createShader(x.VERTEX_SHADER);x.shaderSource(ta,F);x.compileShader(ta);F=x.createShader(x.FRAGMENT_SHADER);x.shaderSource(F,L);x.compileShader(F);L=x.createProgram();x.attachShader(L,ta);x.attachShader(L,F);for(var da in X)x.bindAttribLocation(L,X[da],da);x.linkProgram(L);x.deleteShader(ta);x.deleteShader(F);return L},
yc=function(x,F){for(var L={},X=x.getProgramParameter(F,x.ACTIVE_UNIFORMS),ta,da=0;da<X;da++)ta=x.getActiveUniform(F,da).name.replace("[0]",""),L[ta]=x.getUniformLocation(F,ta);return L},rc=function(){var x=!1,F=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(F)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(F.substr(0,
4)))x=!0;return x},zc=function(x,F){for(var L in F)F.hasOwnProperty(L)&&(x[L]=F[L]);return x},sc=function(x){if(ab()){var F=x.style.width,L=x.style.height;x.style.width=parseInt(F)+1+"px";x.style.height=parseInt(L)+"px";setTimeout(function(){x.style.width=F;x.style.height=L},100)}window.canvas=x},Qc=function(){function x(da,ja,Ja,Pa,Ma,Ua){var Va=Pa||null;Pa=Ua.depthNear;Ua=Ua.depthFar;var cb=Math.tan(Va?Va.upDegrees*F:L),mb=Math.tan(Va?Va.downDegrees*F:L),zb=Math.tan(Va?Va.leftDegrees*F:L);Va=Math.tan(Va?
Va.rightDegrees*F:L);var jb=2/(zb+Va),vb=2/(cb+mb);da[0]=jb;da[1]=0;da[2]=0;da[3]=0;da[4]=0;da[5]=vb;da[6]=0;da[7]=0;da[8]=-((zb-Va)*jb*.5);da[9]=(cb-mb)*vb*.5;da[10]=Ua/(Pa-Ua);da[11]=-1;da[12]=0;da[13]=0;da[14]=Ua*Pa/(Pa-Ua);da[15]=0;da=Ja.orientation||X;Ja=Ja.position||ta;mb=da[0];jb=da[1];vb=da[2];Ua=da[3];var Eb=mb+mb;Va=jb+jb;cb=vb+vb;da=mb*Eb;Pa=mb*Va;mb*=cb;zb=jb*Va;jb*=cb;vb*=cb;Eb*=Ua;Va*=Ua;Ua*=cb;ja[0]=1-(zb+vb);ja[1]=Pa+Ua;ja[2]=mb-Va;ja[3]=0;ja[4]=Pa-Ua;ja[5]=1-(da+vb);ja[6]=jb+Eb;ja[7]=
0;ja[8]=mb+Va;ja[9]=jb-Eb;ja[10]=1-(da+zb);ja[11]=0;ja[12]=Ja[0];ja[13]=Ja[1];ja[14]=Ja[2];ja[15]=1;if(Ma)if(Ja=Ma[0],da=Ma[1],Ma=Ma[2],ja===ja)ja[12]=ja[0]*Ja+ja[4]*da+ja[8]*Ma+ja[12],ja[13]=ja[1]*Ja+ja[5]*da+ja[9]*Ma+ja[13],ja[14]=ja[2]*Ja+ja[6]*da+ja[10]*Ma+ja[14],ja[15]=ja[3]*Ja+ja[7]*da+ja[11]*Ma+ja[15];else{Pa=ja[0];Ua=ja[1];cb=ja[2];mb=ja[3];zb=ja[4];Va=ja[5];jb=ja[6];vb=ja[7];Eb=ja[8];var Jb=ja[9];var Kb=ja[10];var Lb=ja[11];ja[0]=Pa;ja[1]=Ua;ja[2]=cb;ja[3]=mb;ja[4]=zb;ja[5]=Va;ja[6]=jb;ja[7]=
vb;ja[8]=Eb;ja[9]=Jb;ja[10]=Kb;ja[11]=Lb;ja[12]=Pa*Ja+zb*da+Eb*Ma+ja[12];ja[13]=Ua*Ja+Va*da+Jb*Ma+ja[13];ja[14]=cb*Ja+jb*da+Kb*Ma+ja[14];ja[15]=mb*Ja+vb*da+Lb*Ma+ja[15]}Ma=ja[0];Ja=ja[1];da=ja[2];Pa=ja[3];Ua=ja[4];cb=ja[5];mb=ja[6];zb=ja[7];Va=ja[8];jb=ja[9];vb=ja[10];Eb=ja[11];Jb=ja[12];Kb=ja[13];Lb=ja[14];var Wb=ja[15],Zb=Ma*cb-Ja*Ua,$b=Ma*mb-da*Ua,ac=Ma*zb-Pa*Ua,bc=Ja*mb-da*cb,cc=Ja*zb-Pa*cb,dc=da*zb-Pa*mb,ec=Va*Kb-jb*Jb,fc=Va*Lb-vb*Jb,gc=Va*Wb-Eb*Jb,hc=jb*Lb-vb*Kb,ic=jb*Wb-Eb*Kb,jc=vb*Wb-Eb*Lb,
Bb=Zb*jc-$b*ic+ac*hc+bc*gc-cc*fc+dc*ec;Bb&&(Bb=1/Bb,ja[0]=(cb*jc-mb*ic+zb*hc)*Bb,ja[1]=(da*ic-Ja*jc-Pa*hc)*Bb,ja[2]=(Kb*dc-Lb*cc+Wb*bc)*Bb,ja[3]=(vb*cc-jb*dc-Eb*bc)*Bb,ja[4]=(mb*gc-Ua*jc-zb*fc)*Bb,ja[5]=(Ma*jc-da*gc+Pa*fc)*Bb,ja[6]=(Lb*ac-Jb*dc-Wb*$b)*Bb,ja[7]=(Va*dc-vb*ac+Eb*$b)*Bb,ja[8]=(Ua*ic-cb*gc+zb*ec)*Bb,ja[9]=(Ja*gc-Ma*ic-Pa*ec)*Bb,ja[10]=(Jb*cc-Kb*ac+Wb*Zb)*Bb,ja[11]=(jb*ac-Va*cc-Eb*Zb)*Bb,ja[12]=(cb*fc-Ua*hc-mb*ec)*Bb,ja[13]=(Ma*hc-Ja*fc+da*ec)*Bb,ja[14]=(Kb*$b-Jb*bc-Lb*Zb)*Bb,ja[15]=(Va*
bc-jb*$b+vb*Zb)*Bb)}var F=Math.PI/180,L=.25*Math.PI,X=new Float32Array([0,0,0,1]),ta=new Float32Array([0,0,0]);return function(da,ja,Ja){if(!da||!ja)return!1;da.pose=ja;da.timestamp=ja.timestamp;x(da.leftProjectionMatrix,da.leftViewMatrix,ja,Ja._getFieldOfView("left"),Ja._getEyeOffset("left"),Ja);x(da.rightProjectionMatrix,da.rightViewMatrix,ja,Ja._getFieldOfView("right"),Ja._getEyeOffset("right"),Ja);return!0}}(),Bc=function(x){var F=x.indexOf("://");F=x.indexOf("/",-1!==F?F+3:0);-1===F&&(F=x.length);
return x.substring(0,F)},tc=function(){var x={};return function(F,L){void 0===x[F]&&(console.warn("webvr-polyfill: "+L),x[F]=!0)}}(),Tb=function(x,F){tc(x,x+" has been deprecated. This may not work on native WebVR displays. "+(F?"Please use "+F+" instead.":""))},kc=function(x,F,L){if(F){for(var X=[],ta=null,da=0;da<F.length;++da){var ja=F[da];switch(ja){case x.TEXTURE_BINDING_2D:case x.TEXTURE_BINDING_CUBE_MAP:var Ja=F[++da];if(Ja<x.TEXTURE0||Ja>x.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");
X.push(null,null);break}ta||(ta=x.getParameter(x.ACTIVE_TEXTURE));x.activeTexture(Ja);X.push(x.getParameter(ja),null);break;case x.ACTIVE_TEXTURE:ta=x.getParameter(x.ACTIVE_TEXTURE);X.push(null);break;default:X.push(x.getParameter(ja))}}L(x);for(da=0;da<F.length;++da){ja=F[da];L=X[da];switch(ja){case x.ACTIVE_TEXTURE:break;case x.ARRAY_BUFFER_BINDING:x.bindBuffer(x.ARRAY_BUFFER,L);break;case x.COLOR_CLEAR_VALUE:x.clearColor(L[0],L[1],L[2],L[3]);break;case x.COLOR_WRITEMASK:x.colorMask(L[0],L[1],L[2],
L[3]);break;case x.CURRENT_PROGRAM:x.useProgram(L);break;case x.ELEMENT_ARRAY_BUFFER_BINDING:x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,L);break;case x.FRAMEBUFFER_BINDING:x.bindFramebuffer(x.FRAMEBUFFER,L);break;case x.RENDERBUFFER_BINDING:x.bindRenderbuffer(x.RENDERBUFFER,L);break;case x.TEXTURE_BINDING_2D:Ja=F[++da];if(Ja<x.TEXTURE0||Ja>x.TEXTURE31)break;x.activeTexture(Ja);x.bindTexture(x.TEXTURE_2D,L);break;case x.TEXTURE_BINDING_CUBE_MAP:Ja=F[++da];if(Ja<x.TEXTURE0||Ja>x.TEXTURE31)break;x.activeTexture(Ja);
x.bindTexture(x.TEXTURE_CUBE_MAP,L);break;case x.VIEWPORT:x.viewport(L[0],L[1],L[2],L[3]);break;case x.BLEND:case x.CULL_FACE:case x.DEPTH_TEST:case x.SCISSOR_TEST:case x.STENCIL_TEST:L?x.enable(ja):x.disable(ja);break;default:console.log("No GL restore behavior for 0x"+ja.toString(16))}ta&&x.activeTexture(ta)}}else L(x)};N.prototype.destroy=function(){var x=this.gl;this.unpatch();x.deleteProgram(this.program);x.deleteBuffer(this.vertexBuffer);x.deleteBuffer(this.indexBuffer);x.deleteTexture(this.renderTarget);
x.deleteFramebuffer(this.framebuffer);this.depthStencilBuffer&&x.deleteRenderbuffer(this.depthStencilBuffer);this.depthBuffer&&x.deleteRenderbuffer(this.depthBuffer);this.stencilBuffer&&x.deleteRenderbuffer(this.stencilBuffer);this.cardboardUI&&this.cardboardUI.destroy()};N.prototype.onResize=function(){var x=this.gl,F=this;kc(x,[x.RENDERBUFFER_BINDING,x.TEXTURE_BINDING_2D,x.TEXTURE0],function(L){F.realBindFramebuffer.call(L,L.FRAMEBUFFER,null);F.scissorTest&&F.realDisable.call(L,L.SCISSOR_TEST);
F.realColorMask.call(L,!0,!0,!0,!0);F.realViewport.call(L,0,0,L.drawingBufferWidth,L.drawingBufferHeight);F.realClearColor.call(L,0,0,0,1);L.clear(L.COLOR_BUFFER_BIT);F.realBindFramebuffer.call(L,L.FRAMEBUFFER,F.framebuffer);L.bindTexture(L.TEXTURE_2D,F.renderTarget);L.texImage2D(L.TEXTURE_2D,0,F.ctxAttribs.alpha?L.RGBA:L.RGB,F.bufferWidth,F.bufferHeight,0,F.ctxAttribs.alpha?L.RGBA:L.RGB,L.UNSIGNED_BYTE,null);L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.LINEAR);L.texParameteri(L.TEXTURE_2D,
L.TEXTURE_MIN_FILTER,L.LINEAR);L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE);L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,F.renderTarget,0);F.ctxAttribs.depth&&F.ctxAttribs.stencil?(L.bindRenderbuffer(L.RENDERBUFFER,F.depthStencilBuffer),L.renderbufferStorage(L.RENDERBUFFER,L.DEPTH_STENCIL,F.bufferWidth,F.bufferHeight),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_STENCIL_ATTACHMENT,L.RENDERBUFFER,
F.depthStencilBuffer)):F.ctxAttribs.depth?(L.bindRenderbuffer(L.RENDERBUFFER,F.depthBuffer),L.renderbufferStorage(L.RENDERBUFFER,L.DEPTH_COMPONENT16,F.bufferWidth,F.bufferHeight),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_ATTACHMENT,L.RENDERBUFFER,F.depthBuffer)):F.ctxAttribs.stencil&&(L.bindRenderbuffer(L.RENDERBUFFER,F.stencilBuffer),L.renderbufferStorage(L.RENDERBUFFER,L.STENCIL_INDEX8,F.bufferWidth,F.bufferHeight),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.STENCIL_ATTACHMENT,L.RENDERBUFFER,
F.stencilBuffer));!L.checkFramebufferStatus(L.FRAMEBUFFER)===L.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!");F.realBindFramebuffer.call(L,L.FRAMEBUFFER,F.lastBoundFramebuffer);F.scissorTest&&F.realEnable.call(L,L.SCISSOR_TEST);F.realColorMask.apply(L,F.colorMask);F.realViewport.apply(L,F.viewport);F.realClearColor.apply(L,F.clearColor)});if(this.cardboardUI)this.cardboardUI.onResize()};N.prototype.patch=function(){if(!this.isPatched){var x=this,F=this.gl.canvas,L=this.gl;ab()||(F.width=
Xb()*this.bufferScale,F.height=Yb()*this.bufferScale,Object.defineProperty(F,"width",{configurable:!0,enumerable:!0,get:function(){return x.bufferWidth},set:function(X){x.bufferWidth=X;x.realCanvasWidth.set.call(F,X);x.onResize()}}),Object.defineProperty(F,"height",{configurable:!0,enumerable:!0,get:function(){return x.bufferHeight},set:function(X){x.bufferHeight=X;x.realCanvasHeight.set.call(F,X);x.onResize()}}));this.lastBoundFramebuffer=L.getParameter(L.FRAMEBUFFER_BINDING);null==this.lastBoundFramebuffer&&
(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(L.FRAMEBUFFER,this.framebuffer));this.gl.bindFramebuffer=function(X,ta){x.lastBoundFramebuffer=ta?ta:x.framebuffer;x.realBindFramebuffer.call(L,X,x.lastBoundFramebuffer)};this.cullFace=L.getParameter(L.CULL_FACE);this.depthTest=L.getParameter(L.DEPTH_TEST);this.blend=L.getParameter(L.BLEND);this.scissorTest=L.getParameter(L.SCISSOR_TEST);this.stencilTest=L.getParameter(L.STENCIL_TEST);L.enable=function(X){switch(X){case L.CULL_FACE:x.cullFace=
!0;break;case L.DEPTH_TEST:x.depthTest=!0;break;case L.BLEND:x.blend=!0;break;case L.SCISSOR_TEST:x.scissorTest=!0;break;case L.STENCIL_TEST:x.stencilTest=!0}x.realEnable.call(L,X)};L.disable=function(X){switch(X){case L.CULL_FACE:x.cullFace=!1;break;case L.DEPTH_TEST:x.depthTest=!1;break;case L.BLEND:x.blend=!1;break;case L.SCISSOR_TEST:x.scissorTest=!1;break;case L.STENCIL_TEST:x.stencilTest=!1}x.realDisable.call(L,X)};this.colorMask=L.getParameter(L.COLOR_WRITEMASK);L.colorMask=function(X,ta,da,
ja){x.colorMask[0]=X;x.colorMask[1]=ta;x.colorMask[2]=da;x.colorMask[3]=ja;x.realColorMask.call(L,X,ta,da,ja)};this.clearColor=L.getParameter(L.COLOR_CLEAR_VALUE);L.clearColor=function(X,ta,da,ja){x.clearColor[0]=X;x.clearColor[1]=ta;x.clearColor[2]=da;x.clearColor[3]=ja;x.realClearColor.call(L,X,ta,da,ja)};this.viewport=L.getParameter(L.VIEWPORT);L.viewport=function(X,ta,da,ja){x.viewport[0]=X;x.viewport[1]=ta;x.viewport[2]=da;x.viewport[3]=ja;x.realViewport.call(L,X,ta,da,ja)};this.isPatched=!0;
sc(F)}};N.prototype.unpatch=function(){if(this.isPatched){var x=this.gl,F=this.gl.canvas;ab()||(Object.defineProperty(F,"width",this.realCanvasWidth),Object.defineProperty(F,"height",this.realCanvasHeight));F.width=this.bufferWidth;F.height=this.bufferHeight;x.bindFramebuffer=this.realBindFramebuffer;x.enable=this.realEnable;x.disable=this.realDisable;x.colorMask=this.realColorMask;x.clearColor=this.realClearColor;x.viewport=this.realViewport;this.lastBoundFramebuffer==this.framebuffer&&x.bindFramebuffer(x.FRAMEBUFFER,
null);this.isPatched=!1;setTimeout(function(){sc(F)},1)}};N.prototype.setTextureBounds=function(x,F){x||(x=[0,0,.5,1]);F||(F=[.5,0,.5,1]);this.viewportOffsetScale[0]=x[0];this.viewportOffsetScale[1]=x[1];this.viewportOffsetScale[2]=x[2];this.viewportOffsetScale[3]=x[3];this.viewportOffsetScale[4]=F[0];this.viewportOffsetScale[5]=F[1];this.viewportOffsetScale[6]=F[2];this.viewportOffsetScale[7]=F[3]};N.prototype.submitFrame=function(){var x=this.gl,F=this,L=[];this.dirtySubmitFrameBindings||L.push(x.CURRENT_PROGRAM,
x.ARRAY_BUFFER_BINDING,x.ELEMENT_ARRAY_BUFFER_BINDING,x.TEXTURE_BINDING_2D,x.TEXTURE0);kc(x,L,function(X){F.realBindFramebuffer.call(X,X.FRAMEBUFFER,null);var ta=0,da=0;F.instanceExt&&(ta=X.getVertexAttrib(F.attribs.position,F.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),da=X.getVertexAttrib(F.attribs.texCoord,F.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE));F.cullFace&&F.realDisable.call(X,X.CULL_FACE);F.depthTest&&F.realDisable.call(X,X.DEPTH_TEST);F.blend&&F.realDisable.call(X,X.BLEND);F.scissorTest&&
F.realDisable.call(X,X.SCISSOR_TEST);F.stencilTest&&F.realDisable.call(X,X.STENCIL_TEST);F.realColorMask.call(X,!0,!0,!0,!0);F.realViewport.call(X,0,0,X.drawingBufferWidth,X.drawingBufferHeight);if(F.ctxAttribs.alpha||ab())F.realClearColor.call(X,0,0,0,1),X.clear(X.COLOR_BUFFER_BIT);X.useProgram(F.program);X.bindBuffer(X.ELEMENT_ARRAY_BUFFER,F.indexBuffer);X.bindBuffer(X.ARRAY_BUFFER,F.vertexBuffer);X.enableVertexAttribArray(F.attribs.position);X.enableVertexAttribArray(F.attribs.texCoord);X.vertexAttribPointer(F.attribs.position,
2,X.FLOAT,!1,20,0);X.vertexAttribPointer(F.attribs.texCoord,3,X.FLOAT,!1,20,8);F.instanceExt&&(0!=ta&&F.instanceExt.vertexAttribDivisorANGLE(F.attribs.position,0),0!=da&&F.instanceExt.vertexAttribDivisorANGLE(F.attribs.texCoord,0));X.activeTexture(X.TEXTURE0);X.uniform1i(F.uniforms.diffuse,0);X.bindTexture(X.TEXTURE_2D,F.renderTarget);X.uniform4fv(F.uniforms.viewportOffsetScale,F.viewportOffsetScale);X.drawElements(X.TRIANGLES,F.indexCount,X.UNSIGNED_SHORT,0);F.cardboardUI&&F.cardboardUI.renderNoState();
F.realBindFramebuffer.call(F.gl,X.FRAMEBUFFER,F.framebuffer);F.ctxAttribs.preserveDrawingBuffer||(F.realClearColor.call(X,0,0,0,0),X.clear(X.COLOR_BUFFER_BIT));F.dirtySubmitFrameBindings||F.realBindFramebuffer.call(X,X.FRAMEBUFFER,F.lastBoundFramebuffer);F.cullFace&&F.realEnable.call(X,X.CULL_FACE);F.depthTest&&F.realEnable.call(X,X.DEPTH_TEST);F.blend&&F.realEnable.call(X,X.BLEND);F.scissorTest&&F.realEnable.call(X,X.SCISSOR_TEST);F.stencilTest&&F.realEnable.call(X,X.STENCIL_TEST);F.realColorMask.apply(X,
F.colorMask);F.realViewport.apply(X,F.viewport);!F.ctxAttribs.alpha&&F.ctxAttribs.preserveDrawingBuffer||F.realClearColor.apply(X,F.clearColor);F.instanceExt&&(0!=ta&&F.instanceExt.vertexAttribDivisorANGLE(F.attribs.position,ta),0!=da&&F.instanceExt.vertexAttribDivisorANGLE(F.attribs.texCoord,da))});ab()&&(x=x.canvas,x.width!=F.bufferWidth||x.height!=F.bufferHeight)&&(F.bufferWidth=x.width,F.bufferHeight=x.height,F.onResize())};N.prototype.updateDeviceInfo=function(x){var F=this.gl,L=this;kc(F,[F.ARRAY_BUFFER_BINDING,
F.ELEMENT_ARRAY_BUFFER_BINDING],function(X){var ta=L.computeMeshVertices_(L.meshWidth,L.meshHeight,x);X.bindBuffer(X.ARRAY_BUFFER,L.vertexBuffer);X.bufferData(X.ARRAY_BUFFER,ta,X.STATIC_DRAW);L.indexCount||(ta=L.computeMeshIndices_(L.meshWidth,L.meshHeight),X.bindBuffer(X.ELEMENT_ARRAY_BUFFER,L.indexBuffer),X.bufferData(X.ELEMENT_ARRAY_BUFFER,ta,X.STATIC_DRAW),L.indexCount=ta.length)})};N.prototype.computeMeshVertices_=function(x,F,L){for(var X=new Float32Array(2*x*F*5),ta=L.getLeftEyeVisibleTanAngles(),
da=L.getLeftEyeNoLensTanAngles(),ja=L.getLeftEyeVisibleScreenRect(da),Ja=0,Pa=0;2>Pa;Pa++){for(var Ma=0;Ma<F;Ma++)for(var Ua=0;Ua<x;Ua++,Ja++){var Va=Ua/(x-1),cb=Ma/(F-1),mb=Va,zb=cb,jb=ta[0];Va=jb+(ta[2]-jb)*Va;jb=ta[3];var vb=jb+(ta[1]-jb)*cb;cb=Math.sqrt(Va*Va+vb*vb);jb=L.distortion.distortInverse(cb);vb=vb*jb/cb;Va=(Va*jb/cb-da[0])/(da[2]-da[0]);cb=(vb-da[3])/(da[1]-da[3]);Va=2*(ja.x+Va*ja.width-.5);cb=2*(ja.y+cb*ja.height-.5);X[5*Ja]=Va;X[5*Ja+1]=cb;X[5*Ja+2]=mb;X[5*Ja+3]=zb;X[5*Ja+4]=Pa}Ma=
ta[2]-ta[0];ta[0]=-(Ma+ta[0]);ta[2]=Ma-ta[2];Ma=da[2]-da[0];da[0]=-(Ma+da[0]);da[2]=Ma-da[2];ja.x=1-(ja.x+ja.width)}return X};N.prototype.computeMeshIndices_=function(x,F){for(var L=new Uint16Array(2*(x-1)*(F-1)*6),X=x/2,ta=F/2,da=0,ja=0,Ja=0;2>Ja;Ja++)for(var Pa=0;Pa<F;Pa++)for(var Ma=0;Ma<x;Ma++,da++)0!=Ma&&0!=Pa&&(Ma<=X==Pa<=ta?(L[ja++]=da,L[ja++]=da-x-1,L[ja++]=da-x,L[ja++]=da-x-1,L[ja++]=da,L[ja++]=da-1):(L[ja++]=da-1,L[ja++]=da-x,L[ja++]=da,L[ja++]=da-x,L[ja++]=da-1,L[ja++]=da-x-1));return L};
N.prototype.getOwnPropertyDescriptor_=function(x,F){x=Object.getOwnPropertyDescriptor(x,F);if(void 0===x.get||void 0===x.set)x.configurable=!0,x.enumerable=!0,x.get=function(){return this.getAttribute(F)},x.set=function(L){this.setAttribute(F,L)};return x};var Cc=Math.PI/180;P.prototype.destroy=function(){var x=this.gl;this.listener&&x.canvas.removeEventListener("click",this.listener,!1);x.deleteProgram(this.program);x.deleteBuffer(this.vertexBuffer)};P.prototype.listen=function(x,F){var L=this.gl.canvas;
this.listener=function(X){var ta=L.clientWidth/2,da=X.touches?X.touches[0].clientX:X.clientX,ja=X.touches?X.touches[0].clientY:X.clientY;da>ta-42&&da<ta+42&&ja>L.clientHeight-42?x(X):42>da&&42>ja&&F(X)};L.addEventListener("click",this.listener,!1);L.addEventListener("touchstart",this.listener,!1)};P.prototype.onResize=function(){var x=this.gl,F=this;kc(x,[x.ARRAY_BUFFER_BINDING],function(L){function X(mb,zb){var jb=(90-mb)*Cc;mb=Math.cos(jb);jb=Math.sin(jb);da.push(.3125*mb*Ua+ja,.3125*jb*Ua+Ua);
da.push(zb*mb*Ua+ja,zb*jb*Ua+Ua)}function ta(mb,zb){da.push(Va+mb,L.drawingBufferHeight-Va-zb)}var da=[],ja=L.drawingBufferWidth/2,Ja=L.drawingBufferWidth/(Math.max(screen.width,screen.height)*window.devicePixelRatio)*window.devicePixelRatio,Pa=4*Ja/2,Ma=42*Ja,Ua=28*Ja/2,Va=14*Ja;da.push(ja-Pa,Ma);da.push(ja-Pa,L.drawingBufferHeight);da.push(ja+Pa,Ma);da.push(ja+Pa,L.drawingBufferHeight);F.gearOffset=da.length/2;for(Ma=0;6>=Ma;Ma++){var cb=60*Ma;X(cb,1);X(cb+12,1);X(cb+20,.75);X(cb+40,.75);X(cb+48,
1)}F.gearVertexCount=da.length/2-F.gearOffset;F.arrowOffset=da.length/2;Ma=Pa/Math.sin(45*Cc);ta(0,Ua);ta(Ua,0);ta(Ua+Ma,Ma);ta(Ma,Ua+Ma);ta(Ma,Ua-Ma);ta(0,Ua);ta(Ua,2*Ua);ta(Ua+Ma,2*Ua-Ma);ta(Ma,Ua-Ma);ta(0,Ua);ta(Ma,Ua-Pa);ta(28*Ja,Ua-Pa);ta(Ma,Ua+Pa);ta(28*Ja,Ua+Pa);F.arrowVertexCount=da.length/2-F.arrowOffset;L.bindBuffer(L.ARRAY_BUFFER,F.vertexBuffer);L.bufferData(L.ARRAY_BUFFER,new Float32Array(da),L.STATIC_DRAW)})};P.prototype.render=function(){var x=this.gl,F=this;kc(x,[x.CULL_FACE,x.DEPTH_TEST,
x.BLEND,x.SCISSOR_TEST,x.STENCIL_TEST,x.COLOR_WRITEMASK,x.VIEWPORT,x.CURRENT_PROGRAM,x.ARRAY_BUFFER_BINDING],function(L){L.disable(L.CULL_FACE);L.disable(L.DEPTH_TEST);L.disable(L.BLEND);L.disable(L.SCISSOR_TEST);L.disable(L.STENCIL_TEST);L.colorMask(!0,!0,!0,!0);L.viewport(0,0,L.drawingBufferWidth,L.drawingBufferHeight);F.renderNoState()})};P.prototype.renderNoState=function(){var x=this.gl;x.useProgram(this.program);x.bindBuffer(x.ARRAY_BUFFER,this.vertexBuffer);x.enableVertexAttribArray(this.attribs.position);
x.vertexAttribPointer(this.attribs.position,2,x.FLOAT,!1,8,0);x.uniform4f(this.uniforms.color,1,1,1,1);var F=this.projMat,L=x.drawingBufferWidth,X=x.drawingBufferHeight,ta=1/(0-L),da=1/(0-X),ja=1/-1023.9;F[0]=-2*ta;F[1]=0;F[2]=0;F[3]=0;F[4]=0;F[5]=-2*da;F[6]=0;F[7]=0;F[8]=0;F[9]=0;F[10]=2*ja;F[11]=0;F[12]=(0+L)*ta;F[13]=(X+0)*da;F[14]=1024.1*ja;F[15]=1;x.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat);x.drawArrays(x.TRIANGLE_STRIP,0,4);x.drawArrays(x.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount);
x.drawArrays(x.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};ha.prototype.distortInverse=function(x){for(var F=0,L=1,X=x-this.distort(F);1E-4<Math.abs(L-F);){var ta=x-this.distort(L);X=L-(L-F)/(ta-X)*ta;F=L;L=X;X=ta}return L};ha.prototype.distort=function(x){for(var F=x*x,L=0,X=0;X<this.coefficients.length;X++)L=F*(L+this.coefficients[X]);return(L+1)*x};var Gb=Math.PI/180,Hb=180/Math.PI,yb=function(x,F,L){this.x=x||0;this.y=F||0;this.z=L||0};yb.prototype={constructor:yb,set:function(x,F,
L){this.x=x;this.y=F;this.z=L;return this},copy:function(x){this.x=x.x;this.y=x.y;this.z=x.z;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var x=this.length();0!==x?this.multiplyScalar(1/x):this.z=this.y=this.x=0;return this},multiplyScalar:function(x){this.x*=x;this.y*=x;this.z*=x},applyQuaternion:function(x){var F=this.x,L=this.y,X=this.z,ta=x.x,da=x.y,ja=x.z;x=x.w;var Ja=x*F+da*X-ja*L,Pa=x*L+ja*F-ta*X,Ma=x*X+ta*L-da*F;F=-ta*F-da*
L-ja*X;this.x=Ja*x+F*-ta+Pa*-ja-Ma*-da;this.y=Pa*x+F*-da+Ma*-ta-Ja*-ja;this.z=Ma*x+F*-ja+Ja*-da-Pa*-ta;return this},dot:function(x){return this.x*x.x+this.y*x.y+this.z*x.z},crossVectors:function(x,F){var L=x.x,X=x.y;x=x.z;var ta=F.x,da=F.y;F=F.z;this.x=X*F-x*da;this.y=x*ta-L*F;this.z=L*da-X*ta;return this}};var lb=function(x,F,L,X){this.x=x||0;this.y=F||0;this.z=L||0;this.w=void 0!==X?X:1};lb.prototype={constructor:lb,set:function(x,F,L,X){this.x=x;this.y=F;this.z=L;this.w=X;return this},copy:function(x){this.x=
x.x;this.y=x.y;this.z=x.z;this.w=x.w;return this},setFromEulerXYZ:function(x,F,L){var X=Math.cos(x/2),ta=Math.cos(F/2),da=Math.cos(L/2);x=Math.sin(x/2);F=Math.sin(F/2);L=Math.sin(L/2);this.x=x*ta*da+X*F*L;this.y=X*F*da-x*ta*L;this.z=X*ta*L+x*F*da;this.w=X*ta*da-x*F*L;return this},setFromEulerYXZ:function(x,F,L){var X=Math.cos(x/2),ta=Math.cos(F/2),da=Math.cos(L/2);x=Math.sin(x/2);F=Math.sin(F/2);L=Math.sin(L/2);this.x=x*ta*da+X*F*L;this.y=X*F*da-x*ta*L;this.z=X*ta*L-x*F*da;this.w=X*ta*da+x*F*L;return this},
setFromAxisAngle:function(x,F){F/=2;var L=Math.sin(F);this.x=x.x*L;this.y=x.y*L;this.z=x.z*L;this.w=Math.cos(F);return this},multiply:function(x){return this.multiplyQuaternions(this,x)},multiplyQuaternions:function(x,F){var L=x.x,X=x.y,ta=x.z;x=x.w;var da=F.x,ja=F.y,Ja=F.z;F=F.w;this.x=L*F+x*da+X*Ja-ta*ja;this.y=X*F+x*ja+ta*da-L*Ja;this.z=ta*F+x*Ja+L*ja-X*da;this.w=x*F-L*da-X*ja-ta*Ja;return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;this.normalize();return this},normalize:function(){var x=
Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===x?(this.z=this.y=this.x=0,this.w=1):(x=1/x,this.x*=x,this.y*=x,this.z*=x,this.w*=x);return this},slerp:function(x,F){if(0===F)return this;if(1===F)return this.copy(x);var L=this.x,X=this.y,ta=this.z,da=this.w,ja=da*x.w+L*x.x+X*x.y+ta*x.z;0>ja?(this.w=-x.w,this.x=-x.x,this.y=-x.y,this.z=-x.z,ja=-ja):this.copy(x);if(1<=ja)return this.w=da,this.x=L,this.y=X,this.z=ta,this;x=Math.acos(ja);var Ja=Math.sqrt(1-ja*ja);if(.001>Math.abs(Ja))return this.w=
.5*(da+this.w),this.x=.5*(L+this.x),this.y=.5*(X+this.y),this.z=.5*(ta+this.z),this;ja=Math.sin((1-F)*x)/Ja;F=Math.sin(F*x)/Ja;this.w=da*ja+this.w*F;this.x=L*ja+this.x*F;this.y=X*ja+this.y*F;this.z=ta*ja+this.z*F;return this},setFromUnitVectors:function(){var x,F;return function(L,X){void 0===x&&(x=new yb);F=L.dot(X)+1;1E-6>F?(F=0,Math.abs(L.x)>Math.abs(L.z)?x.set(-L.y,L.x,0):x.set(0,-L.z,L.y)):x.crossVectors(L,X);this.x=x.x;this.y=x.y;this.z=x.z;this.w=F;this.normalize();return this}}()};var Rc=
new xa({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Sc=new xa({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),qc={CardboardV1:new La({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new La({id:"CardboardV2",label:"Cardboard I/O 2015",
fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-9.904169E-4,6.183535E-5,-1.6981803E-6]})};ya.prototype.updateDeviceParams=function(x){this.device=this.determineDevice_(x)||this.device};ya.prototype.getDevice=function(){return this.device};ya.prototype.setViewer=function(x){this.viewer=x;this.distortion=new ha(this.viewer.distortionCoefficients)};
ya.prototype.determineDevice_=function(x){if(!x){if(ab())return console.warn("Using fallback iOS device measurements."),Sc;console.warn("Using fallback Android device measurements.");return Rc}var F=.0254/x.xdpi,L=.0254/x.ydpi,X=Xb(),ta=Yb();return new xa({widthMeters:F*X,heightMeters:L*ta,bevelMeters:.001*x.bevelMm})};ya.prototype.getDistortedFieldOfViewLeftEye=function(){var x=this.viewer,F=this.device,L=this.distortion,X=x.screenLensDistance,ta=x.interLensDistance/2,da=x.baselineLensDistance-F.bevelMeters,
ja=F.heightMeters-da;F=Hb*Math.atan(L.distort((F.widthMeters-x.interLensDistance)/2/X));ta=Hb*Math.atan(L.distort(ta/X));da=Hb*Math.atan(L.distort(da/X));L=Hb*Math.atan(L.distort(ja/X));return{leftDegrees:Math.min(F,x.fov),rightDegrees:Math.min(ta,x.fov),downDegrees:Math.min(da,x.fov),upDegrees:Math.min(L,x.fov)}};ya.prototype.getLeftEyeVisibleTanAngles=function(){var x=this.viewer,F=this.device,L=this.distortion,X=Math.tan(-Gb*x.fov),ta=Math.tan(Gb*x.fov),da=Math.tan(Gb*x.fov),ja=Math.tan(-Gb*x.fov),
Ja=F.widthMeters/4,Pa=F.heightMeters/2,Ma=x.interLensDistance/2-Ja,Ua=-(x.baselineLensDistance-F.bevelMeters-Pa),Va=x.screenLensDistance;x=L.distort((Ma-Ja)/Va);F=L.distort((Ua+Pa)/Va);Ja=L.distort((Ma+Ja)/Va);L=L.distort((Ua-Pa)/Va);Pa=new Float32Array(4);Pa[0]=Math.max(X,x);Pa[1]=Math.min(ta,F);Pa[2]=Math.min(da,Ja);Pa[3]=Math.max(ja,L);return Pa};ya.prototype.getLeftEyeNoLensTanAngles=function(){var x=this.viewer,F=this.device,L=this.distortion,X=new Float32Array(4),ta=L.distortInverse(Math.tan(-Gb*
x.fov)),da=L.distortInverse(Math.tan(Gb*x.fov)),ja=L.distortInverse(Math.tan(Gb*x.fov));L=L.distortInverse(Math.tan(-Gb*x.fov));var Ja=F.widthMeters/4,Pa=F.heightMeters/2,Ma=x.interLensDistance/2-Ja;F=-(x.baselineLensDistance-F.bevelMeters-Pa);x=x.screenLensDistance;X[0]=Math.max(ta,(Ma-Ja)/x);X[1]=Math.min(da,(F+Pa)/x);X[2]=Math.min(ja,(Ma+Ja)/x);X[3]=Math.max(L,(F-Pa)/x);return X};ya.prototype.getLeftEyeVisibleScreenRect=function(x){var F=this.viewer,L=this.device,X=F.screenLensDistance,ta=(L.widthMeters-
F.interLensDistance)/2;F=F.baselineLensDistance-L.bevelMeters;var da=(x[0]*X+ta)/L.widthMeters,ja=(x[3]*X+F)/L.heightMeters;return{x:da,y:ja,width:(x[2]*X+ta)/L.widthMeters-da,height:(x[1]*X+F)/L.heightMeters-ja}};ya.prototype.getFieldOfViewLeftEye=function(x){return x?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()};ya.prototype.getFieldOfViewRightEye=function(x){x=this.getFieldOfViewLeftEye(x);return{leftDegrees:x.rightDegrees,rightDegrees:x.leftDegrees,upDegrees:x.upDegrees,
downDegrees:x.downDegrees}};ya.prototype.getUndistortedFieldOfViewLeftEye=function(){var x=this.getUndistortedParams_();return{leftDegrees:Hb*Math.atan(x.outerDist),rightDegrees:Hb*Math.atan(x.innerDist),downDegrees:Hb*Math.atan(x.bottomDist),upDegrees:Hb*Math.atan(x.topDist)}};ya.prototype.getUndistortedViewportLeftEye=function(){var x=this.getUndistortedParams_(),F=this.device,L=this.viewer.screenLensDistance,X=F.width/(F.widthMeters/L);F=F.height/(F.heightMeters/L);L=Math.round((x.eyePosX-x.outerDist)*
X);var ta=Math.round((x.eyePosY-x.bottomDist)*F);return{x:L,y:ta,width:Math.round((x.eyePosX+x.innerDist)*X)-L,height:Math.round((x.eyePosY+x.topDist)*F)-ta}};ya.prototype.getUndistortedParams_=function(){var x=this.viewer,F=this.device,L=x.screenLensDistance,X=x.interLensDistance/2/L,ta=F.heightMeters/L,da=F.widthMeters/L/2-X;F=(x.baselineLensDistance-F.bevelMeters)/L;x=this.distortion.distortInverse(Math.tan(Gb*x.fov));return{outerDist:Math.min(da,x),innerDist:Math.min(X,x),topDist:Math.min(ta-
F,x),bottomDist:Math.min(F,x),eyePosX:da,eyePosY:F}};ya.Viewers=qc;var Kc={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},
{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],
dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],
bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},
{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},
{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,
316.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},
{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},
{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},
{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},
{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],
dpi:[196.7,205.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,
437.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,
431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],
bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,
256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,
bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,
518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},
{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],
dpi:307.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1E3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1E3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2001]}],
dpi:[410.9,415.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],
dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};Wa.prototype.getDeviceParams=function(){return this.deviceParams};Wa.prototype.recalculateDeviceParams_=function(){var x=this.calcDeviceParams_();
if(x){if(this.deviceParams=x,this.onDeviceParamsUpdated)this.onDeviceParamsUpdated(this.deviceParams)}else console.error("Failed to recalculate device parameters.")};Wa.prototype.calcDeviceParams_=function(){var x=this.dpdb;if(!x)return console.error("DPDB not available."),null;if(1!=x.format)return console.error("DPDB has unexpected format version."),null;if(!x.devices||!x.devices.length)return console.error("DPDB does not have a devices section."),null;var F=navigator.userAgent||navigator.vendor||
window.opera,L=Xb(),X=Yb();if(!x.devices)return console.error("DPDB has no devices section."),null;for(var ta=0;ta<x.devices.length;ta++){var da=x.devices[ta];if(!da.rules)console.warn("Device["+ta+"] has no rules section.");else if("ios"!=da.type&&"android"!=da.type)console.warn("Device["+ta+"] has invalid type.");else if(ab()==("ios"==da.type)){for(var ja=!1,Ja=0;Ja<da.rules.length;Ja++)if(this.ruleMatches_(da.rules[Ja],F,L,X)){ja=!0;break}if(ja)return new Za({xdpi:da.dpi[0]||da.dpi,ydpi:da.dpi[1]||
da.dpi,bevelMm:da.bw})}}console.warn("No DPDB device match.");return null};Wa.prototype.ruleMatches_=function(x,F,L,X){if(!x.ua&&!x.res)return!1;x.ua&&"SM"===x.ua.substring(0,2)&&(x.ua=x.ua.substring(0,7));if(x.ua&&0>F.indexOf(x.ua))return!1;if(x.res){if(!x.res[0]||!x.res[1])return!1;F=x.res[0];x=x.res[1];if(Math.min(L,X)!=Math.min(F,x)||Math.max(L,X)!=Math.max(F,x))return!1}return!0};Ya.prototype.set=function(x,F){this.sample=x;this.timestampS=F};Ya.prototype.copy=function(x){this.set(x.sample,x.timestampS)};
kb.prototype.addAccelMeasurement=function(x,F){this.currentAccelMeasurement.set(x,F)};kb.prototype.addGyroMeasurement=function(x,F){this.currentGyroMeasurement.set(x,F);x=F-this.previousGyroMeasurement.timestampS;isNaN(x)||.001>=x||1<x||this.run_();this.previousGyroMeasurement.copy(this.currentGyroMeasurement)};kb.prototype.run_=function(){if(this.isOrientationInitialized){var x=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);
this.gyroIntegralQ.multiply(x);this.filterQ.copy(this.previousFilterQ);this.filterQ.multiply(x);x=new lb;x.copy(this.filterQ);x.inverse();this.estimatedGravity.set(0,0,-1);this.estimatedGravity.applyQuaternion(x);this.estimatedGravity.normalize();this.measuredGravity.copy(this.currentAccelMeasurement.sample);this.measuredGravity.normalize();x=new lb;x.setFromUnitVectors(this.estimatedGravity,this.measuredGravity);x.inverse();if(this.isDebug){var F=console,L=F.log;if(1<x.w){console.warn("getQuaternionAngle: w > 1");
var X=0}else X=2*Math.acos(x.w);L.call(F,"Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Hb*X,this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1))}F=new lb;F.copy(this.filterQ);F.multiply(x);this.filterQ.slerp(F,1-this.kFilter);this.previousFilterQ.copy(this.filterQ)}else this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),
this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0};kb.prototype.getOrientation=function(){return this.filterQ};kb.prototype.accelToQuaternion_=function(x){var F=new yb;F.copy(x);F.normalize();x=new lb;x.setFromUnitVectors(new yb(0,0,-1),F);x.inverse();return x};kb.prototype.gyroToQuaternionDelta_=function(x,F){var L=new lb,X=new yb;X.copy(x);X.normalize();L.setFromAxisAngle(X,x.length()*F);return L};wb.prototype.getPrediction=function(x,F,L){if(!this.previousTimestampS)return this.previousQ.copy(x),
this.previousTimestampS=L,x;var X=new yb;X.copy(F);X.normalize();F=F.length();if(F<20*Gb)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Hb*F).toFixed(1)),this.outQ.copy(x),this.previousQ.copy(x),this.outQ;this.deltaQ.setFromAxisAngle(X,F*this.predictionTimeS);this.outQ.copy(this.previousQ);this.outQ.multiply(this.deltaQ);this.previousQ.copy(x);this.previousTimestampS=L;return this.outQ};ob.prototype.getPosition=function(){return null};ob.prototype.getOrientation=function(){var x=
void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var L=(new lb).setFromAxisAngle(new yb(0,0,-1),0),X=new lb;-90===window.orientation?X.setFromAxisAngle(new yb(0,1,0),Math.PI/-2):X.setFromAxisAngle(new yb(0,1,0),Math.PI/2);return L.multiply(X)}();this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var L=new lb;L.setFromAxisAngle(new yb(1,0,0),-Math.PI/2);return L}();x=this._deviceOrientationQ;
var F=new lb;F.copy(x);F.multiply(this.deviceOrientationFilterToWorldQ);F.multiply(this.resetQ);F.multiply(this.worldToScreenQ);F.multiplyQuaternions(this.deviceOrientationFixQ,F);this.yawOnly&&(F.x=0,F.z=0,F.normalize());this.orientationOut_[0]=F.x;this.orientationOut_[1]=F.y;this.orientationOut_[2]=F.z;this.orientationOut_[3]=F.w;return this.orientationOut_}x=this.filter.getOrientation();x=this.posePredictor.getPrediction(x,this.gyroscope,this.previousTimestampS);F=new lb;F.copy(this.filterToWorldQ);
F.multiply(this.resetQ);F.multiply(x);F.multiply(this.worldToScreenQ);this.yawOnly&&(F.x=0,F.z=0,F.normalize());this.orientationOut_[0]=F.x;this.orientationOut_[1]=F.y;this.orientationOut_[2]=F.z;this.orientationOut_[3]=F.w;return this.orientationOut_};ob.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation());this.resetQ.x=0;this.resetQ.y=0;this.resetQ.z*=-1;this.resetQ.normalize();ub()&&this.resetQ.multiply(this.inverseWorldToScreenQ);this.resetQ.multiply(this.originalPoseAdjustQ)};
ob.prototype.onDeviceOrientation_=function(x){this._deviceOrientationQ=this._deviceOrientationQ||new lb;var F=x.alpha,L=x.beta;x=x.gamma;F=(F||0)*Math.PI/180;L=(L||0)*Math.PI/180;x=(x||0)*Math.PI/180;this._deviceOrientationQ.setFromEulerYXZ(L,F,-x)};ob.prototype.onDeviceMotion_=function(x){this.updateDeviceMotion_(x)};ob.prototype.updateDeviceMotion_=function(x){var F=x.accelerationIncludingGravity,L=x.rotationRate;x=x.timeStamp/1E3;var X=x-this.previousTimestampS;0>X?tc("fusion-pose-sensor:invalid:non-monotonic",
"Invalid timestamps detected: non-monotonic timestamp from devicemotion"):.001>=X||1<X?tc("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."):(this.accelerometer.set(-F.x,-F.y,-F.z),L&&(Nb()?this.gyroscope.set(-L.beta,L.alpha,L.gamma):this.gyroscope.set(L.alpha,L.beta,L.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,x)),this.filter.addAccelMeasurement(this.accelerometer,
x));this.previousTimestampS=x};ob.prototype.onOrientationChange_=function(x){this.setScreenTransform_()};ob.prototype.onMessage_=function(x){(x=x.data)&&x.type&&"devicemotion"===x.type.toLowerCase()&&this.updateDeviceMotion_(x.deviceMotionEvent)};ob.prototype.setScreenTransform_=function(){this.worldToScreenQ.set(0,0,0,1);switch(window.orientation){case 90:this.worldToScreenQ.setFromAxisAngle(new yb(0,0,1),-Math.PI/2);break;case -90:this.worldToScreenQ.setFromAxisAngle(new yb(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ);
this.inverseWorldToScreenQ.inverse()};ob.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this);this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this);this.onMessageCallback_=this.onMessage_.bind(this);this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this);var x;if(x=ab()){x=window.self!==window.top;var F=Bc(document.referrer),L=Bc(window.location.href);x=x&&F!==L}x&&window.addEventListener("message",this.onMessageCallback_);window.addEventListener("orientationchange",
this.onOrientationChangeCallback_);this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)};ob.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_);window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_);window.removeEventListener("orientationchange",this.onOrientationChangeCallback_);window.removeEventListener("message",
this.onMessageCallback_)};var Tc=new yb(1,0,0),Uc=new yb(0,0,1),uc=new lb;uc.setFromAxisAngle(Tc,-Math.PI/2);uc.multiply((new lb).setFromAxisAngle(Uc,Math.PI/2));var Oc=function(){function x(F){if(!(this instanceof x))throw new TypeError("Cannot call a class as a function");this.config=F;this.fusionSensor=this.sensor=null;this._out=new Float32Array(4);this.api=null;this.errors=[];this._sensorQ=new lb;this._outQ=new lb;this._onSensorRead=this._onSensorRead.bind(this);this._onSensorError=this._onSensorError.bind(this);
this.init()}qb(x,[{key:"init",value:function(){var F=null;try{F=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"}),F.addEventListener("error",this._onSensorError)}catch(L){this.errors.push(L),"SecurityError"===L.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===L.name?this.useDeviceMotion():
console.error(L)}F&&(this.api="sensor",this.sensor=F,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion";this.fusionSensor=new ob(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG);this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();
if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var F=this.sensor.quaternion;this._sensorQ.set(F[0],F[1],F[2],F[3]);F=this._outQ;F.copy(uc);F.multiply(this._sensorQ);this.config.YAW_ONLY&&(F.x=F.z=0,F.normalize());this._out[0]=F.x;this._out[1]=F.y;this._out[2]=F.z;this._out[3]=F.w;return this._out}},{key:"_onSensorError",value:function(F){this.errors.push(F.error);"NotAllowedError"===F.error.name?console.error("Permission to access sensor was denied"):
"NotReadableError"===F.error.name?console.error("Sensor could not be read"):console.error(F.error);this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]);return x}();pb.prototype.show=function(x){x||this.overlay.parentElement?x&&(this.overlay.parentElement&&this.overlay.parentElement!=x&&this.overlay.parentElement.removeChild(this.overlay),x.appendChild(this.overlay)):document.body.appendChild(this.overlay);this.overlay.style.display="block";x=this.overlay.querySelector("img").style;
ub()?(x.width="20%",x.marginLeft="40%",x.marginTop="3%"):(x.width="50%",x.marginLeft="25%",x.marginTop="25%")};pb.prototype.hide=function(){this.overlay.style.display="none"};pb.prototype.showTemporarily=function(x,F){this.show(F);this.timer=setTimeout(this.hide.bind(this),x)};pb.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)};pb.prototype.update=function(){this.disableShowTemporarily();!ub()&&rc()?this.show():this.hide()};pb.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+
encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};
nb.prototype.show=function(x){this.root=x;x.appendChild(this.dialog);this.dialog.querySelector("#"+this.selectedKey).checked=!0;this.dialog.style.display="block"};nb.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog);this.dialog.style.display="none"};nb.prototype.getCurrentViewer=function(){return ya.Viewers[this.selectedKey]};nb.prototype.getSelectedKey_=function(){var x=this.dialog.querySelector("input[name=field]:checked");return x?x.id:null};
nb.prototype.onChange=function(x){this.onChangeCallbacks_.push(x)};nb.prototype.fireOnChange_=function(x){for(var F=0;F<this.onChangeCallbacks_.length;F++)this.onChangeCallbacks_[F](x)};nb.prototype.onSave_=function(){if((this.selectedKey=this.getSelectedKey_())&&ya.Viewers[this.selectedKey]){this.fireOnChange_(ya.Viewers[this.selectedKey]);try{localStorage.setItem("WEBVR_CARDBOARD_VIEWER",this.selectedKey)}catch(x){console.error("Failed to save viewer profile: %s",x)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")};
nb.prototype.createDialog_=function(x){var F=document.createElement("div");F.classList.add("webvr-polyfill-viewer-selector");F.style.display="none";var L=document.createElement("div"),X=L.style;X.position="fixed";X.left=0;X.top=0;X.width="100%";X.height="100%";X.background="rgba(0, 0, 0, 0.3)";L.addEventListener("click",this.hide.bind(this));var ta=document.createElement("div");X=ta.style;X.boxSizing="border-box";X.position="fixed";X.top="24px";X.left="50%";X.marginLeft="-140px";X.width="280px";X.padding=
"24px";X.overflow="hidden";X.background="#fafafa";X.fontFamily="'Roboto', sans-serif";X.boxShadow="0px 5px 20px #666";ta.appendChild(this.createH1_("Select your viewer"));for(var da in x)ta.appendChild(this.createChoice_(da,x[da].label));ta.appendChild(this.createButton_("Save",this.onSave_.bind(this)));F.appendChild(L);F.appendChild(ta);return F};nb.prototype.createH1_=function(x){var F=document.createElement("h1"),L=F.style;L.color="black";L.fontSize="20px";L.fontWeight="bold";L.marginTop=0;L.marginBottom=
"24px";F.innerHTML=x;return F};nb.prototype.createChoice_=function(x,F){var L=document.createElement("div");L.style.marginTop="8px";L.style.color="black";var X=document.createElement("input");X.style.fontSize="30px";X.setAttribute("id",x);X.setAttribute("type","radio");X.setAttribute("value",x);X.setAttribute("name","field");var ta=document.createElement("label");ta.style.marginLeft="4px";ta.setAttribute("for",x);ta.innerHTML=F;L.appendChild(X);L.appendChild(ta);return L};nb.prototype.createButton_=
function(x,F){var L=document.createElement("button");L.innerHTML=x;x=L.style;x.float="right";x.textTransform="uppercase";x.color="#1094f7";x.fontSize="14px";x.letterSpacing=0;x.border=0;x.background="none";x.marginTop="16px";L.addEventListener("click",F);return L};var Vc="undefined"!==typeof window?window:"undefined"!==typeof Ob?Ob:"undefined"!==typeof self?self:{},Mc=function(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x["default"]:x}(function(x,F){return F={exports:{}},
x(F,F.exports),F.exports}(function(x,F){(function(L,X){x.exports=X()})(Vc,function(){return function(L){function X(da){if(ta[da])return ta[da].exports;var ja=ta[da]={i:da,l:!1,exports:{}};L[da].call(ja.exports,ja,ja.exports,X);ja.l=!0;return ja.exports}var ta={};X.m=L;X.c=ta;X.d=function(da,ja,Ja){X.o(da,ja)||Object.defineProperty(da,ja,{configurable:!1,enumerable:!0,get:Ja})};X.n=function(da){var ja=da&&da.__esModule?function(){return da["default"]}:function(){return da};X.d(ja,"a",ja);return ja};
X.o=function(da,ja){return Object.prototype.hasOwnProperty.call(da,ja)};X.p="";return X(X.s=0)}([function(L,X,ta){var da=function(){function Pa(Ma,Ua){for(var Va=0;Va<Ua.length;Va++){var cb=Ua[Va];cb.enumerable=cb.enumerable||!1;cb.configurable=!0;"value"in cb&&(cb.writable=!0);Object.defineProperty(Ma,cb.key,cb)}}return function(Ma,Ua,Va){Ua&&Pa(Ma.prototype,Ua);Va&&Pa(Ma,Va);return Ma}}(),ja=ta(1),Ja="undefined"!==typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||
[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream;X=function(){function Pa(){if(!(this instanceof Pa))throw new TypeError("Cannot call a class as a function");Ja?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",ja),this.noSleepVideo.addEventListener("timeupdate",function(Ma){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}
da(Pa,[{key:"enable",value:function(){Ja?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15E3)):this.noSleepVideo.play()}},{key:"disable",value:function(){Ja?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]);return Pa}();L.exports=X},function(L,X,ta){L.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})})),
Lc=1E3,Wc=[0,0,.5,1],Xc=[.5,0,.5,1],Yc=window.requestAnimationFrame,Zc=window.cancelAnimationFrame;hb.prototype.getFrameData=function(x){return Qc(x,this._getPose(),this)};hb.prototype.getPose=function(){Tb("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData");return this._getPose()};hb.prototype.resetPose=function(){Tb("VRDisplay.prototype.resetPose");return this._resetPose()};hb.prototype.getImmediatePose=function(){Tb("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData");
return this._getPose()};hb.prototype.requestAnimationFrame=function(x){return Yc(x)};hb.prototype.cancelAnimationFrame=function(x){return Zc(x)};hb.prototype.wrapForFullscreen=function(x){if(ab())return x;this.fullscreenWrapper_||(this.fullscreenWrapper_=document.createElement("div"),this.fullscreenWrapper_.setAttribute("style",["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important; left: 0 !important; right: 0 !important; border: 0; margin: 0; padding: 0; z-index: 999999 !important; position: fixed"].join("; ")+
";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper"));if(this.fullscreenElement_==x)return this.fullscreenWrapper_;this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_));this.fullscreenElement_=x;(this.originalParent_=x.parentElement)||document.body.appendChild(x);this.fullscreenWrapper_.parentElement||(x=this.fullscreenElement_.parentElement,x.insertBefore(this.fullscreenWrapper_,
this.fullscreenElement_),x.removeChild(this.fullscreenElement_));this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild);this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");this.fullscreenElement_&&this.fullscreenElement_.setAttribute("style",["position: absolute; top: 0; left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0; margin: 0; padding: 0"].join("; ")+
";");return this.fullscreenWrapper_};hb.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var x=this.fullscreenElement_;this.fullscreenElementCachedStyle_?x.setAttribute("style",this.fullscreenElementCachedStyle_):x.removeAttribute("style");this.fullscreenElementCachedStyle_=this.fullscreenElement_=null;var F=this.fullscreenWrapper_.parentElement;this.fullscreenWrapper_.removeChild(x);this.originalParent_===F?F.insertBefore(x,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(x);
F.removeChild(this.fullscreenWrapper_);return x}};hb.prototype.requestPresent=function(x){var F=this.isPresenting,L=this;x instanceof Array||(Tb("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),x=[x]);return new Promise(function(X,ta){if(L.capabilities.canPresent)if(0==x.length||x.length>L.capabilities.maxLayers)ta(Error("Invalid number of layers."));else{var da=x[0];if(da.source){var ja=da.leftBounds||Wc,Ja=da.rightBounds||Xc;if(F){var Pa=
L.layer_;Pa.source!==da.source&&(Pa.source=da.source);for(da=0;4>da;da++)Pa.leftBounds[da]=ja[da],Pa.rightBounds[da]=Ja[da];L.wrapForFullscreen(L.layer_.source);L.updatePresent_();X()}else{L.layer_={predistorted:da.predistorted,source:da.source,leftBounds:ja.slice(0),rightBounds:Ja.slice(0)};L.waitingForPresent_=!1;if(L.layer_&&L.layer_.source){var Ma=L.wrapForFullscreen(L.layer_.source);L.addFullscreenListeners_(Ma,function(){L.isPresenting=Ma===(document.fullscreenElement||document.webkitFullscreenElement||
document.mozFullScreenElement||document.msFullscreenElement);L.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Ua){console.error("screen.orientation.lock() failed due to",Ua.message)}),L.waitingForPresent_=!1,L.beginPresent_(),X()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),L.removeFullscreenWrapper(),L.disableWakeLock(),L.endPresent_(),L.removeFullscreenListeners_());L.fireVRDisplayPresentChange_()},
function(){L.waitingForPresent_&&(L.removeFullscreenWrapper(),L.removeFullscreenListeners_(),L.disableWakeLock(),L.waitingForPresent_=!1,L.isPresenting=!1,ta(Error("Unable to present.")))});if(Pc(Ma))L.enableWakeLock(),L.waitingForPresent_=!0;else if(ab()||Ib())L.enableWakeLock(),L.isPresenting=!0,L.beginPresent_(),L.fireVRDisplayPresentChange_(),X()}L.waitingForPresent_||ab()||(Ac(),ta(Error("Unable to present.")))}}else X()}else ta(Error("VRDisplay is not capable of presenting."))})};hb.prototype.exitPresent=
function(){var x=this.isPresenting,F=this;this.isPresenting=!1;this.layer_=null;this.disableWakeLock();return new Promise(function(L,X){x?(!Ac()&&ab()&&(F.endPresent_(),F.fireVRDisplayPresentChange_()),Ib()&&(F.removeFullscreenWrapper(),F.removeFullscreenListeners_(),F.endPresent_(),F.fireVRDisplayPresentChange_()),L()):X(Error("Was not presenting to VRDisplay."))})};hb.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]};hb.prototype.fireVRDisplayPresentChange_=function(){var x=new CustomEvent("vrdisplaypresentchange",
{detail:{display:this}});window.dispatchEvent(x)};hb.prototype.fireVRDisplayConnect_=function(){var x=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(x)};hb.prototype.addFullscreenListeners_=function(x,F,L){this.removeFullscreenListeners_();this.fullscreenEventTarget_=x;this.fullscreenChangeHandler_=F;this.fullscreenErrorHandler_=L;F&&(document.fullscreenEnabled?x.addEventListener("fullscreenchange",F,!1):document.webkitFullscreenEnabled?x.addEventListener("webkitfullscreenchange",
F,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",F,!1):document.msFullscreenEnabled&&x.addEventListener("msfullscreenchange",F,!1));L&&(document.fullscreenEnabled?x.addEventListener("fullscreenerror",L,!1):document.webkitFullscreenEnabled?x.addEventListener("webkitfullscreenerror",L,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",L,!1):document.msFullscreenEnabled&&x.addEventListener("msfullscreenerror",L,!1))};hb.prototype.removeFullscreenListeners_=
function(){if(this.fullscreenEventTarget_){var x=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var F=this.fullscreenChangeHandler_;x.removeEventListener("fullscreenchange",F,!1);x.removeEventListener("webkitfullscreenchange",F,!1);document.removeEventListener("mozfullscreenchange",F,!1);x.removeEventListener("msfullscreenchange",F,!1)}this.fullscreenErrorHandler_&&(F=this.fullscreenErrorHandler_,x.removeEventListener("fullscreenerror",F,!1),x.removeEventListener("webkitfullscreenerror",
F,!1),document.removeEventListener("mozfullscreenerror",F,!1),x.removeEventListener("msfullscreenerror",F,!1));this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=null}};hb.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()};hb.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()};hb.prototype.beginPresent_=function(){};hb.prototype.endPresent_=function(){};hb.prototype.submitFrame=function(x){};hb.prototype.getEyeParameters=
function(x){return null};var Nc={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};$a.prototype=Object.create(hb.prototype);$a.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,
angularAcceleration:null}};$a.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()};$a.prototype._getFieldOfView=function(x){if("left"==x)x=this.deviceInfo_.getFieldOfViewLeftEye();else if("right"==x)x=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",x),null;return x};$a.prototype._getEyeOffset=function(x){if("left"==x)x=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else if("right"==x)x=[.5*this.deviceInfo_.viewer.interLensDistance,
0,0];else return console.error("Invalid eye provided: %s",x),null;return x};$a.prototype.getEyeParameters=function(x){var F=this._getEyeOffset(x),L=this._getFieldOfView(x);x={offset:F,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};Object.defineProperty(x,"fieldOfView",{enumerable:!0,get:function(){Tb("VRFieldOfView","VRFrameData's projection matrices");return L}});return x};$a.prototype.onDeviceParamsUpdated_=function(x){this.config.DEBUG&&
console.log("DPDB reported that device params were updated.");this.deviceInfo_.updateDeviceParams(x);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)};$a.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)};$a.prototype.beginPresent_=function(){var x=this.layer_.source.getContext("webgl");x||(x=this.layer_.source.getContext("experimental-webgl"));
x||(x=this.layer_.source.getContext("webgl2"));x&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(x.canvas.width=Xb()*this.bufferScale_,x.canvas.height=Yb()*this.bufferScale_,this.cardboardUI_=new P(x)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new P(x)),this.distorter_=new N(x,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(F){this.viewerSelector_.show(this.layer_.source.parentElement);
F.stopPropagation();F.preventDefault()}.bind(this),function(F){this.exitPresent();F.stopPropagation();F.preventDefault()}.bind(this)),this.rotateInstructions_&&(ub()&&rc()?this.rotateInstructions_.showTemporarily(3E3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",
this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())};$a.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null);this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null);this.rotateInstructions_&&this.rotateInstructions_.hide();this.viewerSelector_.hide();window.removeEventListener("orientationchange",this.orientationHandler);window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)};$a.prototype.updatePresent_=
function(){this.endPresent_();this.beginPresent_()};$a.prototype.submitFrame=function(x){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){(x=this.layer_.source.getContext("webgl"))||(x=this.layer_.source.getContext("experimental-webgl"));x||(x=this.layer_.source.getContext("webgl2"));x=x.canvas;if(x.width!=this.lastWidth||x.height!=this.lastHeight)this.cardboardUI_.onResize();this.lastWidth=x.width;this.lastHeight=x.height;this.cardboardUI_.render()}};
$a.prototype.onOrientationChange_=function(x){this.viewerSelector_.hide();this.rotateInstructions_&&this.rotateInstructions_.update();this.onResize_()};$a.prototype.onResize_=function(x){this.layer_&&((x=this.layer_.source.getContext("webgl"))||(x=this.layer_.source.getContext("experimental-webgl")),x||(x=this.layer_.source.getContext("webgl2")),x.canvas.setAttribute("style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;"),
sc(x.canvas))};$a.prototype.onViewerChanged_=function(x){this.deviceInfo_.setViewer(x);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_);this.fireVRDisplayDeviceParamsChange_()};$a.prototype.fireVRDisplayDeviceParamsChange_=function(){var x=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(x)};$a.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=
new Float32Array(16);this.rightViewMatrix=new Float32Array(16);this.pose=null};$a.VRDisplay=hb;return $a})})),sb=function(w){var C=G.call(this)||this;C.global=w;C.onWindowResize=C.onWindowResize.bind(C);C.global.window.addEventListener("resize",C.onWindowResize);C.environmentBlendMode="opaque";return C};$jscomp.inherits(sb,G);sb.prototype.onBaseLayerSet=function(w,C){throw Error("Not implemented");};sb.prototype.isSessionSupported=function(w){throw Error("Not implemented");};sb.prototype.isFeatureSupported=
function(w){throw Error("Not implemented");};sb.prototype.requestSession=function(w,C){return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){throw Error("Not implemented");})};sb.prototype.requestAnimationFrame=function(w){throw Error("Not implemented");};sb.prototype.onFrameStart=function(w){throw Error("Not implemented");};sb.prototype.onFrameEnd=function(w){throw Error("Not implemented");};sb.prototype.doesSessionSupportReferenceSpace=function(w,C){throw Error("Not implemented");};sb.prototype.requestStageBounds=
function(){throw Error("Not implemented");};sb.prototype.requestFrameOfReferenceTransform=function(w,C){return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){return N.return(void 0)})};sb.prototype.cancelAnimationFrame=function(w){throw Error("Not implemented");};sb.prototype.endSession=function(w){throw Error("Not implemented");};sb.prototype.getViewport=function(w,C,N,P){throw Error("Not implemented");};sb.prototype.getProjectionMatrix=function(w){throw Error("Not implemented");};sb.prototype.getBasePoseMatrix=
function(){throw Error("Not implemented");};sb.prototype.getBaseViewMatrix=function(w){throw Error("Not implemented");};sb.prototype.getInputSources=function(){throw Error("Not implemented");};sb.prototype.getInputPose=function(w,C,N){throw Error("Not implemented");};sb.prototype.onWindowResize=function(){this.onWindowResize()};var nc={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],
axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},vc={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},$c={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,
2:0}},"Gear VR Controller":{mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":{mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,
0,1]}},"Oculus Touch (Right)":nc,"Oculus Touch (Left)":nc,"OpenVR Gamepad":{mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,
3]}}}},"Spatial Controller (Spatial Interaction Source) 045E-065A":vc,"Spatial Controller (Spatial Interaction Source) 045E-065D":{mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},"Windows Mixed Reality (Right)":vc,"Windows Mixed Reality (Left)":vc},Dc=p(.155,-.465,-.15),ad=p(-.155,-.465,-.15),bd=p(0,0,-.25),cd=p(0,0,
.05),Ec=p(-.08,.14,.08),Fc=180/Math.PI,Ub=function(){this.hand="right";this.headElbowOffset=Dc;this.controllerQ=I();this.lastControllerQ=I();this.headQ=I();this.headPos=k();this.elbowPos=k();this.wristPos=k();this.lastTime=this.time=null;this.rootQ=I();this.position=k()};Ub.prototype.setHandedness=function(w){this.hand!=w&&(this.hand=w,this.headElbowOffset="left"==this.hand?ad:Dc)};Ub.prototype.update=function(w,C){this.time=fa();w&&(W(this.lastControllerQ,this.controllerQ),W(this.controllerQ,w));
C&&(f(this.headPos,C),g(this.headQ,C));w=this.getHeadYawOrientation_();C=this.quatAngle_(this.lastControllerQ,this.controllerQ);.61<C/((this.time-this.lastTime)/1E3)?Q(this.rootQ,this.rootQ,w,Math.min(C/.175,1)):W(this.rootQ,w);w=p(0,0,-1);t(w,w,this.controllerQ);w=u(w,[0,1,0]);w=this.clamp_((w-.12)/.87,0,1);var N=Y(this.rootQ);T(N,N);J(N,N,this.controllerQ);C=this.elbowPos;r(C,this.headPos);n(C,C,this.headElbowOffset);var P=q(Ec);m(P,P,w);n(C,C,P);P=this.quatAngle_(N,I())*Fc;var ha=(1-Math.pow(P/
180,4))*(.4+.24*w);P=I();Q(P,P,N,ha);ha=T(I(),P);N=Y(N);J(N,N,ha);ha=this.wristPos;r(ha,cd);t(ha,ha,P);n(ha,ha,bd);t(ha,ha,N);n(ha,ha,C);C=q(Ec);m(C,C,w);n(this.position,this.wristPos,C);t(this.position,this.position,this.rootQ);this.lastTime=this.time};Ub.prototype.getPosition=function(){return this.position};Ub.prototype.getHeadYawOrientation_=function(){var w=k();E(w,this.headQ,"YXZ");var C=I(),N=w[1]*Fc;w=.5*Math.PI/180;var P=0*w;N*=w;var ha=0*w;w=Math.sin(P);P=Math.cos(P);var xa=Math.sin(N);
N=Math.cos(N);var ya=Math.sin(ha);ha=Math.cos(ha);C[0]=w*N*ha-P*xa*ya;C[1]=P*xa*ha+w*N*ya;C[2]=P*N*ya-w*xa*ha;C[3]=P*N*ha+w*xa*ya;return C};Ub.prototype.clamp_=function(w,C,N){return Math.min(Math.max(w,C),N)};Ub.prototype.quatAngle_=function(w,C){var N=[0,0,-1],P=[0,0,-1];t(N,N,w);t(P,P,C);w=p(N[0],N[1],N[2]);P=p(P[0],P[1],P[2]);l(w,w);l(P,P);P=u(w,P);P=1<P?0:-1>P?Math.PI:Math.acos(P);return P};var Db=Symbol("@@webxr-polyfill/XRRemappedGamepad"),Gc={pressed:!1,touched:!1,value:0};Object.freeze(Gc);
var wc=function(w,C,N){N||(N={});if(N.userAgentOverrides)for(var P in N.userAgentOverrides)if(navigator.userAgent.includes(P)){P=N.userAgentOverrides[P];for(var ha in P)ha in N?Object.assign(N[ha],P[ha]):N[ha]=P[ha];break}ha=Array(N.axes&&N.axes.length?N.axes.length:w.axes.length);P=Array(N.buttons&&N.buttons.length?N.buttons.length:w.buttons.length);var xa=null;if(N.gripTransform){var ya=N.gripTransform.orientation||[0,0,0,1];xa=a();e(xa,ka(ya,ya),N.gripTransform.position||[0,0,0])}ya=null;if(N.targetRayTransform){var La=
N.targetRayTransform.orientation||[0,0,0,1];ya=a();e(ya,ka(La,La),N.targetRayTransform.position||[0,0,0])}La=N.profiles;N.displayProfiles&&C.displayName in N.displayProfiles&&(La=N.displayProfiles[C.displayName]);this[Db]={gamepad:w,map:N,profiles:La||[w.id],mapping:N.mapping||w.mapping,axes:ha,buttons:P,gripTransform:xa,targetRayTransform:ya};this._update()};wc.prototype._update=function(){for(var w=this[Db].gamepad,C=this[Db].map,N=this[Db].axes,P=0;P<N.length;++P)N[P]=C.axes&&P in C.axes?null===
C.axes[P]?0:w.axes[C.axes[P]]:w.axes[P];if(C.axes&&C.axes.invert){P=$jscomp.makeIterator(C.axes.invert);for(var ha=P.next();!ha.done;ha=P.next())ha=ha.value,ha<N.length&&(N[ha]*=-1)}N=this[Db].buttons;for(P=0;P<N.length;++P)N[P]=C.buttons&&P in C.buttons?null===C.buttons[P]?Gc:w.buttons[C.buttons[P]]:w.buttons[P]};$jscomp.global.Object.defineProperties(wc.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return""}},_profiles:{configurable:!0,enumerable:!0,get:function(){return this[Db].profiles}},
index:{configurable:!0,enumerable:!0,get:function(){return-1}},connected:{configurable:!0,enumerable:!0,get:function(){return this[Db].gamepad.connected}},timestamp:{configurable:!0,enumerable:!0,get:function(){return this[Db].gamepad.timestamp}},mapping:{configurable:!0,enumerable:!0,get:function(){return this[Db].mapping}},axes:{configurable:!0,enumerable:!0,get:function(){return this[Db].axes}},buttons:{configurable:!0,enumerable:!0,get:function(){return this[Db].buttons}},hapticActuators:{configurable:!0,
enumerable:!0,get:function(){return this[Db].gamepad.hapticActuators}}});var lc=function(w,C,N,P){N=void 0===N?0:N;P=void 0===P?-1:P;this.polyfill=w;this.display=C;this.gamepad=this.nativeGamepad=null;this.inputSource=new db(this);this.lastPosition=k();this.emulatedPosition=!1;this.basePoseMatrix=a();this.outputMatrix=a();this.primaryButtonIndex=N;this.primaryActionPressed=!1;this.primarySqueezeButtonIndex=P;this.primarySqueezeActionPressed=!1;this.handedness="";this.targetRayMode="gaze";this.armModel=
null};lc.prototype.updateFromGamepad=function(w){this.nativeGamepad!==w&&(this.gamepad=(this.nativeGamepad=w)?new wc(w,this.display,$c[w.id]):null);this.handedness=""===w.hand?"none":w.hand;this.gamepad&&this.gamepad._update();w.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!w.pose.hasPosition):""===w.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)};lc.prototype.updateBasePoseMatrix=function(){if(this.nativeGamepad&&this.nativeGamepad.pose){var w=this.nativeGamepad.pose,
C=w.position,N=w.orientation;if(!C&&!N)return;C?(this.lastPosition[0]=C[0],this.lastPosition[1]=C[1],this.lastPosition[2]=C[2]):w.hasPosition?C=this.lastPosition:(this.armModel||(this.armModel=new Ub),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(N,this.polyfill.getBasePoseMatrix()),C=this.armModel.getPosition());e(this.basePoseMatrix,N,C)}else w=this.basePoseMatrix,C=this.polyfill.getBasePoseMatrix(),w[0]=C[0],w[1]=C[1],w[2]=C[2],w[3]=C[3],w[4]=C[4],w[5]=C[5],w[6]=C[6],
w[7]=C[7],w[8]=C[8],w[9]=C[9],w[10]=C[10],w[11]=C[11],w[12]=C[12],w[13]=C[13],w[14]=C[14],w[15]=C[15];return this.basePoseMatrix};lc.prototype.getXRPose=function(w,C){this.updateBasePoseMatrix();switch(C){case "target-ray":w._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&this.gamepad[Db].targetRayTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[Db].targetRayTransform);break;case "grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;w._transformBasePoseMatrix(this.outputMatrix,
this.basePoseMatrix);this.gamepad&&this.gamepad[Db].gripTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[Db].gripTransform);break;default:return null}w._adjustForOriginOffset(this.outputMatrix);return new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)};$jscomp.global.Object.defineProperties(lc.prototype,{profiles:{configurable:!0,enumerable:!0,get:function(){return this.gamepad?this.gamepad._profiles:[]}}});var Hc={highRefreshRate:!0},Ic={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},
dd=0,ed=function(w,C,N){N=void 0===N?{}:N;this.mode=w;this.enabledFeatures=C;this.outputContext=null;this.immersive="immersive-vr"==w||"immersive-ar"==w;this.baseLayer=this.ended=null;this.id=++dd;this.modifiedCanvasLayer=!1;this.outputContext&&(this.renderContext=this.outputContext.canvas.getContext(N.renderContextType||"2d"))},tb=function(w,C){var N=C.capabilities.canPresent;var P=sb.call(this,w)||this;P.display=C;P.frame=new w.VRFrameData;P.sessions=new Map;P.immersiveSession=null;P.canPresent=
N;P.baseModelMatrix=a();P.gamepadInputSources={};P.tempVec3=new Float32Array(3);P.onVRDisplayPresentChange=P.onVRDisplayPresentChange.bind(P);w.window.addEventListener("vrdisplaypresentchange",P.onVRDisplayPresentChange);P.CAN_USE_GAMEPAD=w.navigator&&"getGamepads"in w.navigator;P.HAS_BITMAP_SUPPORT=!(!w.ImageBitmapRenderingContext||!w.createImageBitmap);return P};$jscomp.inherits(tb,sb);tb.prototype.onBaseLayerSet=function(w,C){var N=this,P=this.sessions.get(w),ha=C.context.canvas;if(P.immersive){w=
this.display.getEyeParameters("left");var xa=this.display.getEyeParameters("right");ha.width=2*Math.max(w.renderWidth,xa.renderWidth);ha.height=Math.max(w.renderHeight,xa.renderHeight);this.display.requestPresent([{source:ha,attributes:Hc}]).then(function(){N.global.document.body.contains(ha)||(P.modifiedCanvasLayer=!0,N.global.document.body.appendChild(ha),ha.style.display="block",ha.style.position="absolute",ha.style.width=ha.style.height="1px",ha.style.top=ha.style.left="0px");P.baseLayer=C})}else P.baseLayer=
C};tb.prototype.isSessionSupported=function(w){return"immersive-ar"==w||"immersive-vr"==w&&!1===this.canPresent?!1:!0};tb.prototype.isFeatureSupported=function(w){switch(w){case "viewer":return!0;case "local":return!0;case "local-floor":return!0;case "bounded":return!1;case "unbounded":return!1;default:return!1}};tb.prototype.requestSession=function(w,C){var N=this,P,ha,xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ya){if(1==ya.nextAddress){if(!N.isSessionSupported(w))return ya.return(Promise.reject());
P="immersive-vr"==w;if(!P)return ya.jumpTo(2);ha=N.global.document.createElement("canvas");ha.getContext("webgl");return ya.yield(N.display.requestPresent([{source:ha,attributes:Hc}]),2)}xa=new ed(w,C,{renderContextType:N.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});N.sessions.set(xa.id,xa);P&&(N.immersiveSession=xa,N.dispatchEvent("@@webxr-polyfill/vr-present-start",xa.id));return ya.return(Promise.resolve(xa.id))})};tb.prototype.requestAnimationFrame=function(w){return this.display.requestAnimationFrame(w)};
tb.prototype.getPrimaryButtonIndex=function(w){var C=0,N=w.id.toLowerCase(),P;for(P in Ic)if(N.includes(P)){C=Ic[P];break}return Math.min(C,w.buttons.length-1)};tb.prototype.onFrameStart=function(w,C){this.display.depthNear=C.depthNear;this.display.depthFar=C.depthFar;this.display.getFrameData(this.frame);w=this.sessions.get(w);if(w.immersive&&this.CAN_USE_GAMEPAD){var N=this.gamepadInputSources;this.gamepadInputSources={};for(var P=this.global.navigator.getGamepads(),ha=0;ha<P.length;++ha){var xa=
P[ha];if(xa&&0<xa.displayId){var ya=N[ha];ya||(ya=new lc(this,this.display,this.getPrimaryButtonIndex(xa)));ya.updateFromGamepad(xa);this.gamepadInputSources[ha]=ya;if(-1!=ya.primaryButtonIndex){var La=xa.buttons[ya.primaryButtonIndex].pressed;La&&!ya.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:w.id,inputSource:ya.inputSource}):!La&&ya.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:w.id,inputSource:ya.inputSource});
ya.primaryActionPressed=La}-1!=ya.primarySqueezeButtonIndex&&((xa=xa.buttons[ya.primarySqueezeButtonIndex].pressed)&&!ya.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:w.id,inputSource:ya.inputSource}):!xa&&ya.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:w.id,inputSource:ya.inputSource}),ya.primarySqueezeActionPressed=xa)}}}!w.immersive&&w.baseLayer&&(w=w.baseLayer.context.canvas,h(this.frame.leftProjectionMatrix,
C.inlineVerticalFieldOfView,w.width/w.height,C.depthNear,C.depthFar))};tb.prototype.onFrameEnd=function(w){w=this.sessions.get(w);if(!w.ended&&w.baseLayer){if(w.outputContext&&(!w.immersive||this.display.capabilities.hasExternalDisplay)){var C=w.baseLayer.context.canvas,N=w.immersive&&this.display.capabilities.hasExternalDisplay?C.width/2:C.width,P=C.height,ha=w.outputContext.canvas,xa=ha.width;ha=ha.height;var ya=w.renderContext;this.HAS_BITMAP_SUPPORT?C.transferToImageBitmap?ya.transferFromImageBitmap(C.transferToImageBitmap()):
this.global.createImageBitmap(C,0,0,N,P,{resizeWidth:xa,resizeHeight:ha}).then(function(La){return ya.transferFromImageBitmap(La)}):ya.drawImage(C,0,0,N,P,0,0,xa,ha)}w.immersive&&w.baseLayer&&this.display.submitFrame()}};tb.prototype.cancelAnimationFrame=function(w){this.display.cancelAnimationFrame(w)};tb.prototype.endSession=function(w){var C=this,N;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){N=C.sessions.get(w);if(N.ended)return P.return();if(N.immersive)return P.return(C.display.exitPresent());
N.ended=!0;P.jumpToEnd()})};tb.prototype.doesSessionSupportReferenceSpace=function(w,C){w=this.sessions.get(w);return w.ended?!1:w.enabledFeatures.has(C)};tb.prototype.requestStageBounds=function(){if(this.display.stageParameters){var w=this.display.stageParameters.sizeX,C=this.display.stageParameters.sizeZ,N=[];N.push(-w/2);N.push(-C/2);N.push(w/2);N.push(-C/2);N.push(w/2);N.push(C/2);N.push(-w/2);N.push(C/2);return N}return null};tb.prototype.requestFrameOfReferenceTransform=function(w,C){var N=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){return("local-floor"===w||"bounded-floor"===w)&&N.display.stageParameters&&N.display.stageParameters.sittingToStandingTransform?P.return(N.display.stageParameters.sittingToStandingTransform):P.return(null)})};tb.prototype.getProjectionMatrix=function(w){if("left"===w)return this.frame.leftProjectionMatrix;if("right"===w)return this.frame.rightProjectionMatrix;if("none"===w)return this.frame.leftProjectionMatrix;throw Error("eye must be of type 'left' or 'right'");
};tb.prototype.getViewport=function(w,C,N,P){w=this.sessions.get(w);var ha=N.context.canvas;N=ha.width;ha=ha.height;if(!w.immersive)return P.x=P.y=0,P.width=N,P.height=ha,!0;if("left"===C||"none"===C)P.x=0;else if("right"===C)P.x=N/2;else return!1;P.y=0;P.width=N/2;P.height=ha;return!0};tb.prototype.getBasePoseMatrix=function(){var w=this.frame.pose,C=w.position;w=w.orientation;if(!C&&!w)return this.baseModelMatrix;C||(C=this.tempVec3,C[0]=C[1]=C[2]=0);e(this.baseModelMatrix,w,C);return this.baseModelMatrix};
tb.prototype.getBaseViewMatrix=function(w){if("left"===w||"none"===w)return this.frame.leftViewMatrix;if("right"===w)return this.frame.rightViewMatrix;throw Error("eye must be of type 'left' or 'right'");};tb.prototype.getInputSources=function(){var w=[],C;for(C in this.gamepadInputSources)w.push(this.gamepadInputSources[C].inputSource);return w};tb.prototype.getInputPose=function(w,C,N){if(!C)return null;for(var P in this.gamepadInputSources){var ha=this.gamepadInputSources[P];if(ha.inputSource===
w)return ha.getXRPose(C,N)}return null};tb.prototype.onWindowResize=function(){};tb.prototype.onVRDisplayPresentChange=function(w){var C=this;this.display.isPresenting||this.sessions.forEach(function(N){if(N.immersive&&!N.ended){if(N.modifiedCanvasLayer){var P=N.baseLayer.context.canvas;document.body.removeChild(P);P.setAttribute("style","")}C.immersiveSession===N&&(C.immersiveSession=null);C.dispatchEvent("@@webxr-polyfill/vr-present-end",N.id)}})};$jscomp.global.Object.defineProperties(tb.prototype,
{depthNear:{configurable:!0,enumerable:!0,get:function(){return this.display.depthNear},set:function(w){this.display.depthNear=w}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this.display.depthFar},set:function(w){this.display.depthFar=w}}});var Jc=function(w,C){C=new mc(C||{});w=tb.call(this,w,C)||this;w.display=C;w.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),
pose:null,timestamp:null};return w};$jscomp.inherits(Jc,tb);var fd=0,gd=function(w,C){this.mode=w;this.enabledFeatures=C;this.baseLayer=this.ended=null;this.id=++fd},Ab=function(w){w=sb.call(this,w)||this;w.sessions=new Map;w.projectionMatrix=a();w.identityMatrix=a();return w};$jscomp.inherits(Ab,sb);Ab.prototype.onBaseLayerSet=function(w,C){this.sessions.get(w).baseLayer=C};Ab.prototype.isSessionSupported=function(w){return"inline"==w};Ab.prototype.isFeatureSupported=function(w){switch(w){case "viewer":return!0;
default:return!1}};Ab.prototype.requestSession=function(w,C){var N=this,P;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){if(!N.isSessionSupported(w))return ha.return(Promise.reject());P=new gd(w,C);N.sessions.set(P.id,P);return ha.return(Promise.resolve(P.id))})};Ab.prototype.requestAnimationFrame=function(w){return window.requestAnimationFrame(w)};Ab.prototype.cancelAnimationFrame=function(w){window.cancelAnimationFrame(w)};Ab.prototype.onFrameStart=function(w,C){w=this.sessions.get(w);
w.baseLayer&&(w=w.baseLayer.context.canvas,h(this.projectionMatrix,C.inlineVerticalFieldOfView,w.width/w.height,C.depthNear,C.depthFar))};Ab.prototype.onFrameEnd=function(w){};Ab.prototype.endSession=function(w){var C=this,N;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){N=C.sessions.get(w);N.ended=!0;P.jumpToEnd()})};Ab.prototype.doesSessionSupportReferenceSpace=function(w,C){w=this.sessions.get(w);return w.ended?!1:w.enabledFeatures.has(C)};Ab.prototype.requestStageBounds=function(){return null};
Ab.prototype.requestFrameOfReferenceTransform=function(w,C){return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){return N.return(null)})};Ab.prototype.getProjectionMatrix=function(w){return this.projectionMatrix};Ab.prototype.getViewport=function(w,C,N,P){this.sessions.get(w);C=N.context.canvas;w=C.width;C=C.height;P.x=P.y=0;P.width=w;P.height=C;return!0};Ab.prototype.getBasePoseMatrix=function(){return this.identityMatrix};Ab.prototype.getBaseViewMatrix=function(w){return this.identityMatrix};
Ab.prototype.getInputSources=function(){return[]};Ab.prototype.getInputPose=function(w,C,N){return null};Ab.prototype.onWindowResize=function(){};var hd=function(w){var C,N;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){switch(P.nextAddress){case 1:C=null;if(!("getVRDisplays"in w.navigator)){P.jumpTo(2);break}P.setCatchFinallyBlocks(3);return P.yield(w.navigator.getVRDisplays(),5);case 5:(N=P.yieldResult)&&N.length&&(C=new tb(w,N[0]));P.leaveTryBlock(2);break;case 3:P.enterCatchBlock();
case 2:return P.return(C)}})},id=function(w,C){var N,P;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return 1==ha.nextAddress?C.webvr?ha.yield(hd(w),3):ha.jumpTo(2):2!=ha.nextAddress&&(N=ha.yieldResult)?ha.return(N):(P=Vb(w))&&C.cardboard||!P&&C.allowCardboardOnDesktop?(w.VRFrameData||(w.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=new Float32Array(16);this.leftProjectionMatrix=new Float32Array(16);
this.pose=null}),ha.return(new Jc(w,C.cardboardConfig))):ha.return(new Ab(w))})},jd={global:K,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},oc=["navigator","HTMLCanvasElement","WebGLRenderingContext"],pc=function(w){w=void 0===w?{}:w;this.config=Object.freeze(Object.assign({},jd,w));this.global=this.config.global;this.nativeWebXR="xr"in this.global.navigator;this.injected=!1;this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)};pc.prototype._injectPolyfill=
function(w){if(!oc.every(function(P){return!!w[P]}))throw Error("Global must have the following attributes : "+oc);for(var C=$jscomp.makeIterator(Object.keys(Ra)),N=C.next();!N.done;N=C.next())N=N.value,void 0!==w[N]?console.warn(N+" already defined on global."):w[N]=Ra[N];Cb(w.WebGLRenderingContext)&&(Fb(w.HTMLCanvasElement),w.OffscreenCanvas&&Fb(w.OffscreenCanvas),w.WebGL2RenderingContext&&Cb(w.WebGL2RenderingContext),window.isSecureContext||console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));
this.injected=!0;this._patchNavigatorXR()};pc.prototype._patchNavigatorXR=function(){var w=id(this.global,this.config);this.xr=new Ra.XRSystem(w);Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})};pc.prototype._injectCompatibilityShims=function(w){if(!oc.every(function(N){return!!w[N]}))throw Error("Global must have the following attributes : "+oc);if(w.navigator.xr&&"supportsSession"in w.navigator.xr&&!("isSessionSupported"in w.navigator.xr)){var C=w.navigator.xr.supportsSession;
w.navigator.xr.isSessionSupported=function(N){return C.call(this,N).then(function(){return!0}).catch(function(){return!1})};w.navigator.xr.supportsSession=function(N){console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves.");return C.call(this,N)}}};return pc});(function(){var a=function(b,c,d,e,f,g,h,k){this.id=b;this.name=c;this.parentTexture=d;this.textureCropper=e;this.extractedTexture=this.stdExt=this.rawExt=null;this.uvOffsetScale=new THREE.Vector4(f,g,h,k);this.isCutout=!1;this.importAutoScale=this.importGpuCompress=!0};a.prototype={addLoadedListener:function(b){this.parentTexture.addLoadedListener(b)},extractTexture:function(){console.assert(null!==this.textureCropper);console.assert(null===this.extractedTexture);this.extractedTexture=this.textureCropper.cropTextureToPoTTarget(this.parentTexture,
this.uvOffsetScale)},get hasAlpha(){return this.parentTexture.hasAlpha},serialize:function(){return{id:this.id,name:this.name,atlasId:this.parentTexture.id,atlasOffset:[this.uvOffsetScale.x,this.uvOffsetScale.y],atlasScale:[this.uvOffsetScale.z,this.uvOffsetScale.w],rawExt:this.rawExt,stdExt:this.stdExt,webFormats:[],alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale}}};WALK.Texture=function(b,c,d,e,f,g,h,k){this.webFormats=this.stdExt=this.rawExt=this.name=
this.id=null;this.isCube=!1;this.image=void 0!==b?b:WALK.Texture.DEFAULT_IMAGE;this.height=this.width=null;this.mipmaps=[];this.wrapS=void 0!==c?c:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==d?d:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==e?e:GLC.LINEAR;this.minFilter=void 0!==f?f:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==k?k:1;this.isRgbm=this.isCutout=this.hasAlpha=this.isAnimated=!1;this.format=void 0!==g?g:GLC.RGBA;this.type=void 0!==h?h:GLC.UNSIGNED_BYTE;this.generateMipmaps=!0;this.premultiplyAlpha=
!1;this.flipY=!0;this.unpackAlignment=4;this._textureCropper=this._atlasEntries=null;this._needsUpdate=!1;this.releaseOnLoadedToGpu=!0;this.loaded=!1;this._loadedListeners=[];this.__webglSlot=this.__webglTexture=null;this.importAutoScale=this.importGpuCompress=!0};WALK.Texture.DEFAULT_IMAGE=void 0;WALK.Texture.prototype={constructor:WALK.Texture,sleepAnimation:function(){console.assert(!1)},wakeAnimation:function(){console.assert(!1)},get needsUpdate(){return this._needsUpdate},set needsUpdate(b){this._needsUpdate=
b},isAtlas:function(){return null!==this._atlasEntries},enableAtlas:function(b){console.assert(!this.isAtlas());this._atlasEntries={};this._textureCropper=b},getAtlasEntry:function(b,c,d,e,f,g){var h=this._atlasEntries[c];if(h)return h;console.assert(!this.loaded);h=new a(b,c,this,this._textureCropper,d,e,f,g);return this._atlasEntries[c]=h},forEachAtlasEntry:function(b){for(var c in this._atlasEntries)this._atlasEntries.hasOwnProperty(c)&&b(this._atlasEntries[c])},clone:function(b){void 0===b&&(b=
new WALK.Texture);b.isCube=b.isCube;b.image=this.image;b.mipmaps=this.mipmaps.slice(0);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.minFilter=this.minFilter;b.anisotropy=this.anisotropy;b.isCutout=this.isCutout;b.isAnimated=this.isAnimated;b.hasAlpha=this.hasAlpha;b.format=this.format;b.type=this.type;b.generateMipmaps=this.generateMipmaps;b.premultiplyAlpha=this.premultiplyAlpha;b.flipY=this.flipY;b.unpackAlignment=this.unpackAlignment;return b},serialize:function(){var b={id:this.id,
name:this.name,stdExt:this.stdExt,webFormats:this.webFormats,alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale};this.rawExt&&(b.rawExt=this.rawExt);this.isRgbm&&(b.rgbm=!0);return b},dispose:function(){this._loadedListeners=[];this.dispatchEvent({type:"dispose"})},addLoadedListener:function(b){this.loaded?b():this._loadedListeners.push(b)},notifyLoaded:function(){this.loaded=!0;for(var b=this._loadedListeners,c=0;c<b.length;c+=1)b[c]();b.length=0}};
THREE.EventDispatcher.prototype.apply(WALK.Texture.prototype)})();(function(){WALK.CompressedTexture=function(a,b,c,d,e,f,g,h,k,q){WALK.Texture.call(this,null,f,g,h,k,d,e,q);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};WALK.CompressedTexture.prototype=Object.create(WALK.Texture.prototype);WALK.CompressedTexture.prototype.constructor=WALK.CompressedTexture;WALK.CompressedTexture.prototype.clone=function(){var a=new WALK.CompressedTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.DataTexture=function(a,b,c,d,e,f,g,h,k,q){WALK.Texture.call(this,null,f,g,h,k,d,e,q);this.image={data:a,width:b,height:c}};WALK.DataTexture.prototype=Object.create(WALK.Texture.prototype);WALK.DataTexture.prototype.constructor=WALK.DataTexture;WALK.DataTexture.prototype.clone=function(){var a=new WALK.DataTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.VideoTexture=function(a,b,c,d,e,f,g,h,k){var q=this;WALK.Texture.call(this,a,b,c,d,e,f,g,h,k);this.generateMipmaps=!1;this.isAnimated=!0;this.releaseOnLoadedToGpu=!1;this._isPlaying=!0;this._pauseRequested=this._isSleeping=!1;this._videoSrc=null;this._pausedTime=0;this._interruptible=!0;this._resizedListeners=[];this._handlePaused=function(){q._pauseRequested?q._pauseRequested=!1:q._isSleeping=!0;!q._isPlaying&&q._interruptible&&(q.video.src="")};this._handleEnded=function(){q._isPlaying=
!1;q._isSleeping=!1};this._notifyResized=function(){q.width=q.video.videoWidth;q.height=q.video.videoHeight;for(var p=0;p<q._resizedListeners.length;p+=1)q._resizedListeners[p]()}};WALK.VideoTexture.prototype=Object.create(WALK.Texture.prototype);WALK.VideoTexture.prototype.constructor=WALK.VideoTexture;WALK.VideoTexture.prototype._srcAtPausedPosition=function(){return this._videoSrc+"#t="+this._pausedTime};WALK.VideoTexture.prototype._pauseVideo=function(){this._pausedTime=this.video.currentTime;
this.video.pause()};WALK.VideoTexture.prototype.rewind=function(){this._pausedTime=0;this.video.currentTime=0};Object.defineProperty(WALK.VideoTexture.prototype,"video",{get:function(){return this.image},set:function(a){console.assert(void 0===this.image,"Video already attached to texture.");this.image=a;this._videoSrc=a.src;this._isPlaying=!a.paused&&!a.ended;a.addEventListener("pause",this._handlePaused);a.addEventListener("ended",this._handleEnded);a.addEventListener("resize",this._notifyResized);
this._isSleeping&&this._isPlaying&&this._pauseVideo()}});Object.defineProperty(WALK.VideoTexture.prototype,"muted",{get:function(){return this.video.muted},set:function(a){this.video.muted=a}});Object.defineProperty(WALK.VideoTexture.prototype,"loop",{get:function(){return this.video.loop},set:function(a){this.video.loop=a}});Object.defineProperty(WALK.VideoTexture.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying}});WALK.VideoTexture.prototype.play=function(){var a=this;
if(!this._isPlaying)if(this._isSleeping)this._isPlaying=!0;else{var b=this.video;this._interruptible&&(b.src=this._srcAtPausedPosition());var c=b.play();c?(this._isPlaying=!0,c.catch(function(d){console.log("Can't play video texture: "+d);a._isPlaying=!1})):this._isPlaying=!b.paused&&!b.ended}};WALK.VideoTexture.prototype.pause=function(){this._isPlaying&&this.video&&(this._isPlaying=!1,this._isSleeping||(this._pauseRequested=!0,this._pauseVideo()))};WALK.VideoTexture.prototype.sleepAnimation=function(){this._isSleeping||
(this._isPlaying&&this.video&&this._pauseVideo(),this._isSleeping=!0)};WALK.VideoTexture.prototype.wakeAnimation=function(){this._isSleeping&&(this._isPlaying&&this.video&&(this._interruptible&&(this.video.src=this._srcAtPausedPosition()),this.video.play()),this._isSleeping=!1)};WALK.VideoTexture.prototype.dispose=function(){WALK.Texture.prototype.dispose.call(this);this._isPlaying&&this.pause();var a=this.video;this.image=null;this._videoSrc="";this._isPlaying=!1;a.src="";a.removeEventListener("pause",
this._handlePaused);a.removeEventListener("ended",this._handleEnded);a.removeEventListener("resize",this._notifyResized);this._resizedListeners.length=0};WALK.VideoTexture.prototype.addResizedListener=function(a){this._resizedListeners.push(a)};WALK.VideoTexture.prototype.serialize=function(){var a=WALK.Texture.prototype.serialize.call(this);a.video=!0;return a};Object.defineProperty(WALK.VideoTexture.prototype,"needsUpdate",{get:function(){return this._needsUpdate||this.isPlaying&&this.video&&!0!==
this.video.seeking&&this.video.readyState>=this.video.HAVE_CURRENT_DATA},set:function(a){this._needsUpdate=a}})})();(function(){WALK.WebGLRenderTarget=function(a,b,c){this.y=this.x=0;this.width=a;this.height=b;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==c.wrapT?c.wrapT:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==c.magFilter?c.magFilter:GLC.LINEAR;this.minFilter=void 0!==c.minFilter?c.minFilter:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=void 0!==c.format?c.format:
GLC.RGBA;this.type=void 0!==c.type?c.type:GLC.UNSIGNED_BYTE;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=c.generateMipmaps||!1;this.shareDepthFrom=void 0!==c.shareDepthFrom?c.shareDepthFrom:null;this.isCube=!1;this.loaded=!0;this.__webglSlot=this.__webglTexture=this.__webglRenderbuffer=this.__webglFramebuffer=null};WALK.WebGLRenderTarget.prototype={constructor:WALK.WebGLRenderTarget,dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetVR=function(a){this.__webglFramebuffer=a;this.height=this.width=this.y=this.x=null;this.isCube=!1};WALK.WebGLRenderTargetVR.prototype={constructor:WALK.WebGLRenderTargetVR,dispose:function(){this.__webglFramebuffer=null;this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTargetVR.prototype)})();(function(){WALK.WebGLRenderTargetCube=function(a,b,c){WALK.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0;this.isCube=!0;this.__webglFramebuffer=[];this.__webglRenderbuffer=[]};WALK.WebGLRenderTargetCube.prototype=Object.create(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetCube.prototype.constructor=WALK.WebGLRenderTargetCube})();(function(){var a=WALK.DEBUG;WALK.CutoutTextureDetector=function(b){var c={format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1},d=[b.createRenderTarget(1024,1024,c),b.createRenderTarget(512,512,c)];c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvOffsetScale:{type:"v4",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_fragment.glsl")};var e=new THREE.ShaderPass(c,
"map");e.material.depthTest=!1;e.material.depthWrite=!1;var f=new THREE.Vector2,g=new THREE.Vector4;e.uniforms.mapUvStep.value=f;e.uniforms.mapUvOffsetScale.value=g;c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvScale:{type:"v2",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_combine_fragment.glsl")};var h=new THREE.ShaderPass(c,"map");h.material.depthTest=!1;h.material.depthWrite=!1;var k=new THREE.Vector2;
h.uniforms.mapUvScale.value=k;h.uniforms.mapUvStep.value=f;var q=new Uint8Array(4096),p=null;a&&(p=new WALK.Timer);this.isCutoutTexture=function(r){var n=void 0!==r.parentTexture;if(n){var m=r.parentTexture;var l=r.uvOffsetScale.x;var u=r.uvOffsetScale.y;var v=r.uvOffsetScale.z;var t=r.uvOffsetScale.w}else m=r,l=u=0,v=t=1;if(!m.hasAlpha||m.video)r.isCutout=!1;else{a&&p.reset();b.enableScissorTest(!0);var B=m.width*v,D=m.height*t;f.set(1/B,1/D);g.set(l,u,v,t);B=Math.max(Math.floor(B/2),1);D=Math.max(Math.floor(D/
2),1);b.setRenderTarget(d[0]);b.setViewport(0,0,B,D);b.setScissor(0,0,B,D);e.render(b,d[0],m);for(var I=1,J=d[0];1!==B&&1!==D;){f.set(1/J.width,1/J.height);k.set(B/J.width,D/J.height);B=Math.floor(B/2);D=Math.floor(D/2);var Q=d[I];b.setRenderTarget(Q);b.setViewport(0,0,B,D);b.setScissor(0,0,B,D);h.render(b,Q,J);J=Q;I=(I+1)%2}b.readPixels(B,D,q);J=I=0;B=Math.max(B,D);for(D=0;D<B;++D)I+=q[4*D],J+=q[4*D+1];I=100*I/(255*B);J=100*J/(255*B);r.isCutout=20>I||50<J;a&&(B="",n&&(B+="From atlas: "+m.name+" ["+
l+", "+u+", "+v+", "+t+"]\n"),console.log(r.name+" "+m.width+"x"+m.height+"\n "+B+"Is cutout: "+r.isCutout+"\n Partialy transparent regions: "+I+"%\n Fully transparent pixels: "+J+"%\n Time: "+p.elapsedSec()));b.enableScissorTest(!1)}};this.dispose=function(){d[0].dispose();d[1].dispose();e.dispose();h.dispose()}}})();(function(){WALK.TextureCropper=function(a){var b=new THREE.ShaderPass({uniforms:{srcTexture:{type:"t",value:null},uvOffsetScale:{type:"v4",value:null}},vertexShader:WALK.getShader("crop_texture_vertex.glsl"),fragmentShader:WALK.getShader("crop_texture_fragment.glsl")},"srcTexture");b.material.depthTest=!1;b.material.depthWrite=!1;this.cropTextureToPoTTarget=function(c,d){var e=THREE.Math.nextPowerOfTwo(d.z*c.width),f=THREE.Math.nextPowerOfTwo(d.w*c.height);e=a.createRenderTarget(e,f,{wrapS:GLC.REPEAT,
wrapT:GLC.REPEAT,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR_MIPMAP_LINEAR,format:GLC.RGBA,type:GLC.UNSIGNED_BYTE,depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!0});b.uniforms.uvOffsetScale.value=d;b.render(a,e,c);a.deallocateRenderTargetRenderingBuffers(e);return e}}})();WALK.SHADERS={};WALK.SHADERS["aabb_query_fragment.glsl"]="//AUTO GENERATED\nvarIn vec3 vPositionW;\nuniform int axis;\nvec4 encodeFloat(in float x) {\nfloat xabs = abs(x);\nfloat r = floor(xabs);\nfloat g = fract(xabs);\nreturn vec4(r / 255.0, g, 0.0, 0.0);\n}\nvoid main() {\nvec3 viewW = cameraPosition - vPositionW;\nif (axis == 0) {\nfragColor = encodeFloat(viewW.x);\n} else if (axis == 1) {\nfragColor = encodeFloat(viewW.y);\n} else if (axis == 2) {\nfragColor = encodeFloat(viewW.z);\n}\n}\n";
WALK.SHADERS["aabb_query_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["accumulate_fragment.glsl"]="//AUTO GENERATED\nuniform float weight;\nuniform sampler2D inputBuffer;\nvarIn vec2 vUv;\nvoid main() {\nvec3 inputColor = texture2D(inputBuffer, vUv).rgb;\nfragColor = vec4(inputColor, weight);\n}\n";WALK.SHADERS["accumulate_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["alpha_stats_combine_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec2 mapUvScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvScale- mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nvec4 p0 = texture2D(map, uv);\nvec4 p1 = texture2D(map, uv + vec2(0.0, mapUvStep.y));\nvec4 p2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0));\nvec4 p3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y));\nfragColor = vec4((p0.r + p1.r + p2.r + p3.r) / 4.0,\n(p0.g + p1.g + p2.g + p3.g) / 4.0, 0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec4 mapUvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvOffsetScale.zw + mapUvOffsetScale.xy - mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nconst float bias = -1.0;\nfloat a0 = texture2D(map, uv, bias).a;\nfloat a1 = texture2D(map, uv + vec2(0.0, mapUvStep.y), bias).a;\nfloat a2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0), bias).a;\nfloat a3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y), bias).a;\nfloat fully_transparent_count = step(0.0, -a0) + step(0.0, -a1) +\nstep(0.0, -a2) + step(0.0, -a3);\nfloat partialy_transparent_count =\nstep(0.0, -abs(clamp(a0, 0.05, 0.95) - a0)) +\nstep(0.0, -abs(clamp(a1, 0.05, 0.95) - a1)) +\nstep(0.0, -abs(clamp(a2, 0.05, 0.95) - a2)) +\nstep(0.0, -abs(clamp(a3, 0.05, 0.95) - a3));\nfragColor = vec4(step(4.0, partialy_transparent_count),\nfully_transparent_count / 4.0,\n0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["anchor_sprite_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\nvec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\nvec2 scale;\nscale.x = length(modelMatrix[0].xyz);\nscale.y = length(modelMatrix[1].xyz);\nvec2 alignedPosition = position.xy * scale;\nmvPosition.xy += alignedPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["anchor_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarOut vec3 vNormalV;\nvarOut vec3 vPositionV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\nvarOut vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvec3 normal = sphericalDecode(sphericalNormal);\nvec3 normalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nnormalW = normalize(normalW);\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE)\nvec3 anchorCenterW = vec3(modelMatrix[3].xyz);\nvec3 cameraUpW = vec3(modelViewMatrix[0].y,\nmodelViewMatrix[1].y,\nmodelViewMatrix[2].y);\nvec3 forwardW = normalize(anchorCenterW - cameraPosition);\nvec3 rightW = cross(forwardW, cameraUpW);\nrightW.z = 0.0;\nrightW = normalize(rightW);\nvec3 upW = cross(rightW, forwardW);\nvUv = vec2(dot(normalW, rightW) * 0.5 + 0.5, dot(normalW, upW) * 0.5 + 0.5);\n#endif\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = normalW;\nvPositionW = positionW;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["cap_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nvoid main() {\nfragColor = vec4(color, 1.0);\n}\n";WALK.SHADERS["cap_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvoid main() {\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["copy_opaque_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D tDiffuse;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = vec4(texture2D(tDiffuse, vUv).rgb, 1.0);\n}\n";WALK.SHADERS["copy_opaque_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["crop_texture_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D srcTexture;\nuniform vec4 uvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = texture2D(srcTexture, uvOffsetScale.xy + vUv * uvOffsetScale.zw);\n}\n";
WALK.SHADERS["crop_texture_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["cubemap_filter_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\nuniform samplerCube envMap;\nuniform float mipSize;\nuniform float face;\nuniform float gloss;\nvoid main(void) {\nvec2 st = 2.0 * floor(gl_FragCoord.xy) / (mipSize - 1.0) - 1.0;\nvec3 vec;\nif (face == 0.0) {\nvec = vec3(1, -st.y, -st.x);\n} else if (face == 1.0) {\nvec = vec3(-1, -st.y, st.x);\n} else if (face == 2.0) {\nvec = vec3(st.x, 1, st.y);\n} else if (face == 3.0) {\nvec = vec3(st.x, -1, -st.y);\n} else if (face == 4.0) {\nvec = vec3(st.x, -st.y, 1);\n} else {\nvec = vec3(-st.x, -st.y, -1);\n}\nmat3 vecSpace = matrixFromVector(normalize(vec));\nvec3 color = vec3(0.0);\nconst int samples = 200;\nvec3 vect;\nfor(int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nvect = hemisphereSample_cos(\nvec2(float(i) / float(samples), rand), vecSpace, vec, gloss);\ncolor += hdrDecode(textureCube(envMap, vect));\n}\ncolor /= float(samples);\nfragColor = hdrEncode(color);\n}\n";
WALK.SHADERS["cubemap_filter_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["cube_to_equirect_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform samplerCube panoramaCube;\nvarIn vec2 vUv;\nvoid main() {\nvec2 uv = vUv;\nfloat longitude = uv.x * 2. * PI;\nfloat latitude = uv.y * PI;\nvec3 dir = vec3(\nsin(longitude) * sin(latitude),\ncos(longitude) * sin(latitude),\ncos(latitude));\nfragColor = textureCube(panoramaCube, normalize(dir));\n}\n";
WALK.SHADERS["cube_to_equirect_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main()  {\nvUv = vec2(uv.x, uv.y - 1.0);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["editor_light_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform vec3 color;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vNormal;\nvarIn vec3 vViewPosition;\nvoid main() {\nvec3 lVector = normalize(vViewPosition.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormal), lVector), 0.0);\nvec3 lightColor = color * pointDiffuse;\nlightColor = mix(lightColor, highlight, highlightMix);\nfragColor = vec4(min(linearToGamma(lightColor), 1.0), 1.0);\n}\n";
WALK.SHADERS["editor_light_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvarOut vec3 vNormal;\nvarOut vec3 vViewPosition;\nvoid main() {\nvec3 normal = sphericalDecode(sphericalNormal);\nvNormal = normalize(normalMatrix * normal);\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvViewPosition = -mvPosition.xyz;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["equirect_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nuniform sampler2D map;\nuniform float exposure;\nuniform float cameraGamma;\nvarIn vec2 vUv;\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\n#ifdef USE_RGBM_MAP\nvec4 colorRgbm = texture2D(map, vUv);\nvec3 colorLinear = hdrDecode(colorRgbm);\n#else\nvec3 colorLinear = gammaToLinear(texture2D(map, vUv).xyz);\n#endif\n#ifdef HDR_OUTPUT\n#ifdef USE_RGBM_MAP\nfragColor = colorRgbm;\n#else\nfragColor = hdrEncode(10.0 * colorLinear);\n#endif\n#else\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\nvec3 colorGamma =  linearToGammaUnreal(colorExposed);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n";
WALK.SHADERS["equirect_sky_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["gaze_pointer_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nconst float pointRadius = 0.01;\nconst float pointBorder = 0.005;\nconst float timerRadius = 0.04;\nconst float timerBorder = 0.02;\nconst vec3 timerColor =  vec3(0.298, 0.619, 0.851);\nvarIn vec2 coords;\nuniform float circleSpan;\nvoid main() {\nfloat dist =  sqrt(dot(coords, coords));\nif (dist < pointRadius) {\nfloat a = 1.0 - smoothstep(pointRadius - pointBorder, pointRadius, dist);\nfragColor = vec4(1.0, 1.0, 1.0, a);\n} else if (-atan(coords.x, -coords.y) < circleSpan) {\nfloat a2 = smoothstep(timerRadius - timerBorder, timerRadius, dist) -\nsmoothstep(timerRadius, timerRadius + timerBorder, dist);\nfragColor = vec4(timerColor, a2);\n} else {\ndiscard;\n}\n}\n";
WALK.SHADERS["gaze_pointer_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 coords;\nvoid main() {\ncoords = vec2(position.x, position.y);\nvec4 outPosition = projectionMatrix *  modelViewMatrix * vec4(position, 1.0);\noutPosition.z = -0.1;\ngl_Position = outPosition;\n}\n";WALK.SHADERS["luma_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\nuniform vec3 color;\nvoid main() {\nvec3 receivedLight = getLightIntensity();\nvec3 diffuseLight = receivedLight * color;\nfloat luma = 0.299 * diffuseLight.r +\n0.587 * diffuseLight.g +\n0.114 * diffuseLight.b;\nfragColor.r = fract(luma);\nfragColor.g = floor(luma) / 255.0;\n}\n";
WALK.SHADERS["minimap_add_alpha_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D tColor;\n#ifdef USE_ALPHA_FROM_COLOR\nuniform vec3 colorFill;\n#else\nuniform sampler2D tAlpha;\n#endif\nvarIn vec2 vUv;\nvoid main() {\nvec4 color = texture2D(tColor, vUv);\n#ifdef USE_ALPHA_FROM_COLOR\nfloat alphaFromColor = (color.r + color.g + color.b) / 3.0;\nfragColor = vec4(colorFill, alphaFromColor);\n#else\nfloat alpha = vec4(texture2D(tAlpha, vUv)).a;\nfragColor = vec4(color.rgb, alpha);\n#endif\n}\n";
WALK.SHADERS["minimap_add_alpha_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["mirror_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarIn vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn (base < 0.5 ? (2.0 * base * blend) :\n(1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r),\nblendOverlay(mirrorColor.g, color.g),\nblendOverlay(mirrorColor.b, color.b), 1.0);\nfragColor = color;\n}\n";
WALK.SHADERS["mirror_vertex.glsl"]="//AUTO GENERATED\nuniform mat4 textureMatrix;\nvarOut vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvec4 worldPosition = modelMatrix * vec4(position, 1.0);\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";WALK.SHADERS["object_distance_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["object_id_distance_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nfloat cameraDistance = min(distance(cameraPosition, vPositionW), 255.0);\nint x = objectId / 256;\nint y = objectId - 256 * x;\nfloat z = floor(cameraDistance);\nfloat a = fract(cameraDistance);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nz / 255.0, a);\n}\n";WALK.SHADERS["object_id_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 0);\n}\n";
WALK.SHADERS["outline_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nvoid main() {\nfragColor = vec4(color, 1.0);\n}\n";WALK.SHADERS["outline_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nuniform float thickness;\nvoid main() {\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\nvec4 transformedPosition = transformPosition();\nfloat distToCamera = cameraPosition.z - transformedPosition.z;\nvec4 movedPosition = vec4(\ntransformedPosition.x - distToCamera * thickness * normal.x,\ntransformedPosition.y - distToCamera * thickness * normal.y,\ntransformedPosition.z, transformedPosition.w);\ngl_Position = projectionMatrix * modelViewMatrix * movedPosition;\n}\n";
WALK.SHADERS["procedural_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float sinBottomAngle;\nuniform float exponent;\nvarIn vec3 vWorldDirection;\n#ifdef HDR_OUTPUT\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\nfloat sinDirection = normalize(vWorldDirection).z;\nfloat w = max(0.0, (sinDirection - sinBottomAngle) / (1.0 - sinBottomAngle));\nvec3 colorGamma = mix(bottomColor, topColor, pow(w, exponent));\n#ifdef HDR_OUTPUT\nvec3 colorLinear = gammaToLinear(colorGamma);\nfragColor = hdrEncode(10.0 * colorLinear);\n#else\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n";
WALK.SHADERS["procedural_sky_vertex.glsl"]="//AUTO GENERATED\nvarOut vec3 vWorldDirection;\nvoid main() {\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvWorldDirection = positionW - cameraPosition;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["rotate_gizmo_material_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nuniform float opacity;\nuniform vec3 gizmoPosition;\nuniform float sphereRadius;\nvarIn vec4 mPosition;\nvoid discardIfRayIntersectsSphere(vec3 r0, vec3 rd, vec3 s0, float sr) {\nfloat a = dot(rd, rd);\nvec3 s0_r0 = r0 - s0;\nfloat b = 2.0 * dot(rd, s0_r0);\nfloat c = dot(s0_r0, s0_r0) - (sr * sr);\nfloat delta = b * b - 4.0 * a * c;\nif (delta >= 0.0 && -b - sqrt(delta) > 0.0) {\ndiscard;\n}\n}\nvoid main() {\nvec4 outColor;\noutColor.rgb = color;\noutColor.a = opacity;\nvec3 toCamera = normalize(cameraPosition - gizmoPosition);\ndiscardIfRayIntersectsSphere(mPosition.xyz, toCamera, gizmoPosition, sphereRadius);\nfragColor = outColor;\n}\n";
WALK.SHADERS["rotate_gizmo_material_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec4 mPosition;\nvoid main() {\nvec4 p = vec4(position, 1.0);\nmPosition = modelMatrix * p;\nvec4 mvPosition = modelViewMatrix * p;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["standard_material_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarIn vec3 vNormalW;\nvarIn vec3 vPositionW;\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarIn vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarIn vec3 vPositionV;\nvarIn vec3 vNormalV;\nuniform float bumpScale;\nuniform sampler2D bumpTexture;\nvec2 dBumpdxy() {\nvec2 texdx = dFdx(vUv);\nvec2 texdy = dFdy(vUv);\nfloat Hll = bumpScale * texture2D(bumpTexture, vUv).x;\nfloat dBx = bumpScale * texture2D(bumpTexture, vUv + texdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpTexture, vUv + texdy).x - Hll;\nreturn vec2(dBx, dBy);\n}\nvec3 perturbNormal(in vec3 surfPos, in vec3 surfNorm) {\nvec2 dBdxy = dBumpdxy();\nvec3 vSigmaX = dFdx(surfPos);\nvec3 vSigmaY = dFdy(surfPos);\nvec3 R1 = cross(vSigmaY, surfNorm);\nvec3 R2 = cross(surfNorm, vSigmaX);\nfloat fDet = dot(vSigmaX, R1);\nvec3 vGrad = sign(fDet) * (dBdxy.x * R1 + dBdxy.y * R2);\nreturn normalize(abs(fDet) * surfNorm - vGrad);\n}\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nuniform sampler2D baseColorTexture;\nuniform vec4 baseColorAtlasUvMod;\nuniform float alphaDiscardThreshold;\n#ifdef USE_PARALLAX_CORRECTION\n#endif\n#else\nuniform vec3 baseColor;\n#endif\nuniform float opacity;\nuniform vec4 baseColorCorrection;\nvec3 getBaseColor(out float alpha) {\n#ifdef USE_BASE_COLOR_TEXTURE\n#ifdef USE_PARALLAX_CORRECTION\n#else\nvec2 uv = vUv;\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT\nvec2 uvScaled = uv * baseColorAtlasUvMod.zw;\nvec2 dfdx = dFdx(uvScaled);\nvec2 dfdy = dFdy(uvScaled);\nuv = fract(uv) * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\nvec4 baseColorGamma = texture2DGradEXT(baseColorTexture, uv, dfdx, dfdy);\nfloat textureAlpha = baseColorGamma.a;\n#else\nuv = uv * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\n#ifdef USE_ALPHA_IN_LOWER_HALF\nvec4 baseColorGamma = texture2D(baseColorTexture,\nvec2(uv.x, .5 + .5 * uv.y));\nfloat textureAlpha = texture2D(baseColorTexture,\nvec2(uv.x, .5 * uv.y)).r;\n#else\nvec4 baseColorGamma = texture2D(baseColorTexture, uv);\nfloat textureAlpha = baseColorGamma.a;\n#endif\n#endif\nvec3 baseColor = gammaToLinear(baseColorGamma.rgb);\nalpha = opacity * textureAlpha;\n#else // NOT USE_BASE_COLOR_TEXTURE\nalpha = opacity;\n#endif\nvec3 baseColorCorrected = baseColorCorrection.a * baseColor +\nbaseColorCorrection.rgb;\nreturn clamp(baseColorCorrected, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\n#ifdef USE_ROUGHNESS_TEXTURE\nuniform sampler2D roughnessTexture;\n#else\nuniform float roughness;\n#endif\n#ifdef USE_METALLIC_TEXTURE\nuniform sampler2D metallicTexture;\n#else\nuniform float metallic;\n#endif\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity);\n#if defined(USE_ENVMAP)\nconst float DLT = 0.001;\nuniform samplerCube envMap;\nuniform float envMipsCount;\n#ifdef HAVE_TEXTURE_LOD\n#else\nuniform samplerCube envMap2;\n#endif\nstruct Roughness {\nfloat envFresnel; // (1.0 - roughness)^2, used for Fresnel with env map\nfloat envMipLevel0;\nfloat envMipLevel1;\nfloat envMipMixFactor;\n};\nRoughness getRoughnessFactors() {\nRoughness r;\n#ifdef USE_ROUGHNESS_TEXTURE\nfloat roughness = texture2D(roughnessTexture, vUv).x;\n#endif // else roughness is a uniform\nfloat roughness2 = roughness * roughness;\nfloat maxMipLevel = envMipsCount - 1.0;\nfloat mipSelector = roughness * maxMipLevel;\nr.envMipLevel0 = floor(mipSelector);\nr.envMipLevel1 = min(r.envMipLevel0 + 1.0, maxMipLevel);\nr.envMipMixFactor = fract(mipSelector);\nr.envFresnel = (roughness2 - 2.0 * roughness + 1.0);\nreturn r;\n}\n#ifdef USE_ENVMAP_PROJECT\nuniform vec3 envBoxMin;\nuniform vec3 envBoxMax;\nuniform vec3 envMapPosW;\nconst vec3 infBox = vec3(1000.0);\nvec3 cubeMapProject(vec3 reflectionW) {\nvec3 firstPlaneIntersect = (envBoxMax - vPositionW) / reflectionW;\nvec3 secondPlaneIntersect = (envBoxMin - vPositionW) / reflectionW;\nvec3 furthestPlane = max(firstPlaneIntersect, secondPlaneIntersect);\nvec3 furthestPlaneNonNeg =\nstep(0.0, -furthestPlane) * infBox + abs(furthestPlane);\nfloat distance = min(min(furthestPlaneNonNeg.x, furthestPlaneNonNeg.y),\nfurthestPlaneNonNeg.z);\n/*if (furthestPlane.x > 0.0){\ndistance = furthestPlane.x;\n}\nif (furthestPlane.y > 0.0) {\ndistance = min(distance, furthestPlane.y);\n}\nif (furthestPlane.z > 0.0) {\ndistance = min(distance, furthestPlane.z);\n}*/\nvec3 intersectionPosW = vPositionW + reflectionW * distance;\nreturn intersectionPosW - envMapPosW;\n}\n#endif // USE_ENVMAP_PROJECT\nvec3 fixSeams(vec3 vec, float mipLevel) {\nfloat scale = 1.0 - exp2(mipLevel) / 128.0;\nfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\nif (abs(vec.x) != M) vec.x *= scale;\nif (abs(vec.y) != M) vec.y *= scale;\nif (abs(vec.z) != M) vec.z *= scale;\nreturn vec;\n}\nvec3 getEnvColor(in samplerCube envMap, in Roughness roughness,\nin vec3 reflectionW) {\nvec3 reflectionNormW = normalize(reflectionW);\n#ifdef USE_ENVMAP_PROJECT\nif (envBoxMin.x != envBoxMax.x) {\nreflectionNormW = cubeMapProject(reflectionNormW);\n}\n#endif\nvec3 reflectionNormFixedW = fixSeams(reflectionNormW,\nroughness.envMipLevel0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw0 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel0);\n#else\nvec4 cubeColorRaw0 = textureCube(envMap, reflectionNormFixedW);\n#endif\nvec3 cubeColor0 = hdrDecode(cubeColorRaw0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw1 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel1);\n#else\nvec4 cubeColorRaw1 = textureCube(envMap2, reflectionNormFixedW);\n#endif\nvec3 cubeColor1 = hdrDecode(cubeColorRaw1);\nreturn mix(cubeColor0, cubeColor1, roughness.envMipMixFactor);\n}\nvec3 fresnelSchlickEnv(in vec3 specularColor, in Roughness roughness,\nin float clampCosnv, inout float opacity) {\nfloat fresnel = 1.0 - clampCosnv;\nfloat fresnel2 = fresnel * fresnel;\nfresnel *= fresnel2 * fresnel2;\nfresnel *= roughness.envFresnel;\nopacity = opacity + (1.0 - opacity) * fresnel;\nreturn specularColor + (1.0 - specularColor) * fresnel;\n}\nvec3 getSpecularColor(in vec3 baseColor, float metalic) {\nconst float dielectricF0 = 0.04;\nreturn mix(vec3(dielectricF0), baseColor, metalic);\n}\nfloat getLuminance(in vec3 color) {\nreturn 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n}\nvec3 getNormalW() {\n#ifdef USE_BUMP_TEXTURE\nvec3 normalPerturbedV = perturbNormal(-vPositionV, normalize(vNormalV));\nreturn normalize(\ninverseTransformDirection(normalPerturbedV, viewMatrix));\n#else\nreturn normalize(vNormalW);\n#endif\n}\nvec3 addSpecular(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 totalSpec = vec3(0.0, 0.0, 0.0);\n#ifdef USE_METALLIC_TEXTURE\nfloat metallic = texture2D(metallicTexture, vUv).x;\n#endif // else metallic is a uniform\nvec3 diffuseIntensity = totalIntensity * (1.0 - mix(0.04, 1.0, metallic));\nvec3 viewW = normalize(cameraPosition - vPositionW);\nvec3 normalW = getNormalW();\nfloat clampCosnv = saturate(dot(normalW, viewW));\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 specularColor = getSpecularColor(baseColor, metallic);\nRoughness roughness = getRoughnessFactors();\nvec3 envColor = getEnvColor(envMap, roughness, reflectionW);\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\ntotalSpec = envColor * fresnel;\nfloat luminance = getLuminance(totalIntensity);\nreturn (baseColor * diffuseIntensity +\ntotalSpec * mix(0.4, 1.0, luminance));\n}\n#else // NOT USE_ENVMAP\nvec3 addSpecular(vec3 baseColor, in vec3 lightIntensity, in float opacity) {\nreturn baseColor * lightIntensity;\n}\n#endif\n#ifdef USE_HIGHLIGTH\nuniform vec3 highlight;\nuniform float highlightMix;\n#endif\n#if defined(HDR_OUTPUT)\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\n#ifdef USE_CHROMA_KEY\nuniform vec3 chromaKeyColor;\nuniform vec3 chromaKeyDeltaCoeff;\nconst float k32 = sqrt(3.0) / 2.0;\nvec3 rgb2abi(vec3 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\nreturn vec3(\nr - 0.5 * g - 0.5 * b,\nk32 * (g - b),\n0.3333 * (r + g + b));\n}\nconst float IPI2 = 0.5 / 3.1415926538;\nvec3 rgb2hci(vec3 color) {\nvec3 abi = rgb2abi(color);\nreturn vec3(\natan(abi.y, abi.x) * IPI2,\nlength(abi.xy),\nabi.z);\n}\nfloat chromaKeyShapeFn(vec3 delta, vec3 color, vec3 key) {\nvec3 diff = color - key;\nvec3 v = delta * vec3(\n0.5 - abs(abs(diff.x) - 0.5),\nabs(diff.y),\nabs(diff.z));\nfloat x = max(v.r, max(v.g, v.b));\nreturn x * x;\n}\nfloat chromaKeyEdgeFn(float a) {\nreturn clamp(.2/.5 * (a - 1.0), 0.0, 1.0);\n}\n#endif\nuniform float emissionStrength;\nuniform float exposure;\nuniform float cameraGamma;\nvoid main() {\nfloat alpha;\nvec3 baseColor = getBaseColor(alpha);\n#ifdef USE_CHROMA_KEY\nfloat dist = chromaKeyShapeFn(chromaKeyDeltaCoeff, rgb2hci(baseColor), rgb2hci(chromaKeyColor));\nalpha *= chromaKeyEdgeFn(dist);\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nif (alpha < alphaDiscardThreshold) {\ndiscard;\n}\n#endif\nvec3 lightIntensity = getLightIntensity();\n#ifdef USE_HIGHLIGTH\nbaseColor = mix(baseColor, highlight, highlightMix);\nalpha = mix(alpha, 1.0, highlightMix);\n#endif\nvec3 diffuseSpecular = addSpecularHook(baseColor, lightIntensity, alpha);\n#ifdef USE_HEADLIGHT\nvec3 lightW = normalize(cameraPosition - vPositionW.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormalW), lightW), 0.0);\ndiffuseSpecular *= pointDiffuse;\n#endif\nvec3 diffuseSpecularEmissive = diffuseSpecular + baseColor * emissionStrength;\n#ifdef HDR_OUTPUT\nif (alpha < 0.5) {\ndiscard;\n}\nfragColor = hdrEncode(diffuseSpecularEmissive);\n#else // no HDR_OUTPUT\nvec3 exposedColor = pow(exposure * diffuseSpecularEmissive.xyz,\nvec3(cameraGamma));\nvec3 gammaColor =  linearToGammaUnreal(exposedColor);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, min(gammaColor, 1.0)), alpha);\n#else\nfragColor = vec4(gammaColor, alpha);\n#endif\n#endif // no HDR_OUTPUT\n}\n";
WALK.SHADERS["standard_material_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\nuniform vec4 uvMod;\n#endif\n#ifdef USE_LIGHTMAP\nwebgl2centroid varOut vec2 vUv2;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarOut vec3 vPositionV;\nvarOut vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\nvarOut vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvUv = uv * uvMod.zw + uvMod.xy;\n#endif\nvec4 transformedPosition = transformPosition();\nvec4 mvPosition = modelViewMatrix * transformedPosition;\n#ifdef USE_LIGHTMAP\nfloat zeroOrOne = min(uv2.x + uv2.y, 1.0);\nvUv2 = uv2 * uv2Mod.zw + uv2Mod.xy * zeroOrOne;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\nvPositionW = (modelMatrix * transformedPosition).xyz;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["static_render_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform sampler2D staticRender;\nuniform vec2 sizeInv;\nvoid main() {\nvec3 colorLinear = texture2D(staticRender, gl_FragCoord.xy * sizeInv).rgb;\nfragColor = vec4(linearToGammaUnreal(colorLinear), 1.0);\n}\n";
WALK.SHADERS["static_render_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["water.glsl"]="//AUTO GENERATED\n#ifdef USE_NORMAL_TEXTURE\nuniform float time;\nuniform float wavesScale;\nuniform float refractionFactor;\nuniform sampler2D normalTexture;\nvec4 getNoise(in vec2 uv) {\nvec2 uv0 = (uv / 103.0) + vec2(time / 17.0, time / 29.0);\nvec2 uv1 = uv / 107.0 - vec2(time / -19.0, time / 31.0);\nvec2 uv2 = uv / vec2(897.0, 983.0) + vec2(time / 101.0, time / 97.0);\nvec2 uv3 = uv / vec2(991.0, 877.0) - vec2(time / 109.0, time / -113.0);\nvec4 noise = texture2D(normalTexture, uv0) +\ntexture2D(normalTexture, uv1) +\ntexture2D(normalTexture, uv2) +\ntexture2D(normalTexture, uv3);\nreturn noise * 0.5 - 1.0;\n}\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 toEyeW = cameraPosition - vPositionW;\nvec3 viewW = normalize(toEyeW);\nvec4 noise = getNoise(vPositionW.xy * wavesScale);\nvec3 normalW = normalize(noise.xyz);\nfloat clampCosnv = saturate(dot(normalW, viewW));\nRoughness roughness;\nroughness.envMipLevel0 = 0.0;\nroughness.envMipLevel1 = 0.0;\nroughness.envMipMixFactor = 0.0;\nroughness.envFresnel = 1.0;\nconst float waterF0 = 0.02;\nvec3 specularColor = vec3(waterF0);\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 refractionW = refract(-viewW, normalW, 0.75);\nvec3 reflectedEnv = getEnvColor(envMap, roughness, normalize(reflectionW));\nvec3 refractedEnv = refractionFactor *\ngetEnvColor(envMap, roughness, normalize(refractionW));\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\nvec3 totalSpec = reflectedEnv * fresnel + refractedEnv * (1.0 - fresnel);\nvec3 diffuseIntensity = totalIntensity * 0.98;\nfloat luminance = getLuminance(totalIntensity);\nreturn totalSpec * mix(0.4, 1.0, luminance) + baseColor * diffuseIntensity;\n}\n#else // NOT USE_NORMAL_TEXTURE\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nreturn baseColor * totalIntensity;\n}\n#endif\n";
WALK.SHADERS["wireframe_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 lineColor;\nuniform float lineMaxAlpha;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vBaryCentric;\nfloat edgeFactor(){\nvec3 d = fwidth(vBaryCentric);\nvec3 r = smoothstep(vec3(0.0), d * 1.5, vBaryCentric);\nreturn min(min(r.x, r.y), r.z);\n}\nvoid main(void){\nfloat edge = edgeFactor();\nif (edge < 1.0) {\nfragColor = vec4(lineColor, (1.0 - edge) * lineMaxAlpha);\n} else {\nfragColor = vec4(highlight, highlightMix);\n}\n}\n";
WALK.SHADERS["wireframe_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nattr float order;\nvarOut vec3 vBaryCentric;\nvoid main() {\nif (order == 0.0) {\nvBaryCentric = vec3(1.0, 0.0, 0.0);\n} else if (order == 1.0) {\nvBaryCentric = vec3(0.0, 1.0, 0.0);\n} else {\nvBaryCentric = vec3(0.0, 0.0, 1.0);\n}\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";(function(){WALK.Shader=function(b,c){this.id=b;this.code=c};var a=0;WALK.InlineShader=function(b){WALK.Shader.call(this,"inline:"+a,b);a+=1};WALK.getShader=function(b){return new WALK.Shader(b,WALK.SHADERS[b])}})();(function(){var a=0,b=[0,0],c=Object.freeze({uv:b,uv2:b,uv2Mod:[0,0,1/65535,1/65535],t0:[1,0,0,0],t1:[0,1,0,0],t2:[0,0,1,0]}),d=Object.freeze("position sphericalNormal uv uv2 uv2Mod t0 t1 t2".split(" ")),e=new WALK.InlineShader("");WALK.BaseMaterial=function(f,g,h){h=void 0===h?e:h;a+=1;Object.defineProperty(this,"id",{value:a});this.name="";this.side=THREE.FrontSide;this.doNotOverrideSide=!1;this.opacity=1;this.transparent=!1;this.transparentRenderOrder=0;this.blending=THREE.NoBlending;this.blendSrc=
GLC.SRC_ALPHA;this.blendDst=GLC.ONE_MINUS_SRC_ALPHA;this.blendEquation=GLC.FUNC_ADD;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.colorWrite=this.depthWrite=this.depthTest=!0;this._hideFromLightProbes=!1;this._defines=new Set;this._definesString=null;this._textureLodExtension=this._standardDerivativesExtension=!1;this.uniforms={};this.attributes=d;this._vertexShaderBody=f;this._fragmentShaderBody=g;this._fragmentShaderHooks=h;this.defaultAttributeValues=c;this.index0AttributeName=
void 0;this._programNeedsUpdate=this.visible=!0;this.program=null};WALK.BaseMaterial.prototype={constructor:WALK.BaseMaterial,get isAnimated(){return!1},get isPlaying(){return!1},update:function(f){},rewind:function(){console.assert(!1)},play:function(){console.assert(!1)},pause:function(){console.assert(!1)},get hideFromLightProbes(){return this._hideFromLightProbes},set hideFromLightProbes(f){this._hideFromLightProbes=f},get programNeedsUpdate(){return this._programNeedsUpdate},set programNeedsUpdate(f){this._definesString=
null;this._programNeedsUpdate=f},hasDefine:function(f){return this._defines.has(f)},addDefine:function(f){this.hasDefine(f)||(this._defines.add(f),this.programNeedsUpdate=!0)},removeDefine:function(f){this.hasDefine(f)&&(this._defines.delete(f),this.programNeedsUpdate=!0)},condDefine:function(f,g){f?this.addDefine(g):this.removeDefine(g);return f},_getDefinesString:function(){if(null===this._definesString){for(var f=[],g=$jscomp.makeIterator(this._defines),h=g.next();!h.done;h=g.next())f.push("#define "+
h.value);f.sort();this._definesString=f.join("\n")}return this._definesString},generateProgramId:function(){return[this._fragmentShaderBody.id,this._fragmentShaderHooks.id,this._getDefinesString(),this._vertexShaderBody.id,this._standardDerivativesExtension?"+":"",this._textureLodExtension?"+":""].join("$")},enableStandardDerivativesExtension:function(){WALK.DETECTOR.gl.webgl2||this._standardDerivativesExtension||(this.programNeedsUpdate=this._standardDerivativesExtension=!0)},enableTextureLodExtension:function(){WALK.DETECTOR.gl.webgl2||
this._textureLodExtension||(this.programNeedsUpdate=this._textureLodExtension=!0)},_getShaderHeader:function(){return WALK.DETECTOR.gl.webgl2?"#version 300 es\n#define texture2D texture\n#define textureCube texture\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define attr in\n#define varOut out\n#define varIn in\n#define webgl2centroid centroid\n":"\n#define attr attribute\n#define varOut varying\n#define varIn varying\n#define webgl2centroid\n"},generateVertexShader:function(){return[this._getShaderHeader(),
"precision highp float;\nprecision highp int;",this._getDefinesString(),"uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattr vec3 position;\nattr vec2 sphericalNormal;\nattr vec2 uv;\nattr vec2 uv2;\nattr vec4 uv2Mod;\nattr vec4 t0;\nattr vec4 t1;\nattr vec4 t2;",this._vertexShaderBody.code].join("\n")},generateFragmentShader:function(){return[this._getShaderHeader(),this._standardDerivativesExtension?
"#extension GL_OES_standard_derivatives : enable":"",this._textureLodExtension?"#extension GL_EXT_shader_texture_lod : require":"","precision "+WALK.DETECTOR.gl.fragmentPrecision+" float;","precision "+WALK.DETECTOR.gl.fragmentPrecision+" int;",this._getDefinesString(),"uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;",WALK.DETECTOR.gl.webgl2?"out vec4 fragColor;":"#define fragColor gl_FragColor",this._fragmentShaderBody.code,this._fragmentShaderHooks.code].join("\n")},dispose:function(){this.dispatchEvent({type:"dispose"})},
setUniform:function(f,g,h){this.uniforms[f]={type:g,value:h}},propertyFromUniform:function(f){Object.defineProperty(this,f,{get:function(){return this.uniforms[f].value},set:function(g){this.uniforms[f].value=g}})},hash:function(){console.assert(!1,"hash not implemented")},canMerge:function(f){console.assert(!1,"canMerge not implemented")}};THREE.EventDispatcher.prototype.apply(WALK.BaseMaterial.prototype)})();(function(){WALK.CompressedTextureLoader=function(){this._parser=null};WALK.CompressedTextureLoader.prototype={constructor:WALK.CompressedTextureLoader,load:function(a,b,c,d){var e=this,f=[],g=new WALK.CompressedTexture;g.image=f;WALK.queueAjaxGet(a,b,!0,function(h){h=e._parser(h,!0);if(h.isCubemap)for(var k=h.mipmaps.length/h.mipmapCount,q=0;q<k;q+=1){f[q]={mipmaps:[]};for(var p=0;p<h.mipmapCount;p+=1)f[q].mipmaps.push(h.mipmaps[q*h.mipmapCount+p]),f[q].format=h.format,f[q].width=h.width,f[q].height=
h.height}else g.image.width=h.width,g.image.height=h.height,g.mipmaps=h.mipmaps;1===h.mipmapCount&&(g.minFilter=GLC.LINEAR);g.format=h.format;g.width=h.width;g.height=h.height;c&&c(g)},d);return g}}})();THREE.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:new WALK.InlineShader("void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),fragmentShader:new WALK.InlineShader("uniform sampler2D tDiffuse;\nuniform vec2 resolution;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec4 rgbA = (1.0/2.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));\nvec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));\nfloat lumaB = dot(rgbB, vec4(luma, 0.0));\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\nfragColor = rgbA;\n} else {\nfragColor = rgbB;\n}\n}")};THREE.EffectComposer=function(a){this.renderer=a;this.renderTarget2=this.renderTarget1=null;this.passes=[]};
THREE.EffectComposer.prototype={addPass:function(a){this.passes.push(a)},disposeTarget:function(){this.renderTarget1&&(this.renderTarget1.dispose(),this.renderTarget1=null);this.renderTarget2&&(this.renderTarget2.dispose(),this.renderTarget2=null)},configureTarget:function(a,b,c){this.disposeTarget();this.renderTarget1=this.renderer.createRenderTarget(a,b,c);this.renderTarget2=this.renderer.createRenderTarget(a,b,c)},render:function(){var a,b;return function(c){a=this.renderTarget1;b=this.renderTarget2;
var d,e=this.passes.length;for(d=0;d<e;d++){var f=this.passes[d];f.enabled&&(f.render(this.renderer,a,b,c),f.needsSwap&&d!=e-1&&(f=b,b=a,a=f))}}}()};THREE.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse";this.material=new WALK.BaseMaterial(a.vertexShader,a.fragmentShader);this.material.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.uniforms=this.material.uniforms;this.renderToScreen=!1;this.needsSwap=this.enabled=!0;this.clear=!1;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material);this.scene.add(this.quad)};
THREE.ShaderPass.prototype={render:function(a,b,c,d){if(d=this.material.uniforms[this.textureID])d.value=c;this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},dispose:function(){this.material.dispose();this.quad.geometry.dispose()}};THREE.RenderPass=function(a,b,c){this.scene=a;this.camera=b;this.overrideMaterial=c;this.needsSwap=this.clear=this.enabled=!0};THREE.RenderPass.prototype={render:function(a,b,c,d){c=this.scene.overrideMaterial;this.overrideMaterial&&(this.scene.overrideMaterial=this.overrideMaterial);a.render(this.scene,this.camera,b,this.clear);this.scene.overrideMaterial=c}};(function(a){function b(f){return!isNaN(f)&&isFinite(f)}function c(f,g){for(var h=0,k=f.length;h<k;h++)if(f[h]===g)return h;return-1}a.Octree=function(f){f=f||{};this.nodeCount=0;this.INDEX_INSIDE_CROSS=-1;this.INDEX_OUTSIDE_OFFSET=2;this.INDEX_OUTSIDE_POS_X=b(f.INDEX_OUTSIDE_POS_X)?f.INDEX_OUTSIDE_POS_X:0;this.INDEX_OUTSIDE_NEG_X=b(f.INDEX_OUTSIDE_NEG_X)?f.INDEX_OUTSIDE_NEG_X:1;this.INDEX_OUTSIDE_POS_Y=b(f.INDEX_OUTSIDE_POS_Y)?f.INDEX_OUTSIDE_POS_Y:2;this.INDEX_OUTSIDE_NEG_Y=b(f.INDEX_OUTSIDE_NEG_Y)?
f.INDEX_OUTSIDE_NEG_Y:3;this.INDEX_OUTSIDE_POS_Z=b(f.INDEX_OUTSIDE_POS_Z)?f.INDEX_OUTSIDE_POS_Z:4;this.INDEX_OUTSIDE_NEG_Z=b(f.INDEX_OUTSIDE_NEG_Z)?f.INDEX_OUTSIDE_NEG_Z:5;this.INDEX_OUTSIDE_MAP=[];this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0};
this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1};this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1;this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1;this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1;this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1;this.FLAG_POS_Z=
1<<this.INDEX_OUTSIDE_POS_Z+1;this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1;this.utilVec31Search=new a.Vector3;this.utilVec32Search=new a.Vector3;if(this.scene=f.scene)this.visualGeometry=new a.BoxBufferGeometry(1,1,1),this.visualGeometry.addTriangleOrderAttribute(),this.visualMaterial=new WALK.WireframeMaterial(new a.Color(65280));this.depthMax=b(f.depthMax)?f.depthMax:Infinity;this.objectsThreshold=b(f.objectsThreshold)?f.objectsThreshold:8;this.overlapPct=b(f.overlapPct)?f.overlapPct:.15;this.root=
new a.OctreeNode({tree:this,parent:null,position:new a.Vector3})};a.Octree.prototype={add:function(f,g,h){g||(g=f.geometry.boundingSphere.center,h=f.geometry.boundingSphere.radius);0!==h&&this.root.addObject(new a.OctreeObjectData(f,g,h))},search:function(f,g,h){var k,q=[];this.root.appendObjectsFromNode(q);0<g||(g=Number.MAX_VALUE);if(h instanceof a.Vector3){h=this.utilVec31Search.copy(h).normalize();var p=this.utilVec32Search.set(1,1,1).divide(h)}var r=0;for(k=this.root.nodesIndices.length;r<k;r++){var n=
this.root.nodesByIndex[this.root.nodesIndices[r]];n.search(f,g,h,p,q)}return q},setRoot:function(f){f instanceof a.OctreeNode&&(this.root=f,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};a.OctreeObjectData=function(f,g,h){this.object=f;this.radius=h;this.position=g};var d=new a.Vector3,
e=new a.Vector3;new a.Vector3;a.OctreeNode=function(f){this.tree=f.tree;this.id=this.tree.nodeCount++;this.position=f.position;this.radius=0<f.radius?f.radius:1;this.indexOctant=f.indexOctant;this.depth=0;this.reset();this.setParent(f.parent);this.overlap=this.radius*this.tree.overlapPct;this.radiusOverlap=this.radius+this.overlap;this.left=this.position.x-this.radiusOverlap;this.right=this.position.x+this.radiusOverlap;this.bottom=this.position.y-this.radiusOverlap;this.top=this.position.y+this.radiusOverlap;
this.back=this.position.z-this.radiusOverlap;this.front=this.position.z+this.radiusOverlap;this.tree.scene&&(this.visual=new a.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual),this.tree.scene.updateMatrixWorld())};a.OctreeNode.prototype={setParent:function(f){f!==this&&this.parent!==f&&(this.parent=f,this.updateProperties())},updateProperties:function(){var f;
this.parent instanceof a.OctreeNode?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0;var g=0;for(f=this.nodesIndices.length;g<f;g++)this.nodesByIndex[this.nodesIndices[g]].updateProperties()},reset:function(f,g){var h,k=this.nodesIndices||[],q=this.nodesByIndex;this.objects=[];this.nodesIndices=[];this.nodesByIndex={};var p=0;for(h=k.length;p<h;p++){var r=q[k[p]];r.setParent(void 0);!0===f&&r.reset(f,g)}!0===g&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},
addNode:function(f,g){f.indexOctant=g;-1===c(this.nodesIndices,g)&&this.nodesIndices.push(g);this.nodesByIndex[g]=f;f.parent!==this&&f.setParent(this)},removeNode:function(f){var g=c(this.nodesIndices,f);this.nodesIndices.splice(g,1);var h=h||this.nodesByIndex[f];delete this.nodesByIndex[f];h.parent===this&&h.setParent(void 0)},addObject:function(f){var g=this.getOctantIndex(f);-1<g&&0<this.nodesIndices.length?(g=this.branch(g),g.addObject(f)):-1>g&&this.parent instanceof a.OctreeNode?this.parent.addObject(f):
(g=c(this.objects,f),-1===g&&this.objects.push(f),f.node=this,this.checkGrow())},addObjectWithoutCheck:function(f){var g;var h=0;for(g=f.length;h<g;h++){var k=f[h];this.objects.push(k);k.node=this}},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&0<this.tree.objectsThreshold&&this.grow()},grow:function(){var f=[],g=[],h=[],k=[],q=[],p;var r=0;for(p=this.objects.length;r<p;r++){var n=this.objects[r];var m=this.getOctantIndex(n);-1<m?(h.push(n),k.push(m)):-1>m?(f.push(n),g.push(m)):
q.push(n)}0<h.length&&(q=q.concat(this.split(h,k)));0<f.length&&(q=q.concat(this.expand(f,g)));this.objects=q;this.checkMerge()},split:function(f,g){var h;if(this.depth<this.tree.depthMax){f=f||this.objects;g=g||[];var k=[];var q=0;for(h=f.length;q<h;q++){var p=f[q];var r=g[q];-1<r?(r=this.branch(r),r.addObject(p)):k.push(p)}f===this.objects&&(this.objects=k)}else k=this.objects;return k},branch:function(f){if(this.nodesByIndex[f]instanceof a.OctreeNode)var g=this.nodesByIndex[f];else{g=.5*this.radiusOverlap;
var h=g*this.tree.overlapPct;h=g-h;h=d.set(f&1?h:-h,f&2?h:-h,f&4?h:-h);h=(new a.Vector3).addVectors(this.position,h);g=new a.OctreeNode({tree:this.tree,parent:this,position:h,radius:g,indexOctant:f});this.addNode(g,f)}return g},expand:function(f,g){var h,k=this.tree.INDEX_OUTSIDE_MAP;if(this.tree.root.getDepthEnd()<this.tree.depthMax){f=f||this.objects;g=g||[];var q=[];var p=[];var r=0;for(h=k.length;r<h;r++)k[r].count=0;r=0;for(h=f.length;r<h;r++){var n=f[r];var m=g[r];-1>m?(m=-m-this.tree.INDEX_OUTSIDE_OFFSET,
m&this.tree.FLAG_POS_X?k[this.tree.INDEX_OUTSIDE_POS_X].count++:m&this.tree.FLAG_NEG_X&&k[this.tree.INDEX_OUTSIDE_NEG_X].count++,m&this.tree.FLAG_POS_Y?k[this.tree.INDEX_OUTSIDE_POS_Y].count++:m&this.tree.FLAG_NEG_Y&&k[this.tree.INDEX_OUTSIDE_NEG_Y].count++,m&this.tree.FLAG_POS_Z?k[this.tree.INDEX_OUTSIDE_POS_Z].count++:m&this.tree.FLAG_NEG_Z&&k[this.tree.INDEX_OUTSIDE_NEG_Z].count++,p.push(n)):q.push(n)}if(0<p.length){var l=k.slice(0);l.sort(function(t,B){return B.count-t.count});m=l[0];r=m.index|
1;n=l[1];k=l[2];g=(n.index|1)!==r?n:k;h=g.index|1;n=l[2];k=l[3];l=l[4];var u=n.index|1;var v=k.index|1;n=u!==r&&u!==h?n:v!==r&&v!==h?k:l;r=m.x+g.x+n.x;h=m.y+g.y+n.y;g=m.z+g.z+n.z;m=this.getOctantIndexFromPosition(r,h,g);g=this.getOctantIndexFromPosition(-r,-h,-g);h=this.overlap;n=this.radius;r=0<this.tree.overlapPct?h/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*n;k=r*this.tree.overlapPct;h=r+k-(n+h);e.set(m&1?h:-h,m&2?h:-h,m&4?h:-h);m=(new a.Vector3).addVectors(this.position,e);m=new a.OctreeNode({tree:this.tree,
position:m,radius:r});m.addNode(this,g);this.tree.setRoot(m);r=0;for(h=p.length;r<h;r++)this.tree.root.addObject(p[r])}f===this.objects&&(this.objects=q)}else q=f;return q},shrink:function(){this.checkMerge();this.tree.root.checkContract()},checkMerge:function(){for(var f=this,g;f.parent instanceof a.OctreeNode&&f.getObjectCountEnd()<this.tree.objectsThreshold;)g=f,f=f.parent;f!==this&&f.merge(g)},merge:function(f){var g;f=f?"[object Array]"===Object.prototype.toString.call(f)!==!0?[f]:f:[];var h=
0;for(g=f.length;h<g;h++){var k=f[h];this.addObjectWithoutCheck(k.getObjectsEnd());k.reset(!0,!0);this.removeNode(k.indexOctant,k)}this.checkMerge()},checkContract:function(){var f;if(0<this.nodesIndices.length){var g=0;var h=this.objects.length;var k=0;for(f=this.nodesIndices.length;k<f;k++){var q=this.nodesByIndex[this.nodesIndices[k]];var p=q.getObjectCountEnd();h+=p;if(!1===r instanceof a.OctreeNode||p>g){var r=q;g=p}}h-g<this.tree.objectsThreshold&&r instanceof a.OctreeNode&&this.contract(r)}},
contract:function(f){var g;var h=0;for(g=this.nodesIndices.length;h<g;h++){var k=this.nodesByIndex[this.nodesIndices[h]];k!==f&&(f.addObjectWithoutCheck(k.getObjectsEnd()),k.reset(!0,!0))}f.addObjectWithoutCheck(this.objects);this.reset(!1,!0);this.tree.setRoot(f);f.checkContract()},getOctantIndex:function(f){var g=this.position,h=this.radiusOverlap,k=this.overlap,q=0;if(f instanceof a.OctreeObjectData){var p=f.radius;var r=f.position}else f instanceof a.OctreeNode&&(r=f.position,p=0);var n=r.x-g.x;
var m=r.y-g.y;r=r.z-g.z;g=Math.abs(n);var l=Math.abs(m);var u=Math.abs(r);if(Math.max(g,l,u)+p>h)return g+p>h&&(q^=0<n?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),l+p>h&&(q^=0<m?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),u+p>h&&(q^=0<r?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),f.indexOctant=-q-this.tree.INDEX_OUTSIDE_OFFSET,f.indexOctant;if(n-p>-k)q|=1;else if(!(n+p<k))return f.indexOctant=this.tree.INDEX_INSIDE_CROSS,f.indexOctant;if(m-p>-k)q|=2;else if(!(m+p<k))return f.indexOctant=this.tree.INDEX_INSIDE_CROSS,
f.indexOctant;if(r-p>-k)q|=4;else if(!(r+p<k))return f.indexOctant=this.tree.INDEX_INSIDE_CROSS,f.indexOctant;f.indexOctant=q;return f.indexOctant},getOctantIndexFromPosition:function(f,g,h){var k=0;0<f&&(k|=1);0<g&&(k|=2);0<h&&(k|=4);return k},appendObjectsFromNode:function(f){var g,h=this.objects;var k=0;for(g=h.length;k<g;k+=1)f.push(h[k].object)},search:function(f,g,h,k,q){var p;if(!0===this.intersectRay(f,h,g,k)){this.appendObjectsFromNode(q);var r=0;for(p=this.nodesIndices.length;r<p;r++){var n=
this.nodesByIndex[this.nodesIndices[r]];n.search(f,g,h,k,q)}}},intersectRay:function(f,g,h,k){g=(this.left-f.x)*k.x;var q=(this.right-f.x)*k.x,p=(this.bottom-f.y)*k.y,r=(this.top-f.y)*k.y,n=(this.back-f.z)*k.z;k=(this.front-f.z)*k.z;f=Math.min(Math.min(Math.max(g,q),Math.max(p,r)),Math.max(n,k));if(0>f)return!1;g=Math.max(Math.max(Math.min(g,q),Math.min(p,r)),Math.min(n,k));return g>f||g>h?!1:!0},getDepthEnd:function(f){var g;if(0<this.nodesIndices.length){var h=0;for(g=this.nodesIndices.length;h<
g;h++){var k=this.nodesByIndex[this.nodesIndices[h]];f=k.getDepthEnd(f)}}else f=!f||this.depth>f?this.depth:f;return f},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var f,g=this.nodesIndices.length;var h=0;for(f=this.nodesIndices.length;h<f;h++)g+=this.nodesByIndex[this.nodesIndices[h]].getNodeCountRecursive();return g},getObjectsEnd:function(f){var g;f=(f||[]).concat(this.objects);var h=0;for(g=this.nodesIndices.length;h<g;h++){var k=
this.nodesByIndex[this.nodesIndices[h]];f=k.getObjectsEnd(f)}return f},getObjectCountEnd:function(){var f,g=this.objects.length;var h=0;for(f=this.nodesIndices.length;h<f;h++)g+=this.nodesByIndex[this.nodesIndices[h]].getObjectCountEnd();return g},getObjectCountStart:function(){for(var f=this.objects.length,g=this.parent;g instanceof a.OctreeNode;)f+=g.objects.length,g=g.parent;return f},toConsole:function(f){var g;f="string"===typeof f?f:"   ";console.log(this.parent?f+" octree NODE > ":" octree ROOT > ",
this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth);console.log(this.parent?f+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects);console.log(this.parent?f+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex);var h=0;for(g=this.nodesIndices.length;h<g;h++){var k=this.nodesByIndex[this.nodesIndices[h]];k.toConsole(f+"   ")}}}})(THREE);THREE.PolyhedronBufferGeometry=function(a,b,c,d){function e(q){h.push(q.x,q.y,q.z)}function f(q,p){q*=3;p.x=a[q+0];p.y=a[q+1];p.z=a[q+2]}function g(q,p,r,n){0>n&&1===q.x&&(k[p]=q.x-1);0===r.x&&0===r.z&&(k[p]=n/2/Math.PI+.5)}THREE.BufferGeometry.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;var h=[],k=[];(function(q){for(var p=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Vector3,m=0;m<b.length;m+=3){f(b[m+0],p);f(b[m+1],
r);f(b[m+2],n);var l,u,v=p,t=r,B=n,D=Math.pow(2,q),I=[];for(u=0;u<=D;u++){I[u]=[];var J=v.clone().lerp(B,u/D),Q=t.clone().lerp(B,u/D),T=D-u;for(l=0;l<=T;l++)I[u][l]=0===l&&u===D?J:J.clone().lerp(Q,l/T)}for(u=0;u<D;u++)for(l=0;l<2*(D-u)-1;l++)v=Math.floor(l/2),0===l%2?(e(I[u][v+1]),e(I[u+1][v]),e(I[u][v])):(e(I[u][v+1]),e(I[u+1][v+1]),e(I[u+1][v]))}})(d);(function(q){for(var p=new THREE.Vector3,r=0;r<h.length;r+=3)p.x=h[r+0],p.y=h[r+1],p.z=h[r+2],p.normalize().multiplyScalar(q),h[r+0]=p.x,h[r+1]=p.y,
h[r+2]=p.z})(c);(function(){for(var q=new THREE.Vector3,p=0;p<h.length;p+=3)q.x=h[p+0],q.y=h[p+1],q.z=h[p+2],k.push(Math.atan2(q.z,-q.x)/2/Math.PI+.5,1-(Math.atan2(-q.y,Math.sqrt(q.x*q.x+q.z*q.z))/Math.PI+.5));q=new THREE.Vector3;p=new THREE.Vector3;for(var r=new THREE.Vector3,n=new THREE.Vector3,m=new THREE.Vector2,l=new THREE.Vector2,u=new THREE.Vector2,v=0,t=0;v<h.length;v+=9,t+=6){q.set(h[v+0],h[v+1],h[v+2]);p.set(h[v+3],h[v+4],h[v+5]);r.set(h[v+6],h[v+7],h[v+8]);m.set(k[t+0],k[t+1]);l.set(k[t+
2],k[t+3]);u.set(k[t+4],k[t+5]);n.copy(q).add(p).add(r).divideScalar(3);var B=Math.atan2(n.z,-n.x);g(m,t+0,q,B);g(l,t+2,p,B);g(u,t+4,r,B)}for(q=0;q<k.length;q+=6)p=k[q+0],r=k[q+2],n=k[q+4],m=Math.min(p,r,n),.9<Math.max(p,r,n)&&.1>m&&(.2>p&&(k[q+0]+=1),.2>r&&(k[q+2]+=1),.2>n&&(k[q+4]+=1))})();this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(h),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(h.slice()),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(k),
2));0===d?this.computeVertexNormals():this.normalizeNormals()};THREE.PolyhedronBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PolyhedronBufferGeometry.prototype.constructor=THREE.PolyhedronBufferGeometry;THREE.IcosahedronBufferGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronBufferGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}};THREE.IcosahedronBufferGeometry.prototype=Object.create(THREE.PolyhedronBufferGeometry.prototype);
THREE.IcosahedronBufferGeometry.prototype.constructor=THREE.IcosahedronBufferGeometry;(function(){function a(z){return 0>z?-k(-z,1/3):k(z,1/3)}var b=Math,c=b.abs,d=b.cos,e=b.sin,f=b.acos,g=b.atan2,h=b.sqrt,k=b.pow;b=Math.PI;var q=2*b,p=b/2,r=Number.MAX_SAFE_INTEGER||9007199254740991,n=Number.MIN_SAFE_INTEGER||-9007199254740991,m={x:0,y:0,z:0},l={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,
.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,
.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(z,A){z=A(z);A=z.x*z.x+z.y*z.y;"undefined"!==typeof z.z&&(A+=z.z*z.z);return h(A)},compute:function(z,A,y){if(0===z)return A[0].t=0,A[0];var E=A.length-1;if(1===z)return A[E].t=1,A[E];var K=1-z,H=A;if(0===E)return A[0].t=z,A[0];if(1===E){var G={x:K*H[0].x+z*H[1].x,y:K*H[0].y+z*H[1].y,t:z};y&&(G.z=K*H[0].z+z*H[1].z);return G}if(4>E){var O=
K*K,Y=z*z;A=0;if(2===E){H=[H[0],H[1],H[2],m];G=O;var W=K*z*2;var ka=Y}else 3===E&&(G=O*K,W=O*z*3,ka=K*Y*3,A=z*Y);z={x:G*H[0].x+W*H[1].x+ka*H[2].x+A*H[3].x,y:G*H[0].y+W*H[1].y+ka*H[2].y+A*H[3].y,t:z};y&&(z.z=G*H[0].z+W*H[1].z+ka*H[2].z+A*H[3].z);return z}for(y=JSON.parse(JSON.stringify(A));1<y.length;){for(H=0;H<y.length-1;H++)y[H]={x:y[H].x+(y[H+1].x-y[H].x)*z,y:y[H].y+(y[H+1].y-y[H].y)*z},"undefined"!==typeof y[H].z&&(y[H]=y[H].z+(y[H+1].z-y[H].z)*z);y.splice(y.length-1,1)}y[0].t=z;return y[0]},
computeWithRatios:function(z,A,y,E){var K=1-z,H=y[0],G=y[1],O=y[2];y=y[3];H*=K;G*=z;if(2===A.length)return K=H+G,{x:(H*A[0].x+G*A[1].x)/K,y:(H*A[0].y+G*A[1].y)/K,z:E?(H*A[0].z+G*A[1].z)/K:!1,t:z};H*=K;G*=2*K;O*=z*z;if(3===A.length)return K=H+G+O,{x:(H*A[0].x+G*A[1].x+O*A[2].x)/K,y:(H*A[0].y+G*A[1].y+O*A[2].y)/K,z:E?(H*A[0].z+G*A[1].z+O*A[2].z)/K:!1,t:z};H*=K;G*=1.5*K;O*=3*K;y*=z*z*z;if(4===A.length)return K=H+G+O+y,{x:(H*A[0].x+G*A[1].x+O*A[2].x+y*A[3].x)/K,y:(H*A[0].y+G*A[1].y+O*A[2].y+y*A[3].y)/
K,z:E?(H*A[0].z+G*A[1].z+O*A[2].z+y*A[3].z)/K:!1,t:z}},derive:function(z,A){for(var y=[],E=z.length,K=E-1;1<E;E--,K--){for(var H=[],G=0,O;G<K;G++)O={x:K*(z[G+1].x-z[G].x),y:K*(z[G+1].y-z[G].y)},A&&(O.z=K*(z[G+1].z-z[G].z)),H.push(O);y.push(H);z=H}return y},between:function(z,A,y){return A<=z&&z<=y||l.approximately(z,A)||l.approximately(z,y)},approximately:function(z,A,y){return c(z-A)<=(y||1E-6)},length:function(z){for(var A=l.Tvalues.length,y=0,E=0,K;E<A;E++)K=.5*l.Tvalues[E]+.5,y+=l.Cvalues[E]*
l.arcfn(K,z);return.5*y},map:function(z,A,y,E,K){return E+(z-A)/(y-A)*(K-E)},lerp:function(z,A,y){var E={x:A.x+z*(y.x-A.x),y:A.y+z*(y.y-A.y)};void 0!==A.z&&void 0!==y.z&&(E.z=A.z+z*(y.z-A.z));return E},pointToString:function(z){var A=z.x+"/"+z.y;"undefined"!==typeof z.z&&(A+="/"+z.z);return A},pointsToString:function(z){return"["+z.map(l.pointToString).join(", ")+"]"},copy:function(z){return JSON.parse(JSON.stringify(z))},angle:function(z,A,y){var E=A.x-z.x;A=A.y-z.y;var K=y.x-z.x;z=y.y-z.y;return g(E*
z-A*K,E*K+A*z)},round:function(z,A){z=""+z;var y=z.indexOf(".");return parseFloat(z.substring(0,y+1+A))},dist:function(z,A){var y=z.x-A.x;z=z.y-A.y;return h(y*y+z*z)},closest:function(z,A){var y=k(2,63),E,K;z.forEach(function(H,G){K=l.dist(A,H);K<y&&(y=K,E=G)});return{mdist:y,mpos:E}},abcratio:function(z,A){if(2!==A&&3!==A)return!1;if("undefined"===typeof z)z=.5;else if(0===z||1===z)return z;z=k(z,A)+k(1-z,A);return c((z-1)/z)},projectionratio:function(z,A){if(2!==A&&3!==A)return!1;if("undefined"===
typeof z)z=.5;else if(0===z||1===z)return z;var y=k(1-z,A);z=k(z,A)+y;return y/z},lli8:function(z,A,y,E,K,H,G,O){var Y=(z-y)*(H-O)-(A-E)*(K-G);return 0==Y?!1:{x:((z*E-A*y)*(K-G)-(z-y)*(K*O-H*G))/Y,y:((z*E-A*y)*(H-O)-(A-E)*(K*O-H*G))/Y}},lli4:function(z,A,y,E){return l.lli8(z.x,z.y,A.x,A.y,y.x,y.y,E.x,E.y)},lli:function(z,A){return l.lli4(z,z.c,A,A.c)},makeline:function(z,A){return new M(z.x,z.y,(z.x+A.x)/2,(z.y+A.y)/2,A.x,A.y)},findbbox:function(z){var A=r,y=r,E=n,K=n;z.forEach(function(H){H=H.bbox();
A>H.x.min&&(A=H.x.min);y>H.y.min&&(y=H.y.min);E<H.x.max&&(E=H.x.max);K<H.y.max&&(K=H.y.max)});return{x:{min:A,mid:(A+E)/2,max:E,size:E-A},y:{min:y,mid:(y+K)/2,max:K,size:K-y}}},shapeintersections:function(z,A,y,E,K){if(!l.bboxoverlap(A,E))return[];var H=[],G=[y.startcap,y.forward,y.back,y.endcap];[z.startcap,z.forward,z.back,z.endcap].forEach(function(O){O.virtual||G.forEach(function(Y){if(!Y.virtual){var W=O.intersects(Y,K);0<W.length&&(W.c1=O,W.c2=Y,W.s1=z,W.s2=y,H.push(W))}})});return H},makeshape:function(z,
A,y){var E=z.points.length,K=l.makeline(A.points[A.points.length-1],z.points[0]);E=l.makeline(z.points[E-1],A.points[0]);var H={startcap:K,forward:z,back:A,endcap:E,bbox:l.findbbox([K,z,A,E]),intersections:function(G){return l.shapeintersections(H,H.bbox,G,G.bbox,y)}};return H},getminmax:function(z,A,y){if(!y)return{min:0,max:0};var E=r,K=n;-1===y.indexOf(0)&&(y=[0].concat(y));-1===y.indexOf(1)&&y.push(1);for(var H=0,G=y.length;H<G;H++){var O=y[H];O=z.get(O);O[A]<E&&(E=O[A]);O[A]>K&&(K=O[A])}return{min:E,
mid:(E+K)/2,max:K,size:K-E}},align:function(z,A){var y=A.p1.x,E=A.p1.y,K=-g(A.p2.y-E,A.p2.x-y);return z.map(function(H){return{x:(H.x-y)*d(K)-(H.y-E)*e(K),y:(H.x-y)*e(K)+(H.y-E)*d(K)}})},roots:function(z,A){A=A||{p1:{x:0,y:0},p2:{x:1,y:0}};var y=z.length-1;A=l.align(z,A);z=function(O){return 0<=O&&1>=O};if(2===y){y=A[0].y;var E=A[1].y,K=A[2].y;A=y-2*E+K;return 0!==A?(K=-h(E*E-y*K),y=-y+E,[-(K+y)/A,-(-K+y)/A].filter(z)):E!==K&&0===A?[(2*E-K)/(2*E-2*K)].filter(z):[]}y=A[0].y;E=A[1].y;var H=A[2].y;K=
-y+3*E-3*H+A[3].y;A=3*y-6*E+3*H;H=-3*y+3*E;if(l.approximately(K,0)){if(l.approximately(A,0))return l.approximately(H,0)?[]:[-y/H].filter(z);y=h(H*H-4*A*y);A*=2;return[(y-H)/A,(-H-y)/A].filter(z)}A/=K;H/=K;E=(3*H-A*A)/3;var G=E/3;y=(2*A*A*A-9*A*H+y/K*27)/27;K=y/2;H=K*K+G*G*G;if(0>H)return E=-E/3,E=h(E*E*E),y=-y/(2*E),K=f(-1>y?-1:1<y?1:y),H=2*a(E),y=H*d(K/3)-A/3,E=H*d((K+q)/3)-A/3,A=H*d((K+2*q)/3)-A/3,[y,E,A].filter(z);if(0===H)return y=0>K?a(-K):-a(K),[2*y-A/3,-y-A/3].filter(z);E=h(H);y=a(-K+E);E=
a(K+E);return[y-E-A/3].filter(z)},droots:function(z){if(3===z.length){var A=z[0],y=z[1],E=z[2];z=A-2*y+E;return 0!==z?(E=-h(y*y-A*E),A=-A+y,[-(E+A)/z,-(-E+A)/z]):y!==E&&0===z?[(2*y-E)/(2*(y-E))]:[]}return 2===z.length&&(A=z[0],y=z[1],A!==y)?[A/(A-y)]:[]},curvature:function(z,A,y,E,K){var H=l.compute(z,A);var G=l.compute(z,y);var O=H.x*H.x+H.y*H.y;E?(G=h(k(H.y*G.z-G.y*H.z,2)+k(H.z*G.x-G.z*H.x,2)+k(H.x*G.y-G.x*H.y,2)),O=k(O+H.z*H.z,1.5)):(G=H.x*G.y-H.y*G.x,O=k(O,1.5));if(0===G||0===O)return{k:0,r:0};
H=G/O;G=O/G;if(!K){K=l.curvature(z-.001,A,y,E,!0).k;z=l.curvature(z+.001,A,y,E,!0).k;var Y=(z-H+(H-K))/2;var W=(c(z-H)+c(H-K))/2}return{k:H,r:G,dk:Y,adk:W}},inflections:function(z){if(4>z.length)return[];z=l.align(z,{p1:z[0],p2:z.slice(-1)[0]});var A=z[2].x*z[1].y,y=z[3].x*z[1].y,E=z[1].x*z[2].y;z=18*(-3*A+2*y+3*E-z[3].x*z[2].y);y=18*(3*A-y-3*E);A=18*(E-A);if(l.approximately(z,0))return!l.approximately(y,0)&&(z=-A/y,0<=z&&1>=z)?[z]:[];A=Math.sqrt(y*y-4*z*A);z*=2;return l.approximately(z,0)?[]:[(A-
y)/z,-(y+A)/z].filter(function(K){return 0<=K&&1>=K})},bboxoverlap:function(z,A){for(var y=["x","y"],E=y.length,K=0,H,G,O;K<E;K++)if(H=y[K],G=z[H].mid,O=A[H].mid,H=(z[H].size+A[H].size)/2,c(G-O)>=H)return!1;return!0},expandbox:function(z,A){A.x.min<z.x.min&&(z.x.min=A.x.min);A.y.min<z.y.min&&(z.y.min=A.y.min);A.z&&A.z.min<z.z.min&&(z.z.min=A.z.min);A.x.max>z.x.max&&(z.x.max=A.x.max);A.y.max>z.y.max&&(z.y.max=A.y.max);A.z&&A.z.max>z.z.max&&(z.z.max=A.z.max);z.x.mid=(z.x.min+z.x.max)/2;z.y.mid=(z.y.min+
z.y.max)/2;z.z&&(z.z.mid=(z.z.min+z.z.max)/2);z.x.size=z.x.max-z.x.min;z.y.size=z.y.max-z.y.min;z.z&&(z.z.size=z.z.max-z.z.min)},pairiteration:function(z,A,y){var E=z.bbox(),K=A.bbox(),H=y||.5;if(E.x.size+E.y.size<H&&K.x.size+K.y.size<H)return[(1E5*(z._t1+z._t2)/2|0)/1E5+"/"+(1E5*(A._t1+A._t2)/2|0)/1E5];z=z.split(.5);A=A.split(.5);A=[{left:z.left,right:A.left},{left:z.left,right:A.right},{left:z.right,right:A.right},{left:z.right,right:A.left}];A=A.filter(function(O){return l.bboxoverlap(O.left.bbox(),
O.right.bbox())});var G=[];if(0===A.length)return G;A.forEach(function(O){G=G.concat(l.pairiteration(O.left,O.right,H))});return G=G.filter(function(O,Y){return G.indexOf(O)===Y})},getccenter:function(z,A,y){var E=A.x-z.x,K=A.y-z.y,H=y.x-A.x,G=y.y-A.y,O=E*d(p)-K*e(p);E=E*e(p)+K*d(p);K=H*d(p)-G*e(p);H=H*e(p)+G*d(p);G=(z.x+A.x)/2;var Y=(z.y+A.y)/2,W=(A.x+y.x)/2,ka=(A.y+y.y)/2;O=l.lli8(G,Y,G+O,Y+E,W,ka,W+K,ka+H);E=l.dist(O,z);z=g(z.y-O.y,z.x-O.x);A=g(A.y-O.y,A.x-O.x);y=g(y.y-O.y,y.x-O.x);if(z<y){if(z>
A||A>y)z+=q;z>y&&(A=y,y=z,z=A)}else y<A&&A<z?(A=y,y=z,z=A):y+=q;O.s=z;O.e=y;O.r=E;return O},numberSort:function(z,A){return z-A}},u=function(z){this.curves=[];this._3d=!1;z&&(this.curves=z,this._3d=this.curves[0]._3d)};u.prototype.valueOf=function(){return this.toString()};u.prototype.toString=function(){return"["+this.curves.map(function(z){return l.pointsToString(z.points)}).join(", ")+"]"};u.prototype.addCurve=function(z){this.curves.push(z);this._3d=this._3d||z._3d};u.prototype.length=function(){return this.curves.map(function(z){return z.length()}).reduce(function(z,
A){return z+A})};u.prototype.curve=function(z){return this.curves[z]};u.prototype.bbox=function(){for(var z=this.curves,A=z[0].bbox(),y=1;y<z.length;y++)l.expandbox(A,z[y].bbox());return A};u.prototype.offset=function(z){var A=[];this.curves.forEach(function(y){A.push.apply(A,$jscomp.arrayFromIterable(y.offset(z)))});return new u(A)};b=Math;var v=b.abs,t=b.min,B=b.max,D=b.cos,I=b.sin,J=b.acos,Q=b.sqrt,T=Math.PI,M=function(z){var A=z&&z.forEach?z:Array.from(arguments).slice(),y=!1;if("object"===typeof A[0]){y=
A.length;var E=[];A.forEach(function(W){["x","y","z"].forEach(function(ka){"undefined"!==typeof W[ka]&&E.push(W[ka])})});A=E}var K=!1,H=A.length;if(y){if(4<y){if(1!==arguments.length)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");K=!0}}else if(6!==H&&8!==H&&9!==H&&12!==H&&1!==arguments.length)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");K=this._3d=!K&&(9===H||12===H)||z&&z[0]&&"undefined"!==typeof z[0].z;y=this.points=[];
for(var G=0,O=K?3:2;G<H;G+=O){var Y={x:A[G],y:A[G+1]};K&&(Y.z=A[G+2]);y.push(Y)}A=this.order=y.length-1;H=this.dims=["x","y"];K&&H.push("z");this.dimlen=H.length;H=l.align(y,{p1:y[0],p2:y[A]});y=l.dist(y[0],y[A]);this._linear=H.reduce(function(W,ka){return W+v(ka.y)},0)<y/50;this._lut=[];this._t1=0;this._t2=1;this.update()};M.quadraticFromPoints=function(z,A,y,E){"undefined"===typeof E&&(E=.5);if(0===E)return new M(A,A,y);if(1===E)return new M(z,A,A);A=M.getABC(2,z,A,y,E);return new M(z,A.A,y)};M.cubicFromPoints=
function(z,A,y,E,K){"undefined"===typeof E&&(E=.5);var H=M.getABC(3,z,A,y,E);"undefined"===typeof K&&(K=l.dist(A,H.C));var G=K*(1-E)/E,O=l.dist(z,y),Y=(y.x-z.x)/O;O=(y.y-z.y)/O;H=H.A;return new M(z,{x:z.x+(H.x+(A.x-K*Y-H.x)/(1-E)-z.x)/E,y:z.y+(H.y+(A.y-K*O-H.y)/(1-E)-z.y)/E},{x:y.x+(H.x+(A.x+G*Y-H.x)/E-y.x)/(1-E),y:y.y+(H.y+(A.y+G*O-H.y)/E-y.y)/(1-E)},y)};M.getUtils=function(){return l};M.prototype.getUtils=function(){return M.getUtils()};M.prototype.valueOf=function(){return this.toString()};M.prototype.toString=
function(){return l.pointsToString(this.points)};M.prototype.toSVG=function(){if(this._3d)return!1;for(var z=this.points,A=["M",z[0].x,z[0].y,2===this.order?"Q":"C"],y=1,E=z.length;y<E;y++)A.push(z[y].x),A.push(z[y].y);return A.join(" ")};M.prototype.setRatios=function(z){if(z.length!==this.points.length)throw Error("incorrect number of ratio values");this.ratios=z;this._lut=[]};M.prototype.verify=function(){var z=this.coordDigest();z!==this._print&&(this._print=z,this.update())};M.prototype.coordDigest=
function(){return this.points.map(function(z,A){return""+A+z.x+z.y+(z.z?z.z:0)}).join("")};M.prototype.update=function(){this._lut=[];this.dpoints=l.derive(this.points,this._3d);this.computedirection()};M.prototype.computedirection=function(){var z=this.points;this.clockwise=0<l.angle(z[0],z[this.order],z[1])};M.prototype.length=function(){return l.length(this.derivative.bind(this))};M.getABC=function(z,A,y,E,K){z=void 0===z?2:z;K=void 0===K?.5:K;var H=l.projectionratio(K,z),G=1-H;H={x:H*A.x+G*E.x,
y:H*A.y+G*E.y};z=l.abcratio(K,z);return{A:{x:y.x+(y.x-H.x)/z,y:y.y+(y.y-H.y)/z},B:y,C:H,S:A,E:E}};M.prototype.getABC=function(z,A){A=A||this.get(z);return M.getABC(this.order,this.points[0],A,this.points[this.order],z)};M.prototype.getLUT=function(z){this.verify();z=z||100;if(this._lut.length===z)return this._lut;z++;this._lut=[];for(var A=0,y,E;A<z;A++)E=A/(z-1),y=this.compute(E),y.t=E,this._lut.push(y);return this._lut};M.prototype.on=function(z,A){A=A||5;for(var y=this.getLUT(),E=[],K=0,H;K<y.length;K++)H=
y[K],l.dist(H,z)<A&&E.push(H);return E.length?NaN/E.length:!1};M.prototype.project=function(z){var A=this.getLUT(),y=A.length-1,E=l.closest(A,z),K=E.mpos;A=(K+1)/y;var H=.1/y;E=E.mdist;K=y=(K-1)/y;for(E+=1;y<A+H;y+=H){var G=this.compute(y);G=l.dist(z,G);G<E&&(E=G,K=y)}K=0>K?0:1<K?1:K;G=this.compute(K);G.t=K;G.d=E;return G};M.prototype.get=function(z){return this.compute(z)};M.prototype.point=function(z){return this.points[z]};M.prototype.compute=function(z){return this.ratios?l.computeWithRatios(z,
this.points,this.ratios,this._3d):l.compute(z,this.points,this._3d,this.ratios)};M.prototype.raise=function(){for(var z=this.points,A=[z[0]],y=z.length,E=1,K,H;E<y;E++)K=z[E],H=z[E-1],A[E]={x:(y-E)/y*K.x+E/y*H.x,y:(y-E)/y*K.y+E/y*H.y};A[y]=z[y-1];return new M(A)};M.prototype.derivative=function(z){return l.compute(z,this.dpoints[0],this._3d)};M.prototype.dderivative=function(z){return l.compute(z,this.dpoints[1],this._3d)};M.prototype.align=function(){var z=this.points;return new M(l.align(z,{p1:z[0],
p2:z[z.length-1]}))};M.prototype.curvature=function(z){return l.curvature(z,this.dpoints[0],this.dpoints[1],this._3d)};M.prototype.inflections=function(){return l.inflections(this.points)};M.prototype.normal=function(z){return this._3d?this.__normal3(z):this.__normal2(z)};M.prototype.__normal2=function(z){z=this.derivative(z);var A=Q(z.x*z.x+z.y*z.y);return{x:-z.y/A,y:z.x/A}};M.prototype.__normal3=function(z){var A=this.derivative(z);z=this.derivative(z+.01);var y=Q(A.x*A.x+A.y*A.y+A.z*A.z),E=Q(z.x*
z.x+z.y*z.y+z.z*z.z);A.x/=y;A.y/=y;A.z/=y;z.x/=E;z.y/=E;z.z/=E;y=z.y*A.z-z.z*A.y;E=z.z*A.x-z.x*A.z;z=z.x*A.y-z.y*A.x;var K=Q(y*y+E*E+z*z);y/=K;E/=K;z/=K;z=[y*y,y*E-z,y*z+E,y*E+z,E*E,E*z-y,y*z-E,E*z+y,z*z];return{x:z[0]*A.x+z[1]*A.y+z[2]*A.z,y:z[3]*A.x+z[4]*A.y+z[5]*A.z,z:z[6]*A.x+z[7]*A.y+z[8]*A.z}};M.prototype.hull=function(z){var A=this.points,y=[],E=0;y[E++]=A[0];y[E++]=A[1];y[E++]=A[2];for(3===this.order&&(y[E++]=A[3]);1<A.length;){var K=[];for(var H=0,G,O=A.length-1;H<O;H++)G=l.lerp(z,A[H],A[H+
1]),y[E++]=G,K.push(G);A=K}return y};M.prototype.split=function(z,A){if(0===z&&A)return this.split(A).left;if(1===A)return this.split(z).right;var y=this.hull(z);y={left:2===this.order?new M([y[0],y[3],y[5]]):new M([y[0],y[4],y[7],y[9]]),right:2===this.order?new M([y[5],y[4],y[2]]):new M([y[9],y[8],y[6],y[3]]),span:y};y.left._t1=l.map(0,0,1,this._t1,this._t2);y.left._t2=l.map(z,0,1,this._t1,this._t2);y.right._t1=l.map(z,0,1,this._t1,this._t2);y.right._t2=l.map(1,0,1,this._t1,this._t2);if(!A)return y;
A=l.map(A,z,1,0,1);return y.right.split(A).left};M.prototype.extrema=function(){var z={},A=[];this.dims.forEach(function(y){var E=function(H){return H[y]},K=this.dpoints[0].map(E);z[y]=l.droots(K);3===this.order&&(K=this.dpoints[1].map(E),z[y]=z[y].concat(l.droots(K)));z[y]=z[y].filter(function(H){return 0<=H&&1>=H});A=A.concat(z[y].sort(l.numberSort))}.bind(this));z.values=A.sort(l.numberSort).filter(function(y,E){return A.indexOf(y)===E});return z};M.prototype.bbox=function(){var z=this.extrema(),
A={};this.dims.forEach(function(y){A[y]=l.getminmax(this,y,z[y])}.bind(this));return A};M.prototype.overlaps=function(z){var A=this.bbox();z=z.bbox();return l.bboxoverlap(A,z)};M.prototype.offset=function(z,A){if("undefined"!==typeof A){var y=this.get(z),E=this.normal(z),K={c:y,n:E,x:y.x+E.x*A,y:y.y+E.y*A};this._3d&&(K.z=y.z+E.z*A);return K}if(this._linear){var H=this.normal(0);A=this.points.map(function(G){var O={x:G.x+z*H.x,y:G.y+z*H.y};G.z&&H.z&&(O.z=G.z+z*H.z);return O});return[new M(A)]}return this.reduce().map(function(G){return G._linear?
G.offset(z)[0]:G.scale(z)})};M.prototype.simple=function(){if(3===this.order){var z=l.angle(this.points[0],this.points[3],this.points[1]),A=l.angle(this.points[0],this.points[3],this.points[2]);if(0<z&&0>A||0>z&&0<A)return!1}z=this.normal(0);A=this.normal(1);var y=z.x*A.x+z.y*A.y;this._3d&&(y+=z.z*A.z);return v(J(y))<T/3};M.prototype.reduce=function(){var z,A=0,y=0,E=[],K=[],H=this.extrema().values;-1===H.indexOf(0)&&(H=[0].concat(H));-1===H.indexOf(1)&&H.push(1);A=H[0];for(z=1;z<H.length;z++){y=
H[z];var G=this.split(A,y);G._t1=A;G._t2=y;E.push(G);A=y}E.forEach(function(O){for(y=A=0;1>=y;)for(y=A+.01;1.01>=y;y+=.01)if(G=O.split(A,y),!G.simple()){y-=.01;if(.01>v(A-y))return[];G=O.split(A,y);G._t1=l.map(A,0,1,O._t1,O._t2);G._t2=l.map(y,0,1,O._t1,O._t2);K.push(G);A=y;break}1>A&&(G=O.split(A,1),G._t1=l.map(A,0,1,O._t1,O._t2),G._t2=O._t2,K.push(G))});return K};M.prototype.translate=function(z,A,y){y="number"===typeof y?y:A;var E=this.order,K=this.points.map(function(H,G){return(1-G/E)*A+G/E*y});
return new M(this.points.map(function(H,G){return{x:H.x+z.x*K[G],y:H.y+z.y*K[G]}}))};M.prototype.scale=function(z){var A=this,y=this.order,E=!1;"function"===typeof z&&(E=z);if(E&&2===y)return this.raise().scale(E);var K=this.clockwise,H=this.points;if(this._linear)return this.translate(this.normal(0),E?E(0):z,E?E(1):z);var G=E?E(0):z,O=E?E(1):z,Y=[this.offset(0,10),this.offset(1,10)],W=[],ka=l.lli4(Y[0],Y[0].c,Y[1],Y[1].c);if(!ka)throw Error("cannot scale this curve. Try reducing it first.");[0,1].forEach(function(la){var oa=
W[la*y]=l.copy(H[la*y]);oa.x+=(la?O:G)*Y[la].n.x;oa.y+=(la?O:G)*Y[la].n.y});if(!E)return[0,1].forEach(function(la){if(2!==y||!la){var oa=W[la*y],ra=A.derivative(la);W[la+1]=l.lli4(oa,{x:oa.x+ra.x,y:oa.y+ra.y},ka,H[la+1])}}),new M(W);[0,1].forEach(function(la){if(2!==y||!la){var oa=H[la+1],ra=oa.x-ka.x,Ba=oa.y-ka.y,ma=E?E((la+1)/y):z;E&&!K&&(ma=-ma);var Ga=Q(ra*ra+Ba*Ba);W[la+1]={x:oa.x+ra/Ga*ma,y:oa.y+Ba/Ga*ma}}});return new M(W)};M.prototype.outline=function(z,A,y,E){function K(S,R,Z,ca,na){return function(Aa){var Ca=
R-S;return l.map(Aa,0,1,S+ca/Z*Ca,S+(ca+na)/Z*Ca)}}A=void 0===A?z:A;if(this._linear){var H=this.normal(0),G=this.points[0],O=this.points[this.points.length-1];void 0===y&&(y=z,E=A);var Y={x:G.x+H.x*z,y:G.y+H.y*z};var W={x:O.x+H.x*y,y:O.y+H.y*y};var ka={x:(Y.x+W.x)/2,y:(Y.y+W.y)/2};var la=[Y,ka,W];Y={x:G.x-H.x*A,y:G.y-H.y*A};W={x:O.x-H.x*E,y:O.y-H.y*E};ka={x:(Y.x+W.x)/2,y:(Y.y+W.y)/2};H=[W,ka,Y];G=l.makeline(H[2],la[0]);O=l.makeline(la[2],H[0]);la=[G,new M(la),O,new M(H)];return new u(la)}H=this.reduce();
la=H.length;var oa=[],ra=[],Ba,ma=0,Ga=this.length(),aa="undefined"!==typeof y&&"undefined"!==typeof E;H.forEach(function(S){var R=S.length();aa?(oa.push(S.scale(K(z,y,Ga,ma,R))),ra.push(S.scale(K(-A,-E,Ga,ma,R)))):(oa.push(S.scale(z)),ra.push(S.scale(-A)));ma+=R});ra=ra.map(function(S){Ba=S.points;S.points=Ba[3]?[Ba[3],Ba[2],Ba[1],Ba[0]]:[Ba[2],Ba[1],Ba[0]];return S}).reverse();H=oa[la-1].points[oa[la-1].points.length-1];G=ra[0].points[0];la=l.makeline(ra[la-1].points[ra[la-1].points.length-1],oa[0].points[0]);
H=l.makeline(H,G);la=[la].concat(oa).concat([H]).concat(ra);return new u(la)};M.prototype.outlineshapes=function(z,A,y){z=this.outline(z,A||z).curves;A=[];for(var E=1,K=z.length;E<K/2;E++){var H=l.makeshape(z[E],z[K-E],y);H.startcap.virtual=1<E;H.endcap.virtual=E<K/2-1;A.push(H)}return A};M.prototype.intersects=function(z,A){if(!z)return this.selfintersects(A);if(z.p1&&z.p2)return this.lineIntersects(z);z instanceof M&&(z=z.reduce());return this.curveintersects(this.reduce(),z,A)};M.prototype.lineIntersects=
function(z){var A=this,y=t(z.p1.x,z.p2.x),E=t(z.p1.y,z.p2.y),K=B(z.p1.x,z.p2.x),H=B(z.p1.y,z.p2.y);return l.roots(this.points,z).filter(function(G){G=A.get(G);return l.between(G.x,y,K)&&l.between(G.y,E,H)})};M.prototype.selfintersects=function(z){for(var A=this.reduce(),y=A.length-2,E=[],K=0,H,G;K<y;K++)H=A.slice(K,K+1),G=A.slice(K+2),H=this.curveintersects(H,G,z),E.push.apply(E,$jscomp.arrayFromIterable(H));return E};M.prototype.curveintersects=function(z,A,y){var E=[];z.forEach(function(H){A.forEach(function(G){H.overlaps(G)&&
E.push({left:H,right:G})})});var K=[];E.forEach(function(H){H=l.pairiteration(H.left,H.right,y);0<H.length&&(K=K.concat(H))});return K};M.prototype.arcs=function(z){return this._iterate(z||.5,[])};M.prototype._error=function(z,A,y,E){var K=(E-y)/4;y=this.get(y+K);E=this.get(E-K);A=l.dist(z,A);y=l.dist(z,y);z=l.dist(z,E);return v(y-A)+v(z-A)};M.prototype._iterate=function(z,A){var y=0;do{var E=0;var K=1;var H=this.get(y);var G=void 0;var O=!1;var Y=1;do{var W=O;var ka=G;var la=(y+K)/2;G=this.get(la);
O=this.get(K);G=l.getccenter(H,G,O);G.interval={start:y,end:K};O=this._error(G,H,y,K)<=z;(W=W&&!O)||(Y=K);if(O){if(1<=K){G.interval.end=Y=1;ka=G;1<K&&(y={x:G.x+G.r*D(G.e),y:G.y+G.r*I(G.e)},G.e+=l.angle({x:G.x,y:G.y},y,this.get(1)));break}K+=(K-y)/2}else K=la}while(!W&&100>E++);if(100<=E)break;ka=ka?ka:G;A.push(ka);y=Y}while(1>K);return A};$jscomp.global.Object.defineProperties(M,{PolyBezier:{configurable:!0,enumerable:!0,get:function(){return u}}});window.Bezier=M})();(function(){WALK.ColorUtils={linearToGamma:function(a){return.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055},gammaToLinear:function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},hdrEncode:function(a,b){var c=Math.sqrt(a.r)/2.82842712,d=Math.sqrt(a.g)/2.82842712;a=Math.sqrt(a.b)/2.82842712;var e=Math.max(Math.max(c,d),a);e=THREE.Math.clamp(e,1/255,1);e=Math.ceil(255*e)/255;b.setRGB(c/e,d/e,a/e);return 1-e}};THREE.Color.prototype.copyGammaToLinear=void 0;THREE.Color.prototype.copyLinearToGamma=
void 0;THREE.Color.prototype.convertLinearToGamma=void 0;THREE.Color.prototype.convertGammaToLinear=function(){this.r=WALK.ColorUtils.gammaToLinear(this.r);this.g=WALK.ColorUtils.gammaToLinear(this.g);this.b=WALK.ColorUtils.gammaToLinear(this.b)};THREE.Color.prototype.roundChannels=function(){this.r=WALK.round(this.r,3);this.g=WALK.round(this.g,3);this.b=WALK.round(this.b,3);return this}})();/*
 Copyright (C) 2017-present Shapespark
*/
(function(){var a=new THREE.Vector3;WALK.Math={crossVectors2d:function(b,c){return b.x*c.y-b.y*c.x},toSnorm8:function(b){return Math.round(127*THREE.Math.clamp(b,-1,1))},minBytesToHold:function(b){return 127>=b?1:32767>=b?2:4},anyPositiveRootOfQuadraticEquation:function(b,c,d){d=c*c-4*b*d;if(0>d)return null;d=Math.sqrt(d);var e=(-c-d)/(2*b);if(0<e)return e;b=(-c+d)/(2*b);return 0<b?b:null},spheresUnion:function(b,c){if(c.empty())c.copy(b);else{var d=c.center.distanceTo(b.center);if(b.radius>c.radius){var e=
b;b=c}else e=c;var f=(e.radius+b.radius+d)/2;f<=e.radius?c.copy(e):(d=(f-e.radius)/d,console.assert(0<d),a.copy(b.center).sub(e.center).multiplyScalar(d),c.center.copy(e.center).add(a),c.radius=f)}}}})();(function(){WALK.Euler=function(a,b,c){THREE.Euler.call(this,b,c,a,"ZXY")};WALK.Euler.prototype=Object.create(THREE.Euler.prototype);WALK.Euler.prototype.constructor=WALK.Euler;Object.defineProperty(WALK.Euler.prototype,"yaw",{get:function(){return this.z},set:function(a){this.z=a}});Object.defineProperty(WALK.Euler.prototype,"pitch",{get:function(){return this.x},set:function(a){this.x=a}});Object.defineProperty(WALK.Euler.prototype,"roll",{get:function(){return this.y},set:function(a){this.y=a}});
Object.defineProperty(WALK.Euler.prototype,"yawDeg",{get:function(){return THREE.Math.radToDeg(this.yaw)},set:function(a){this.yaw=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"pitchDeg",{get:function(){return THREE.Math.radToDeg(this.pitch)},set:function(a){this.pitch=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"rollDeg",{get:function(){return THREE.Math.radToDeg(this.roll)},set:function(a){this.roll=THREE.Math.degToRad(a)}});WALK.Euler.prototype.setFromDegTriple=
function(a){var b=THREE.Math.degToRad(a[0]),c=THREE.Math.degToRad(a[1]);a=THREE.Math.degToRad(a[2]);this.set(c,a,b);return this};WALK.Euler.prototype.toDegTriple=function(){return[this.yawDeg,this.pitchDeg,this.rollDeg]};WALK.Euler.prototype.setFromDirection=function(a){this.set(Math.asin(a.z),0,Math.atan2(-a.x,a.y));return this};WALK.Euler.prototype.toQuaternion=function(){var a=new THREE.Quaternion;a.setFromEuler(this);return a};WALK.Euler.prototype.toRotationMatrix=function(){var a=new THREE.Matrix4;
a.makeRotationFromEuler(this);return a}})();(function(){var a=new THREE.Sphere;WALK.Frustum=function(){this.planes=[new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane]};WALK.Frustum.prototype={constructor:WALK.Frustum,setFromMatrix:function(b){var c=this.planes,d=b.elements;b=d[0];var e=d[1],f=d[2],g=d[3],h=d[4],k=d[5],q=d[6],p=d[7],r=d[8],n=d[9],m=d[10],l=d[11],u=d[12],v=d[13],t=d[14];d=d[15];c[0].setComponents(g-b,p-h,l-r,d-u).normalize();c[1].setComponents(g+b,p+h,l+r,d+u).normalize();c[2].setComponents(g+
e,p+k,l+n,d+v).normalize();c[3].setComponents(g-e,p-k,l-n,d-v).normalize();c[4].setComponents(g-f,p-q,l-m,d-t).normalize();c[5].setComponents(g+f,p+q,l+m,d+t).normalize();return this},intersectsObject:function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();b.matrixWorld?(a.copy(c.boundingSphere),a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return this.intersectsSphere(b)},nearPlaneDistanceToCenter:function(b){var c=b.geometry,d=this.planes[5];b.matrixWorld?(a.copy(c.boundingSphere),
a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return d.distanceToPoint(b.center)},intersectsSphere:function(b){var c=this.planes,d=b.center;b=-b.radius;for(var e=0;6>e;e+=1)if(c[e].distanceToPoint(d)<b)return!1;return!0},intersectsBox:function(){var b=new THREE.Vector3,c=new THREE.Vector3;return function(d){for(var e=this.planes,f=0;6>f;f+=1){var g=e[f];b.x=0<g.normal.x?d.min.x:d.max.x;c.x=0<g.normal.x?d.max.x:d.min.x;b.y=0<g.normal.y?d.min.y:d.max.y;c.y=0<g.normal.y?d.max.y:d.min.y;b.z=0<
g.normal.z?d.min.z:d.max.z;c.z=0<g.normal.z?d.max.z:d.min.z;var h=g.distanceToPoint(b);g=g.distanceToPoint(c);if(0>h&&0>g)return!1}return!0}}(),containsPoint:function(b){for(var c=this.planes,d=0;6>d;d+=1)if(0>c[d].distanceToPoint(b))return!1;return!0}}})();(function(){WALK.DETECTOR=new function(){function a(k){var q=document.createElement("a");q.href=k;return q.protocol+"//"+q.host}function b(k,q){k=k.toLowerCase();q=q.toLowerCase();return-1!==k.indexOf(q)}function c(k){return navigator&&navigator.userAgent?b(navigator.userAgent,k):!1}function d(k,q){console.assert(void 0===e[k]);e[k]=q;void 0!==e.webp&&(h.forEach(function(p){return p()}),h.length=0)}var e=this;this.https="https:"===window.location.protocol;this.localhost="localhost"===window.location.hostname||
"127.0.0.1"===window.location.hostname;this.canForceBrotliBuffers=!1;this.ipad=/iPad/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;this.mobile=/mobile|ip(hone|od)|android|silk/i.test(navigator.userAgent)||this.ipad||WALK.urlHashContains("mobile");this.ios=/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||this.ipad;this.android=/Android/.test(navigator.userAgent);this.facebookApp=/FBAN|FBAV/.test(navigator.userAgent);this.whatsApp=/WhatsApp/.test(navigator.userAgent);
this.inCrossOriginIframe=function(){var k=window.self!==window.top,q=a(document.referrer),p=a(window.location.href);return k&&q!==p}();this.firefox=c("firefox");this.opera=c("opera")||c("OPR/");var f;(f=c("msie"))||(f=navigator&&navigator.appVersion?b(navigator.appVersion,"trident/"):!1);this.ie=f;this.edge=c("edge/");this.safari=c("safari/")&&!(c("chrome/")||c("chromium/"));this.mac=c("macintosh")&&!this.ipad;this.BASIS_DECODE_WORKERS=this.safari||this.ios?0:Math.min(4,navigator.hardwareConcurrency||
4);this.gl=null;var g=function(k){function q(m){var l=r[m];if(void 0!==l)return l;switch(m){case "EXT_texture_filter_anisotropic":l=k.getExtension("EXT_texture_filter_anisotropic")||k.getExtension("MOZ_EXT_texture_filter_anisotropic")||k.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":l=k.getExtension("WEBGL_compressed_texture_s3tc")||k.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||k.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":l=
k.getExtension("WEBGL_compressed_texture_pvrtc")||k.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":l=k.getExtension("WEBGL_compressed_texture_etc1");break;default:l=k.getExtension(m)}return r[m]=l}function p(){var m=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return m?parseInt(m[2],10):!1}var r={};this.extension=q;this.webgl2="undefined"!==typeof WebGL2RenderingContext&&k instanceof WebGL2RenderingContext;this.antialiasNative=k.getContextAttributes().antialias&&
1<k.getParameter(k.SAMPLES);this.antialiasSamples=k.getParameter(k.SAMPLES);this.antialiasPostprocess=!e.mobile;this.floatTextures=this.webgl2||q("OES_texture_float");this.standardDerivatives=this.webgl2||q("OES_standard_derivatives");this.maxAnisotropy=function(){var m=q("EXT_texture_filter_anisotropic");return null!==m?k.getParameter(m.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}();this.indexUint=this.webgl2||q("OES_element_index_uint");this.instances=this.webgl2||q("ANGLE_instanced_arrays");this.fragmentPrecision=
void 0===k.getShaderPrecisionFormat||0<k.getShaderPrecisionFormat(k.FRAGMENT_SHADER,k.HIGH_FLOAT).precision?"highp":0<k.getShaderPrecisionFormat(k.FRAGMENT_SHADER,k.MEDIUM_FLOAT).precision?"mediump":"lowp";var n=4096>k.getParameter(k.MAX_TEXTURE_SIZE)?"Your graphics card does not have sufficient capabilities, texture sizes 4096x4096 need to be supported.":null;this.missingCapabilities=n;this.maxRenderBufferSize=k.getParameter(k.MAX_RENDERBUFFER_SIZE);this.dxtTextures=function(){try{if(WALK.urlHashContains("nodxt"))return!1;
for(var m=q("WEBGL_compressed_texture_s3tc"),l=k.getParameter(k.COMPRESSED_TEXTURE_FORMATS),u=!1,v=!1,t=0;t<l.length;t+=1)u=u||l[t]===m.COMPRESSED_RGB_S3TC_DXT1_EXT,v=v||l[t]===m.COMPRESSED_RGBA_S3TC_DXT5_EXT;return u&&v}catch(B){}return!1}();n=WALK.urlHashContains("nopvr")?!1:q("WEBGL_compressed_texture_pvrtc");this.pvrtcTextures=n;n=WALK.urlHashContains("noetc1")?!1:q("WEBGL_compressed_texture_etc1")&&e.mobile;this.etc1Textures=n;this.astcTextures=!1;this.textureLod=this.webgl2||q("EXT_shader_texture_lod")&&
(!e.firefox||!e.android);this.mirrorCubeMaps=!e.mobile||WALK.MOBILE_HI;this.disableTextureSlotReuse=e.mac||83===p();this.reportToConsole=function(){WALK.log("WebGL"+(this.webgl2?"2":"")+"; "+this.fragmentPrecision+" fragment precision.");this.dxtTextures||WALK.log("DXT textures not supported.");this.textureLod||WALK.log("Texture fetch level of detail not supported.");this.floatTextures||WALK.log("Float textures not supported.");this.antialiasNative?WALK.log("Native anti-aliasing supported with "+
this.antialiasSamples+" samples."):WALK.log("Native anti-aliasing not supported");this.disableTextureSlotReuse&&WALK.log("WebGL texture slot reuse disabled.");this.indexUint||WALK.log("Uint index not supported");this.instances||WALK.log("Instanced geometry not supported")}};this.resetGlDetector=function(k){this.gl=new g(k)};this.webp=void 0;var h=[];(function(){var k=new Image;k.onload=function(){d("webp",0<k.width&&0<k.height)};k.onerror=function(){d("webp",!1)};k.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="})();
this.onAsyncPropertiesDetected=function(k){void 0!==e.webp?k():h.push(k)}}})();(function(){WALK.Viewer=function(a,b,c){function d(){return null}function e(U){c.isMaterialEditable(U)||console.assert(!1,"Can't access material, call ViewerApi.setMaterialEditable('"+U+"') before the scene is loaded.")}function f(){for(var U=[],pa=$jscomp.makeIterator(G.materials),Da=pa.next();!Da.done;Da=pa.next())Da=Da.value,c.isMaterialEditable(Da.name)&&U.push(Da);return U}function g(){for(var U=[],pa=$jscomp.makeIterator(G.nodeConfigs),Da=pa.next();!Da.done;Da=pa.next())Da=Da.value,c.isNodeTypeEditable(Da.name)&&
U.push(Da.name);return U}function h(U){e(U);for(var pa=$jscomp.makeIterator(G.materials),Da=pa.next();!Da.done;Da=pa.next())if(Da=Da.value,Da.name===U)return Da;return null}function k(){qa.copy(O.cameraWorldPosition());return qa}function q(){fa.yaw=O.getYawAngle();fa.pitch=O.getPitchAngle();fa.roll=0;return fa}function p(){return G.boundingBox}function r(U){var pa=[];e(U);for(var Da=$jscomp.makeIterator(G.gpuMeshes),wa=Da.next();!wa.done;wa=Da.next())wa=wa.value,wa.material.name===U&&pa.push(wa);
return pa}function n(U){return(U=G.findNodeConfig(U))?U.nodes.slice(0):[]}function m(U,pa){pa.geometry.isUvs0Repeating&&U.ensureTexturesRepeatable&&U.ensureTexturesRepeatable();pa.material=U;ra.requestFrame()}function l(U,pa){console.warn("setMaterialForNode() is deprecated, use setMaterialForMesh() instead");m(U,pa)}function u(U,pa,Da){var wa;(wa="string"===typeof U?G.findViewByName(U):U)?(!0===pa?pa=0:!1===pa&&(pa=void 0),W.isRunning()&&(pa=0,W.stop()),Da?(Y.activateSky(wa),Y.updateHiddenMeshes(wa)):
Y.switchToView(wa,pa)):console.error("Unknown view: "+U)}function v(U){U=void 0===U?{}:U;var pa=U.isPanorama||!1,Da=U.width||(pa?4E3:window.innerWidth),wa=U.height||(pa?2E3:window.innerHeight);if(U.toDataUrl)return la.monoScreenToDataUrl(pa,Da,wa);la.monoScreenToLocalImage(pa,Da,wa)}function t(U){G.addAuxiliaryObject(U);U!==U.colliderMesh&&H.uploadNewBuffers(U.colliderMesh);ka.addDynamicObstacle(U.colliderMesh)}function B(U,pa){for(var Da=[],wa=1;wa<arguments.length;++wa)Da[wa-1]=arguments[wa];try{return U.apply(null,
$jscomp.arrayFromIterable(Da))}catch(Ha){console.error(Ha)}return!1}function D(U,pa){for(var Da=[],wa=1;wa<arguments.length;++wa)Da[wa-1]=arguments[wa];if(U){wa=$jscomp.makeIterator(U);for(var Ha=wa.next();!Ha.done;Ha=wa.next())B.apply(null,[Ha.value].concat($jscomp.arrayFromIterable(Da)))}}function I(){D(na.nextPageInteraction);na.nextPageInteraction.length=0}function J(U,pa){U=new WALK.Anchor(G,U);Aa.push(U);va&&t(U);na.anchorClicked[U.colliderMesh.id]=pa;S=!0;ra.requestFrame();return U}function Q(U){delete na.anchorClicked[U.colliderMesh.id];
va&&(G.removeAuxiliaryObject(U),ka.removeDynamicObstacle(U.colliderMesh));WALK.removeFromArray(U,Aa);U.dispose();ra.requestFrame()}function T(U,pa){U=new WALK.Avatar(G,U,pa);Ca.push(U);G.addAuxiliaryObject(U,!0);pa=$jscomp.makeIterator(U.colliders);for(var Da=pa.next();!Da.done;Da=pa.next())ka.addDynamicObstacle(Da.value);D(na.avatarListChanged);return U}function M(U){for(var pa=$jscomp.makeIterator(U.colliders),Da=pa.next();!Da.done;Da=pa.next())ka.removeDynamicObstacle(Da.value);G.removeAuxiliaryObject(U);
WALK.removeFromArray(U,Ca);U.dispose();D(na.avatarListChanged)}function z(U){return WALK.find(Ca,function(pa){return pa.uuid===U})}function A(){for(var U=$jscomp.makeIterator(G.getAnimatedMaterials()),pa=U.next();!pa.done;pa=U.next())pa.value.sleepAnimation()}function y(){for(var U=$jscomp.makeIterator(G.getAnimatedMaterials()),pa=U.next();!pa.done;pa=U.next())pa.value.wakeAnimation();ra.requestFrame()}function E(U,pa){return Ba.getExtension(U,pa)}function K(U,pa){var Da=U[pa];if(Da)return Da;Da=
[];return U[pa]=Da}var H,G=null,O,Y,W,ka,la,oa,ra,Ba,ma,Ga,aa,S=!1,R=!1,Z=null,ca=null,na={nextPageInteraction:[],viewerConfigLoaded:[],sceneReadyToDisplay:[],sceneLoadComplete:[],anchorClicked:{},materialPickerClicked:{},materialPickerClosed:null,nodeTypeClicked:{},anyNodeTypeClicked:[],materialClicked:{},nodeTypeHoverChanged:{},materialHoverChanged:{},viewSwitchStarted:[],viewSwitchDone:[],vrChange:[],beforeRender:[],anchorsVisibilityChanged:[],apiUserStateChanged:{},anyApiUserStateChanged:[],meetingJoined:[],
avatarListChanged:[]},Aa=[],Ca=[],qa=new THREE.Vector3,fa=new WALK.Euler;document.addEventListener("keydown",I);document.addEventListener("mousedown",I);WALK.DETECTOR.ios?document.addEventListener("touchstart",I):document.addEventListener("touchend",I);var va=!0;Object.defineProperty(this,"anchorsVisible",{get:function(){return va},set:function(U){U!==va&&((va=U)?Aa.forEach(function(pa){return t(pa)}):Aa.forEach(function(pa){G.removeAuxiliaryObject(pa);ka.removeDynamicObstacle(pa.colliderMesh)}),
this.requestFrame(),D(na.anchorsVisibilityChanged,va))}});var sa=function(){function U(Ka,gb,bb){Da.set(Ka.x,Ka.y,Xa.z).sub(Xa);Ka=Da.length();Ka>gb&&(Da.normalize().multiplyScalar(Ka-gb),bb.add(Da))}var pa=new THREE.Vector3,Da=new THREE.Vector3,wa=new THREE.Vector3,Ha=new WALK.View,Ia=new THREE.Sphere,Xa;return function(Ka){Xa=O.cameraWorldPosition();var gb=Ha.position;gb.copy(Xa);Ka instanceof WALK.LightInstance&&"sun"===Ka.light.type?(WALK.sunRotationToPosition(G,Ka.rotation,pa),Ka=pa):Ka instanceof
WALK.Node?(WALK.computeNodeBoundingSphere(Ka,Ia),Ka=Ia.center,U(Ka,1+Ia.radius,gb)):(Ka=Ka.position,U(Ka,1,gb));wa.copy(Ka).sub(gb).normalize();Ha.rotation.setFromDirection(wa);Y.switchToView(Ha)}}();this.openMaterialPicker=function(U,pa,Da,wa,Ha){console.assert(!Z,"Only one material picker can be opened");Z=new WALK.MaterialPicker(U,wa,Ha,G,O,oa,Ga);Z.meshes.forEach(function(Ia){G.addAuxiliaryObject(Ia);ka.addDynamicObstacle(Ia);na.materialPickerClicked[Ia.id]=pa});na.materialPickerClosed=Da};this.closeMaterialPicker=
function(){Z&&(Z.meshes.forEach(function(U){G.removeAuxiliaryObject(U);ka.removeDynamicObstacle(U);delete na.materialPickerClicked[U.id]}),Z.dispose(),Z=null,na.materialPickerClosed&&(na.materialPickerClosed(),na.materialPickerClosed=null))};window.addEventListener("resize",this.closeMaterialPicker.bind(this));this._vrChange=function(U){D(na.vrChange,U)};this._update=function(U){D(na.beforeRender,U)};this._clickListener=function(U,pa,Da){if(!S)return!1;if(Z){var wa=na.materialPickerClicked[U.id];
if(wa)return B(wa,U.material,Z.meshes.indexOf(U)),!0;this.closeMaterialPicker();return!0}if(wa=na.anchorClicked[U.id])return B(wa,U.anchor,pa,Da),!0;wa=function(Ia,Xa){if(Ia){Ia=$jscomp.makeIterator(Ia);for(var Ka=Ia.next();!Ka.done;Ka=Ia.next())if(B(Ka.value,Xa,pa,Da))return!0}return!1};for(var Ha=U.node;Ha;Ha=Ha.parent)if(wa(na.nodeTypeClicked[Ha.type],U.node))return!0;return U.node&&wa(na.anyNodeTypeClicked,U.node)?!0:U.material?wa(na.materialClicked[U.material.name],U.material):!1};this._createHoverListener=
function(){var U=na.nodeTypeHoverChanged,pa=na.materialHoverChanged,Da=[];return 0===Object.keys(U).length&&0===Object.keys(pa).length?null:function(wa,Ha){for(var Ia=wa.node;Ia;Ia=Ia.parent)for(var Xa=$jscomp.makeIterator(U[Ia.type]||Da),Ka=Xa.next();!Ka.done;Ka=Xa.next())if(B(Ka.value,Ia,Ha))return!0;if(wa.material)for(Ia=$jscomp.makeIterator(pa[wa.material.name]||Da),Ka=Ia.next();!Ka.done;Ka=Ia.next())if(B(Ka.value,wa.material,Ha))return!0;return!1}};this._teleportStarted=function(U){U=U.view;
null!==U&&D(na.viewSwitchStarted,U.name,U)};this._teleportDone=function(U){U=U.view;null!==U&&D(na.viewSwitchDone,U.name,U)};this._viewerConfigLoaded=function(U){ma=U;D(na.viewerConfigLoaded,ma);na.viewerConfigLoaded=[]};this._sceneReadyToDisplay=function(U,pa,Da,wa,Ha,Ia,Xa,Ka,gb,bb,eb,ib){H=U;G=pa;O=Da;Y=wa;W=Ha;ka=Ia;la=Xa;oa=Ka;Ga=gb;aa=bb;ra=eb;Ba=ib;this.getEditableMaterials=f;this.getEditableNodeTypes=g;this.findMaterial=h;this.findMeshesWithMaterial=r;this.findNodesOfType=n;this.getCameraPosition=
k;this.getCameraRotation=q;this.getSceneBoundingBox=p;this.setMaterialForNode=l;this.setMaterialForMesh=m;this.switchToView=u;this.captureImage=v;this.addAnchor=J;this.removeAnchor=Q;this.addAvatar=T;this.removeAvatar=M;this.findAvatar=z;this.seeItem=sa;this.sleepAnimatedMaterials=A;this.wakeAnimatedMaterials=y;this.getExtension=E;D(na.sceneReadyToDisplay,G);na.sceneReadyToDisplay=[];Y.addEventListener("teleportStarted",this._teleportStarted.bind(this));Y.addEventListener("teleportDone",this._teleportDone.bind(this))};
this._contextLost=function(){R=!1;ma=G=Y=W=ka=la=aa=ra=null;this.getExtension=this.wakeAnimatedMaterials=this.sleepAnimatedMaterials=this.findAvatar=this.removeAnchor=this.addAvatar=this.addAnchor=this.captureImage=this.switchToView=this.setMaterialForMesh=this.setMaterialForNode=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d};this._sceneLoadComplete=function(){D(na.sceneLoadComplete);na.sceneLoadComplete=[];R=!0;for(var U=
$jscomp.makeIterator(Aa),pa=U.next();!pa.done;pa=U.next())pa.value.enableLightProbe()};this.openUrl=function(U,pa){pa||a?window.open(U):window.location.href=U};this.onNextPageInteraction=function(U){na.nextPageInteraction.push(U)};this.onViewerConfigLoaded=function(U){ma?U(ma):na.viewerConfigLoaded.push(U)};this.isSceneReadyToDisplay=function(){return null!==G};this.onSceneReadyToDisplay=function(U){G?U(G):na.sceneReadyToDisplay.push(U)};this.onSceneLoadComplete=function(U){R?U(G):na.sceneLoadComplete.push(U)};
this.requestFrame=function(){ra&&ra.requestFrame()};this.setNodeTypeEditable=function(U){console.assert(null===G,"setNodeTypeEditable must be called before the scene is loaded");c.setNodeTypeEditable(U)};this.setMaterialEditable=function(U){console.assert(null===G,"setMaterialEditable must be called before the scene is loaded");c.setMaterialEditable(U)};this.setAllMaterialsEditable=function(){console.assert(null===G,"setAllMaterialsEditable must be called before the scene is loaded");c.setAllMaterialsEditable()};
this.onNodeTypeClicked=function(U,pa){"function"===typeof U?na.anyNodeTypeClicked.push(U):K(na.nodeTypeClicked,U).push(pa);S=!0};this.removeOnNodeTypeClicked=function(U,pa){"function"===typeof U?WALK.removeFromArray(U,na.anyNodeTypeClicked):WALK.removeFromArray(pa,na.nodeTypeClicked[U])};this.onMaterialClicked=function(U,pa){this.setMaterialEditable(U);K(na.materialClicked,U).push(pa);S=!0};this.onNodeTypeHoverChanged=function(U,pa){this.setNodeTypeEditable(U);K(na.nodeTypeHoverChanged,U).push(pa)};
this.onMaterialHoverChanged=function(U,pa){this.setMaterialEditable(U);K(na.materialHoverChanged,U).push(pa)};this.onViewSwitchStarted=function(U){na.viewSwitchStarted.push(U)};this.onViewSwitchDone=function(U){na.viewSwitchDone.push(U)};this.onVrChange=function(U){na.vrChange.push(U)};this.onBeforeRender=function(U){na.beforeRender.push(U)};this.createTextureFromHtmlImage=function(U,pa){function Da(){Ha.needsUpdate=!0;Ha.width=U.naturalWidth;Ha.height=U.naturalHeight;THREE.Math.isPowerOfTwo(Ha.width)&&
THREE.Math.isPowerOfTwo(Ha.height)||(Ha.minFilter=GLC.LINEAR);Ha.notifyLoaded()}function wa(){Da();Ia&&Ia();U.onload=Ia}pa=void 0===pa?!1:pa;var Ha=new WALK.Texture;Ha.image=U;Ha.wrapS=Ha.wrapT=GLC.REPEAT;Ha.minFilter=GLC.LINEAR_MIPMAP_LINEAR;Ha.anisotropy=WALK.DEFAULT_ANISOTROPY;Ha.format=pa?GLC.RGBA:GLC.RGB;Ha.hasAlpha=pa;var Ia=null;U.complete&&0!==U.naturalHeight?Da():(Ia=U.onload,U.onload=wa);return Ha};this.createTextureFromHtmlVideo=function(U){var pa=new WALK.VideoTexture;pa.video=U;pa.minFilter=
GLC.LINEAR;pa.anisotropy=WALK.DEFAULT_ANISOTROPY;pa.format=GLC.RGB;pa.generateMipmaps=!1;U.setAttribute("playsinline","");U.setAttribute("webkit-playsinline","");U.crossOrigin="anonymous";WALK.onVideoDataReady(U,function(Da){pa.width=Da.videoWidth;pa.height=Da.videoHeight;THREE.Math.isPowerOfTwo(pa.width)&&THREE.Math.isPowerOfTwo(pa.height)?(pa.wrapS=GLC.REPEAT,pa.wrapT=GLC.REPEAT):(pa.wrapS=GLC.CLAMP_TO_EDGE,pa.wrapT=GLC.CLAMP_TO_EDGE);pa.notifyLoaded()});return pa};this.createStreamTextureFromHtmlVideo=
function(U){U=this.createTextureFromHtmlVideo(U);U._interruptible=!1;return U};this.addAnchor=function(){console.assert(!1,"Can't add anchors until the scene is ready to display")};this.removeAnchor=function(){console.assert(!1,"Can't remove anchors until the scene is ready to display")};this.addAvatar=function(){console.assert(!1,"Can't add avatars until the scene is ready to display")};this.removeAvatar=function(){console.assert(!1,"Can't remove avatars until the scene is ready to display")};this.findAvatar=
function(){console.assert(!1,"Can't find avatars until the scene is ready to display")};this.sleepAnimatedMaterials=function(){console.assert(!1,"Can't sleep animated materials until the scene is ready to display")};this.wakeAnimatedMaterials=function(){console.assert(!1,"Can't wake animated materials until the scene is ready to display")};this.getExtension=function(){console.assert(!1,"Can't get extension until the scene is ready to display")};this.onAnchorsVisibilityChanged=function(U){na.anchorsVisibilityChanged.push(U)};
this.removeAnchorsVisibilityChangedListener=function(U){na.anchorsVisibilityChanged=na.anchorsVisibilityChanged.filter(function(pa){return pa!==U})};this.seeItem=this.captureImage=this.switchToView=this.setMaterialForNode=this.getSceneBoundingBox=this.getCameraRotation=this.getCameraPosition=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d;this.getViewerAssetUrl=function(U){return WALK.getViewerAssetUrl(U)};this.addMenuButton=
function(U){return b.addExtraButton(U)};this.removeMenuButton=function(U){b.removeExtraButton(U)};this.getMenuButtonIcon=function(U){return b.getExtraButonIcon(U)};Object.defineProperty(this,"menuVisible",{get:function(){return b.visible},set:function(U){b.visible=U}});this.onMenuVisibilityChanged=function(U){b.addEventListener("visibilityChanged",function(){U()})};Object.defineProperty(this,"helpVisible",{get:function(){return b.helpVisible},set:function(U){b.helpVisible=U}});this.play=function(){WALK.play()};
var Fa={};this.apiUserChangeState=function(U,pa){WALK.deepEqual(Fa[U],pa)||(Fa[U]=WALK.readOnlyCopy(pa),pa=WALK.cloneObject(pa),D(na.apiUserStateChanged[U],U,pa),D(na.anyApiUserStateChanged,U,pa))};this.onApiUserStateChanged=function(U,pa){"function"===typeof U?na.anyApiUserStateChanged.push(U):K(na.apiUserStateChanged,U).push(pa)};this.removeOnApiUserStateChanged=function(U,pa){"function"===typeof U?WALK.removeFromArray(U,na.anyApiUserStateChanged):WALK.removeFromArray(pa,na.apiUserStateChanged[U])};
this.getApiUserState=function(U){if(void 0===U)return WALK.cloneObject(Fa);U=Fa[U];return void 0===U?void 0:WALK.cloneObject(U)};this._meetingJoined=function(U){console.assert(null===ca);ca=U;D(na.meetingJoined,ca)};this._onMeetingJoined=function(U){na.meetingJoined.push(U);null!==ca&&U(ca)};this._removeOnMeetingJoined=function(U){WALK.removeFromArray(U,na.meetingJoined)};this._onAvatarListChanged=function(U){na.avatarListChanged.push(U)};this._removeOnAvatarListChanged=function(U){WALK.removeFromArray(U,
na.avatarListChanged)};this._createPointerEventHelper=function(U){return new WALK.PointerEventHelper(aa,U)};this._disableControls=function(){O.disable()};this._enableControls=function(){O.enable()};var Ta=new WALK.RayIntersection;this._findIntersectionAtPosition=function(U,pa){ka.findIntersectionAtPosition(U,pa,!0,Ta);return Ta};this.getWalkMaxSpeed=function(){console.assert(G,"getWalkMaxSpeed must be called after the scene is loaded");return G.camera.moveMaxSpeed};this.setWalkMaxSpeed=function(U){console.assert(G,
"setWalkMaxSpeed must be called after the scene is loaded");G.camera.moveMaxSpeed=U};this.openPopup=function(U,pa,Da){pa=void 0===pa?{}:pa;return WALK.openPopup(U,pa,Da)};this.enableMinimap=function(){console.assert(G,"enableMinimap must be called after the scene is loaded");G.minimapConfig.enabled=!0};this.disableMinimap=function(){console.assert(G,"disableMinimap must be called after the scene is loaded");G.minimapConfig.enabled=!1};this.isMinimapEnabled=function(){console.assert(G,"isMinimapEnabled must be called after the scene is loaded");
return G.minimapConfig.enabled}}})();(function(){function a(d){for(var e=0,f=0;f<d.length;f+=1)d[f].id>=e&&(e=d[f].id+1);return e}function b(d,e){for(var f=0;f<d.length;f+=1)if(d[f].name===e)return!1;return!0}function c(d,e){for(var f=d,g=2;!b(e,f);g+=1)f=d+g.toString();return f}WALK.EditorHooks=function(d,e,f,g,h,k,q,p,r){function n(){WALK.USER_MSG.info("Failed to load texture")}var m={geometryFacesCnt:d.nodes.reduce(function(t,B){return t+B.facesInSubtree()},0),objectsCnt:function(){var t=0;d.visitAllNodes(function(B){B.mesh&&t++});
return t}()},l=new WALK.TextureLoader(WALK.ASSETS_URL,WALK.DETECTOR,function(t){p.requestFrame()},n,n,!0,!1),u=new WALK.SkyLoader(l),v=h.transformControls;this.getExtensionManager=function(){return k};this.getCameraPosition=function(){var t=f.cameraWorldPosition();return[t.x,t.y,t.z]};this.getCameraRotation=function(){return[THREE.Math.radToDeg(f.getYawAngle()),THREE.Math.radToDeg(f.getPitchAngle())]};this.getCamera=function(){return d.camera};this.getSceneStats=function(){return m};this.getMaterials=
function(){return d.sortedMaterials()};this.getLights=function(){return d.lights};this.getLightProbes=function(){return d.lightProbes};this.getCameraVolumes=function(){return d.cameraVolumes};this.getNodes=function(){return d.nodes};this.getMinimap=function(){return r};this.getMinimapConfig=function(){return d.minimapConfig};this.setLevelSelectedCallback=function(t){r.addEventListener("minimapLevelSelected",function(B){null!==B.level&&t(B.level)})};this.getBoundingBox=function(){return d.boundingBox};
this.addLight=function(t,B,D){t=new WALK.Light({name:c(t,d.lights),type:B,doNotImport:!0});t.addInstance(D);d.addLight(t)};this.removeLight=function(t){d.removeLight(t)};this.renameLight=function(t,B){B=B.trim()||"light";t.name="";t.name=c(B,d.lights)};this.addLightInstance=function(t,B,D){t.addInstance(B,D)};this.removeLightInstance=function(t,B){t.removeInstance(B)};this.addLightProbe=function(t){var B=a(d.lightProbes);t=new WALK.LightProbe({id:B,position:t});t.enableBoundingBox();d.addLightProbe(t);
1===d.lightProbes.length&&d.enableLightProbesForMaterials()};this.removeLightProbe=function(t){d.removeLightProbe(t);0===d.lightProbes.length&&d.disableLightProbesForMaterials()};this.getCameraVolumeTypes=function(){return WALK.CameraVolume.CameraVolumeTypes};this.addCameraVolume=function(t,B){var D=(new THREE.Vector3).fromArray(this.getCameraPosition()),I=this.getCameraRotation();I=(new THREE.Vector3(0,3,0)).applyEuler(new WALK.Euler(I[0]/180*Math.PI,I[1]/180*Math.PI,0));var J=a(d.cameraVolumes);
d.addCameraVolume(new WALK.CameraVolume({id:J,name:B||t+J,type:t,position:D.add(I).toArray(),rotation:[0,0,0],scale:[1,1,1],exposure:d.camera.defaultExposure,gamma:d.camera.defaultGamma}))};this.removeCameraVolume=function(t){d.removeCameraVolume(t)};this.shiftCameraVolume=function(t,B){d.shiftCameraVolume(t,B)};this.getViews=function(){return d.views.filter(function(t){return!t.internal})};this.markScreenshotArea=function(t){q.markArea(t)};this.unmarkScreenshotArea=function(){q.unmarkArea()};this.monoScreenToBuffer=
function(t,B,D){return q.monoScreenToBuffer(t,B,D)};this.stereoPanoramaToBuffer=function(t,B,D,I){return q.stereoPanoramaToBuffer(t,B,D,I)};this.addViewFromCamera=function(t,B){var D=[];console.assert("fps"===B||"top"===B||"orbit"===B);var I=f.cameraWorldPosition(),J=f.orbit;D[0]=THREE.Math.radToDeg(f.getYawAngle());D[1]=THREE.Math.radToDeg(f.getPitchAngle());t={id:a(d.views),name:c(t.trim()||"view",d.views),rotation:D};"fps"===B?(t.mode="fps",t.sky=WALK.EDITOR_CONTROLLED_SKY_NAME,t.position=I.toArray()):
"top"===B?(t.mode="orbit",t.sky=WALK.DEFAULT_SKY_NAME,t.panPrimary=!0,t.noPitchRotate=!0,t.rotation[1]=-90,t.minUpAngle=0,t.maxUpAngle=Math.PI/2,J.isEnabled()?(t.target=[J.target.x,J.target.y,d.boundingBox.min.z],t.distance=J.getCameraDistance(),t.minDistance=J.getMinDistance(),t.maxDistance=J.getMaxDistance()):(t.target=[I.x,I.y,d.boundingBox.min.z],t.distance=Math.max(I.z-d.boundingBox.min.z,1))):(t.mode="orbit",t.sky=WALK.DEFAULT_SKY_NAME,t.panPrimary=!1,t.noPitchRotate=!1,J.isEnabled()?(t.target=
J.target.toArray(),t.distance=J.getCameraDistance(),t.minDistance=J.getMinDistance(),t.maxDistance=J.getMaxDistance(),t.minUpAngle=-J.getMaxPitchAngle(),t.maxUpAngle=-J.getMinPitchAngle()):(B=d.boundingBox.center(),t.target=B.toArray(),B.sub(I),t.distance=B.length(),B.normalize(),t.rotation=[THREE.Math.radToDeg(Math.atan2(-B.x,B.y)),THREE.Math.radToDeg(Math.asin(B.z))],t.minUpAngle=0,t.maxUpAngle=Math.PI/2));I=new WALK.View(t);d.addView(I);return I};this.cloneView=function(t){var B=[THREE.Math.radToDeg(t.rotation.yaw),
THREE.Math.radToDeg(t.rotation.pitch)],D=t.serialize();D.id=a(d.views);D.name=c(t.name.trim()||"view",d.views);D.rotation=B;"fps"===t.mode?D.position=t.position.toArray():D.target=t.target.toArray();var I=new WALK.View(D);d.addView(I);d.nodeConfigs.forEach(function(J){J.hideInViews&&J.isOnHideInViews(t.id)&&J.addToHideInViews(I.id)});return I};this.resetViewFromCamera=function(t){var B=f.cameraWorldPosition();"fps"===t.mode?t.position.copy(B):(t.target.copy(f.orbit.target),t.distance=B.distanceTo(t.target));
"fps"!==t.mode&&t.isTop()||(t.rotation.pitch=f.getPitchAngle());t.setYaw(f.getYawAngle())};this.removeView=function(t){d.removeView(t)};this.shiftView=function(t,B){d.shiftView(t,B)};this.activateSkyForView=function(t){g.activateSky(t)};this.switchToView=function(t){g.switchToView(t);WALK.focusWalkCanvas()};this.renameView=function(t,B){B=B.trim()||"view";t.name="";t.setName(c(B,d.views))};this.updateHiddenMeshes=function(t){g.updateHiddenMeshes(t)};this.getSky=function(){return d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)};
this.loadTexture=function(t){return l.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,t,!0,!0,WALK.DEFAULT_ANISOTROPY)};this.materialTextureUpdated=function(t,B){var D=new Set,I="";t.textureNeedsUv0(B)&&d.visitMeshesWithMaterial(t,function(J){0===J.geometry.vertexCnt||J.uv0InBuffers()||D.has(J.node.type)||(D.add(J.node.type),5<D.size||(""!==I&&(I+=", "),I+="'"+J.node.type+"'"))});return 0<D.size&&"Texture "+B+" won't be correctly mapped. The following objects lack base color UV mapping coming from the 3D modeling tool: "+
I+(5<D.size?" (plus "+(D.size-5)+" more).":".")};this.changeSkyTexture=function(t){var B=d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);B.isEquirect?u.loadSkyTexture(B,t):(d.removeSkyMesh(B),u.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"equirect",texture:t},d));d.adjustSkiesAndCameraFarToSpanWholeScene()};this.removeSkyTexture=function(){var t=d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);t.isEquirect&&(d.removeSkyMesh(t),u.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"procedural"},
d));d.adjustSkiesAndCameraFarToSpanWholeScene()};this.getColorMapName=function(){return d.camera.colorMap?d.camera.colorMap.name:null};this.loadColorMap=function(t){t=l.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,t,!1,!1,WALK.NO_ANISOTROPY);t.flipY=!1;return t};this.getSceneJson=function(){return d.serialize()};this.getCoverJson=function(){var t=e.cover;t.extensions=k.getConfig();return t};this.disableSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};this.enableMaterialSelection=
function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.MATERIAL)};this.enableLightSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT)};this.enableLightProbeSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE)};this.enableExtensionSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.EXTENSION)};this.enablePositionSelection=function(t){h.setDistanceToObject(t);h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.POSITION)};
this.enableNodeSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.NODE)};this.enableCameraVolumeSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME)};this.selectMaterial=function(t){h.selectMaterial(t)};this.replaceMaterial=function(t,B){t=d.replaceMaterial(t,B);t.isAnimated&&t.play();return t};this.selectLights=function(t,B){h.selectLights(t,B)};this.selectLightInstances=function(t,B,D){h.selectLightInstances(t,B,D)};this.selectLightProbe=
function(t){h.selectLightProbe(t,!1)};this.selectCameraVolume=function(t){h.selectEditorCameraVolume(t)};this.selectExtension=function(t){h.selectExtension(t,!1)};this.selectNodes=function(t,B,D,I,J){h.selectNodes(t,B,D,I,J)};this.setMaterialClickedCallback=function(t){h.setMaterialClickedCallback(t)};this.setLightInstanceClickedCallback=function(t){h.setLightInstanceClickedCallback(t)};this.setLightProbeClickedCallback=function(t){h.setLightProbeClickedCallback(t)};this.setNodeClickedCallback=function(t){h.setNodeClickedCallback(t)};
this.setExtensionClickedCallback=function(t){h.setExtensionClickedCallback(t)};this.setPositionClickedCallback=function(t){h.setPositionClickedCallback(t)};this.setItemModifiedCallback=function(t){v.setItemModifiedCallback(t)};this.setViewSelectedCallback=function(t){g.addEventListener("teleportStarted",function(B){null!==B.view&&t(B.view)})};this.coverModified=function(t){e.updateCover(t)};this.autoTourModified=function(){e.refresh()};this.hasLightMap=function(){return d.hasLightMap()};this.getAutoTour=
function(){return d.autoTour};this.getDisableProgressiveLoader=function(){return d.disableProgressiveLoader};this.setDisableProgressiveLoader=function(t){d.disableProgressiveLoader=t};this.getSceneScaleHtmlWarning=function(){var t=d.boundingBox;return!t.empty()&&(t=t.size(),200<t.x||200<t.y||200<t.z)?"The scene has unusually large dimensions: <strong>"+Math.round(t.x)+"m x "+Math.round(t.y)+"m x "+Math.round(t.z)+'m</strong>.</br></br>Shapespark assumes real-world scale, 1 meter in the scene should correspond to 1 meter in the real world. If the scale of the scene is invalid, either re-scale the model or change the scale in the import dialog, otherwise you can disable this message.</br></br>For more information consult <a href="/assets/help.html#importing-the-scene">Importing the scene</a> section of the help.':
null};this.getTransformMode=function(){return v.mode};this.setTransformMode=function(t){v.setTransformMode(t)};this.getSupportedTransformModes=function(){return v.supportedModes};this.seeItem=function(t){WALK.getViewer().seeItem(t)}};WALK.SceneLoadConfig=function(){this.onSceneLoaded=null;this.enableCollisions=!0;this.forcedInitialCameraRotation=this.forcedInitialCameraPosition=null;this.sendCoverToServer=!1}})();(function(){function a(){var d=new THREE.BufferGeometry,e=new Float32Array(288);d.addAttribute("position",new THREE.BufferAttribute(e,3));var f=0;[[[-1,-1,-1],[-1,-.6,-1],[-.6,-1,-1]],[[-1,-1,-1],[-1,-1,-.6],[-1,-.6,-1]],[[-1,-1,-1],[-.6,-1,-1],[-1,-1,-.6]],[[-.6,-1,-1],[-1,-.6,-1],[-1,-1,-.6]],[[-1,-1,1],[-.6,-1,1],[-1,-.6,1]],[[-1,-1,1],[-1,-.6,1],[-1,-1,.6]],[[-1,-1,1],[-1,-1,.6],[-.6,-1,1]],[[-.6,-1,1],[-1,-1,.6],[-1,-.6,1]],[[1,-1,-1],[.6,-1,-1],[1,-.6,-1]],[[1,-1,-1],[1,-.6,-1],[1,-1,-.6]],
[[1,-1,-1],[1,-1,-.6],[.6,-1,-1]],[[.6,-1,-1],[1,-1,-.6],[1,-.6,-1]],[[-1,1,-1],[-.6,1,-1],[-1,.6,-1]],[[-1,1,-1],[-1,.6,-1],[-1,1,-.6]],[[-1,1,-1],[-1,1,-.6],[-.6,1,-1]],[[-.6,1,-1],[-1,1,-.6],[-1,.6,-1]],[[1,1,1],[.6,1,1],[1,.6,1]],[[1,1,1],[1,.6,1],[1,1,.6]],[[1,1,1],[1,1,.6],[.6,1,1]],[[.6,1,1],[1,1,.6],[1,.6,1]],[[1,-1,1],[1,-.6,1],[.6,-1,1]],[[1,-1,1],[1,-1,.6],[1,-.6,1]],[[1,-1,1],[.6,-1,1],[1,-1,.6]],[[.6,-1,1],[1,-.6,1],[1,-1,.6]],[[1,1,-1],[1,.6,-1],[.6,1,-1]],[[1,1,-1],[1,1,-.6],[1,.6,
-1]],[[1,1,-1],[.6,1,-1],[1,1,-.6]],[[.6,1,-1],[1,.6,-1],[1,1,-.6]],[[-1,1,1],[-1,.6,1],[-.6,1,1]],[[-1,1,1],[-1,1,.6],[-1,.6,1]],[[-1,1,1],[-.6,1,1],[-1,1,.6]],[[-.6,1,1],[-1,.6,1],[-1,1,.6]]].forEach(function(g){for(var h=0;3>h;h+=1)for(var k=0;3>k;k+=1)e[f]=g[h][k],f+=1});d.computeVertexNormals();d.convertNormalsToSpherical();return d}function b(){var d=new WALK.StandardMaterial;d.disableLightProbe=!0;d.headLight=!0;d.baseColor=WALK.EDITOR_SELECTION_COLOR;d.setUniforms();return d}function c(){function d(r,
n){q.push([[r.x,r.y,r.z],[n.x,r.y,r.z],[r.x,n.y,r.z]]);q.push([[r.x,n.y,r.z],[n.x,r.y,r.z],[n.x,n.y,r.z]])}function e(r,n){q.push([[r.x,r.y,r.z],[r.x,n.y,r.z],[r.x,r.y,n.z]]);q.push([[r.x,r.y,n.z],[r.x,n.y,r.z],[r.x,n.y,n.z]])}function f(r,n){q.push([[r.x,r.y,r.z],[n.x,r.y,r.z],[r.x,r.y,n.z]]);q.push([[r.x,r.y,n.z],[n.x,r.y,r.z],[n.x,r.y,n.z]])}function g(r,n,m){var l=Math.min(r.x,n.x),u=Math.min(r.y,n.y),v=Math.min(r.z,n.z),t=Math.max(r.x,n.x),B=Math.max(r.y,n.y);r=Math.max(r.z,n.z);"XY"!==m&&(d({x:t,
y:u,z:v},{x:l,y:B,z:v}),d({x:l,y:u,z:r},{x:t,y:B,z:r}));"YZ"!==m&&(e({x:l,y:B,z:v},{x:l,y:u,z:r}),e({x:t,y:u,z:v},{x:t,y:B,z:r}));"XZ"!==m&&(f({x:t,y:B,z:v},{x:l,y:B,z:r}),f({x:l,y:u,z:v},{x:t,y:u,z:r}))}var h=new THREE.BufferGeometry,k=new Float32Array(864);h.addAttribute("position",new THREE.BufferAttribute(k,3));var q=[];g({x:-.876,y:.876,z:.876},{x:.876,y:.866,z:.866},"YZ");g({x:-.876,y:.876,z:-.866},{x:.876,y:.866,z:-.876},"YZ");g({x:-.876,y:-.876,z:-.876},{x:.876,y:-.866,z:-.866},"YZ");g({x:-.876,
y:-.876,z:.876},{x:.876,y:-.866,z:.866},"YZ");g({x:.876,y:.876,z:.876},{x:.866,y:-.876,z:.866},"XZ");g({x:.876,y:.876,z:-.876},{x:.866,y:-.876,z:-.866},"XZ");g({x:-.876,y:.876,z:-.876},{x:-.866,y:-.876,z:-.866},"XZ");g({x:-.876,y:.876,z:.876},{x:-.866,y:-.876,z:.866},"XZ");g({x:.876,y:.876,z:.876},{x:.866,y:.866,z:-.876},"XY");g({x:.876,y:-.876,z:.876},{x:.866,y:-.866,z:-.876},"XY");g({x:-.876,y:.876,z:.876},{x:-.866,y:.866,z:-.876},"XY");g({x:-.876,y:-.876,z:.876},{x:-.866,y:-.866,z:-.876},"XY");
var p=0;q.forEach(function(r){for(var n=0;3>n;n+=1)for(var m=0;3>m;m+=1)k[p]=r[n][m],p+=1});h.computeVertexNormals();h.convertNormalsToSpherical();return h}WALK.LightControls=function(d,e){function f(M){if("spot"===M.type){var z=THREE.Math.degToRad(M.angle);M=1*Math.cos(z/2);z=new THREE.CylinderBufferGeometry(0,1*Math.sin(z/2),M,32,1);t.makeTranslation(0,-M/2,0);v.makeRotationZ(Math.PI);B.multiplyMatrices(v,t);z.applyMatrix(B);z.convertNormalsToSpherical()}else z="area"===M.type?I:D;return z}function g(M,
z,A){var y=new WALK.LightMaterial(M);A=new THREE.Mesh(A,y);A.visibilityId=null;var E=new THREE.Mesh(J,T);A.add(E);var K=new THREE.Mesh(Q,T);z===l.selectedLightInstance||l.subSelectedLightInstances.includes(z)||(K.visible=!1);A.add(K);if("sun"!==M.type){var H=z.rotation.toQuaternion().multiply(A.quaternion);A.setRotationFromQuaternion(H);A.position.copy(z.position);"area"===M.type?(y.side=THREE.DoubleSide,A.scale.set(M.width,1,M.height),y=Math.max(M.width,M.height)/2,E.scale.set(y/M.width,y,y/M.height),
K.scale.set(y/M.width,y,y/M.height)):A.scale.set(M.size,M.size,M.size)}else M=d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME).radius,M=1*Math.PI*M*1.5/360,WALK.sunRotationToPosition(d,z.rotation,A.position),A.scale.set(M,M,M);A.userData.lightInstance=z;A.updateMatrixWorld();l.lightInstanceMeshes.push(A);u&&d.addAuxiliaryObject(A)}function h(M){var z=f(M);M.forEachLightInstance(function(A){g(M,A,z)})}function k(M){for(var z=0;z<l.lightInstanceMeshes.length;z+=1){var A=l.lightInstanceMeshes[z];if(A.userData.lightInstance===
M)return A}return null}function q(M){for(var z=[],A=0;A<l.lightInstanceMeshes.length;A+=1){var y=l.lightInstanceMeshes[A];y.userData.lightInstance.light===M?(u&&d.removeAuxiliaryObject(y),y.geometry!==D&&y.geometry!==I&&y.geometry.dispose(),y.material.dispose()):z.push(y)}l.lightInstanceMeshes=z}function p(M){M=M.target;q(M);h(M)}function r(M){M=M.instance;var z=M.light;var A=z.instances[0]!==M?k(z.instances[0]).geometry:f(z);g(z,M,A);e.requestFrame()}function n(M){M=M.instance.light;q(M);h(M);e.requestFrame()}
function m(M){h(M);M.addEventListener("updated",p);M.addEventListener("instanceAdded",r);M.addEventListener("instanceRemoved",n)}var l=this,u=!1,v=new THREE.Matrix4,t=new THREE.Matrix4,B=new THREE.Matrix4,D=new THREE.SphereBufferGeometry(1,32,16);D.convertNormalsToSpherical();var I=new THREE.PlaneBufferGeometry(1,1);v.makeRotationX(-Math.PI/2);I.applyMatrix(v);I.convertNormalsToSpherical();var J=a(),Q=c(),T=b();this.selectedLightInstance=null;this.subSelectedLightInstances=[];this.lightInstanceMeshes=
[];this.getLightInstanceMaterial=function(M){return k(M).material};this.showLights=function(){if(!u){u=!0;for(var M=0;M<this.lightInstanceMeshes.length;M+=1)d.addAuxiliaryObject(this.lightInstanceMeshes[M])}};this.showSelectionMesh=function(M,z){this.lightInstanceMeshes.forEach(function(A){A.children[0].visible=A.userData.lightInstance.light===M||z.includes(A.userData.lightInstance.light)})};this.showInstancesSelectionMesh=function(M,z){this.selectedLightInstance=M;this.subSelectedLightInstances=
z;this.lightInstanceMeshes.forEach(function(A){A.children[1].visible=A.userData.lightInstance===M||z.includes(A.userData.lightInstance)})};this.hideLights=function(){if(u){u=!1;for(var M=0;M<this.lightInstanceMeshes.length;M+=1)d.removeAuxiliaryObject(this.lightInstanceMeshes[M])}};d.lights.forEach(m);d.addEventListener("lightAdded",function(M){m(M.light);e.requestFrame()});d.addEventListener("lightRemoved",function(M){q(M.light);e.requestFrame()})}})();(function(){WALK.LightProbeControls=function(a,b){function c(u,v){v.position.addVectors(u.boxMin,u.boxMax).multiplyScalar(.5).sub(u.position);v.scale.subVectors(u.boxMax,u.boxMin);v.scale.subScalar(.005)}function d(u){var v=new WALK.StandardMaterial;v.hideFromLightProbes=!0;v.disableLightProbe=!1;v.highlight=WALK.EDITOR_SELECTION_COLOR;v.metallic=1;v.roughness=0;v.setUniforms();v=new THREE.Mesh(n,v);v.visibilityId=null;v.lightProbe=u;v.position.copy(u.position);var t=new THREE.Mesh(l,m);t.visible=
!1;v.add(t);u.isBoundingBoxEnabled()&&c(u,t);v.updateMatrixWorld(!0);v.visible=p;q.lightProbeMeshes.push(v);a.addAuxiliaryObject(v)}function e(u){for(var v=0;v<q.lightProbeMeshes.length;v+=1)if(q.lightProbeMeshes[v].lightProbe===u)return v;console.assert(!1);return null}function f(u){u=u.target;var v=q.lightProbeMeshes[e(u)];v.position.copy(u.position);var t=v.children[0];u.isBoundingBoxEnabled()?(c(u,t),t.visible=!0):t.visible=!1;v.updateMatrixWorld()}function g(u){u=u.lightProbe;d(u);u.addEventListener("positionUpdated",
f);u.addEventListener("boundsUpdated",f)}function h(u){u=e(u.lightProbe);var v=q.lightProbeMeshes[u];a.removeAuxiliaryObject(v);v.material.dispose();q.lightProbeMeshes.splice(u,1)}function k(u){for(var v=0;v<q.lightProbeMeshes.length;v+=1){var t=q.lightProbeMeshes[v];if(t.lightProbe===u)return t}return null}var q=this,p=!1,r=null;this.lightProbeMeshes=[];var n=new THREE.SphereBufferGeometry(.2,32,16);n.convertNormalsToSpherical();var m=WALK.createBoundingBoxMaterial(),l=new THREE.BoxBufferGeometry(1,
1,1);l.addTriangleOrderAttribute();l.convertNormalsToSpherical();this.getLightProbeMaterial=function(u){return(u=k(u))?u.material:null};this.showLightProbeBoundingBox=function(u){r&&(r.visible=!1,r=null);u.isBoundingBoxEnabled()&&(r=k(u).children[0],r.visible=!0)};this.showLightProbes=function(){if(!p){p=!0;for(var u=0;u<this.lightProbeMeshes.length;u+=1)this.lightProbeMeshes[u].visible=!0}b.requestFrame()};this.hideLightProbes=function(){if(p){p=!1;for(var u=0;u<this.lightProbeMeshes.length;u+=1)this.lightProbeMeshes[u].visible=
!1}b.requestFrame()};(function(){for(var u=0;u<a.lightProbes.length;u+=1){var v=a.lightProbes[u];d(v);v.addEventListener("positionUpdated",f);v.addEventListener("boundsUpdated",f)}a.addEventListener("lightProbeAdded",g);a.addEventListener("lightProbeRemoved",h)})()}})();(function(){WALK.CameraVolumeControls=function(a,b){function c(h){function k(){p.position.copy(h.position);p.rotation.copy(h.rotation);p.scale.copy(h.scale);p.updateMatrixWorld()}var q=WALK.createBoundingBoxMaterial(),p=new THREE.Mesh(h.getVolumeGeometry(),q);p.visible=!1;p.visibilityId=null;f.add(p);e.set(h,p);k(h);h.addEventListener("updated",k)}var d=function(){},e=new Map,f=new THREE.Object3D;f.visible=!1;a.addAuxiliaryObject(f);this.setHighlightedCameraVolume=function(h){d();var k=e.get(h);k.visible=
!0;d=function(){return k.visible=!1};return k.material};this.setControlsVisible=function(h){f.visible=h;b.requestFrame()};a.addEventListener("cameraVolumeAdded",function(h){c(h.cameraVolume);b.requestFrame()});a.addEventListener("cameraVolumeRemoved",function(h){h=h.cameraVolume;var k=e.get(h);f.remove(k);k.material.dispose();e.delete(h);b.requestFrame()});for(var g=0;g<a.cameraVolumes.length;g+=1)c(a.cameraVolumes[g])}})();/*
 Copyright (C) 2019-present Shapespark
*/
(function(){WALK.sunRotationToPosition=function(a,b,c){a=a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);c.set(0,-a.radius,0);c.applyEuler(b);c.add(a.position)};WALK.computeNodeBoundingSphere=function(a,b){b.radius=0;a.visitSubtree(function(c){c.mesh&&WALK.Math.spheresUnion(c.mesh.geometry.boundingSphere,b)})}})();(function(){WALK.hasShiftKeyModifier=function(a){return a&1};WALK.hasCtrlEquivalentKeyModifier=function(a){return a&2};WALK.hasAltEquivalentModifier=function(a){return a&4};WALK.PointerEventDispatcher=function(a,b){function c(v){if(void 0===v.button)return 0;switch(v.button){case 0:return 0;case 1:return 1;case 2:return 2}return-1}function d(v,t,B){if(!B)for(B=0;B<v.changedTouches.length;B++){var D=v.changedTouches[B];if(D.identifier===t)return D}for(B=0;B<v.touches.length;B++)if(D=v.touches[B],D.identifier===
t)return D;return null}function e(v,t){if(0!==v.length){var B=void 0!==t.touches;if(!B&&(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement))l.clipX=0,l.clipY=0;else{if(B){var D=d(t,m);console.assert(null!==D);B=D.clientX;D=D.clientY}else B=t.clientX,D=t.clientY;l.clipX=B/window.innerWidth*2-1;l.clipY=2*-(D/window.innerHeight)+1}B=l;for(D=0;D<v.length;D++){var I=v[D].callback,J=B.clipX,Q=B.clipY,T=0;if(t.ctrlKey&&!WALK.DETECTOR.mac||t.metaKey&&WALK.DETECTOR.mac)T|=
2;t.altKey&&(T|=4);t.shiftKey&&(T|=1);if(I(J,Q,T))break}}}function f(v){0!==c(v)||n||(n=!0,void 0!==v.touches&&(console.assert(0<v.changedTouches.length),m=v.changedTouches[0].identifier),e(q,v))}function g(v){if(0===c(v)){var t=void 0!==v.touches;t&&d(v,m,!0)||!n||(n=!1,e(p,v),t&&(m=-1))}}function h(v){void 0!==v.touches&&-1===m||e(r,v)}function k(v,t,B){var D=v.filter(function(J){return J.callback===t});console.assert(0===D.length,"Do not add the same callback twice!");B={callback:t,priority:B};
for(D=D=0;D<v.length;D+=1){var I=v[D];if(B.priority<=I.priority){if(B.priority===I.priority){console.error("Adding two listeners with the same priority is not allowed!");return}break}}v.splice(D,0,B)}var q=[],p=[],r=[],n=!1,m=-1,l={clipX:0,clipY:0};this.addPointerDownListener=function(v,t){k(q,v,t)};this.removePointerDownListener=function(v){q=q.filter(function(t){return t.callback!==v})};this.addPointerUpListener=function(v,t){k(p,v,t)};this.removePointerUpListener=function(v){p=p.filter(function(t){return t.callback!==
v})};this.addPointerMoveListener=function(v,t){k(r,v,t)};this.removePointerMoveListener=function(v){r=r.filter(function(t){return t.callback!==v})};var u=!1;this.isEnabled=function(){return u};this.enable=function(){u||(a.addEventListener("mousedown",f,!1),a.addEventListener("touchstart",f,!1),a.addEventListener("mouseup",g,!1),a.addEventListener("touchend",g,!1),a.addEventListener("mousemove",h,!1),a.addEventListener("touchmove",h,!1),window.addEventListener("mouseup",g,!1),b&&window.top.addEventListener("mouseup",
g,!1),u=!0)};this.disable=function(){u&&(a.removeEventListener("mousedown",f,!1),a.removeEventListener("touchstart",f,!1),a.removeEventListener("mouseup",g,!1),a.removeEventListener("touchend",g,!1),a.removeEventListener("mousemove",h,!1),a.removeEventListener("touchmove",h,!1),window.removeEventListener("mouseup",g,!1),b&&window.top.removeEventListener("mouseup",g,!1),u=!1)};this.enable()}})();(function(){WALK.PointerEventHelper=function(a,b){function c(){return!1}function d(l,u){var v=g.callbacks.onPointerDown(l,u);h=!0;k=l;q=u;return v}function e(l,u,v){var t=g.callbacks.onPointerUp(l,u);if(h){var B=Date.now();t=null!==n&&.03>=Math.abs(p-k)&&.03>=Math.abs(r-q)&&500>=Math.abs(n-B)&&g.callbacks.onDoubleClick!==c?g.callbacks.onDoubleClick(l,u)||t:g.callbacks.onClick(l,u,v)||t;n=B;p=l;r=u}return t}function f(l,u){var v=g.callbacks.onPointerMove(l,u);!h||.03>=Math.abs(l-k)&&.03>=Math.abs(u-
q)||(h=!1,n=null);return v}var g=this,h=!1,k=null,q=null,p=null,r=null,n=null;this.callbacks={onClick:c,onDoubleClick:c,onPointerDown:c,onPointerUp:c,onPointerMove:c};var m=!1;this.isEnabled=function(){return m};this.enable=function(){m||(a.addPointerDownListener(d,b),a.addPointerUpListener(e,b),a.addPointerMoveListener(f,b),m=!0)};this.disable=function(){m&&(a.removePointerDownListener(d),a.removePointerUpListener(e),a.removePointerMoveListener(f),m=!1)};this.enable()}})();(function(){function a(D){var I=new THREE.Box3;D instanceof THREE.Object3D&&D.traverse(function(J){J instanceof THREE.Mesh&&(J.geometry.boundingBox||J.geometry.computeBoundingBox(),I.union(J.geometry.boundingBox))});return I}function b(D,I){var J=a(D);D=J.size();D=new THREE.BoxBufferGeometry(D.x,D.y,D.z);J=J.center();var Q=new THREE.Matrix4;Q.makeTranslation(J.x,J.y,J.z);D.applyMatrix(Q);D.computeBoundingBox();I=new THREE.Mesh(D,I);I.visible=!1;I.visibilityId=null;return I}function c(D,I){var J=new WALK.StandardMaterial;
J.hideFromLightProbes=!0;J.baseColor.copy(D);J.opacity=I;J.specularOff=1;J.depthTest=!1;J.depthWrite=!1;return J}function d(D){for(var I=[],J=0;J<arguments.length;++J)I[J-0]=arguments[J];console.assert(0<I.length,"Part must have at least one element!");var Q=new THREE.Object3D;I.forEach(function(T){return Q.add(T)});I=b(Q,c(f,.6));return new n(Q,I,Q.children[0].material)}function e(D,I,J){var Q=D.material;Q.opacity=I===D.collider?D.hoveredOpacity:J&&null!==I?D.notUsedOpacity:D.defaultOpacity;Q.setUniforms()}
WALK.TRANSFORM_MODE={TRANSLATE:0,ROTATE:1,SCALE:2};var f=new THREE.Color(16777215),g=new THREE.Color(16711680),h=new THREE.Color(65280),k=new THREE.Color(255),q=new THREE.Vector3(0,0,1),p=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),n=function(D,I,J){THREE.Object3D.call(this);this.add(D);this.add(I);this.material=J;this.collider=I;this.defaultOpacity=J.opacity;this.hoveredOpacity=.99;this.notUsedOpacity=.3;this.usedAxes=0};n.prototype=Object.create(THREE.Object3D.prototype);n.prototype.constructor=
n;var m=function(){function D(A){A=c(A,.6);A.depthTest=!0;return new THREE.Mesh(I,A)}THREE.Object3D.call(this);var I=new THREE.CylinderBufferGeometry(.005,.005,1E3,4,1,!1),J=D(g);J.rotation.set(0,0,Math.PI/2);var Q=D(h),T=D(k);T.rotation.set(Math.PI/2,0,0);this.add(J);this.add(Q);this.add(T);var M=[!1,!1,!1];this.show=function(A){M[0]=1===(1&A);M[1]=2===(2&A);M[2]=4===(4&A);J.visible=M[0];Q.visible=M[1];T.visible=M[2]};var z=new THREE.Vector3;this.update=function(A){z.copy(A);z.sub(this.position);
z.normalize();J.visible=M[0]&&.998>Math.abs(p.dot(z));Q.visible=M[1]&&.998>Math.abs(r.dot(z));T.visible=M[2]&&.998>Math.abs(q.dot(z))}};m.prototype=Object.create(THREE.Object3D.prototype);m.prototype.constructor=m;var l=function(){function D(){var M=c(f,.99);return new THREE.Mesh(I,M)}THREE.Object3D.call(this);var I=new THREE.SphereBufferGeometry(.012,10,10),J=D(),Q=D(),T=D();this.add(J);this.add(Q);this.add(T);this.show=function(M){J.visible=1===(1&M);Q.visible=2===(2&M);T.visible=4===(4&M)};this.update=
function(M){J.position.set(M.x,0,0);J.updateMatrixWorld();Q.position.set(0,M.y,0);Q.updateMatrixWorld();T.position.set(0,0,M.z);T.updateMatrixWorld()}};l.prototype=Object.create(THREE.Object3D.prototype);l.prototype.constructor=l;var u=function(){function D(A){A=c(A,.2);A.depthTest=!0;A.side=THREE.DoubleSide;return d(new THREE.Mesh(I,A))}THREE.Object3D.call(this);var I=new THREE.PlaneBufferGeometry(1E3,1E3,1,1),J=D(f);this.add(J);var Q=new THREE.Object3D;this.add(Q);var T=D(k);T.rotation.set(0,0,
0);var M=D(h);M.rotation.set(Math.PI/2,0,0);var z=D(g);z.rotation.set(0,Math.PI/2,0);Q.add(T);Q.add(M);Q.add(z);this.setLocalRotation=function(A){A?Q.rotation.copy(A):Q.rotation.set(0,0,0)};this.update=function(A){J.rotation.setFromRotationMatrix(A.matrixWorld);J.updateMatrixWorld()};this.cameraPlane=J;this.findPlaneIntersectionPoint=function(){function A(K){switch(K){case 1:return z;case 2:return M;case 4:return T;case 3:return T;case 5:return M;case 6:return z;case 7:return J;default:throw"Impossible";
}}var y=new THREE.Vector3,E=new THREE.Vector3;return function(K,H,G,O){var Y=A(K);Y.getWorldPosition(y).sub(H);Y.getWorldDirection(E);if(1===K||2===K||4===K){K=E.dot(E);Y=E.dot(G);var W=G.dot(G),ka=E.dot(y),la=G.dot(y);W=K*W-Y*Y;K=1E-5>Math.abs(W)?Infinity:(K*la-Y*ka)/W}else K=E.dot(G),K=1E-5>Math.abs(K)?Infinity:E.dot(y)/K;if(Infinity===K)return!1;O.copy(G).multiplyScalar(K).add(H);return!0}}();this.show=function(A){J.visible=7===A?!0:!1;T.visible=3===A;M.visible=5===A;z.visible=6===A}};u.prototype=
Object.create(THREE.Object3D.prototype);u.prototype.constructor=u;var v=function(){function D(O){for(var Y=new Uint8Array(4096),W=Math.floor(255*O.r),ka=Math.floor(255*O.g),la=Math.floor(255*O.b),oa=0,ra=0;32>ra;ra++)for(var Ba=0;32>Ba;Ba++)Y[oa]=W,Y[oa+1]=ka,Y[oa+2]=la,Y[oa+3]=0===ra||0===Ba||31===ra||31===Ba?220:150,oa+=4;Y=new WALK.DataTexture(Y,32,32,THREE.RGBAFormat);Y.hasAlpha=!0;Y.needsUpdate=!0;Y.loaded=!0;W=new WALK.StandardMaterial;W.hideFromLightProbes=!0;W.specularOff=1;W.disableLightProbe=
!0;W.depthTest=!1;W.depthWrite=!1;W.transparent=!0;W.baseColor=O;W.side=THREE.DoubleSide;W.baseColorTexture=Y;W.opacity=.6;W.configureTransparency();W.setUniforms();return d(new THREE.Mesh(Q.squareGeometry,W))}function I(O){O=c(O,.6);return d(new THREE.Mesh(Q.lineGeometry,O),new THREE.Mesh(Q.arrowHeadGeometry,O))}var J=this;THREE.Object3D.call(this);var Q=function(){var O=new THREE.Matrix4,Y=new THREE.SphereBufferGeometry(.1,16,16),W=new THREE.PlaneBufferGeometry(.23,.23,1,1);O.makeTranslation(.45,
.45,0);W.applyMatrix(O);W.addTriangleOrderAttribute();var ka=new THREE.CylinderBufferGeometry(.015,.015,1,4,1,!1);O.makeTranslation(0,.65,0);ka.applyMatrix(O);var la=new THREE.CylinderBufferGeometry(0,.05,.2,10,1,!1);O.makeTranslation(0,1.25,0);la.applyMatrix(O);return{pickerGeometry:Y,squareGeometry:W,lineGeometry:ka,arrowHeadGeometry:la}}(),T=function(){var O=c(f,.6);return d(new THREE.Mesh(Q.pickerGeometry,O))}(),M=I(g);M.rotation.set(0,0,-Math.PI/2);var z=I(h),A=I(k);A.rotation.set(Math.PI/2,
0,0);var y=D(k),E=D(h);E.rotation.set(Math.PI/2,0,0);var K=D(g);K.rotation.set(0,-Math.PI/2,0);T.usedAxes=7;M.usedAxes=1;z.usedAxes=2;A.usedAxes=4;y.usedAxes=3;E.usedAxes=5;K.usedAxes=6;var H=[T,M,z,A,y,E,K];H.forEach(function(O){return J.add(O)});var G=new Map(H.map(function(O){return[O.collider,O]}));this.colliders=[].concat($jscomp.arrayFromIterable(G.keys()));this.highlight=function(O,Y){H.forEach(function(W){return e(W,O,Y)})};this.usedAxes=function(O){return G.get(O).usedAxes}};v.prototype=
Object.create(THREE.Object3D.prototype);v.prototype.constructor=v;var t=function(){function D(H){var G=new THREE.TorusBufferGeometry(H,.012,6,64);H=new THREE.TorusBufferGeometry(H,.038,6,64);return{torusGeometry:G,colliderGeometry:H}}function I(H,G){H=new WALK.RotateGizmoMaterial(H,.6);var O=new THREE.Object3D;O.add(new THREE.Mesh(G.torusGeometry,H));G=new THREE.Mesh(G.colliderGeometry,H);G.visible=!1;G.visibilityId=null;return new n(O,G,H)}var J=this;THREE.Object3D.call(this);var Q=D(.9),T=I(g,Q);
T.rotation.set(0,Math.PI/2,0);var M=I(h,Q);M.rotation.set(Math.PI/2,0,0);Q=I(k,Q);var z=D(1.12),A=I(f,z),y=function(H,G){H=c(H,0);var O=new THREE.SphereBufferGeometry(G,32,32);G=new THREE.Object3D;G.add(new THREE.Mesh(O,H));O=new THREE.Mesh(O,H);O.visible=!1;O.visibilityId=null;H=new n(G,O,H);H.defaultOpacity=0;H.hoveredOpacity=.2;H.notUsedOpacity=0;return H}(f,.848),E=[T,M,Q,A,y];E.forEach(function(H){return J.add(H)});var K=new Map(E.map(function(H){return[H.collider,H]}));this.colliders=[].concat($jscomp.arrayFromIterable(K.keys()));
this.update=function(H){var G=this;E.filter(function(O){return O!==y}).forEach(function(O){O=O.material;O.gizmoPosition.copy(G.position);O.sphereRadius=.86*G.scale.x});A.rotation.setFromRotationMatrix(H.matrixWorld);A.updateMatrixWorld()};T.usedAxes=1;M.usedAxes=2;Q.usedAxes=4;A.usedAxes=7;y.usedAxes=0;this.highlight=function(H,G){E.forEach(function(O){return e(O,H,G)})};this.usedAxes=function(H){return K.get(H).usedAxes}};t.prototype=Object.create(THREE.Object3D.prototype);t.prototype.constructor=
t;var B=function(){function D(O){for(var Y=new Uint8Array(4096),W=Math.floor(255*O.r),ka=Math.floor(255*O.g),la=Math.floor(255*O.b),oa=0,ra=0;32>ra;ra++)for(var Ba=0;32>Ba;Ba++)Y[oa]=W,Y[oa+1]=ka,Y[oa+2]=la,Y[oa+3]=0===ra||0===Ba||31===ra||31===Ba?220:150,oa+=4;Y=new WALK.DataTexture(Y,32,32,THREE.RGBAFormat);Y.hasAlpha=!0;Y.needsUpdate=!0;Y.loaded=!0;W=new WALK.StandardMaterial;W.hideFromLightProbes=!0;W.specularOff=1;W.disableLightProbe=!0;W.depthTest=!1;W.depthWrite=!1;W.transparent=!0;W.baseColor=
O;W.side=THREE.DoubleSide;W.baseColorTexture=Y;W.opacity=.6;W.configureTransparency();W.setUniforms();return d(new THREE.Mesh(Q.squareGeometry,W))}function I(O){O=c(O,.6);return d(new THREE.Mesh(Q.lineGeometry,O),new THREE.Mesh(Q.cubeGeometry,O))}var J=this;THREE.Object3D.call(this);var Q=function(){var O=new THREE.Matrix4,Y=new THREE.BoxBufferGeometry(.3,.3,.3),W=new THREE.PlaneBufferGeometry(.23,.23,1,1);O.makeTranslation(.45,.45,0);W.applyMatrix(O);W.addTriangleOrderAttribute();var ka=new THREE.CylinderBufferGeometry(.015,
.015,1,4,1,!1);O.makeTranslation(0,.65,0);ka.applyMatrix(O);var la=new THREE.BoxBufferGeometry(.1,.1,.1);O.makeTranslation(0,1.1,0);la.applyMatrix(O);return{pickerGeometry:Y,squareGeometry:W,lineGeometry:ka,cubeGeometry:la}}(),T=function(){var O=c(f,.6);return d(new THREE.Mesh(Q.pickerGeometry,O))}(),M=I(g);M.rotation.set(0,0,-Math.PI/2);var z=I(h),A=I(k);A.rotation.set(Math.PI/2,0,0);var y=D(k),E=D(h);E.rotation.set(Math.PI/2,0,0);var K=D(g);K.rotation.set(0,-Math.PI/2,0);T.usedAxes=7;M.usedAxes=
1;z.usedAxes=2;A.usedAxes=4;y.usedAxes=3;E.usedAxes=5;K.usedAxes=6;var H=[T,M,z,A,y,E,K];H.forEach(function(O){return J.add(O)});var G=new Map(H.map(function(O){return[O.collider,O]}));this.colliders=[].concat($jscomp.arrayFromIterable(G.keys()));this.highlight=function(O,Y){H.forEach(function(W){return e(W,O,Y)})};this.usedAxes=function(O){return G.get(O).usedAxes}};B.prototype=Object.create(THREE.Object3D.prototype);B.prototype.constructor=B;WALK.TransformGizmo=function(D,I,J,Q){function T(qa){A.oldPosition.copy(qa);
A.newPosition.copy(qa);y.position.copy(qa);E.position.copy(qa);K.position.copy(qa);H.position.copy(qa);G.position.copy(qa);O.position.copy(qa)}function M(qa){A.oldRotation.copy(qa);A.newRotation.copy(qa);oa===WALK.TRANSFORM_MODE.SCALE?(y.rotation.copy(qa),E.setLocalRotation(qa),O.rotation.copy(A.oldRotation)):(y.rotation.set(0,0,0),E.setLocalRotation(null))}function z(){ra?oa===WALK.TRANSFORM_MODE.TRANSLATE?(D.addAuxiliaryObject(y),D.addAuxiliaryObject(E),D.addAuxiliaryObject(K),D.addAuxiliaryObject(H),
D.removeAuxiliaryObject(G),D.removeAuxiliaryObject(O)):oa===WALK.TRANSFORM_MODE.ROTATE?(D.addAuxiliaryObject(y),D.removeAuxiliaryObject(H),D.addAuxiliaryObject(G),D.removeAuxiliaryObject(O)):(D.addAuxiliaryObject(y),D.addAuxiliaryObject(E),D.removeAuxiliaryObject(H),D.removeAuxiliaryObject(G),D.addAuxiliaryObject(O)):(D.removeAuxiliaryObject(y),D.removeAuxiliaryObject(E),D.removeAuxiliaryObject(K),D.removeAuxiliaryObject(H),D.removeAuxiliaryObject(G),D.removeAuxiliaryObject(O))}var A=this;this.subTargetsInfo=
this.target=null;var y=new m;y.show(7);var E=new u;E.show(0);var K=new l;K.show(0);var H=new v,G=new t,O=new B,Y=!1;Object.defineProperty(this,"transforming",{get:function(){return Y}});var W=new THREE.Vector3(0,0,0),ka=0,la=new THREE.Vector3;this.oldPosition=new THREE.Vector3(0,0,0);this.newPosition=new THREE.Vector3(0,0,0);this.oldRotation=new THREE.Euler(0,0,0);this.newRotation=new THREE.Euler(0,0,0);this.oldScale=new THREE.Vector3(1,1,1);this.newScale=new THREE.Vector3(1,1,1);Object.defineProperty(this,
"position",{get:function(){return y.position}});Object.defineProperty(this,"rotation",{get:function(){return A.oldRotation}});var oa=!1;Object.defineProperty(this,"scale",{get:function(){return A.oldScale}});var ra=!1;Object.defineProperty(this,"mode",{get:function(){return oa},set:function(qa){oa!==qa&&(oa=qa,z(),Q.requestFrame())}});Object.defineProperty(this,"visible",{get:function(){return ra},set:function(qa){ra!==qa&&(ra=qa,z())}});this.mode=WALK.TRANSFORM_MODE.TRANSLATE;var Ba=Infinity,ma=
Infinity,Ga=new THREE.Vector3(0,0,0),aa=null,S=!1,R=7,Z=function(){var qa=new THREE.Vector3,fa=new THREE.Vector3,va=new THREE.Quaternion;return function(sa,Fa,Ta){qa.set(Fa,Ta,1).unproject(D.camera);qa.sub(J).normalize();if(!E.findPlaneIntersectionPoint(sa,J,qa,fa))return null;fa.sub(y.position);fa.applyQuaternion(va.setFromEuler(y.rotation).inverse());sa&1||(fa.x=0);sa&2||(fa.y=0);sa&4||(fa.z=0);return fa}}(),ca=function(){var qa=new THREE.Vector3,fa=new THREE.Vector3,va=new THREE.Vector3;return function(sa,
Fa){var Ta=E.cameraPlane;qa.set(0,0,-1);qa.transformDirection(Ta.matrixWorld);fa.set(-1,0,0);fa.transformDirection(Ta.matrixWorld);sa=Z(7,sa,Fa).normalize();va.copy(fa).cross(sa);return Math.sign(qa.dot(va))*Math.acos(fa.dot(sa))}}(),na=new THREE.Vector3;this.rotationSpeed=5;var Aa=function(){var qa=new THREE.Vector2(0,0),fa=new THREE.Quaternion,va=new THREE.Euler,sa=new THREE.Quaternion,Fa=new THREE.Quaternion,Ta=new THREE.Vector3,U=new THREE.Vector3,pa=new THREE.Vector3;return function(Da,wa){fa.setFromEuler(A.oldRotation);
fa.normalize();qa.set(Ba-Da,ma-wa);qa.multiplyScalar(A.rotationSpeed);if(0===R)return Da=E.cameraPlane,Ta.copy(p),Ta.transformDirection(Da.matrixWorld),U.set(0,1,0),U.transformDirection(Da.matrixWorld),Fa.setFromAxisAngle(Ta,qa.y),sa.setFromAxisAngle(U,-qa.x),sa.multiply(Fa),sa.multiply(fa),sa.normalize(),va.setFromQuaternion(sa,"ZXY"),va;if(7===R){var Ha=E.cameraPlane;pa.set(0,0,-1);pa.transformDirection(Ha.matrixWorld);Ha=pa;Da=ca(Da,wa);Da-=ka}else{4!==R&&qa.multiplyScalar((1===R?-1:1)*Math.sign((1===
R?r:p).dot(na)));a:{switch(R){case 1:Ha=p;break a;case 2:Ha=r;break a;case 4:Ha=q;break a}console.error("Unable to get direction for this value!");Ha=void 0}Da=4===R?-qa.x:qa.y}sa.setFromAxisAngle(Ha,Da);sa.multiply(fa);sa.normalize();va.setFromQuaternion(sa,"ZXY");return va}}(),Ca=function(){var qa={hoveredCollider:null,hasAnythingChanged:!1};return function(fa,va,sa){var Fa=oa===WALK.TRANSFORM_MODE.TRANSLATE?H:oa===WALK.TRANSFORM_MODE.ROTATE?G:O;fa=I.findMeshFromListAtPosition(Fa.colliders,fa,va,
!0);va=!1;if(fa!==aa||S!==sa)aa=fa,Fa.highlight(fa,sa),va=!0;qa.hoveredCollider=fa;qa.hasAnythingChanged=va;return qa}}();this.onCanvasPointerMove=function(qa,fa){if(this.transforming){if(this.mode===WALK.TRANSFORM_MODE.TRANSLATE){var va=Z(R,qa,fa);va&&this.newPosition.copy(va.sub(W).add(y.position));Ga.copy(this.newPosition);Ga.sub(y.position);Ga.divide(y.scale);K.update(Ga);if(qa!==Ba||fa!==ma)H.visible=!1,K.show(R),y.show(R)}else if(this.mode===WALK.TRANSFORM_MODE.ROTATE){if(y.show(R),this.newRotation.copy(Aa(qa,
fa)),qa!==Ba||fa!==ma)G.visible=!1}else{y.show(R);if(va=Z(R,qa,fa))va.addScalar(1).divide(la),this.newScale.copy(va);if(qa!==Ba||fa!==ma)O.visible=!1}Q.requestFrame();return!0}Ca(qa,fa,S).hasAnythingChanged&&Q.requestFrame();return!1};this.onCanvasPointerDown=function(qa,fa){var va=Ca(qa,fa,!0);S=!0;if(null!==va.hoveredCollider)return Y=!0,R=(oa===WALK.TRANSFORM_MODE.TRANSLATE?H:oa===WALK.TRANSFORM_MODE.ROTATE?G:O).usedAxes(va.hoveredCollider),Ba=qa,ma=fa,this.mode===WALK.TRANSFORM_MODE.TRANSLATE?
(E.show(R),this.newPosition.copy(this.oldPosition),W.copy(Z(R,qa,fa))):this.mode===WALK.TRANSFORM_MODE.ROTATE?7===R&&(this.newRotation.copy(this.oldRotation),ka=ca(qa,fa)):(E.show(7===R?0:R),this.newScale.copy(this.oldScale),qa=Z(R,qa,fa),la.copy(qa).addScalar(1).divide(this.oldScale)),!0;R=7;Y=!1;va.hasAnythingChanged&&Q.requestFrame();return!1};this.onCanvasPointerUp=function(qa,fa){if(this.transforming){T(this.newPosition);M(this.newRotation);var va=this.newScale;A.oldScale.copy(va);A.newScale.copy(va);
E.show(0);K.show(0);R=7;y.show(R);this.mode===WALK.TRANSFORM_MODE.TRANSLATE?H.visible=!0:this.mode===WALK.TRANSFORM_MODE.ROTATE?G.visible=!0:O.visible=!0}va=this.transforming;Y=!1;this.update();Ca(qa,fa,!1).hasAnythingChanged&&Q.requestFrame();S=!1;return va};this.update=function(){if(!this.transforming&&(void 0!==this.target.position&&T(this.target.position),void 0!==this.target.rotation&&M(this.target.rotation),void 0!==this.target.scale)){var qa=this.target.scale;A.oldScale.copy(qa);A.newScale.copy(qa)}na.copy(J);
na.sub(y.position);na.normalize();qa=.18*y.position.distanceTo(J)*D.camera.fov/90;y.scale.set(qa,qa,qa);E.scale.set(qa,qa,qa);K.scale.set(qa,qa,qa);H.scale.set(qa,qa,qa);G.scale.set(qa,qa,qa);O.scale.set(qa,qa,qa);G.update(D.camera);E.update(D.camera);y.update(J);y.updateMatrixWorld();E.updateMatrixWorld();K.updateMatrixWorld();H.updateMatrixWorld();G.updateMatrixWorld();O.updateMatrixWorld()}}})();(function(){WALK.SubTargetData=function(a,b){this.isSupported=function(c){return b[c]};this.offsetPosition=function(c){c=a.position.clone().add(c);a.setPosition(c.x,c.y,c.z)};this.offsetRotation=function(c){a.setRotation(a.rotation.z+c.z,a.rotation.x+c.x,a.rotation.y+c.y)};this.offsetScale=function(c){c=a.scale.clone().add(c);a.setScale(c.x,c.y,c.z)};Object.defineProperty(this,"target",{get:function(){return a}})};WALK.TransformControls=function(a,b,c,d,e){function f(){}function g(m){e.isEnabled()!==
m&&(m?e.enable():e.disable())}var h=this,k=!1,q=new WALK.TransformGizmo(c,d,e.cameraWorldPosition(),b);q.mode=WALK.TRANSFORM_MODE.TRANSLATE;var p={itemModified:f},r=[];Object.defineProperty(this,"supportedModes",{get:function(){return r}});Object.defineProperty(this,"mode",{get:function(){return q.mode}});this.setItemModifiedCallback=function(m){console.assert(p.itemModified===f);p.itemModified=m};var n=new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.TRANSFORM_CONTROLS);n.callbacks.onPointerDown=
function(m,l){m=q.onCanvasPointerDown(m,l);g(!q.transforming);return m};n.callbacks.onPointerUp=function(m,l){m=q.onCanvasPointerUp(m,l);g(!q.transforming);return m};n.callbacks.onPointerMove=function(m,l){m=q.onCanvasPointerMove(m,l);if(q.transforming)if(q.mode===WALK.TRANSFORM_MODE.TRANSLATE){l=q.newPosition;var u=l.clone().sub(h.target.position);h.target.setPosition(l.x,l.y,l.z);p.itemModified(h.target);h.subTargetsData&&h.subTargetsData.forEach(function(B){B.isSupported(q.mode)&&(B.offsetPosition(u),
p.itemModified(B.target))})}else if(q.mode===WALK.TRANSFORM_MODE.ROTATE){l=q.newRotation;var v={x:l.x-h.target.rotation.x,y:l.y-h.target.rotation.y,z:l.z-h.target.rotation.z};h.target.setRotation(h.target.rotation.z+v.z,h.target.rotation.x+v.x,h.target.rotation.y+v.y);p.itemModified(h.target);h.subTargetsData&&h.subTargetsData.forEach(function(B){B.isSupported(q.mode)&&(B.offsetRotation(v),p.itemModified(B.target))})}else{l=q.newScale;var t=l.clone().sub(h.target.scale);h.target.setScale(l.x,l.y,
l.z);p.itemModified(h.target);h.subTargetsData&&h.subTargetsData.forEach(function(B){B.isSupported(q.mode)&&(B.offsetScale(t),p.itemModified(B.target))})}return m};n.disable();Object.defineProperty(this,"target",{get:function(){return q.target}});Object.defineProperty(this,"subTargetsData",{get:function(){return q.subTargetsData}});this.setTransformMode=function(m){q.mode=m};this.update=function(){k&&q.update()};this.enable=function(m,l,u){k=!0;q.target=m;q.subTargetsData=u;null!==m&&(q.update(),
q.visible=!0);r=l;-1===l.indexOf(q.mode)&&(q.mode=l[0]);n.enable()};this.disable=function(){k=!1;r=[];q.visible=!1;n.disable()}}})();(function(){var a=function(b,c){this._nodesPrimary=b;this._nodesSecondary=c};a.prototype.constructor=a;Object.defineProperty(a.prototype,"highlightMix",{set:function(b){this._nodesPrimary.forEach(function(c){c.highlightMix=b});this._nodesSecondary.forEach(function(c){c.highlightMix=b})}});Object.defineProperty(a.prototype,"selected",{set:function(b){this._nodesPrimary.forEach(function(c){c.selected=b});this._nodesSecondary.forEach(function(c){c.selectedSecondary=b})}});WALK.EditorSelector=function(b,
c,d,e,f,g,h,k,q){function p(){}function r(){B.highlightMix=.8*Math.pow(D/t.selectionTimeSec,2)}function n(G){null!==B&&(B.highlightMix=0);null!==G&&(B=G,D=t.selectionTimeSec,r());k.requestFrame()}function m(G){var O=G.geometry;O&&void 0===O.getAttribute("order")&&G.visible&&(G.visible=!1,H.push(G))}function l(){for(var G=$jscomp.makeIterator(H),O=G.next();!O.done;O=G.next())O.value.visible=!0}function u(){z.set(!0,!1,!1);A.set(y);c.gpuMeshes.forEach(function(G){G.geometry.addTriangleOrderAttribute();
G.highlightMix=0;G.selected=!1;d.uploadNewBuffers(G)});H.length=0;c.threeScene.traverse(m);c.threeScene.overrideMaterial=E;c.skyMeshes.forEach(function(G){G.visible=!1})}function v(){z.restore();A.restore();l();c.threeScene.overrideMaterial=null;c.gpuMeshes.forEach(function(G){G.highlightMix=null;G.selected=null;G.selectedSecondary=!1});I=null;c.skyMeshes.forEach(function(G){G.visible=!0})}var t=this,B=null,D=0,I=null,J=0,Q=new WALK.RayIntersection,T=new WALK.TransformControls(b,k,c,e,q),M={materialClicked:p,
lightInstanceClicked:p,lightProbeClicked:p,nodeClicked:p,extensionClicked:p,positionClicked:p},z=new WALK.AutoClearAlter(d),A=new WALK.ClearColorAlter(d),y=new THREE.Color(16777215),E=new WALK.WireframeMaterial(new THREE.Color(0));E.highlight=E.meshSelectedLineColor;var K;this.selectionTimeSec=1;this.selectMaterial=function(G){console.assert(K===WALK.EditorSelector.SELECTION_MODE.MATERIAL);n(G)};this.selectLights=function(G,O){console.assert(K===WALK.EditorSelector.SELECTION_MODE.LIGHT);f.showSelectionMesh(G,
O);k.requestFrame()};this.selectLightInstances=function(G,O,Y){function W(la){return la.map(function(oa){var ra=WALK.SubTargetData,Ba=[];switch(oa.light.type){case "point":Ba[WALK.TRANSFORM_MODE.TRANSLATE]=!0;break;case "sun":Ba[WALK.TRANSFORM_MODE.ROTATE]=!0;break;default:Ba[WALK.TRANSFORM_MODE.TRANSLATE]=!0,Ba[WALK.TRANSFORM_MODE.ROTATE]=!0}return new ra(oa,Ba)})}f.showInstancesSelectionMesh(G,O);console.assert(K===WALK.EditorSelector.SELECTION_MODE.LIGHT);if(G){var ka=G.light.type;T.enable(G,"point"===
ka?[WALK.TRANSFORM_MODE.TRANSLATE]:"sun"===ka?[WALK.TRANSFORM_MODE.ROTATE]:[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE],W(O))}else T.disable();Y?(G=f.getLightInstanceMaterial(Y),n(G)):k.requestFrame()};this.selectLightProbe=function(G){var O=null;console.assert(K===WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE);G?(g.showLightProbeBoundingBox(G),O=g.getLightProbeMaterial(G),T.enable(G,[WALK.TRANSFORM_MODE.TRANSLATE])):T.disable();n(O)};this.selectEditorCameraVolume=function(G){console.assert(K===
WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME);G?(n(h.setHighlightedCameraVolume(G)),T.enable(G,[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE,WALK.TRANSFORM_MODE.SCALE])):(n(null),T.disable())};this.selectExtension=function(G){var O=null;console.assert(K===WALK.EditorSelector.SELECTION_MODE.EXTENSION);G&&0<G.triggers.length&&(G=G.triggers[0].mesh)&&(O=G.material);n(O)};this.selectNodes=function(G,O,Y,W,ka){console.assert(K===WALK.EditorSelector.SELECTION_MODE.NODE);I&&(I.selected=!1);
G||O.length?(G=[G].concat(Y),O=O.concat(W),I=new a(G,O),I.selected=!0):I=null;ka&&(ka=new a([ka],ka.config.nodes),n(ka))};this.update=function(G){T.update();null!==B&&(D-=G,0<D?r():(B.highlightMix=0,B=null),k.requestFrame())};var H=[];this.setDistanceToObject=function(G){J=G};this.setSelectionMode=function(G){if(G!==K){K===WALK.EditorSelector.SELECTION_MODE.NODE&&v();K===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&h.setControlsVisible(!1);switch(G){case WALK.EditorSelector.SELECTION_MODE.OFF:case WALK.EditorSelector.SELECTION_MODE.MATERIAL:case WALK.EditorSelector.SELECTION_MODE.EXTENSION:case WALK.EditorSelector.SELECTION_MODE.POSITION:case WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME:f.hideLights();
g.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT:f.showLights();g.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:f.hideLights();g.showLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.NODE:f.hideLights(),g.hideLightProbes(),u()}G===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&h.setControlsVisible(!0);T.disable();if(G===WALK.EditorSelector.SELECTION_MODE.MATERIAL||G===WALK.EditorSelector.SELECTION_MODE.EXTENSION)for(var O=$jscomp.makeIterator(c.getAnimatedMaterials()),
Y=O.next();!Y.done;Y=O.next())Y.value.play();else for(O=$jscomp.makeIterator(c.getAnimatedMaterials()),Y=O.next();!Y.done;Y=O.next())Y.value.pause();K=G}};this.setMaterialClickedCallback=function(G){console.assert(M.materialClicked===p);M.materialClicked=G};this.setLightInstanceClickedCallback=function(G){console.assert(M.lightInstanceClicked===p);M.lightInstanceClicked=G};this.setLightProbeClickedCallback=function(G){console.assert(M.lightProbeClicked===p);M.lightProbeClicked=G};this.setNodeClickedCallback=
function(G){console.assert(M.nodeClicked===p);M.nodeClicked=G};this.setExtensionClickedCallback=function(G){console.assert(M.extensionClicked===p);M.extensionClicked=G};this.setPositionClickedCallback=function(G){console.assert(M.positionClicked===p);M.positionClicked=G};(function(){var G=new WALK.PointerEventHelper(b,WALK.POINTER_PRIORITY.EDITOR_SELECTOR);G.callbacks.onClick=function(O,Y,W){if(K===WALK.EditorSelector.SELECTION_MODE.OFF)return!1;var ka=!1;switch(K){case WALK.EditorSelector.SELECTION_MODE.MATERIAL:O=
e.findObstacleMeshAtPosition(O,Y,!1);O=null!==O?O.material:null;null!==O&&(ka=M.materialClicked(O,W));break;case WALK.EditorSelector.SELECTION_MODE.LIGHT:O=e.findMeshFromListAtPosition(f.lightInstanceMeshes,O,Y);O=null!==O?O.userData.lightInstance:null;null!==O&&(ka=M.lightInstanceClicked(O,W));break;case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:O=e.findMeshFromListAtPosition(g.lightProbeMeshes,O,Y);O=null!==O?O.lightProbe:null;null!==O&&(ka=M.lightProbeClicked(O,W));break;case WALK.EditorSelector.SELECTION_MODE.NODE:O=
e.findObstacleMeshAtPosition(O,Y,!1);(O=null!==O?O.node:null)&&(ka=M.nodeClicked(O,W));break;case WALK.EditorSelector.SELECTION_MODE.EXTENSION:O=e.findIntersectionAtPosition(O,Y,!1,Q)?Q.object.anchor||null:null;O&&O.extension&&(ka=M.extensionClicked(O.extension,O,W));break;case WALK.EditorSelector.SELECTION_MODE.POSITION:O=e.findIntersectionAtPosition(O,Y,!1,Q)&&!Q.object.anchor?e.movePointTowardsTheCamera(Q.point,J):null,O&&(ka=M.positionClicked(O,W))}return ka};G.callbacks.onDoubleClick=function(O,
Y){return!1}})();Object.defineProperty(this,"transformControls",{get:function(){return T}});this.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};WALK.EditorSelector.SELECTION_MODE={OFF:0,MATERIAL:1,LIGHT:2,LIGHT_PROBE:3,NODE:4,EXTENSION:6,POSITION:7,CAMERA_VOLUME:8}})();(function(){function a(){WALK.BaseMaterial.call(this,WALK.getShader("static_render_vertex.glsl"),WALK.getShader("static_render_fragment.glsl"));this.uniforms={staticRender:{type:"t",value:null},sizeInv:{type:"v2",value:new THREE.Vector2}}}function b(c){c=WALK.createRenderer(c,{antialias:!1});c.autoClear=!1;c.autoUpdateObjects=!1;c.sortObjects=!1;return c}a.prototype=Object.create(WALK.BaseMaterial.prototype);a.prototype.constructor=a;WALK.StaticRenderViewer=function(c){var d=b(c),e=new a,f=new THREE.OrthographicCamera(-1,
1,1,-1,0,1),g=new THREE.Scene;c=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),e);d.uploadNewBuffers(c);g.add(c);this.update=function(h){var k=new Float32Array(h,0,h.byteLength/4);h=k[0];var q=k[1];k=k.subarray(2);console.assert(h*q===k.length/3);k=new WALK.DataTexture(k,h,q,GLC.RGB,GLC.FLOAT);k.minFilter=GLC.NEAREST;k.magFilter=GLC.NEAREST;k.generateMipmaps=!1;k.flipY=!1;k.needsUpdate=!0;e.uniforms.staticRender.value=k;e.uniforms.sizeInv.value.set(1/h,1/q);d.setCanvasSize(h,q);d.render(g,f);k.dispose()}}})();(function(){WALK.VRManager=function(a,b,c,d,e,f,g){function h(){return WALK.DETECTOR.ios&&void 0!==DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&void 0!==DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?new Promise(function(T,M){Promise.all([DeviceMotionEvent.requestPermission(),DeviceOrientationEvent.requestPermission()]).then(function(z){"granted"===z[0]&&"granted"===z[1]?T():M()},function(){M()})}):Promise.resolve()}function k(){n=
null;I.dispose();l=m=v=I=null;b.removeAllXrGamepads();g(!1);if(D){var T=D;D=null;T()}}function q(T){for(var M=$jscomp.makeIterator(T.removed),z=M.next();!z.done;z=M.next())z=z.value,z.gamepad&&b.removeXrGamepad(z.gamepad);T=$jscomp.makeIterator(T.added);for(z=T.next();!z.done;z=T.next())M=z.value,M.gamepad&&b.addXrGamepad(M.gamepad,M.handedness)}var p=navigator.xr,r=c?!c.nativeWebXR:!1,n,m,l,u=!1,v,t,B,D=null,I,J=new THREE.Matrix4,Q=WALK.CAMERA_MIN_FAR;this.setCameraFar=function(T){Q=T;n&&(v.depthFar=
Q,n.updateRenderState(v))};this.render=function(T,M,z){B.set(!1,!0,!1);t.matrixWorld=M;M=t.projectionMatrix;for(var A=l.views,y=0;y<A.length;++y){var E=A[y];J.fromArray(E.transform.inverse.matrix);M.fromArray(l.transform.matrix);J.multiply(M);M.fromArray(E.projectionMatrix);M.multiply(J);z(t);a.enableScissorTest(!0);E=v.baseLayer.getViewport(E);a.setScissor(E.x,E.y,E.width,E.height);I.x=E.x;I.y=E.y;I.width=E.width;I.height=E.height;a.render(T,t,I);a.enableScissorTest(!1)}B.restore()};this.enableVr=
function(T){p?u?(f(!0),h().then(function(){return T.makeXRCompatible().then(function(){return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"]})}).then(function(M){n=M;return n.requestReferenceSpace("local-floor")}).then(function(M){m=M;M=new XRWebGLLayer(n,T);I=a.createFrameBufferRenderTarget(M.framebuffer);v={baseLayer:M};t||(t=new THREE.PerspectiveCamera,B=new WALK.AutoClearAlter(a));v.depthNear=WALK.CAMERA_WALK_NEAR;v.depthFar=Q;n.updateRenderState(v);n.addEventListener("end",
k);r||n.addEventListener("inputsourceschange",q);f(!1);g(!0)}).catch(function(){f(!1);WALK.USER_MSG.info("Failed to enable VR mode")})}).catch(function(){f(!1);WALK.USER_MSG.info("Permissions necessary for VR mode not granted")})):WALK.USER_MSG.info("VR device not connected"):WALK.USER_MSG.info('You need a <a href="https://mozvr.com/#start" target="_blank">VR ready browser</a>.')};this.disableVr=function(){n.end().then(function(){WALK.USER_MSG.hideInfo()},function(){WALK.USER_MSG.info("Failed to exit VR mode")})};
this.vrEnabled=function(){return!!m};this.requestAnimationFrame=function(){function T(M,z){l=z.getViewerPose(m);D&&(z=D,D=null,z(M))}return function(M){D=M;n.requestAnimationFrame(T)}}();this.update=function(){var T=new WALK.Euler,M=new THREE.Vector3;return function(){if(l){var z=l.transform;if(null!==z.orientation){T.setFromQuaternion(z.orientation,"YXZ");var A=T.y;T.y=-T.z;T.z=A;z=z.position;e(T,z&&M.set(z.x,-z.z,z.y,z.w))}}}}();(WALK.DETECTOR.https||WALK.DETECTOR.localhost)&&p?(c=function(){navigator.xr.isSessionSupported("immersive-vr").then(function(T){u=
T;d(T)})},c(),navigator.xr.addEventListener("devicechange",c,!1)):d(!1)}})();(function(){WALK.RaycasterConfig=function(a,b,c){this.ray=new THREE.Ray(a,b);this.far=c||Infinity;this.ignoreVisibility=this.onlyGroundCollisions=this.respectColliderSettings=!1};WALK.RayIntersection=function(){this.distance=Infinity;this.point=new THREE.Vector3;this.object=null};WALK.GpuRaycaster=function(a,b){function c(r,n){if(!n.ignoreVisibility&&!r.visible)return!1;var m=r.node||p;if(m.disableCollisions&&n.respectColliderSettings||!m.ground&&n.onlyGroundCollisions)return!1;m=n.ray;if(r.matrixWorld)return!0;
var l=r.geometry.boundingSphere;if(l.distanceToPoint(m.origin)>n.far||!1===m.isIntersectionSphere(l))return!1;r=r.geometry.boundingBox;return r.distanceToPoint(m.origin)>n.far||!m.isIntersectionBox(r)?!1:!0}var d=a.createRenderTarget(1,1,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),e=new Uint8Array(4),f=new WALK.AutoClearAlter(a),g=new WALK.ClearColorAlter(a),h=new THREE.Color(16777215),k=new WALK.ObjectDistanceMaterial(!1),q=new THREE.PerspectiveCamera(1,
1,b.near,b.far),p={disableCollisions:!1,ground:!1};this.closestIntersection=function(r,n,m){for(var l=[],u=0;u<r.length;u+=1){var v=r[u];console.assert(null===v.visibilityId);c(v,n)&&(v.visibilityId=l.length,l.push(v))}if(0===l.length)return!1;q.position.set(0,0,0);q.lookAt(n.ray.direction);q.position.copy(n.ray.origin);q.updateMatrixWorld();f.set(!0,!0,!1);g.set(h);r=a.sortObjects;a.sortObjects=!1;a.renderMeshes(l,k,q,d,!1,n.ignoreVisibility);a.sortObjects=r;g.restore();f.restore();a.readPixels(1,
1,e);a.setRenderTarget(null);r=256*e[0]+e[1];u=e[2]+e[3]/255;for(v=0;v<l.length;v+=1)l[v].visibilityId=null;if(65535===r||u>n.far)return!1;console.assert(r<l.length);m.object=l[r];m.distance=u;m.point.copy(n.ray.direction).multiplyScalar(u).add(n.ray.origin);return!0}}})();(function(){WALK.movePointTowards=function(){var a=new THREE.Vector3;return function(b,c,d){a.copy(b);a.sub(c).normalize();a.multiplyScalar(d);return b.sub(a)}}();WALK.Collider=function(a,b,c){var d=this,e=new THREE.Octree({scene:null,depthMax:Infinity,objectsThreshold:8,overlapPct:.15}),f=c.cameraWorldPosition(),g=b.camera,h=[];this.addStaticObstacle=function(r,n,m){e.add(r,n,m)};this.addDynamicObstacle=function(r){h.push(r)};this.removeDynamicObstacle=function(r){WALK.removeFromArray(r,h)};var k=
function(){var r=new WALK.GpuRaycaster(a,g);return function(n,m){for(var l=e.search(n.ray.origin,n.far,n.ray.direction),u=0;u<h.length;u+=1)l.push(h[u]);return r.closestIntersection(l,n,m)?!0:!1}}(),q=function(){var r=new WALK.RayIntersection;return function(n){return k(n,r)?r.distance:Infinity}}(),p=function(){var r=new WALK.RaycasterConfig;r.ray.direction.set(0,0,-1);r.respectColliderSettings=!0;r.onlyGroundCollisions=g.autoClimb;return function(n,m){r.ray.origin.copy(n);r.far=m;n=q(r);return g.autoClimb||
1<=n?n:Infinity}}();this.distanceToGround=function(r){return p(f,r)};this.findIntersectionBelow=function(){var r=new WALK.RaycasterConfig;r.ray.direction.set(0,0,-1);r.respectColliderSettings=!1;return function(n,m,l){r.ray.origin.copy(n);r.far=m;return k(r,l)}}();this.distanceToCeiling=function(){var r=new WALK.RaycasterConfig(f);r.ray.direction.set(0,0,1);r.respectColliderSettings=!0;return function(n){r.far=n;return q(r)}}();this.distanceToCeilingFrom=function(){var r=new WALK.RaycasterConfig;
r.ray.direction.set(0,0,1);r.respectColliderSettings=!0;return function(n,m){r.ray.origin.copy(n);r.far=m;return q(r)}}();this.cameraHeightFromPoint=function(r){r=p(r,WALK.MAX_GROUND_SEARCH_DEPTH);return Infinity===r?null:r};this.adjustPointToMatchCameraHeight=function(r){var n=g.fixedHeight||WALK.CAMERA_FIXED_HEIGHT||c.cameraHeight;if(null===n)return!1;var m=p(r,WALK.MAX_GROUND_SEARCH_DEPTH);if(Infinity===m)return!1;n-=m;if(.01>Math.abs(n)||0<n&&Infinity!==this.distanceToCeilingFrom(r,n+WALK.MIN_DISTANCE_TO_CEILING))return!1;
r.z+=n;return!0};this.findIntersectionAtPosition=function(){var r=new WALK.RaycasterConfig(f),n=r.ray.direction;return function(m,l,u,v){n.set(m,l,1).unproject(c.camera());n.sub(f).normalize();r.respectColliderSettings=u;return k(r,v)}}();this.findObstacleMeshAtPosition=function(){var r=new WALK.RayIntersection;return function(n,m,l){return this.findIntersectionAtPosition(n,m,l,r)?r.object:null}}();this.findMeshFromListAtPosition=function(){var r=new WALK.RaycasterConfig(f),n=new WALK.RayIntersection,
m=new WALK.GpuRaycaster(a,g),l=r.ray.direction;return function(u,v,t,B,D){r.ignoreVisibility=void 0===B?!1:B;B=void 0===D?n:D;l.set(v,t,1).unproject(g);l.sub(f).normalize();return m.closestIntersection(u,r,B)?B.object:null}}();this.clickedPointToMoveTarget=function(){function r(t){var B=m.x-v.x;var D=m.y-v.y;B=Math.sqrt(B*B+D*D);n.far=B+WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE;l.x=v.x-m.x;l.y=v.y-m.y;if(!(.01>Math.abs(l.x)&&.01>Math.abs(l.y)))if(l.z=0,l.normalize(),k(n,u)){if(D=u.distance-WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE,
0<D&&(t.x=m.x+l.x*D,t.y=m.y+l.y*D,t.z=m.z),D=Math.min(u.distance-.01,B),m.x+=l.x*D,m.y+=l.y*D,d.adjustPointToMatchCameraHeight(m))return r(t)}else t.x=v.x,t.y=v.y,t.z=m.z}var n=new WALK.RaycasterConfig;n.respectColliderSettings=!0;var m=n.ray.origin,l=n.ray.direction,u=new WALK.RayIntersection,v=new THREE.Vector3;return function(t){m.copy(f);v.copy(t);t.copy(f);r(t);d.adjustPointToMatchCameraHeight(t)}}();this.movePointTowardsTheCamera=function(r,n){return WALK.movePointTowards(r,f,n)};this.handleCollisions=
function(){function r(t){c.applyCameraYaw(m);m.normalize();var B=l.start.distanceTo(f),D=l.end.distanceTo(f);if(v-.02<B+D&&B+D<v+.02&&D>=t&&u.equals(m))return!1;B=q(n);Infinity===B&&(B=n.far);u.copy(m);l.start.copy(f);l.end.copy(m).multiplyScalar(B).add(f);v=l.distance();return B<t}var n=new WALK.RaycasterConfig(f),m=n.ray.direction,l=new THREE.Line3,u=new THREE.Vector3,v=0;n.respectColliderSettings=!0;n.far=5;console.assert(n.far>WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE);return function(t){t=c.maxFrameMoveLinearDistance(t)+
WALK.KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE;c.movesForward()&&(m.set(0,1,0),r(t)&&c.stopForward());c.movesBackward()&&(m.set(0,-1,0),r(t)&&c.stopBackward());c.movesLeft()&&(m.set(-1,0,0),r(t)&&c.stopLeft());c.movesRight()&&(m.set(1,0,0),r(t)&&c.stopRight());c.movesDown()&&(m.set(0,0,-1),r(t)&&c.stopDown());c.movesUp()&&(m.set(0,0,1),r(t)&&c.stopUp())}}()}})();(function(){WALK.OrbitControls=function(a,b,c,d){function e(S,R){m.collider&&m.mouseZoomToPointer&&m.collider.findIntersectionAtPosition(S/window.innerWidth*2-1,2*-(R/window.innerHeight)+1,!0,u)?A.copy(u.point):A.copy(m.target)}function f(){var S=b.getYawAngle(),R=b.getPitchAngle(),Z=b.cameraWorldPosition();m.autoRotate&&Ga===ma.NONE&&m.rotateLeft(2*Math.PI/60/60*m.autoRotateSpeed);var ca=m.getMinYawAngle(),na=m.getMaxYawAngle();Math.abs(na-ca)>=2*Math.PI-1E-6?S+=H:ca===na?S=ca:(ca>na&&(na+=2*Math.PI,
S<ca&&(S+=2*Math.PI)),S=0>H?Math.min(Math.max(S+H,ca),na):Math.max(Math.min(S+H,na),ca));R=THREE.Math.clamp(R+G,m.getMinPitchAngle(),m.getMaxPitchAngle());y.copy(m.target).sub(Z);na=y.length();ca=THREE.Math.clamp(na*O,m.getMinDistance(),m.getMaxDistance());na=ca/na;E.copy(A).sub(Z);K.copy(A).sub(m.target).multiplyScalar(1-na);m.target.add(K);m.target.add(Y);WALK.OrbitControls.computeCameraPosition(Z,m.target,S,R,ca);b.cameraPositionUpdated();b.setYawAngle(S);b.setPitchAngle(R);S=WALK.OrbitControls.computeCameraNear(ca);
1E-6<Math.abs(S-a.near)&&(a.near=S,a.updateProjectionMatrix());G=H=0;O=1;Y.set(0,0,0);d.requestFrame()}function g(){ra=Ba=la=oa=ka=0;aa&&(aa(),aa=!1)}function h(S){if(!1!==l){S.preventDefault();var R=c===document?c.body:c;if(Ga===ma.ROTATE){if(!0===m.noRotate)return;t.set(S.clientX,S.clientY);B.subVectors(t,v);m.rotateLeft(B.x/R.clientWidth*m.mouseRotateSpeed);!1===m.noPitchRotate&&m.rotateUp(B.y/R.clientHeight*m.mouseRotateSpeed);v.copy(t)}else if(Ga===ma.DOLLY){if(!0===m.noZoom)return;M.set(S.clientX,
S.clientY);z.subVectors(M,T);0<z.y?m.dollyIn():0>z.y&&m.dollyOut();T.copy(M)}else if(Ga===ma.PAN){if(!0===m.noPan)return;I.set(S.clientX,S.clientY);J.subVectors(I,D);m.pan(J.x/R.clientHeight,J.y/R.clientWidth);D.copy(I)}Ga!==ma.NONE&&f()}}function k(){!1!==l&&aa&&(aa(),aa=!1)}function q(S){if(!1!==l&&!0!==m.noZoom&&Ga===ma.NONE){S.preventDefault();var R=0;void 0!==S.wheelDelta?R=S.wheelDelta:void 0!==S.detail&&(R=-S.detail);e(S.clientX,S.clientY);0<R?m.dollyOut():0>R&&m.dollyIn();f()}}function p(S,
R,Z){return!0===Z?R:S===R?0:S}function r(S,R){var Z=!1,ca=S.keyCode;if(!1!==l){if(!0===W&&!1===m.noPan)if(38===ca||87===ca)Ba=p(Ba,1,R),Z=!0;else if(40===ca||83===ca)Ba=p(Ba,-1,R),Z=!0;else if(37===ca||65===ca)ra=p(ra,1,R),Z=!0;else{if(39===ca||68===ca)ra=p(ra,-1,R),Z=!0}else if(!1===W&&!1===m.noRotate)if((38===ca||87===ca)&&!1===m.noPitchRotate)oa=p(oa,1,R),Z=!0;else if((40===ca||83===ca)&&!1===m.noPitchRotate)oa=p(oa,-1,R),Z=!0;else if(37===ca||65===ca)la=p(la,1,R),Z=!0;else if(39===ca||68===ca)la=
p(la,-1,R),Z=!0;switch(ca){case m.dollyKeys.IN1:case m.dollyKeys.IN2:case m.dollyKeys.IN3:!1===m.noZoom&&(ka=p(ka,1,R),Z=!0);break;case m.dollyKeys.OUT1:case m.dollyKeys.OUT2:case m.dollyKeys.OUT3:!1===m.noZoom&&(ka=p(ka,-1,R),Z=!0)}Z&&(S.preventDefault(),d.requestFrame())}}function n(S){return m.noPan?!1:W&&1===S.length?!0:W||2!==S.length?!1:Math.abs(S[0].clientY-S[1].clientY)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}this.collider=null;this.target=new THREE.Vector3;this.noZoom=!1;this.mouseZoomToPointer=
!0;this.mouseZoomSpeed=.97;this.keyZoomSpeed=.7;this.minZoom=0;this.maxZoom=Infinity;this.noPitchRotate=this.noRotate=!1;this.mouseRotateSpeed=2*Math.PI;this.keyYawRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED;this.keyPitchRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED/2;this.autoRotate=!1;this.autoRotateSpeed=2;this.getMinPitchAngle=function(){return-Math.PI/2};this.getMaxPitchAngle=function(){return Math.PI/2};this.getMinYawAngle=function(){return-Math.PI};this.getMaxYawAngle=function(){return Math.PI};
this.getMinDistance=function(){return 0};this.getMaxDistance=function(){return Infinity};this.noPan=!1;this.keyPanSpeed=.25;this.dollyKeys={IN1:61,IN2:187,IN3:69,OUT1:173,OUT2:189,OUT3:81};this.primaryMouseButton=THREE.MOUSE.LEFT;this.secondaryMouseButton=THREE.MOUSE.RIGHT;this.mouseButtons={ROTATE:this.primaryMouseButton,ZOOM:THREE.MOUSE.MIDDLE,PAN:this.secondaryMouseButton};var m=this,l=!1,u=new WALK.RayIntersection,v=new THREE.Vector2,t=new THREE.Vector2,B=new THREE.Vector2,D=new THREE.Vector2,
I=new THREE.Vector2,J=new THREE.Vector2,Q=new THREE.Vector3,T=new THREE.Vector2,M=new THREE.Vector2,z=new THREE.Vector2,A=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector3,K=new THREE.Vector3,H=0,G=0,O=1,Y=new THREE.Vector3,W=!1,ka=0,la=0,oa=0,ra=0,Ba=0,ma={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},Ga=ma.NONE,aa=!1;this.enable=function(){l=!0;f()};this.disable=function(){l=!1;g()};this.isEnabled=function(){return l};this.setPanPrimary=function(S){W=S;!0===W?
(this.mouseButtons.PAN=this.primaryMouseButton,this.mouseButtons.ROTATE=this.secondaryMouseButton):(this.mouseButtons.ROTATE=this.primaryMouseButton,this.mouseButtons.PAN=this.secondaryMouseButton)};this.getCameraDistance=function(){var S=new THREE.Vector3;return function(){S.copy(b.cameraWorldPosition()).sub(this.target);return S.length()}}();this.rotateLeft=function(S){void 0===S&&(S=2*Math.PI/60/60*m.autoRotateSpeed);H-=S};this.rotateUp=function(S){void 0===S&&(S=2*Math.PI/60/60*m.autoRotateSpeed);
G-=S};this.panLeft=function(S){var R=a.matrixWorld.elements;Q.set(R[0],R[1],R[2]);Q.multiplyScalar(-S);Y.add(Q)};this.panUp=function(S){var R=a.matrixWorld.elements;Q.set(R[4],R[5],R[6]);Q.multiplyScalar(S);Y.add(Q)};this.pan=function(S,R){if(a instanceof THREE.PerspectiveCamera){var Z=b.cameraWorldPosition().clone().sub(m.target).length();Z*=Math.tan(a.fov/2*Math.PI/180);m.panLeft(2*S*Z);m.panUp(2*R*Z)}else a instanceof THREE.OrthographicCamera&&(m.panLeft(S*(a.right-a.left)),m.panUp(R*(a.top-a.bottom)))};
this.dollyIn=function(S){void 0===S&&(S=this.mouseZoomSpeed);a instanceof THREE.PerspectiveCamera?O/=S:a instanceof THREE.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom*S)),a.updateProjectionMatrix())};this.dollyOut=function(S){void 0===S&&(S=this.mouseZoomSpeed);a instanceof THREE.PerspectiveCamera?O*=S:a instanceof THREE.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom/S)),a.updateProjectionMatrix())};this.update=function(S){if(l&&S){var R=
!1;0!==la&&(m.rotateLeft(la*m.keyYawRotateSpeed*S),R=!0);0!==oa&&(m.rotateUp(oa*m.keyPitchRotateSpeed*S),R=!0);if(0!==ra||0!==Ba)m.pan(ra*m.keyPanSpeed*S,Ba*m.keyPanSpeed*S),R=!0;0!==ka&&(S=Math.pow(m.keyZoomSpeed,S),-1===ka?m.dollyIn(S):m.dollyOut(S),R=!0);R&&f()}};c.addEventListener("mousedown",function(S){if(!1!==l){c.focus();S.preventDefault();if(S.button===m.mouseButtons.ROTATE){if(!0===m.noRotate)return;Ga=ma.ROTATE;v.set(S.clientX,S.clientY)}else if(S.button===m.mouseButtons.ZOOM){if(!0===
m.noZoom)return;Ga=ma.DOLLY;T.set(S.clientX,S.clientY);e(S.clientX,S.clientY)}else if(S.button===m.mouseButtons.PAN){if(!0===m.noPan)return;Ga=ma.PAN;D.set(S.clientX,S.clientY)}Ga!==ma.NONE&&(document.addEventListener("mousemove",h,!1),document.addEventListener("mouseup",k,!1),aa=function(){document.removeEventListener("mousemove",h,!1);document.removeEventListener("mouseup",k,!1);Ga=ma.NONE})}},!1);c.addEventListener("mousewheel",q,!1);c.addEventListener("DOMMouseScroll",q,!1);c.addEventListener("touchstart",
function(S){if(!1!==l){var R=S.touches.length;S.preventDefault();if(n(S.touches))Ga=ma.TOUCH_PAN,D.set(S.touches[0].clientX,S.touches[0].clientY);else if(m.noRotate||W||1!==R)if(m.noZoom||2!==R)Ga=ma.NONE;else{Ga=ma.TOUCH_DOLLY;R=S.touches[0].clientX-S.touches[1].clientX;var Z=S.touches[0].clientY-S.touches[1].clientY;T.set(0,Math.sqrt(R*R+Z*Z));e(S.touches[0].clientX-R/2,S.touches[0].clientY-Z/2)}else Ga=ma.TOUCH_ROTATE,v.set(S.touches[0].clientX,S.touches[0].clientY)}},!1);c.addEventListener("touchend",
function(){!1!==l&&(Ga=ma.NONE)},!1);c.addEventListener("touchmove",function(S){if(!1!==l){var R=S.touches.length;S.preventDefault();var Z=c===document?c.body:c;n(S.touches)&&Ga===ma.TOUCH_PAN?(I.set(S.touches[0].clientX,S.touches[0].clientY),J.subVectors(I,D),m.pan(J.x/Z.clientHeight,J.y/Z.clientWidth),D.copy(I),f()):m.noRotate||W||1!==R||Ga!==ma.TOUCH_ROTATE?m.noZoom||2!==R||Ga!==ma.TOUCH_DOLLY?Ga=ma.NONE:(R=S.touches[0].clientX-S.touches[1].clientX,S=S.touches[0].clientY-S.touches[1].clientY,M.set(0,
Math.sqrt(R*R+S*S)),z.subVectors(M,T),0<z.y?m.dollyOut():0>z.y&&m.dollyIn(),T.copy(M),f()):(t.set(S.touches[0].clientX,S.touches[0].clientY),B.subVectors(t,v),m.rotateLeft(B.x/Z.clientWidth*m.mouseRotateSpeed),m.rotateUp(B.y/Z.clientHeight*m.mouseRotateSpeed),v.copy(t),f())}},!1);c.addEventListener("blur",function(S){g()},!1);c.addEventListener("keydown",function(S){WALK.isModifierPressed(S)||r(S,!0)},!1);c.addEventListener("keyup",function(S){r(S,!1)},!1);a instanceof THREE.PerspectiveCamera||a instanceof
THREE.OrthographicCamera||console.warn("WARNING: OrbitControls.js requires perspective or orthographic camers")};WALK.OrbitControls.prototype.constructor=WALK.OrbitControls;WALK.OrbitControls.computeCameraPosition=function(){var a=new THREE.Vector3;return function(b,c,d,e,f){d-=Math.PI/2;e+=Math.PI/2;a.x=f*Math.sin(e)*Math.cos(d);a.y=f*Math.sin(e)*Math.sin(d);a.z=f*Math.cos(e);b.copy(c).add(a)}}();WALK.OrbitControls.computeCameraNear=function(a){return a*WALK.CAMERA_ORBIT_NEAR_FROM_1M}})();(function(){WALK.Controls=function(a,b,c,d){function e(){ma.rotation.z=WALK.normalizeRotation(S.z+aa.z)}function f(){e();Ba.rotation.x=WALK.normalizeRotation(S.x+aa.x);ra.rotation.y=S.y;ma.updateMatrixWorld(!0)}function g(R){return Math.abs(R[0].y-R[1].y)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}function h(R){y[0].copy(A[0]);y[1].copy(A[1]);R.touches?(A[0].set(R.touches[0].clientX,R.touches[0].clientY),2===R.touches.length?A[1].set(R.touches[1].clientX,R.touches[1].clientY):A[1].set(0,0)):(A[0].set(R.clientX,
R.clientY),A[1].set(0,0))}function k(R){if(l)if(R.preventDefault(),h(R),Y){if(Y!==O){if(Y===K){var Z=W[0].distanceTo(W[1]);R=A[0].distanceTo(A[1]);10<=Math.abs(R-Z)?(Y=H,Z=!0):g(A)&&g(W)&&10<=Math.abs(A[0].y-W[0].y)?(Y=G,Z=!0):Z=!1;if(!Z)return}Y===H?(Z=y[1].distanceTo(y[0]),Z=A[1].distanceTo(A[0])-Z,0<Math.abs(Z)&&(ka=Date.now(),T.activateDirectionFromSource(Math.sign(Z),B)),d.requestFrame()):Y===G&&g(A)&&(Z=A[0].y-y[0].y,0<Math.abs(Z)&&(la=Date.now(),M.activateDirectionFromSource(Math.sign(Z),B)),
d.requestFrame())}}else if(!m.mousePressLook||oa||!Y&&R.touches){Z=R.movementX||R.mozMovementX||R.webkitMovementX;void 0===Z&&(Z=A[0].x-y[0].x);var ca=R.movementY||R.mozMovementY||R.webkitMovementY;void 0===ca&&(ca=A[0].y-y[0].y);R=m.flipMouseLook||!Y&&R.touches?1:-1;aa.z+=R*Z*WALK.CAMERA_LOOK_SPEED;m.mouseControlsPitch&&(aa.x+=R*ca*WALK.CAMERA_LOOK_SPEED);m.restrictVerticalAngle&&(aa.x>m.verticalAngleMax?aa.x=m.verticalAngleMax:aa.x<m.verticalAngleMin&&(aa.x=m.verticalAngleMin));f();d.requestFrame()}}
function q(R){l&&(b.focus(),R.preventDefault(),h(R),oa=!0,d.requestFrame())}function p(R){l&&(R.preventDefault(),oa=!1)}function r(R){var Z=0,ca;(ca=!l)||(ca=void 0!==document.hasFocus?document.hasFocus():document.activeElement===b,ca=!ca);ca||(R||(R=window.event),R.preventDefault(),R.wheelDelta?Z=R.wheelDelta/120:R.detail&&(Z=-R.detail/3),E+=Z*WALK.CAMERA_SCROLL_SPEED,E=0<=E?Math.min(E,.5):Math.max(E,-.5),d.requestFrame())}function n(){m.stopForward();m.stopBackward();m.stopLeft();m.stopRight();
m.stopUp();m.stopDown();z.stopInDirection(1);z.stopInDirection(-1)}var m=this,l=!0,u=Math.PI/12,v=Symbol("MOVE_SOURCE_NONE"),t=Symbol("MOVE_SOURCE_KEY"),B=Symbol("MOVE_SOURCE_GESTURE"),D=Symbol("MOVE_SOURCE_GAMEPAD"),I=function(R){this.activeDirection=0;this.activeSource=v;this.speed=0;this.moves=function(){return this.activeDirection||this.speed};this.movesInDirection=function(Z){return this.activeDirection===Z||Math.sign(this.speed)===Z};this.activateDirectionFromSource=function(Z,ca){this.activeDirection=
Z;this.activeSource=ca};this.deactivateDirectionFromSource=function(Z,ca){this.activeDirection===Z&&this.activeSource===ca&&(this.activeDirection=0,this.activeSource=ca)};this.deactivateSource=function(Z){this.activeSource===Z&&(this.activeDirection=0,this.activeSource=v)};this.stopInDirection=function(Z){this.activeDirection===Z&&(this.activeDirection=0,this.activeSource=v);Math.sign(this.speed)===Z&&(this.speed=0)};this.update=function(Z,ca){if(!this.moves())return 0;var na=Math.sign(this.speed),
Aa=this.activeDirection||-na;Aa=ca*Aa*(na===Aa?Z/WALK.CAMERA_FULL_ACCELERATION_TIME:Z/WALK.CAMERA_FULL_DECELERATION_TIME);ca*=this.speed+Aa/2;this.speed=THREE.Math.clamp(this.speed+Aa,-Z,Z);this.activeDirection||Math.sign(this.speed)===na||(this.speed=0);return THREE.Math.clamp(ca,-R,R)}},J=1,Q=new I(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),T=new I(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),M=new I(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),z=new I(u),A=[new THREE.Vector2(0,0),new THREE.Vector2(0,
0)],y=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],E=0,K=Symbol("GESTURE_RECOGNITION"),H=Symbol("GESTURE_PINCH"),G=Symbol("GESTURE_TWO_POINTER_DRAG"),O=Symbol("GESTURE_IGNORE"),Y=null,W=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],ka=0,la=0,oa=!1,ra=new THREE.Object3D,Ba=new THREE.Object3D,ma=new THREE.Object3D,Ga=!1,aa=new THREE.Vector3(0,0,0),S=new THREE.Euler(0,0,0);ra.add(a);Ba.add(ra);ma.add(Ba);this.flipMouseLook=this.mousePressLook=!1;this.restrictVerticalAngle=this.mouseControlsPitch=
!0;this.verticalAngleMin=-Math.PI/2;this.verticalAngleMax=Math.PI/3;this.arrowsTurn=!0;this.orbit=new WALK.OrbitControls(a,this,b,d);this.cameraHeight=null;this.isFpsEnabled=function(){return l};this.isOrbitEnabled=function(){return this.orbit.isEnabled()};this.orbitModeEnable=function(){l=!1;this.orbit.enable()};this.camera=function(){return a};this.applyCameraYaw=function(R){R.applyEuler(ma.rotation)};this.cameraWorldPosition=function(){return ma.position};this.cameraPositionUpdated=function(){var R=
{type:"positionChanged",target:null},Z=null,ca=null,na=null;return function(){ma.updateMatrixWorld(!0);var Aa=ma.position;if(Z!==Aa.x||ca!==Aa.y||na!==Aa.z)Z=Aa.x,ca=Aa.y,na=Aa.z,a.dispatchEvent(R)}}();this.resetRollAngle=function(){0!==ra.rotation.y&&(S.y=0,f())};this.getPitchAngle=function(){return Ba.rotation.x};this.setPitchAngle=function(R){R!==Ba.rotation.x&&(aa.x=R,S.x=0,f())};this.resetPitchAngle=function(){this.setPitchAngle(0)};this.getYawAngle=function(){return ma.rotation.z};this.setYawAngle=
function(R){R!==ma.rotation.z&&(aa.z=R,S.z=0,f())};this.resetYawAngle=function(){this.setYawAngle(0)};this.isHandlingGesture=function(){return null!==Y};this.hmdReset=function(){Ga=!0;this.resetPitchAngle()};this.onHmdUpdate=function(){var R=new THREE.Vector3,Z=new THREE.Vector3,ca=new THREE.Vector3,na=new THREE.Vector3,Aa=new THREE.Vector3;return function(Ca,qa){l&&(S.copy(Ca),Ga?aa.z-=S.z:qa&&(na.subVectors(qa,ca),R.set(Math.cos(aa.z),Math.sin(aa.z),0),Z.set(-Math.sin(aa.z),Math.cos(aa.z),0),Aa.copy(R.multiplyScalar(na.x)),
Aa.add(Z.multiplyScalar(na.y)),Aa.z=na.z,ma.position.add(Aa)),qa&&ca.copy(qa),Ga=!1,f())}}();this.maxFrameMoveLinearDistance=function(R){return Math.min(R*a.moveMaxSpeed*J,WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)};this.movesForward=function(){return T.movesInDirection(1)||0<E};this.stopForward=function(){0<E&&(E=0);T.stopInDirection(1)};this.movesBackward=function(){return T.movesInDirection(-1)||0>E};this.stopBackward=function(){0>E&&(E=0);T.stopInDirection(-1)};this.movesLeft=function(){return Q.movesInDirection(-1)};
this.stopLeft=function(){Q.stopInDirection(-1)};this.movesRight=function(){return Q.movesInDirection(1)};this.stopRight=function(){Q.stopInDirection(1)};this.movesUp=function(){return M.movesInDirection(1)};this.stopUp=function(){M.stopInDirection(1)};this.movesDown=function(){return M.movesInDirection(-1)};this.stopDown=function(){M.stopInDirection(-1)};this.enable=function(){this.orbit.disable();l=!0;oa=0};this.disable=function(){this.orbit.disable();l=!1;n()};this.update=function(R){if(l){T.activeSource===
B&&100<Date.now()-ka&&T.deactivateSource(B);M.activeSource===B&&100<Date.now()-la&&M.deactivateSource(B);var Z=Q.update(a.moveMaxSpeed*J,R),ca=T.update(a.moveMaxSpeed*J,R),na=M.update(a.moveMaxSpeed*J,R);var Aa=0;ca?E=0:(E&&(ca=m.maxFrameMoveLinearDistance(R),Aa=THREE.Math.clamp(E,-ca,ca),E-=Aa),ca=Aa);ma.translateX(Z);ma.translateY(ca);ma.translateZ(na);R=z.update(WALK.CAMERA_ARROWS_TURN_SPEED,R);aa.z+=R;e();(Q.moves()||T.moves()||M.moves()||z.moves()||E)&&d.requestFrame();this.cameraPositionUpdated()}else this.orbit.update(R)};
a.rotation.set(0,0,0);a.up.set(0,0,1);a.lookAt(new THREE.Vector3(0,1,0));b.setAttribute("tabindex",-1);b.addEventListener("contextmenu",function(R){R.preventDefault()},!1);b.addEventListener("mousedown",q,!1);b.addEventListener("touchstart",function(R){l&&(R.preventDefault(),h(R),2===R.touches.length?(Y=K,W[0].copy(A[0]),W[1].copy(A[1])):2<R.touches.length&&(Y=O))},!1);b.addEventListener("mousemove",k,!1);b.addEventListener("touchmove",k,!1);b.addEventListener("mouseup",p,!1);b.addEventListener("touchend",
function(R){l&&(R.preventDefault(),Y=0===R.touches.length?null:O)},!1);b.addEventListener("keydown",function(R){var Z=!0;if(l&&!WALK.isModifierPressed(R)){J=R.shiftKey?WALK.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:1;switch(R.keyCode){case 38:case 32:case 87:T.activateDirectionFromSource(1,t);break;case 37:m.arrowsTurn?z.activateDirectionFromSource(1,t):Q.activateDirectionFromSource(-1,t);break;case 65:Q.activateDirectionFromSource(-1,t);break;case 40:case 83:T.activateDirectionFromSource(-1,t);break;case 39:m.arrowsTurn?
z.activateDirectionFromSource(-1,t):Q.activateDirectionFromSource(1,t);break;case 68:Q.activateDirectionFromSource(1,t);break;case 33:case 69:M.activateDirectionFromSource(1,t);break;case 34:case 81:M.activateDirectionFromSource(-1,t);break;default:Z=!1}Z&&(R.preventDefault(),d.requestFrame())}},!1);b.addEventListener("keyup",function(R){var Z=!0;if(l){J=R.shiftKey?WALK.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:1;switch(R.keyCode){case 38:case 32:case 87:T.deactivateDirectionFromSource(1,t);break;case 37:case 65:z.deactivateDirectionFromSource(1,
t);Q.deactivateDirectionFromSource(-1,t);break;case 40:case 83:T.deactivateDirectionFromSource(-1,t);break;case 39:case 68:z.deactivateDirectionFromSource(-1,t);Q.deactivateDirectionFromSource(1,t);break;case 33:case 69:M.deactivateDirectionFromSource(1,t);break;case 34:case 81:M.deactivateDirectionFromSource(-1,t);break;default:Z=!1}Z&&R.preventDefault()}},!1);b.addEventListener("mouseout",function(R){p(R)},!1);b.addEventListener("mouseenter",function(R){0<R.buttons&&q(R)},!1);b.addEventListener("DOMMouseScroll",
r,!1);b.addEventListener("mousewheel",r,!1);b.addEventListener("blur",function(R){n()},!1);c.addEventListener("actionActivated",function(R){if(l)switch(R.action){case WALK.GAMEPAD_ACTION.BACKWARD:T.activateDirectionFromSource(-1,D);break;case WALK.GAMEPAD_ACTION.FORWARD:T.activateDirectionFromSource(1,D);break;case WALK.GAMEPAD_ACTION.LEFT:m.arrowsTurn?z.activateDirectionFromSource(1,D):Q.activateDirectionFromSource(-1,D);break;case WALK.GAMEPAD_ACTION.RIGHT:m.arrowsTurn?z.activateDirectionFromSource(-1,
D):Q.activateDirectionFromSource(1,D);break;case WALK.GAMEPAD_ACTION.DOWN:M.activateDirectionFromSource(-1,D);break;case WALK.GAMEPAD_ACTION.UP:M.activateDirectionFromSource(1,D)}});c.addEventListener("actionDeactivated",function(R){if(l)switch(R.action){case WALK.GAMEPAD_ACTION.BACKWARD:T.deactivateDirectionFromSource(-1,D);break;case WALK.GAMEPAD_ACTION.FORWARD:T.deactivateDirectionFromSource(1,D);break;case WALK.GAMEPAD_ACTION.LEFT:Q.deactivateDirectionFromSource(-1,D);z.deactivateDirectionFromSource(1,
D);break;case WALK.GAMEPAD_ACTION.RIGHT:Q.deactivateDirectionFromSource(1,D);z.deactivateDirectionFromSource(-1,D);break;case WALK.GAMEPAD_ACTION.DOWN:M.deactivateDirectionFromSource(-1,D);break;case WALK.GAMEPAD_ACTION.UP:M.deactivateDirectionFromSource(1,D)}});this.isEnabled=function(){return l}}})();(function(){function a(){var d=new WALK.StandardMaterial;d.baseColor.setRGB(.298,.619,.851);d.highlight=(new THREE.Color).setRGB(.033,.125,.445);d.setUniforms();return d}function b(d){var e=new THREE.CylinderBufferGeometry(.05,.05,.011,32),f=new THREE.CylinderBufferGeometry(.05,.03,.011,32,1,!1),g=new THREE.CylinderBufferGeometry(0,.05,.2,32,1,!0);WALK.EDIT_MODE&&(e.addTriangleOrderAttribute(),f.addTriangleOrderAttribute(),g.addTriangleOrderAttribute());var h=new THREE.Matrix4;h.makeRotationX(Math.PI/
2);e.applyMatrix(h);e.convertNormalsToSpherical();e=new THREE.Mesh(e,d);e.position.z+=.0055;h.makeTranslation(0,-(.1+.0055),0);f.applyMatrix(h);f.convertNormalsToSpherical();f=new THREE.Mesh(f,d);g.convertNormalsToSpherical();d=new THREE.Mesh(g,d);d.add(f);d.rotateX(-Math.PI/2);d.position.z=.158;g=new THREE.Object3D;g.add(e);g.add(d);return g}function c(d){var e=a(),f=b(e),g=f.children[0],h=!1,k=1;this.hide=function(){h&&(d.removeAuxiliaryObject(f),h=!1)};this.isVisible=function(){return h};this.showTargetAtPosition=
function(q,p,r,n){h||(d.addAuxiliaryObject(f),h=!0);g.visible=n;f.position.set(q,p,r);f.updateMatrixWorld()};this.update=function(q){e.highlightMix+=q*k;1<=e.highlightMix&&(e.highlightMix=1,k=-1);0>=e.highlightMix&&(e.highlightMix=0,k=1)}}WALK.ClickNavigator=function(d,e,f,g){function h(){g.teleportingToPoint&&g.cancelSwitchToPoint()}function k(){!f.mousePressLook&&g.teleportingToPoint&&g.cancelSwitchToPoint()}var q=new c(d),p=new WALK.RayIntersection;g.addEventListener("teleportDone",function(){q.hide()});
this.onMeshClicked=function(r,n){if(!f.isOrbitEnabled()&&!f.isHandlingGesture()&&0!==f.camera().moveMaxSpeed){e.clickedPointToMoveTarget(n);r=n.x;var m=n.y,l=n.z,u=!1;if(e.findIntersectionBelow(n,4,p)){l=p.point.z;var v=p.object.geometry.boundingBox;v&&l>v.max.z-.01&&(u=!0)}else l-=f.cameraHeight||1.6;WALK.CLICK_MOVE_SHOW_TARGET_INDICATOR&&q.showTargetAtPosition(r,m,l,u);g.switchToPoint(n)}};this.update=function(r){q.isVisible()&&q.update(r)};this.dispose=function(){document.removeEventListener("keydown",
h,!1);document.removeEventListener("mousedown",h,!1);document.removeEventListener("mousemove",k,!1);document.removeEventListener("touchstart",h,!1);document.removeEventListener("DOMMouseScroll",h,!1);document.removeEventListener("mousewheel",h,!1)};document.addEventListener("keydown",h,!1);document.addEventListener("mousedown",h,!1);document.addEventListener("mousemove",k,!1);document.addEventListener("touchstart",h,!1);document.addEventListener("DOMMouseScroll",h,!1);document.addEventListener("mousewheel",
h,!1)}})();(function(){WALK.StepsClimber=function(a,b,c){var d,e,f=b.cameraWorldPosition(),g=new THREE.Vector3;this.updateCameraHeight=function(h){if(d){var k=f.z-g.z;null!==b.cameraHeight&&(b.cameraHeight+=k);f.x!==g.x||f.y!==g.y?e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH):Infinity!==e&&(e+=k);Infinity!==e&&(null===b.cameraHeight&&(b.cameraHeight=e),k=b.cameraHeight,e<k-.005||e>k+.005)&&(k=b.cameraHeight,h=Math.min(Math.max(Math.sqrt(Math.pow(f.x-g.x,2)+Math.pow(f.y-g.y,2))/h*1.5,WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED)*
h,Math.abs(e-k)),e>k&&(h=-h),0>h||Infinity===a.distanceToCeiling(h+WALK.MIN_DISTANCE_TO_CEILING))&&(f.z+=h,e+=h,c.requestFrame());g.copy(f)}};this.enable=function(){d=!0;e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH);b.cameraHeight=Infinity!==e?e:null;g.copy(f)};this.disable=function(){d=!1};this.isEnabled=function(){return d};this.enable()}})();(function(){WALK.VRHeightController=function(a,b){var c=a.cameraWorldPosition(),d,e,f;this.onHmdPositionUpdate=function(g){d&&!f&&1<g.z&&(a.cameraHeight=g.z,b.adjustPointToMatchCameraHeight(c),a.cameraPositionUpdated(),e=c.z,f=!0)};this.onTeleportDone=function(){d&&(e=c.z)};this.updateCameraHeight=function(){d&&(a.cameraHeight+=c.z-e,e=c.z)};this.enable=function(){d=!0;a.cameraHeight=b.cameraHeightFromPoint(c);null===a.cameraHeight&&(a.cameraHeight=WALK.FALLBACK_CAMERA_HEIGHT);e=c.z;f=!1};this.disable=
function(){d=!1;a.cameraHeight=null}}})();(function(){function a(d){var e=null;this.activateSky=function(f){if(e){if(e.name===f)return;d.removeAuxiliaryObject(e)}var g=d.findSkyMesh(f);(f=g.material.map)&&!f.loaded?(this.activateSky(WALK.DEFAULT_SKY_NAME),e=g,f.addLoadedListener(function(){e===g&&(d.addAuxiliaryObject(g),g.updateMatrixWorld(!0))})):(d.addAuxiliaryObject(g),g.updateMatrixWorld(!0),e=g)};this.activeSkyName=function(){return e.name}}function b(d,e,f){this.position=d||new THREE.Vector3;this.rotation=e||new THREE.Vector2;this.fov=
f||0}var c=1/180;WALK.Teleport=function(d,e,f,g,h){function k(){B=[];for(var W=0;W<d.views.length;W+=1)B[d.views[W].id]=[];for(W=0;W<d.gpuMeshes.length;W+=1){var ka=d.gpuMeshes[W],la=ka.hideInViews;if(la)for(var oa=0;oa<la.length;oa+=1)B[la[oa]]?B[la[oa]].push(ka):console.warn("Invalid view id in hideInViews list: '"+la[W]+"'")}}function q(W){for(var ka=0;ka<W.length;ka+=1){var la=W[ka];la.visible=!1;D.push(la)}}function p(){for(var W=0;W<D.length;W+=1)D[W].visible=!0;D.length=0}function r(W){p();
q(W)}function n(){t.fov=Q.fov;v.copy(Q.position);e.setYawAngle(Q.rotation.x);e.setPitchAngle(Q.rotation.y);e.cameraPositionUpdated();J=null}function m(){return[new THREE.Vector2(Y().position.x,Y().position.y),new THREE.Vector2(Q.position.x,Q.position.y)]}var l=this,u=new a(d),v=e.cameraWorldPosition(),t=d.camera,B,D=[],I=new WALK.CameraPath(d,h),J=null,Q=new b,T=new THREE.Vector3,M,z,A,y=!1,E={type:"teleportStarted",target:this,view:null},K={type:"teleportDone",target:this,view:null},H=null;this.lastDestinationView=
null;var G=this.teleportingToPoint=this.teleportingToView=!1,O=!1,Y=function(){var W=new b(e.cameraWorldPosition());return function(){W.rotation.set(WALK.normalizeRotation(e.getYawAngle()),WALK.normalizeRotation(e.getPitchAngle()));W.fov=t.fov;return W}}();this.update=function(W){if(l.teleportingToView||l.teleportingToPoint){W=Math.min(W,.067);W=Math.max(W,c);var ka=!0;null!==J&&(this.teleportingToPoint&&(Q.position.z=v.z),J.update(W,v)?ka=!1:n());ka&&(this.teleportingToView&&("orbit"!==A.mode||y?
(W=e.camera(),W.near=WALK.CAMERA_WALK_NEAR,W.updateProjectionMatrix(),e.enable()):(e.orbit.minDistance=M,e.orbit.maxDistance=z,e.orbit.setPanPrimary(A.panPrimary||!1),e.orbit.noPan=A.noPan||!1,e.orbit.noRotate=A.noRotate||!1,e.orbit.noPitchRotate=A.noPitchRotate||!1,e.orbit.getMinPitchAngle=function(){return-A.maxUpAngle},e.orbit.getMaxPitchAngle=function(){return-A.minUpAngle},e.orbit.getMinYawAngle=function(){return A.minSideAngle},e.orbit.getMaxYawAngle=function(){return A.maxSideAngle},e.orbit.getMinDistance=
function(){return A.minDistance},e.orbit.getMaxDistance=function(){return A.maxDistance},e.orbit.target.copy(T),e.orbitModeEnable()),u.activateSky(A.sky),r(B[A.id]||[])),this.teleportingToView=this.teleportingToPoint=!1,K.view=A,this.dispatchEvent(K));g.requestFrame()}};this.cancelSwitchToPoint=function(){console.assert(this.teleportingToPoint);this.teleportingToPoint=!1;K.view=null;this.dispatchEvent(K)};this.switchToPoint=function(W){if(W.x!==v.x||W.y!==v.y)A=null,this.teleportingToPoint=!0,this.teleportingToView=
!1,E.view=null,this.dispatchEvent(E),G?Q.position.set(W.x,W.y,W.z):Q.position.set(W.x,W.y,v.z),W=WALK.yawRotationToPoint(v,W),W=WALK.normalizeRotation(W),Q.rotation.set(W,0),Q.fov=t.defaultFov,G?(n(),this.update(c)):(J=new WALK.TeleportMovement(t,e,m(),Y().position.z,Y().rotation,t.fov,void 0,Q.rotation,Q.fov,WALK.TELEPORT_TO_POINT_MAX_TIME,WALK.TELEPORT_TO_POINT_ACCELERATION,!1),g.requestFrame())};this.switchToView=function(W,ka){var la="orbit"!==W.mode;var oa=l.lastDestinationView?"orbit"!==l.lastDestinationView.mode:
!0;la=t.autoPath&&la&&oa;void 0===ka&&(ka=la?WALK.TELEPORT_PATH_MAX_TIME:WALK.TELEPORT_TO_VIEW_MAX_TIME);W.hideFromMenu||(H=W);this.lastDestinationView=A=W;this.teleportingToView=!0;this.teleportingToPoint=!1;E.view=A;this.dispatchEvent(E);e.disable();e.resetRollAngle();q(B[A.id]||[]);void 0!==A.rotation?Q.rotation.set(A.rotation.yaw,A.rotation.pitch):Q.rotation.set(0,0);Q.fov=A.fov||t.defaultFov;"orbit"===A.mode?(void 0!==A.target?T.set(A.target.x,A.target.y,A.target.z):T.set(0,0,0),M=A.minDistance,
z=A.maxDistance,W=THREE.Math.clamp(A.distance||10,M,z),WALK.OrbitControls.computeCameraPosition(Q.position,T,Q.rotation.x,Q.rotation.y,W),t.near=WALK.OrbitControls.computeCameraNear(W),t.updateProjectionMatrix()):void 0!==A.position?(Q.position.set(A.position.x,A.position.y,A.position.z),(O||null!==t.fixedHeight||null!==WALK.CAMERA_FIXED_HEIGHT)&&f.adjustPointToMatchCameraHeight(Q.position)):Q.position.set(0,0,0);if(0===ka||G)n(),this.update(c);else{A.sky!==u.activeSkyName()&&u.activateSky(WALK.DEFAULT_SKY_NAME);
W=la?I.findPath(Y(),Q):m();oa=la?WALK.TELEPORT_PATH_ACCELERATION:WALK.TELEPORT_TO_VIEW_ACCELERATION;if(void 0===A.rotation){var ra=WALK.yawRotationToPoint(W[W.length-2],W[W.length-1]);ra=WALK.normalizeRotation(ra);Q.rotation.set(ra,0)}J=new WALK.TeleportMovement(t,e,W,Y().position.z,Y().rotation,t.fov,Q.position.z,Q.rotation,Q.fov,ka,oa,la);g.requestFrame()}};this._switchToAdjacentVisibleView=function(W,ka){var la=d.visibleViews();if(0!==la.length)if(null===H)this.switchToView(la[0],ka);else{var oa=
la.indexOf(H);-1===oa&&this.switchToView(la[0],ka);this.switchToView(la[(oa+la.length+W)%la.length],ka)}};this.switchToPreviousVisibleView=function(W){this._switchToAdjacentVisibleView(-1,W)};this.switchToNextVisibleView=function(W){this._switchToAdjacentVisibleView(1,W)};this.updateHiddenMeshes=function(W){k();W?r(B[W.id]||[]):p();g.requestFrame()};this.activateSky=function(W){u.activateSky(W.sky);g.requestFrame()};this.executeWithViewVisibilitySettings=function(W,ka){var la=D.slice();r(B[W.id]||
[]);u.activateSky(W.sky);ka();u.activateSky(this.lastDestinationView.sky);r(la)};this.onVrChange=function(W){O=G=y=W;this.lastDestinationView&&"orbit"===this.lastDestinationView.mode&&this.switchToView(this.lastDestinationView,0)};k();d.addEventListener("viewAdded",k);d.addEventListener("viewRemoved",k);d.addEventListener("skyMeshAdded",function(W){u.activateSky(W.skyMesh.name);g.requestFrame()});d.addEventListener("skyMeshRemoved",function(W){u.activeSkyName()===W.skyMesh.name&&(u.activateSky(WALK.DEFAULT_SKY_NAME),
g.requestFrame())})};THREE.EventDispatcher.prototype.apply(WALK.Teleport.prototype)})();(function(){WALK.AutoTour=function(a,b){function c(){d&&b.switchToNextVisibleView(4)}var d=!1,e={type:"tourStarted"},f={type:"tourStopped"};b.addEventListener("teleportDone",function(){d&&setTimeout(c,WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)});this.isRunning=function(){return d};this.start=function(){console.assert(!d);d=!0;this.dispatchEvent(e);c()};this.stop=function(){console.assert(d);d=!1;b.switchToView(b.lastDestinationView,0);this.dispatchEvent(f)}};THREE.EventDispatcher.prototype.apply(WALK.AutoTour.prototype)})();(function(){function a(g){return-.7>=g?0:.7<=g?1:-1}function b(g,h){if("xr-standard"===g.mapping)return"left"===(g.hand?g.hand:h)?d:e;h=$jscomp.makeIterator(c);for(var k=h.next();!k.done;k=h.next()){k=k.value;var q=g;var p=k;q=p.gamepadIdPattern.test(q.id)?void 0!==p.gamepadLayoutMappingId?q.mapping===p.gamepadLayoutMappingId:!0:!1;if(q)return k}console.error("No matching action mapping for gamepad found",g.id);return null}WALK.GAMEPAD_ACTION={TRIGGER:0,BACKWARD:1,FORWARD:2,LEFT:3,RIGHT:4,DOWN:5,
UP:6,PREVIOUS:7,NEXT:8};var c=[{gamepadIdPattern:/^Spatial Controller \(Spatial Interaction Source\).*$/,axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[3,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]],[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/Oculus Touch \(Left\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,
WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.DOWN],[4,WALK.GAMEPAD_ACTION.UP]])},{gamepadIdPattern:/Oculus Touch \(Right\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.NEXT],[4,WALK.GAMEPAD_ACTION.PREVIOUS]])},
{gamepadIdPattern:/OpenVR (Gamepad|Controller)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.DOWN,WALK.GAMEPAD_ACTION.UP]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,gamepadLayoutMappingId:"standard",axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]],[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,
[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.DOWN],[1,WALK.GAMEPAD_ACTION.NEXT],[2,WALK.GAMEPAD_ACTION.PREVIOUS],[3,WALK.GAMEPAD_ACTION.UP],[4,WALK.GAMEPAD_ACTION.TRIGGER],[5,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[1,WALK.GAMEPAD_ACTION.TRIGGER],
[2,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.TRIGGER]])}],d={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[4,WALK.GAMEPAD_ACTION.DOWN],[5,WALK.GAMEPAD_ACTION.UP]])},e={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],
[4,WALK.GAMEPAD_ACTION.NEXT],[5,WALK.GAMEPAD_ACTION.PREVIOUS]])},f=function(g,h){h=b(g,h);this.axisMapping=h.axisMapping;this.buttonMapping=h.buttonMapping;this.axisPosition=g.axes.map(a);this.buttonPressed=g.buttons.map(function(k){return k.pressed})};WALK.GamepadManager=function(){function g(l){var u=l.gamepad;l=new f(l.gamepad);k.set(u.index,l)}function h(l){k.delete(l.gamepad.index)}var k=new Map,q=new Map,p=new Set,r=new Set,n={type:"actionActivated",action:null},m={type:"actionDeactivated",
action:null};this.hasGamepads=function(){return 0<k.size||0<q.size};this.update=function(){function l(B,D){for(var I=0;I<D.axes.length;++I){var J=a(D.axes[I]),Q=B.axisPosition[I];if(J!==Q){var T=B.axisMapping.get(I);void 0!==T&&(-1!==Q&&r.add(T[Q]),-1!==J&&p.add(T[J]))}B.axisPosition[I]=J}for(I=0;I<D.buttons.length;++I)J=D.buttons[I].pressed,Q=B.buttonPressed[I],J!==Q&&(T=B.buttonMapping.get(I),void 0!==T&&(Q?r.add(T):p.add(T))),B.buttonPressed[I]=J}if(this.hasGamepads()){p.clear();r.clear();var u=
navigator.getGamepads?navigator.getGamepads():[];u=$jscomp.makeIterator(u);for(var v=u.next();!v.done;v=u.next())if(v=v.value){var t=k.get(v.index);l(t,v)}u=$jscomp.makeIterator(q);for(v=u.next();!v.done;v=u.next())t=$jscomp.makeIterator(v.value),v=t.next().value,t=t.next().value,l(t,v);v=$jscomp.makeIterator(r);for(u=v.next();!u.done;u=v.next())m.action=u.value,this.dispatchEvent(m);v=$jscomp.makeIterator(p);for(u=v.next();!u.done;u=v.next())n.action=u.value,this.dispatchEvent(n)}};this.addXrGamepad=
function(l,u){u=new f(l,u);q.set(l,u)};this.removeXrGamepad=function(l){q.delete(l)};this.removeAllXrGamepads=function(){q.clear()};(function(){if(navigator.getGamepads){window.addEventListener("gamepadconnected",g);window.addEventListener("gamepaddisconnected",h);for(var l=$jscomp.makeIterator(navigator.getGamepads()),u=l.next();!u.done;u=l.next())if(u=u.value){var v=new f(u);k.set(u.index,v)}}})()};THREE.EventDispatcher.prototype.apply(WALK.GamepadManager.prototype)})();/*
 Copyright (C) 2020-present Shapespark
*/
(function(){WALK.GazeModeObserver=function(){var a=this,b=!1,c={type:"modeDisabled"},d={type:"modeEnabled"};this.enableMode=function(){b=!0;a.dispatchEvent(d)};this.disableMode=function(){b=!1;a.dispatchEvent(c)};this.modeIsEnabled=function(){return b}};THREE.EventDispatcher.prototype.apply(WALK.GazeModeObserver.prototype)})();(function(){function a(){var c=new THREE.BufferGeometry,d=new Float32Array(18);c.addAttribute("position",new THREE.BufferAttribute(d,3));d[0]=.05;d[1]=-.05;d[2]=-2;d[3]=.05;d[4]=.05;d[5]=-2;d[6]=-.05;d[7]=-.05;d[8]=-2;d[9]=.05;d[10]=.05;d[11]=-2;d[12]=-.05;d[13]=.05;d[14]=-2;d[15]=-.05;d[16]=-.05;d[17]=-2;c.computeBoundingSphere();return c}console.assert(WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S<=WALK.GAZE_POINTER_ACTIVATE_AFTER_S);var b=Math.PI/60;WALK.GazePointer=function(c,d,e,f){function g(){k=q=
null;p=0;r=!1;n&&n.setCircleSpan(0)}var h=f.modeIsEnabled(),k,q,p,r,n=null,m=null,l=null;this.setGazeHandlers=function(v,t){m=v;l=t};var u=function(){if(!h)g();else if(!n){var v=new WALK.GazePointerMaterial,t=new THREE.Mesh(a(),v);c.addAuxiliaryObject(t);t.frustumCulled=!1;t.matrixWorld=d.camera().matrixWorld;n={setVisible:function(B){t.visible=B;e()},setCircleSpan:function(B){v.circleSpan=B;e()}};g()}n&&n.setVisible(h)};f.addEventListener("modeDisabled",function(){h=!1;u()});f.addEventListener("modeEnabled",
function(){h=!0;u()});this.reset=function(){null!==k&&g()};this.update=function(v){if(h){var t=d.getPitchAngle(),B=d.getYawAngle();null===k?(k=t,q=B):Math.abs(k-t)>b||Math.abs(q-B)>b?g():(p+=v,p>=WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S&&(r?(n.setCircleSpan(Math.min((p-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S)/(WALK.GAZE_POINTER_ACTIVATE_AFTER_S-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S),1)),p>=WALK.GAZE_POINTER_ACTIVATE_AFTER_S&&(l&&l(),g())):m&&m()?r=!0:g()))}};u()}})();/*
 Copyright (C) 2018-present Shapespark
*/
(function(){WALK.HashChangeTeleport=function(a,b){function c(){var d=WALK.urlHashGetArgument("view");d&&(d=a.findViewByName(d))&&(b.switchToView(d),window.location.hash=WALK.urlHashRemoveArgument("view"))}window.addEventListener("hashchange",c,!1);this.dispose=function(){window.removeEventListener("hashchange",c,!1)}}})();(function(){var a=function(e,f){function g(v){return parseFloat(v.toFixed(4))}function h(v,t){return v.reduce(function(B,D){return B+D[t]},0)}function k(v,t,B,D){var I=2*v.x;v=2*v.y;D=2*(void 0===D?1:D);m.lineWidth=2*(void 0===B?1:B);m.strokeStyle=void 0===t?"black":t;m.beginPath();m.arc(I,v,D,0,2*Math.PI);m.stroke()}function q(v){v.forEach(function(t){var B=255*t.distanceToObstacle;B=0===t.distanceToObstacle?"black":"rgb(255,"+B+","+B+")";var D=0,I=!0;B=void 0===B?"black":B;I=void 0===I?!1:I;var J=
2*t.x-1;t=2*t.y-1;m.lineWidth=2*(void 0===D?1:D);m.strokeStyle=B;m.fillStyle=B;m.beginPath();m.rect(J,t,2,2);m.stroke();I&&m.fill()})}function p(v){v.forEach(function(t){t=new THREE.Vector2(t.x,t.y);k(t,"green",.5,.5)})}function r(v){v.forEach(function(t,B){t=new THREE.Vector2(t.x,t.y);if(0<B){B=new THREE.Vector2(v[B-1].x,v[B-1].y);var D="blue",I=1;m.lineWidth=2*(void 0===I?1:I);m.strokeStyle=void 0===D?"black":D;m.beginPath();m.moveTo(2*B.x,2*B.y);m.lineTo(2*t.x,2*t.y);m.stroke()}k(t,"blue",1,1)})}
console.warn("Camera path debug mode");var n=document.createElement("canvas"),m=n.getContext("2d");n.width=2*e;n.height=2*f;n.style.position="absolute";n.style.left="0";n.style.top="0";n.style.maxWidth="100%";document.body.appendChild(n);var l={};this.render=function(v,t,B){m.clearRect(0,0,2*e,2*f);q(v);p(t);r(B)};var u=function(v){var t=[];this.start=function(){var B=performance.now();t.push({start:B,end:B,delta:0})};this.end=function(){var B=performance.now();void 0!==t[t.length-1]&&(t[t.length-
1].end=B,t[t.length-1].delta=t[t.length-1].end-t[t.length-1].start)};this.stats=function(){var B=t[t.length-1].delta,D=t.reduce(function(Q,T){return Q.delta<T.delta?Q:T}).delta,I=t.reduce(function(Q,T){return Q.delta>T.delta?Q:T}).delta,J=h(t,"delta")/t.length;return{name:v,last:g(B),best:g(D),worst:g(I),average:g(J)}}};this.timeStart=function(v){void 0===l[v]&&(l[v]=new u(v));l[v].start()};this.timeEnd=function(v){void 0!==l[v]&&l[v].end()};this.logTime=function(){var v=[];Object.values(l).forEach(function(B){v.push(B.stats())});
var t={name:"TOTAL",last:g(h(v,"last")),best:g(h(v,"best")),worst:g(h(v,"worst")),average:g(h(v,"average"))};v.push(t);console.table(v)}},b=function(e){function f(k){for(var q=h[k];0<k;){var p=Math.floor((k-1)/2),r=h[p];if(q[e]<=r[e])h[p]=q,h[k]=r,k=p;else break}}function g(k){for(var q=h[k];;){var p=2*k+1,r=2*k+2,n=void 0,m=null;p<h.length&&(n=h[p],q[e]>n[e]&&(m=p));r<h.length&&(p=h[r],null===m&&q[e]>p[e]||null!==m&&n[e]>p[e])&&(m=r);if(null!==m)h[k]=h[m],h[m]=q,k=m;else break}}e=void 0===e?"score":
e;var h=[];this.extract=function(){var k=h[0],q=h.pop();0<h.length&&(h[0]=q,g(0));return k};this.insert=function(k){h.push(k);f(h.length-1)};this.update=function(k){var q=h.indexOf(k);0!==q&&(k[e]<h[Math.floor((q-1)/2)]?f(q):g(q))};this.size=function(){return h.length}},c=function(e,f,g,h){this.id=e;this.x=f;this.y=g;this.distanceToObstacle=h;this.parent=null;this.score=0};c.prototype={distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},distanceMeasured:function(){return void 0!==
this.distanceToObstacle},isObstacle:function(){return 0===this.distanceToObstacle},visited:function(){return null!==this.parent},visit:function(e,f){this.parent=e;this.score=f}};var d=function(e,f,g,h){var k=[-1,1,-f,f],q=e.canvasRange,p=e.sceneRange,r=[];(function(n){for(var m=new b("distanceToObstacle"),l=0;l<=n.data.length;l+=4){var u=255===n.data[l-1],v=Math.floor(l/(4*f));v=new c(l/4,l/4-v*f,v,u?0:void 0);r.push(v);u&&m.insert(v)}for(n={};0<m.size();)n.$jscomp$loop$prop$current$182=m.extract(),
k.forEach(function(t){return function(B){B=t.$jscomp$loop$prop$current$182.id+B;1>t.$jscomp$loop$prop$current$182.distanceToObstacle&&void 0!==r[B]&&!1===r[B].distanceMeasured()&&(r[B].distanceToObstacle=Math.min(1,t.$jscomp$loop$prop$current$182.distanceToObstacle+1/h),m.insert(r[B]))}}(n)),n={$jscomp$loop$prop$current$182:n.$jscomp$loop$prop$current$182}})(e.collisionImageData);this.forEachNeighbour=function(n,m){var l=n.x+n.y*f;k.forEach(function(u){var v;if(v=void 0!==r[l+u])if(v=r[l+u],0!==n.x&&
n.x!==f-1)v=!0;else{var t=n.x+v.x!==f-2;v=1===n.x+v.x&&!t}v&&m(r[l+u])})};this.hasObstacleAt=function(n,m){return r[Math.round(n)+Math.round(m)*f].isObstacle()};this.getNodeAtScenePosition=function(n){var m=Math.round(THREE.Math.mapLinear(n.position.x,p.x.min,p.x.max,q.x.min,q.x.max));n=Math.round(THREE.Math.mapLinear(n.position.y,p.y.min,p.y.max,q.y.min,q.y.max));return r[m+n*f]};this.getScenePointFromNode=function(n){var m=THREE.Math.mapLinear(n.x,q.x.min,q.x.max,p.x.min,p.x.max);n=THREE.Math.mapLinear(n.y,
q.y.min,q.y.max,p.y.min,p.y.max);return new THREE.Vector2(m,n)};this.resetNodeMap=function(){r.forEach(function(n){n.parent=null;n.score=0})};this.getNodeMap=function(){return r}};WALK.CameraPath=function(e,f){function g(m,l){var u=q.getNodeAtScenePosition(m);l=q.getNodeAtScenePosition(l);if(!u||!l)return[];var v=new b;v.insert(u);m=[];for(var t={};0<v.size();){t.$jscomp$loop$prop$current$184=v.extract();if(t.$jscomp$loop$prop$current$184===l){for(l=t.$jscomp$loop$prop$current$184;l;l=l.parent)l&&
m.push(l);m.reverse();break}q.forEachNeighbour(t.$jscomp$loop$prop$current$184,function(B){return function(D){if(!D.isObstacle()){var I=B.$jscomp$loop$prop$current$184.score+1/(D.distanceToObstacle?D.distanceToObstacle:1),J=D.visited()||D===u;if(!J||I<D.score)D.visit(B.$jscomp$loop$prop$current$184,I),J?v.update(D):v.insert(D)}}}(t));t={$jscomp$loop$prop$current$184:t.$jscomp$loop$prop$current$184}}return m}function h(m,l,u,v){var t;a:{for(t=m+1;t<l.length;t++){b:{var B=l[m],D=l[t],I=B.x<D.x?B:D,
J=B.x<D.x?D:B,Q=B.y<D.y?B:D,T=B.y<D.y?D:B;var M=I.x===J.x?null:(J.y-I.y)/(J.x-I.x);var z=null===M?I.x:I.y-M*I.x;if(Math.abs(B.y-D.y)>Math.abs(B.x-D.x))for(I=Q.y;I<=T.y;I+=.2){if(q.hasObstacleAt(null===M?Q.x:(I-z)/M,I)){M=!0;break b}}else for(Q=I.x;Q<=J.x;Q+=.2)if(q.hasObstacleAt(Q,null===M?I.y:M*Q+z)){M=!0;break b}M=!1}if(M)break a}t=-1}-1===t?u.push(l[l.length-1]):(m=t-m,m=m>v?t-v:t-Math.floor(m/2),u.push(l[m]),h(m,l,u,v))}var k=null,q=null;e=f.calculateRenderSize(200);var p=e.width,r=e.height,n=
WALK.DEBUG_CAMERA_PATH?new a(p,r):null;this.findPath=function(m,l){n&&n.timeStart("Graph");var u=l.position.z.toFixed(4);if(u!==k){var v={outlineThickness:2,outlineColor:new THREE.Color(0,0,0),slicePlaneHeight:l.position.z};v=f.getCollisionData(v,p,r);q=new d(v,p,r,7);k=u}else q.resetNodeMap();n&&n.timeEnd("Graph");n&&n.timeStart("Raw path");u=g(m,l);n&&n.timeEnd("Raw path");v=[];var t=[];if(2>u.length)t.push(new THREE.Vector2(m.position.x,m.position.y),new THREE.Vector2(l.position.x,l.position.y));
else{n&&n.timeStart("Refine path");var B=v.push,D=B.apply,I=$jscomp,J=I.arrayFromIterable,Q=[u[0]];h(0,u,Q,5);D.call(B,v,J.call(I,Q));n&&n.timeEnd("Refine path");n&&n.timeStart("Calculate points");B=t.push;D=B.apply;I=$jscomp;J=I.arrayFromIterable;Q=[];Q.push(new THREE.Vector2(m.position.x,m.position.y));for(m=1;m<v.length-1;m++)Q.push(q.getScenePointFromNode(v[m]));Q.push(new THREE.Vector2(l.position.x,l.position.y));D.call(B,t,J.call(I,Q));n&&n.timeEnd("Calculate points")}n&&(n.render(q.getNodeMap(),
u,v),n.logTime());return t}}})();(function(){function a(n){return-(Math.cos(Math.PI*n)-1)/2}function b(n,m,l){var u=n.velocity,v=m.velocity,t=m.distance-n.distance,B=Math.sqrt(.5*Math.pow(u,2)+.5*Math.pow(v,2)+t*l);if(B>u&&B>v){var D=.5*(Math.pow(B,2)-Math.pow(u,2))/l;console.assert(.001>Math.abs(t-D-.5*(Math.pow(B,2)-Math.pow(v,2))/l));u=(B-u)/l;m.time=n.time+u+(B-v)/l;return new q(n,m,B,u,D,l)}if(B<=v)return v=Math.sqrt(Math.pow(u,2)+2*t*l),console.assert(.001>Math.abs(t-.5*(Math.pow(v,2)-Math.pow(u,2))/l)),m.time=n.time+v-u,m.velocity=
v,new k(n,m,l);l=2*t/(u+v);console.assert(.001>Math.abs(t-(u*l+.5*(v-u)*l)));m.time=n.time+l;return new k(n,m,(v-u)/l)}function c(n){return new THREE.Vector2(n.x,n.y)}function d(n,m){return new Bezier([n,n.clone().lerp(m,1/3),n.clone().lerp(m,2/3),m])}function e(n,m,l,u){var v=m.distanceTo(n),t=m.distanceTo(l),B=Math.min(t,v);v=B/v;t=B/t;B=.5>u/B?u/B:.5;u=m.clone().lerp(n,B*v);n=m.clone().lerp(n,B/3*v);v=m.clone().lerp(l,B/3*t);m=m.clone().lerp(l,B*t);return new Bezier([u,n,v,m])}var f=Math.PI/3,
g=2*WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED,h=function(n){this.distance=n;this.time=this.velocity=0;this.setVelocityFromCornerAngle=function(m){this.velocity=THREE.Math.mapLinear(Math.max(f,m),f,Math.PI,1,g)}},k=function(n,m,l){this.endTime=function(){return m.time};this.getDistance=function(u){u-=n.time;return n.distance+(n.velocity*u+.5*l*Math.pow(u,2))};this.isTimeWithinEquation=function(u){return u>=n.time&&u<=m.time}},q=function(n,m,l,u,v,t){this.endTime=function(){return m.time};this.getDistance=
function(B){B-=n.time;return B<u?n.distance+(n.velocity*B+.5*t*Math.pow(B,2)):n.distance+v+(l*(B-u)-.5*t*Math.pow(B-u,2))};this.isTimeWithinEquation=function(B){return B>=n.time&&B<=m.time}},p=function(n,m,l){this.endDistance=m;this.getPoint=function(u){u=THREE.Math.mapLinear(u,n,m,0,1);return l.get(u)};this.getRotation=function(u){u=THREE.Math.mapLinear(u,n,m,0,1);u=l.normal(u);return Math.atan2(u.y,u.x)-Math.PI};this.isDistanceWithinCurve=function(u){return u>=n&&u<=m}},r=function(){var n=new THREE.Vector2,
m=new THREE.Vector2;return function(l,u,v){n.subVectors(u,l);m.subVectors(v,u);return Math.asin(WALK.Math.crossVectors2d(n,m)/(n.length()*m.length()))}}();WALK.TeleportMovement=function(n,m,l,u,v,t,B,D,I,J,Q,T){function M(Z){return aa.find(function(ca){return ca.isDistanceWithinCurve(Z)})}function z(){for(var Z=[],ca=1;ca<l.length-1;ca++){var na=l[ca-1],Aa=l[ca],Ca=l[ca+1],qa=r(na,Aa,Ca),fa=THREE.Math.mapLinear(Math.max(f,qa),f,Math.PI,2,6);na=e(na,Aa,Ca,fa);Z.push({bezier:na,angle:qa})}ca=[];ca.push(new h(0));
na=l[0];for(Aa=qa=0;Aa<Z.length;Aa++){var va=Z[Aa-1];Ca=Z[Aa];fa=Z[Aa+1];void 0!==va&&(na=c(va.bezier.points[3]));va=c(Ca.bezier.points[0]);va=d(na,va);if(0<va.length()){var sa=qa,Fa=qa+va.length();sa=new p(sa,Fa,va);aa.push(sa);qa+=va.length()}va=Ca.bezier.length()/2;sa=new p(qa,qa+2*va,Ca.bezier);aa.push(sa);qa+=va;sa=Math.abs(Ca.angle);sa>f&&(Fa=new h(qa),Fa.setVelocityFromCornerAngle(sa),ca.push(Fa));qa+=va;void 0===fa&&(na=c(Ca.bezier.points[3]))}Z=d(na,l[l.length-1]);na=qa+Z.length();na=new p(qa,
na,Z);aa.push(na);qa+=Z.length();ca.push(new h(qa));for(Z=1;Z<ca.length;Z++)na=b(ca[Z-1],ca[Z],Q),S.push(na);oa=function(Ta){return ka.getPoint(Ta)};ka=aa[0];la=S[0];Y=qa;Z=S[S.length-1].endTime();O=Math.max(1.5,Math.min(Z,J));W=S[S.length-1].endTime()/O}function A(){if(5<Y){var Z=M(1.25),ca=WALK.normalizeRotation(Z.getRotation(1.25)-v.x),na=Y-3.75;Z=M(na);var Aa=WALK.normalizeRotation(D.x-Z.getRotation(na));Ba=function(Fa){return 1.25>Fa?(Fa=a(Fa/1.25),v.x+Fa*ca):Fa>na?(Fa=1-a((Fa-na)/(Y-na)),D.x-
Fa*Aa):ka.getRotation(Fa)}}else{var Ca=WALK.normalizeRotation(D.x-v.x);Ba=function(Fa){Fa=a(Fa/Y);return v.x+Fa*Ca}}if(5<Y){var qa=WALK.normalizeRotation(0-v.y),fa=Y-3.25,va=WALK.normalizeRotation(D.y);ma=function(Fa){return 1.75>Fa?(Fa=a(Fa/1.75),v.y+Fa*qa):Fa>fa?a((Fa-fa)/(Y-fa))*va:0}}else{var sa=WALK.normalizeRotation(D.y-v.y);ma=function(Fa){Fa=a(Fa/Y);return v.y+Fa*sa}}}function y(){var Z=WALK.normalizeRotation(D.x-v.x);Ba=function(na){return v.x+a(na/O)*Z};var ca=WALK.normalizeRotation(D.y-
v.y);ma=function(na){return v.y+a(na/O)*ca}}function E(){var Z=3<Y?3:Y;ra=function(ca){return ca<Z?(ca=a(ca/Z),THREE.Math.mapLinear(ca,0,1,u,B)):B}}function K(){ra=function(Z){Z=a(Z/O);return THREE.Math.mapLinear(Z,0,1,u,B)}}function H(){var Z=G*W;Z>la.endTime()&&(la=S.find(function(ca){return ca.isTimeWithinEquation(Z)}));return la.getDistance(Z)}var G=0,O=1.5,Y=0,W=1,ka=null,la=null,oa=null,ra=null,Ba=null,ma=null,Ga=null,aa=[],S=[],R=.001<l[0].distanceTo(l[l.length-1]);R&&z();T&&R?(A(),E()):(y(),
void 0!==B&&(!R&&.001<Math.abs(B-u)&&(Y=Math.abs(B-u),O=Math.max(1.5,Math.min(Math.sqrt(Y/Q),J))),K()),y());void 0!==I&&(Ga=function(Z){Z=a(Z/O);return THREE.Math.mapLinear(Z,0,1,t,I)});this.update=function(Z,ca){G+=Z;if(G<O){T&&R?(Z=H(),Z>ka.endDistance&&(ka=M(Z))):Z=G;if(oa){var na=oa(H());ca.setX(na.x);ca.setY(na.y)}ra&&(na=ra(Z),ca.setZ(na));Ga&&(n.fov=Ga(G),n.updateProjectionMatrix());m.setYawAngle(Ba(Z));m.setPitchAngle(ma(Z));m.cameraPositionUpdated();return!0}return!1}}})();(function(){WALK.AutoClearAlter=function(a){var b,c,d,e;this.set=function(f,g,h){console.assert(void 0===b&&void 0===c&&void 0===d&&void 0===e);b=a.autoClear;c=a.autoClearColor;d=a.autoClearDepth;e=a.autoClearStencil;a.autoClear=f||g||h;a.autoClearColor=f;a.autoClearDepth=g;a.autoClearStencil=h};this.restore=function(){console.assert(void 0!==b&&void 0!==c&&void 0!==d&&void 0!==e);a.autoClear=b;a.autoClearColor=c;a.autoClearDepth=d;a.autoClearStencil=e;e=d=c=b=void 0}}})();(function(){WALK.ClearColorAlter=function(a){var b=new THREE.Color,c=null,d=!1;this.set=function(e,f){console.assert(!d);d=!0;b.copy(a.getClearColor());c=a.getClearAlpha();a.setClearColor(e,f)};this.restore=function(){console.assert(d);d=!1;a.setClearColor(b,c)}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("standard_material_fragment.glsl"),c=new WALK.InlineShader("vec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\n                     inout float opacity) {\n  return addSpecular(baseColor, totalIntensity, opacity);\n}"),d=new THREE.Color,e=new THREE.Vector3(0,0,0),f=new THREE.Vector4(0,0,1,1);WALK.ParallaxModes={basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"};
WALK.StandardMaterial=function(){var g=this;WALK.BaseMaterial.call(this,a,b,this.fragmentShaderHooks());this.type="standard";this.merged=!1;this._opacity=1;Object.defineProperty(this,"opacity",{get:function(){return this._opacity},set:function(k){this._opacity=.99<k?1:k;this.configureTransparency();this.setUniforms();this._updated()}});this.baseColor=new THREE.Color(16777215);this._baseColorTexture=null;this._baseColorTextureCorrection=this.planarReflector=!1;this._baseColorTextureContrast=0;this.baseColorTextureHslOffset=
{h:0,s:0,l:0};this._baseColorCorrectionUniform=new THREE.Vector4;this._emissive=this.lightMapped=!1;this._roughness=this._emissionStrength=1;this._metallic=0;this._lastUsedLightProbeId=this.cubeCameraIndex=null;this._haveTextureLod=WALK.DETECTOR.gl.textureLod;this._mipLevel1=this._mipLevel0=null;this.disableLightProbeTmp=this.disableLightProbe=!1;this._envMapProject=!0;this._hdrOutput=!1;this._bumpScale=.001;this.parallaxCorrection=!1;this.parallaxMode="basic";this.parallaxScale=-.03;this.parallaxMinLayers=
10;this.parallaxMaxLayers=15;this.colorMap=null;this.cameraExposure=0;this.cameraGamma=1;this.headLight=!1;this._uvOffsetScale=null;this._repeatableTexturesRequired=!1;this.highlight=WALK.EDIT_MODE?WALK.EDITOR_SELECTION_COLOR:null;this._specularOff=this._highlightMix=0;this.doNotImport={baseColor:!1,opacity:!1};var h={type:"updated",target:this};this._updated=function(){return g.dispatchEvent(h)};this._alphaInLowerHalf=!1;this._chromaKeyEnabled=void 0;this.chromaKeyColor=(new THREE.Color).setRGB(0,
.94,0);this._chromaKeyDelta=new THREE.Vector3(.1,.1,.1);this._chromaKeyDeltaCoeff=new THREE.Vector3};WALK.StandardMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.StandardMaterial.prototype.constructor=WALK.StandardMaterial;WALK.StandardMaterial.prototype.addTextureProperty=function(g){var h="_"+g;Object.defineProperty(this,g,{get:function(){return this[h]||null},set:function(k){var q=this;(this[h]=k)?k.addLoadedListener(function(){q.setUniforms();q._updated();q=k=null}):(q.setUniforms(),
q._updated())}})};WALK.StandardMaterial.prototype.addTextureProperty("roughnessTexture");WALK.StandardMaterial.prototype.addTextureProperty("metallicTexture");WALK.StandardMaterial.prototype.addTextureProperty("bumpTexture");WALK.StandardMaterial.prototype.fragmentShaderHooks=function(){return c};WALK.StandardMaterial.prototype._useChromaKey=function(){return!(!this.isAnimated||!this.chromaKeyEnabled)};WALK.StandardMaterial.prototype._useAlphaInLowerHalf=function(){return!(!this.isAnimated||!this.alphaInLowerHalf)};
WALK.StandardMaterial.prototype._useBaseColorTextureAsCutout=function(){var g=this._baseColorTexture;return 1===this.opacity&&(g&&g.isCutout||this._useAlphaInLowerHalf()||this._useChromaKey())};WALK.StandardMaterial.prototype.configureTransparency=function(){var g=this._baseColorTexture;g=g&&(g.hasAlpha||this._useAlphaInLowerHalf()||this._useChromaKey());this.transparent=1>this.opacity||g;g=this._useBaseColorTextureAsCutout();this.transparent?(this.blending=THREE.NormalBlending,this.transparentRenderOrder=
g?0:1):this.blending=THREE.NoBlending;this.depthWrite=!this.transparent||g};Object.defineProperty(WALK.StandardMaterial.prototype,"alphaInLowerHalf",{get:function(){return this._alphaInLowerHalf},set:function(g){this._alphaInLowerHalf=g;this.configureTransparency();this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"chromaKeyEnabled",{get:function(){return!!this._chromaKeyEnabled},set:function(g){this._chromaKeyEnabled=!!g;this.configureTransparency();this.setUniforms();
this._updated()}});WALK.StandardMaterial.prototype.setChromaKeyColorRGB=function(g,h,k){this.chromaKeyColor.setRGB(g,h,k);this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.getChromaKeyDeltaComponent=function(g){return this._chromaKeyDelta.getComponent(g)};WALK.StandardMaterial.prototype.setChromaKeyDeltaComponent=function(g,h){this._chromaKeyDelta.setComponent(g,h);this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,"isAnimated",{get:function(){var g=
this.baseColorTexture;return g&&g.isAnimated}});Object.defineProperty(WALK.StandardMaterial.prototype,"isPlaying",{get:function(){var g=this.baseColorTexture;return g&&g.isAnimated&&g.isPlaying}});WALK.StandardMaterial.prototype.rewind=function(){this.baseColorTexture.rewind()};WALK.StandardMaterial.prototype.play=function(){console.assert(this.isAnimated);var g=this.baseColorTexture.isPlaying;this.baseColorTexture.play();this.baseColorTexture.isPlaying!==g&&this._updated()};WALK.StandardMaterial.prototype.pause=
function(){console.assert(this.isAnimated);var g=this.baseColorTexture.isPlaying;this.baseColorTexture.pause();this.baseColorTexture.isPlaying!==g&&this._updated()};WALK.StandardMaterial.prototype.sleepAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.sleepAnimation()};WALK.StandardMaterial.prototype.wakeAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.wakeAnimation()};Object.defineProperty(WALK.StandardMaterial.prototype,"doubleSided",{get:function(){return this.side===
THREE.DoubleSide},set:function(g){this.side=g?THREE.DoubleSide:THREE.FrontSide;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapMirror",{get:function(){return 0===this.roughness&&!this.roughnessTexture}});Object.defineProperty(WALK.StandardMaterial.prototype,"hdrOutput",{get:function(){return this._hdrOutput},set:function(g){g!==this._hdrOutput&&(this._hdrOutput=g,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"specularOff",
{get:function(){return this._specularOff},set:function(g){g!==this._specularOff&&(this._specularOff=g,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"highlightMix",{get:function(){return this._highlightMix},set:function(g){g!==this._highlightMix&&(this._highlightMix=g,this.uniforms.highlightMix.value=g)}});Object.defineProperty(WALK.StandardMaterial.prototype,"cameraExposure",{get:function(){return this._cameraExposure},set:function(g){this._cameraExposure=g;this.setUniform("exposure",
"f",Math.pow(2,g))}});Object.defineProperty(WALK.StandardMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(g){this.setUniform("cameraGamma","f",g)}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTexture",{get:function(){return this._baseColorTexture},set:function(g){var h=this;(this._baseColorTexture=g)?g.addLoadedListener(function(){h.configureTransparency();h._repeatableTexturesRequired&&h.ensureTexturesRepeatable();h.setUniforms();
h._updated();h=g=null}):(h.setUniforms(),h._updated())}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureCorrection",{get:function(){return this._baseColorTextureCorrection},set:function(g){this._baseColorTextureCorrection=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureContrast",{get:function(){return this._baseColorTextureContrast},set:function(g){this._baseColorTextureContrast=g;this.setUniforms();this._updated()}});
WALK.StandardMaterial.prototype.setBaseColorTextureHslOffset=function(g,h,k){this.baseColorTextureHslOffset.h=g;this.baseColorTextureHslOffset.s=h;this.baseColorTextureHslOffset.l=k;this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,"emissive",{get:function(){return this._emissive},set:function(g){this._emissive=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"emissionStrength",{get:function(){return this._emissionStrength},
set:function(g){this._emissionStrength=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"roughness",{get:function(){return this._roughness},set:function(g){this._roughness=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"metallic",{get:function(){return this._metallic},set:function(g){this._metallic=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapProject",
{get:function(){return this._envMapProject},set:function(g){this._envMapProject=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"bumpScale",{get:function(){return this._bumpScale},set:function(g){this._bumpScale=g;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"uvOffsetAndScaleEnabled",{get:function(){return null!==this._uvOffsetScale},set:function(g){g?this.setUvOffsetAndScale(f):(this._uvOffsetScale=null,
this.setUniforms(),this._updated())}});WALK.StandardMaterial.prototype.setDoNotImport=function(g,h){this.doNotImport[g]=h;this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.isLightProbeDisabled=function(){return this.disableLightProbe||this.disableLightProbeTmp||this.specularOff||1===this.roughness&&!this._roughnessTexture||this.transparent&&this.doubleSided};WALK.StandardMaterial.prototype._setLightProbeUniforms=function(){this.setUniform("envMap","t",null);if(!this.condDefine(this._haveTextureLod,
"HAVE_TEXTURE_LOD")){var g=WALK.LIGHT_PROBE_MIPS_COUNT-1;this._mipLevel0=Math.floor(this.roughness*g);this._mipLevel1=Math.min(this._mipLevel0+1,g);this.setUniform("envMap2","t",null)}this.envMapMirror?this.setUniform("envMipsCount","f",1):this.setUniform("envMipsCount","f",0);this.condDefine(this.envMapProject,"USE_ENVMAP_PROJECT")&&(this.setUniform("envMapPosW","v3",e),this.setUniform("envBoxMin","v3",e),this.setUniform("envBoxMax","v3",e));this._lastUsedLightProbeId=null};WALK.StandardMaterial.prototype.getUvOffsetAndScale=
function(g){return g.copy(this._uvOffsetScale||f)};WALK.StandardMaterial.prototype._uvOffsetAndScaleModified=function(){this.ensureTexturesRepeatable();this._updated()};WALK.StandardMaterial.prototype.setUvOffsetAndScale=function(g,h,k,q){this._uvOffsetScale||(this._uvOffsetScale=new THREE.Vector4,this.setUniforms());g instanceof THREE.Vector4?this._uvOffsetScale.copy(g):this._uvOffsetScale.set(g,h,k,q);this._uvOffsetAndScaleModified()};WALK.StandardMaterial.prototype.getUvOffsetAndScaleByProperty=
function(g){return this._uvOffsetScale[g]};WALK.StandardMaterial.prototype.setUvOffsetAndScaleByProperty=function(g,h){switch(g){case "x":this._uvOffsetScale.setX(h);break;case "y":this._uvOffsetScale.setY(h);break;case "z":this._uvOffsetScale.setZ(h);break;case "w":this._uvOffsetScale.setW(h)}this._uvOffsetAndScaleModified()};WALK.StandardMaterial.prototype.ensureTexturesRepeatable=function(){this._repeatableTexturesRequired=!0;var g=this.baseColorTexture;g&&g.parentTexture&&g.parentTexture.loaded&&
(this._haveTextureLod&&WALK.DETECTOR.gl.standardDerivatives?(this.enableStandardDerivativesExtension(),this.enableTextureLodExtension(),this.addDefine("USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT")):this._baseColorTexture.extractedTexture||(g.extractTexture(),this.setUniforms()))};WALK.StandardMaterial.prototype.setUniforms=function(){this.setUniform("opacity","f",this.opacity);var g=!this.isLightProbeDisabled(),h=!1,k=this.roughnessTexture;this.condDefine(k&&k.loaded&&g,"USE_ROUGHNESS_TEXTURE")?(this.setUniform("roughnessTexture",
"t",k),h=!0):this.setUniform("roughness","f",this.roughness);k=this.metallicTexture;this.condDefine(k&&k.loaded&&g,"USE_METALLIC_TEXTURE")?(this.setUniform("metallicTexture","t",k),h=!0):this.setUniform("metallic","f",this.metallic);this.setUniform("emissionStrength","f",this.emissive?this.emissionStrength:0);this._baseColorTexture&&this.baseColorTextureCorrection?(d.set(this.baseColor),d.offsetHSL(this.baseColorTextureHslOffset.h,this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l),
k=Math.max(1+this.baseColorTextureContrast,0),this._baseColorCorrectionUniform.set(k*(d.r-this.baseColor.r-.5)+.5,k*(d.g-this.baseColor.g-.5)+.5,k*(d.b-this.baseColor.b-.5)+.5,k)):this._baseColorCorrectionUniform.set(0,0,0,1);this.setUniform("baseColorCorrection","v4",this._baseColorCorrectionUniform);k=null;if(this._baseColorTexture)if(this._baseColorTexture.parentTexture&&!this._baseColorTexture.extractedTexture){k=this._baseColorTexture.parentTexture;var q=this._baseColorTexture.uvOffsetScale}else k=
this._baseColorTexture.extractedTexture||this._baseColorTexture,q=f;this.condDefine(k&&k.loaded,"USE_BASE_COLOR_TEXTURE")?(this.setUniform("baseColorTexture","t",k),h=!0,this.setUniform("baseColorAtlasUvMod","v4",q),this._useBaseColorTextureAsCutout()?this.setUniform("alphaDiscardThreshold","f",.25):this.setUniform("alphaDiscardThreshold","f",0)):this.setUniform("baseColor","c",this.baseColor);this.condDefine(this._useAlphaInLowerHalf(),"USE_ALPHA_IN_LOWER_HALF");this.condDefine(this._useChromaKey(),
"USE_CHROMA_KEY")&&(this.setUniform("chromaKeyColor","c",this.chromaKeyColor),q=this._chromaKeyDelta,this._chromaKeyDeltaCoeff.x=1/(1.22*q.x),this._chromaKeyDeltaCoeff.y=1/(1.22*q.y),this._chromaKeyDeltaCoeff.z=1/(1.22*q.z),this.setUniform("chromaKeyDeltaCoeff","v3",this._chromaKeyDeltaCoeff));k=this.bumpTexture;this.condDefine(k&&k.loaded&&g,"USE_BUMP_TEXTURE")&&(this.enableStandardDerivativesExtension(),this.setUniform("bumpTexture","t",k),h=!0,this.setUniform("bumpScale","f",this.bumpScale),this.condDefine(this.parallaxCorrection,
"USE_PARALLAX_CORRECTION")&&(this.addDefine(WALK.ParallaxModes[this.parallaxMode]),this.setUniform("parallaxScale","f",this.parallaxScale),this.setUniform("parallaxMinLayers","f",this.parallaxMinLayers),this.setUniform("parallaxMaxLayers","f",this.parallaxMaxLayers)));h&&this.setUniform("uvMod","v4",this._uvOffsetScale||f);this.condDefine(this.lightMapped,"USE_LIGHTMAP")&&this.setUniform("lightMap","t",null);this.condDefine(g,"USE_ENVMAP")&&(this._haveTextureLod&&this.enableTextureLodExtension(),
this._setLightProbeUniforms());this.condDefine(this.highlight,"USE_HIGHLIGTH")&&(this.setUniform("highlight","c",this.highlight),this.setUniform("highlightMix","f",this.highlightMix));this.condDefine(this.hdrOutput,"HDR_OUTPUT");this.condDefine(!this.hdrOutput&&this.colorMap,"USE_COLORMAP")&&this.setUniform("colorMap","t",this.colorMap);this.condDefine((this.headLight||!this.lightMapped)&&!this.specularOff,"USE_HEADLIGHT")};WALK.StandardMaterial.prototype.forceObjectUniformsRefresh=function(){this._lastUsedLightProbeId=
null};WALK.StandardMaterial.prototype.textureNeedsUv0=function(g){return!0};WALK.StandardMaterial.prototype.hash=function(){return this.baseColorTexture?"standard"+this.baseColorTexture.name:"standard#"+this.baseColor.r+":"+this.baseColor.g+":"+this.baseColor.b};WALK.StandardMaterial.prototype.canMerge=function(g){if(this.type!==g.type||this.opacity!==g.opacity)return!1;if(this._baseColorTexture||g._baseColorTexture){if(this._baseColorTexture!==g._baseColorTexture||this.baseColorTextureCorrection!==
g.baseColorTextureCorrection||this.baseColorTextureContrast!==g.baseColorTextureContrast||this.baseColorTextureHslOffset.h!==g.baseColorTextureHslOffset.h||this.baseColorTextureHslOffset.s!==g.baseColorTextureHslOffset.s||this.baseColorTextureHslOffset.l!==g.baseColorTextureHslOffset.l||this._useAlphaInLowerHalf()!==g._useAlphaInLowerHalf()||(this._useChromaKey()?!(g._useChromaKey()&&this.chromaKeyColor.equals(g.chromaKeyColor)&&this._chromaKeyDelta.equals(g._chromaKeyDelta)):g._useChromaKey()))return!1}else if(!this.baseColor.equals(g.baseColor))return!1;
if(this.emissive||g.emissive)if(this.emissive!==g.emissive||this.emissionStrength!==g.emissionStrength)return!1;if(this.roughnessTexture||g.roughnessTexture){if(this.roughnessTexture!==g.roughnessTexture)return!1}else if(this.roughness!==g.roughness)return!1;if(this.metallicTexture||g.metallicTexture){if(this.metallicTexture!==g.metallicTexture)return!1}else if(this.metallic!==g.metallic)return!1;return(this.bumpTexture||g.bumpTexture)&&(this.bumpTexture!==g.bumpTexture||this.bumpScale!==g.bumpScale)||
this.envMapProject!==g.envMapProject||this.doubleSided!==g.doubleSided||this.parallaxCorrection||g.parallaxCorrection?!1:!0};WALK.StandardMaterial.prototype.refreshPerObjectUniforms=function(g,h){var k=!1;if(!this.isLightProbeDisabled()){var q=g.lightProbe;if(this._lastUsedLightProbeId!==q.id){k=!0;this._lastUsedLightProbeId=q.id;var p=this.envMapMirror?q.getMirrorTexture():this._haveTextureLod?q.getFilteredTexture():q.getFilteredTextureNoLod(this._mipLevel0);h.envMap.value=p;this._haveTextureLod||
(h.envMap2.value=q.getFilteredTextureNoLod(this._mipLevel1));this.envMapMirror||(h.envMipsCount.value=WALK.LIGHT_PROBE_MIPS_COUNT);this.envMapProject&&(q.isBoundingBoxEnabled()?(h.envMapPosW.value=q.position,h.envBoxMin.value=q.boxMin,h.envBoxMax.value=q.boxMax):(h.envBoxMin.value=e,h.envBoxMax.value=e))}}g=g.lightMap;this.lightMapped&&h.lightMap.value!==g&&(k=!0,h.lightMap.value=g);return k};WALK.StandardMaterial.prototype.setBaseColorRGB=function(g,h,k){this.baseColor.setRGB(g,h,k);this.setUniforms();
this._updated()};WALK.StandardMaterial.prototype.setTexture=function(g,h){if(h){var k=this.baseColorTexture;k&&(h.wrapS=k.wrapS,h.wrapT=k.wrapT,h.anisotropy=k.anisotropy)}this[g]=h||null;"baseColorTexture"===g?(this._baseColorTextureCorrection=!1,this._baseColorTextureContrast=0,this.baseColorTextureHslOffset.h=0,this.baseColorTextureHslOffset.s=0,this.baseColorTextureHslOffset.l=0):"bumpTexture"===g&&(this._bumpScale=.001)};WALK.StandardMaterial.prototype.serialize=function(){var g=this,h=null;console.assert(!this.merged);
this.baseColorTextureCorrection&&(h={contrast:this.baseColorTextureContrast,hslOffset:[this.baseColorTextureHslOffset.h,this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l]});var k={name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),baseColorTextureCorrection:h,alphaInLowerHalf:this.alphaInLowerHalf,opacity:this.opacity,emissive:this.emissive,emissionStrength:this.emissionStrength,roughness:this.roughness,metallic:this.metallic,envMapProject:this.envMapProject,
bumpScale:this.bumpScale,doubleSided:this.doubleSided,doNotImport:this.doNotImport};void 0!==this._chromaKeyEnabled&&(k.chromaKeyEnabled=this.chromaKeyEnabled,k.chromaKeyColor=this.chromaKeyColor.roundChannels().toArray(),k.chromaKeyDelta=this._chromaKeyDelta.toArray());k.uvOffsetScale=this.uvOffsetAndScaleEnabled?this._uvOffsetScale.toArray():null;h=function(q){var p=g[q];k[q]=p?p.serialize():null};h("baseColorTexture");h("roughnessTexture");h("metallicTexture");h("bumpTexture");return k}})();(function(){WALK.StandardMaterialWater=function(){WALK.StandardMaterial.call(this);this.type="water";this._isPlaying=!0;this._isSleeping=!1;this.setUniform("time","f",0);this._roughness=0;this.baseColor=new THREE.Color(0);this._wavesScale=this._wavesSpeed=1;this._refractionFactor=0;this.opacity=.2;this.doNotImport={baseColor:!0,baseColorTexture:!0,opacity:!0}};WALK.StandardMaterialWater.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.StandardMaterialWater.prototype.constructor=WALK.StandardMaterialWater;
WALK.StandardMaterialWater.prototype.addTextureProperty("normalTexture");WALK.StandardMaterialWater.prototype.textureNeedsUv0=function(a){return!1};WALK.StandardMaterialWater.prototype.hash=function(a){return"water"};WALK.StandardMaterialWater.prototype.canMerge=function(a){return this.type===a.type&&this.opacity===a.opacity&&this.baseColor.equals(a.baseColor)&&this.normalTexture===a.normalTexture&&this.wavesSpeed===a.wavesSpeed&&this.wavesScale===a.wavesScale&&this.refractionFactor===a.refractionFactor};
WALK.StandardMaterialWater.prototype.setUniforms=function(){WALK.StandardMaterial.prototype.setUniforms.call(this);var a=this.normalTexture;this.condDefine(a&&a.loaded&&!this.isLightProbeDisabled(),"USE_NORMAL_TEXTURE")&&(this.setUniform("normalTexture","t",a),this.setUniform("wavesScale","f",this.wavesScale),1!==this.opacity?this.setUniform("refractionFactor","f",this.refractionFactor):this.setUniform("refractionFactor","f",0))};WALK.StandardMaterialWater.prototype.fragmentShaderHooks=function(){return WALK.getShader("water.glsl")};
Object.defineProperty(WALK.StandardMaterialWater.prototype,"refractionFactor",{get:function(){return this._refractionFactor},set:function(a){this._refractionFactor=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesSpeed",{get:function(){return this._wavesSpeed},set:function(a){this._wavesSpeed=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesScale",{get:function(){return this._wavesScale},
set:function(a){this._wavesScale=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"hideFromLightProbes",{get:function(){return 1!==this.opacity&&0!==this.refractionFactor}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isAnimated",{get:function(){return!0}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying&&0<this.wavesSpeed}});WALK.StandardMaterialWater.prototype.play=
function(){this._isPlaying=!0};WALK.StandardMaterialWater.prototype.pause=function(){this._isPlaying=!1};WALK.StandardMaterialWater.prototype.sleepAnimation=function(){this._isSleeping=!0};WALK.StandardMaterialWater.prototype.wakeAnimation=function(){this._isSleeping=!1};WALK.StandardMaterialWater.prototype.update=function(a){this.uniforms.time.value+=a*this.wavesSpeed*.1};WALK.StandardMaterialWater.prototype.serialize=function(){return{name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),
baseColorTexture:null,opacity:this.opacity,normalTexture:this.normalTexture?this.normalTexture.serialize():null,wavesSpeed:this.wavesSpeed,wavesScale:this.wavesScale,refractionFactor:this.refractionFactor,doNotImport:this.doNotImport}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("luma_fragment.glsl"),c=new THREE.Color(16777215);WALK.LumaMaterial=function(d){WALK.BaseMaterial.call(this,a,b);this.computeIncidentLuma=d;this.setUniform("lightMap","t",null);this.color=new THREE.Color(c);this.setUniform("color","c",this.color);this.addDefine("USE_LIGHTMAP")};WALK.LumaMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LumaMaterial.prototype.constructor=WALK.LumaMaterial;WALK.LumaMaterial.prototype.refreshPerObjectUniforms=
function(d,e){var f=d.lightMap,g=!1;e.lightMap.value!==f&&(e.lightMap.value=f,g=!0);d=this.computeIncidentLuma?c:d.material.baseColor;d.equals(this.color)||(this.color.copy(d),g=!0);return g}})();(function(){WALK.DebugMaterial=function(){WALK.StandardMaterial.call(this);this.noSharedBuffers=new THREE.Color(16777215);this.sharedBuffersMaster=new THREE.Color(255);this.sharedBuffersCopy=new THREE.Color(65280);this.headLight=!0;this.setUniforms();this.defaultAttributeValues=Object.assign({},this.defaultAttributeValues);this.defaultAttributeValues.sphericalNormal=[0,0]};WALK.DebugMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.DebugMaterial.prototype.refreshPerObjectUniforms=
function(a,b){b.baseColor.value=0===a.sharedBuffersDebug?this.noSharedBuffers:1===a.sharedBuffersDebug?this.sharedBuffersMaster:this.sharedBuffersCopy;return!0}})();(function(){var a=WALK.getShader("equirect_sky_vertex.glsl"),b=WALK.getShader("equirect_sky_fragment.glsl");WALK.EquirectSkyMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.depthWrite=!1;this.side=THREE.FrontSide;this.uniforms={map:{type:"t",value:null},colorMap:{type:"t",value:null},exposure:{type:"f",value:1},cameraGamma:{type:"f",value:1}}};WALK.EquirectSkyMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.EquirectSkyMaterial.prototype.constructor=WALK.EquirectSkyMaterial;
Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"map",{get:function(){return this.uniforms.map.value},set:function(c){this.uniforms.map.value=c;this.condDefine(this.map.isRgbm,"USE_RGBM_MAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(c){this.condDefine(c,"HDR_OUTPUT")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(c){this.uniforms.colorMap.value=
c;this.condDefine(c,"USE_COLORMAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraExposure",{get:function(){return Math.log2(this.uniforms.exposure.value)},set:function(c){this.uniforms.exposure.value=Math.pow(2,c)}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(c){this.uniforms.cameraGamma.value=c}})})();(function(){WALK.ProceduralSkyMaterial=function(){WALK.BaseMaterial.call(this,WALK.getShader("procedural_sky_vertex.glsl"),WALK.getShader("procedural_sky_fragment.glsl"));this.depthWrite=!1;this.side=THREE.BackSide;this.uniforms={topColor:{type:"c",value:new THREE.Color(15135487)},bottomColor:{type:"c",value:new THREE.Color(16777215)},sinBottomAngle:{type:"f",value:Math.sin(THREE.Math.degToRad(-30))},exponent:{type:"f",value:.9},colorMap:{type:"t",value:null}}};WALK.ProceduralSkyMaterial.prototype=
Object.create(WALK.BaseMaterial.prototype);WALK.ProceduralSkyMaterial.prototype.constructor=WALK.ProceduralSkyMaterial;Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(a){this.uniforms.colorMap.value=a;this.condDefine(a,"USE_COLORMAP")}})})();(function(){var a=WALK.getShader("object_distance_vertex.glsl"),b=WALK.getShader("object_id_fragment.glsl"),c=WALK.getShader("object_id_distance_fragment.glsl");WALK.ObjectDistanceMaterial=function(d){WALK.BaseMaterial.call(this,a,d?b:c);this.doNotOverrideSide=!0;this.uniforms={objectId:{type:"i",value:null}}};WALK.ObjectDistanceMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.ObjectDistanceMaterial.prototype.constructor=WALK.ObjectDistanceMaterial;WALK.ObjectDistanceMaterial.prototype.refreshPerObjectUniforms=
function(d,e){e.objectId.value=d.visibilityId;return!0}})();(function(){var a=WALK.getShader("wireframe_vertex.glsl"),b=WALK.getShader("wireframe_fragment.glsl");WALK.WireframeMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.lineColor=c;this.setUniform("lineColor","c",c);this.setUniform("lineMaxAlpha","f",.65);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0);this.customLightmapResolutionLineColor=new THREE.Color(170);this.autoLightmapResolutionLineColor=new THREE.Color(43690);this.meshSelectedLineColor=
new THREE.Color(47872);this.meshSelectedSecondaryLineColor=new THREE.Color(13404160);this.transparent=!0;this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.attributes=this.attributes.concat(["order"]);this.enableStandardDerivativesExtension()};WALK.WireframeMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.WireframeMaterial.prototype.constructor=WALK.WireframeMaterial;WALK.WireframeMaterial.prototype.propertyFromUniform("lineMaxAlpha");WALK.WireframeMaterial.prototype.propertyFromUniform("highlight");
WALK.WireframeMaterial.prototype.propertyFromUniform("highlightMix");WALK.WireframeMaterial.prototype.refreshPerObjectUniforms=function(c,d){var e=!1;null!==c.highlightMix&&void 0!==c.highlightMix&&c.highlightMix!==d.highlightMix.value&&(d.highlightMix.value=c.highlightMix,e=!0);return null!==c.selected&&void 0!==c.selected&&(c=!0===c.selected?this.meshSelectedLineColor:!0===c.selectedSecondary?this.meshSelectedSecondaryLineColor:null!==c.node.lightmapResolution?this.customLightmapResolutionLineColor:
0<=c.autoLightmapResolution?this.autoLightmapResolutionLineColor:this.lineColor,d.lineColor.value!==c)?(d.lineColor.value=c,!0):e}})();(function(){var a=new WALK.InlineShader("attr vec3 envLookup;\nvarOut vec3 vEnvLookup;\nvoid main() {\nvEnvLookup = envLookup;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"),b=new WALK.InlineShader("uniform samplerCube envMap;\nvarIn vec3 vEnvLookup;\nvoid main() {\nint objectId = int(textureCube(envMap, vEnvLookup).x);\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 1.0);\n}");
WALK.ObjectDistanceReader=function(c,d){var e=[],f=[],g=3*d,h=2*d;this.readCubeMapToBuffer=function(l){m.uniforms.envMap.value=l;n.set(!0,!1,!1);c.render(q,k,p);c.readPixels(g,h,r);n.restore();return r};this.dispose=function(){for(var l=0;6>l;l+=1)e[l].geometry.dispose();m.dispose();p.dispose();r=null};var k=new THREE.OrthographicCamera(-1,1,1,-1,0,1);var q=new THREE.Scene;var p=c.createRenderTarget(g,h,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});
var r=new Uint8Array(4*g*h);var n=new WALK.AutoClearAlter(c);var m=new WALK.BaseMaterial(a,b);m.uniforms={envMap:{type:"t",value:null}};m.attributes={envLookup:{type:"v3",value:null}};(function(){for(var l=[[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1]],[[-1,1,-1],[-1,1,1],[-1,-1,-1],[-1,-1,1]],[[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1]],[[-1,-1,1],[1,-1,1],[-1,-1,-1],[1,-1,-1]],[[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1]],[[1,1,-1],[-1,1,-1],[1,-1,-1],[-1,-1,-1]]],u=0;6>u;u+=1){var v=new THREE.PlaneBufferGeometry(d,d),
t=new Float32Array(12);v.addAttribute("envLookup",new THREE.BufferAttribute(t,3));for(var B=0;4>B;B+=1){var D=B,I=l[u][B];t[3*D]=I[0];t[3*D+1]=I[1];t[3*D+2]=I[2]}e[u]=new THREE.Mesh(v,m);q.add(e[u])}f[0]=[0,0];f[1]=[d,0];f[2]=[2*d,0];f[3]=[0,d];f[4]=[d,d];f[5]=[2*d,d]})();(function(l,u){l/=2;var v=u/2;k.left=-l;k.right=l;k.top=v;k.bottom=-v;k.updateProjectionMatrix();u=-l+d/2;l=v-d/2;for(v=0;v<e.length;v+=1)e[v].position.set(u+f[v][0],l-f[v][1],0)})(g,h)}})();(function(){WALK.ObjectVisibilityQuery=function(a,b,c){var d=new WALK.ObjectDistanceMaterial(!0),e=new WALK.CubeCamera(WALK.CAMERA_WALK_NEAR,c),f=WALK.OBJECT_VISIBILITY_TARGET_SIZE,g=a.createRenderTarget(f,f,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,depthBuffer:!0,stencilBuffer:!1,generateMipmaps:!1}),h=new Uint8Array(4*f*f),k=new WALK.AutoClearAlter(a),q=new WALK.ClearColorAlter(a),p=new THREE.Color(16777215);this.findVisibleObjects=function(r){var n=new Set,m=[];e.position.copy(r);
e.updateMatrixWorld();for(r=0;r<b.length;r+=1){var l=b[r];console.assert(!l.visibilityId);l.visibilityId=r;m.push(l)}k.set(!0,!0,!1);q.set(p);for(r=0;6>r;r+=1){a.renderMeshes(m,d,e.sideCameras[r],g);a.readPixels(f,f,h);l=h;for(var u=l.length,v=0;v<u;v+=4){var t=Math.round(65536*l[v]+256*l[v+1]+l[v+2]);16777215!==t&&n.add(t)}}q.restore();k.restore();m=[];n=$jscomp.makeIterator(n);for(r=n.next();!r.done;r=n.next())m.push(b[r.value]);for(n=0;n<b.length;n+=1)b[n].visibilityId=null;return m};this.dispose=
function(){d.dispose();g.dispose();h=g=null}};WALK.ObjectVisibilityQuery.prototype.constructor=WALK.ObjectDistanceQuery})();(function(){var a=WALK.getShader("aabb_query_vertex.glsl"),b=WALK.getShader("aabb_query_fragment.glsl");WALK.AabbQueryMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.side=THREE.DoubleSide;this.uniforms={axis:{type:"i",value:0}}};WALK.AabbQueryMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.AabbQueryMaterial.prototype.constructor=WALK.AabbQueryMaterial;Object.defineProperty(WALK.AabbQueryMaterial.prototype,"axis",{get:function(){return this.uniforms.axis.value},set:function(c){console.assert(0===
c||1===c||2===c);this.uniforms.axis.value=c}})})();(function(){var a=WALK.getShader("gaze_pointer_vertex.glsl"),b=WALK.getShader("gaze_pointer_fragment.glsl");WALK.GazePointerMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.transparent=!0;this.transparentRenderOrder=2;this.setUniform("circleSpan","f",0)};WALK.GazePointerMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.GazePointerMaterial.prototype.constructor=WALK.GazePointerMaterial;Object.defineProperty(WALK.GazePointerMaterial.prototype,
"circleSpan",{set:function(c){console.assert(1>=c);this.uniforms.circleSpan.value=2*Math.PI*c-Math.PI}})})();(function(){var a=WALK.getShader("editor_light_vertex.glsl"),b=WALK.getShader("editor_light_fragment.glsl");WALK.LightMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.setUniform("color","c",c.color);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0)};WALK.LightMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LightMaterial.prototype.propertyFromUniform("highlightMix")})();(function(){WALK.MirrorMaterial=function(a,b){WALK.BaseMaterial.call(this,WALK.getShader("mirror_vertex.glsl"),WALK.getShader("mirror_fragment.glsl"));this.hideFromLightProbes=!0;this.uniforms={mirrorColor:{type:"c",value:a},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:b}}};WALK.MirrorMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.MirrorMaterial.prototype.constructor=WALK.MirrorMaterial;Object.defineProperty(WALK.MirrorMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},
set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.MirrorMaterial.prototype,"mirrorSampler",{get:function(){return this.uniforms.mirrorSampler.value},set:function(a){this.uniforms.mirrorSampler.value=a}})})();(function(){var a=WALK.getShader("cap_vertex.glsl"),b=WALK.getShader("cap_fragment.glsl");WALK.CapMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.side=THREE.DoubleSide;this.uniforms={color:{type:"c",value:c}}};WALK.CapMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.CapMaterial.prototype.constructor=WALK.CapMaterial})();(function(){var a=WALK.getShader("outline_vertex.glsl"),b=WALK.getShader("outline_fragment.glsl");WALK.OutlineMaterial=function(c,d){WALK.BaseMaterial.call(this,a,b);this.side=THREE.DoubleSide;this.uniforms={color:{type:"c",value:c},thickness:{type:"f",value:d}}};WALK.OutlineMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.OutlineMaterial.prototype.constructor=WALK.OutlineMaterial})();(function(){WALK.createBoundingBoxMaterial=function(){var a=new WALK.WireframeMaterial(WALK.EDITOR_SELECTION_COLOR);a.depthTest=!0;a.depthWrite=!1;a.side=THREE.DoubleSide;a.hideFromLightProbes=!0;return a}})();(function(){var a=WALK.getShader("anchor_vertex.glsl");WALK.AnchorMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=a;this._metallic=.1;this._roughness=.5;this._bumpScale=.01;this.hideFromLightProbes=!0};WALK.AnchorMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);var b=WALK.getShader("anchor_sprite_vertex.glsl");WALK.AnchorSpriteMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=b;this.hideFromLightProbes=!0};WALK.AnchorSpriteMaterial.prototype=
Object.create(WALK.StandardMaterial.prototype)})();(function(){var a=WALK.getShader("rotate_gizmo_material_vertex.glsl"),b=WALK.getShader("rotate_gizmo_material_fragment.glsl");WALK.RotateGizmoMaterial=function(c,d){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.transparent=!0;this.transparentRenderOrder=1E3;this.hideFromLightProbes=!0;this.uniforms={opacity:{type:"f",value:1},color:{type:"c",value:c},gizmoPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},sphereRadius:{type:"f",value:1}};
Object.defineProperty(this,"color",{get:function(){return this.uniforms.color.value}});Object.defineProperty(this,"opacity",{get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}});Object.defineProperty(this,"gizmoPosition",{get:function(){return this.uniforms.gizmoPosition.value}});Object.defineProperty(this,"sphereRadius",{get:function(){return this.uniforms.sphereRadius.value},set:function(e){this.uniforms.sphereRadius.value=e}});this.opacity=d;this.setUniforms=
function(){}};WALK.RotateGizmoMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.RotateGizmoMaterial.prototype.constructor=WALK.RotatoGizmoMaterial})();(function(){WALK.Camera=function(){var a=this;THREE.PerspectiveCamera.call(this,WALK.CAMERA_DEFAULT_FOV,1,WALK.CAMERA_WALK_NEAR,WALK.CAMERA_MIN_FAR);this._defaultFov=this.fov;this._exposure=this._defaultExposure=0;this._gamma=this._defaultGamma=1;this._autoExposure=!1;this._autoExposureDarkness=.3;this._moveMaxSpeed=WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;this._autoClimb=this._autoPath=!1;this._colorMap=this._fixedHeight=null;this._exposureUpdatedEvent={type:"exposureUpdated",target:null};this._gammaUpdatedEvent=
{type:"gammaUpdated",target:null};this._colorMapUpdated={type:"colorMapUpdated",target:null};var b={type:"updated",target:this};this._updated=function(){return a.dispatchEvent(b)}};WALK.Camera.prototype=Object.create(THREE.PerspectiveCamera.prototype);WALK.Camera.prototype.constructor=WALK.Camera;Object.defineProperty(WALK.Camera.prototype,"defaultFov",{get:function(){return this._defaultFov},set:function(a){this.fov=this._defaultFov=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,
"colorMap",{get:function(){return this._colorMap},set:function(a){var b=this;this._colorMap&&this._colorMap.dispose();(this._colorMap=a)?a.addLoadedListener(function(){return b.dispatchEvent(b._colorMapUpdated)}):this.dispatchEvent(this._colorMapUpdated)}});WALK.Camera.prototype.colorMapReady=function(){return this._colorMap&&this._colorMap.loaded};Object.defineProperty(WALK.Camera.prototype,"defaultExposure",{get:function(){return this._defaultExposure},set:function(a){this._defaultExposure=a;this._updated()}});
Object.defineProperty(WALK.Camera.prototype,"exposure",{get:function(){return this._exposure},set:function(a){a!==this._exposure&&(this._exposure=a,this.dispatchEvent(this._exposureUpdatedEvent))}});WALK.Camera.prototype.setExposureController=function(a){this.exposureController=a};WALK.Camera.prototype.setExposure=function(a){this.exposureController?this.exposureController.setTargetExposure(a):this.exposure=a};Object.defineProperty(WALK.Camera.prototype,"defaultGamma",{get:function(){return this._defaultGamma},
set:function(a){this._defaultGamma=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"gamma",{get:function(){return this._gamma},set:function(a){a!==this._gamma&&(this._gamma=a,this.dispatchEvent(this._gammaUpdatedEvent))}});WALK.Camera.prototype.setGamma=function(a){this.gamma=a};Object.defineProperty(WALK.Camera.prototype,"autoExposure",{get:function(){return this._autoExposure},set:function(a){a!==this._autoExposure&&(this._autoExposure=a,this._exposure=this._defaultExposure,this._updated())}});
WALK.Camera.prototype.setFar=function(a){this.far=a;this.updateProjectionMatrix();this._updated()};Object.defineProperty(WALK.Camera.prototype,"moveMaxSpeed",{get:function(){return this._moveMaxSpeed},set:function(a){this._moveMaxSpeed=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoPath",{get:function(){return this._autoPath},set:function(a){this._autoPath=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoClimb",{get:function(){return this._autoClimb},set:function(a){this._autoClimb=
a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoExposureDarkness",{get:function(){return this._autoExposureDarkness},set:function(a){this._autoExposureDarkness=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"fixedHeight",{get:function(){return this._fixedHeight||WALK.CAMERA_FIXED_HEIGHT},set:function(a){this._fixedHeight=a;this._updated()}});WALK.Camera.prototype.serialize=function(){return{fov:this.defaultFov,exposure:this.defaultExposure,gamma:this.defaultGamma,
lutTexture:this.colorMap?this.colorMap.serialize():null,autoPath:this.autoPath,autoClimb:this.autoClimb,moveMaxSpeed:this.moveMaxSpeed,fixedHeight:this._fixedHeight}};THREE.EventDispatcher.prototype.apply(WALK.Camera.prototype)})();(function(){WALK.LightInstance=function(b,c,d){this.light=b;this.position=c;this.rotation=d;this._directionW=new THREE.Vector3};WALK.LightInstance.prototype={constructor:WALK.LightInstance,directionW:function(){this._directionW.set(0,1,0);this._directionW.applyEuler(this.rotation);return this._directionW},get index(){var b=this.light.instances.indexOf(this);console.assert(-1!==b,"Light instance not found");return b},setPosition:function(b,c,d){this.position.set(b,c,d);this.light._updated()},setRotation:function(b,
c,d){this.rotation.yaw=WALK.normalizeRotation(b);this.rotation.pitch=WALK.normalizeRotation(c);this.rotation.roll=WALK.normalizeRotation(d);this.light._updated()},setRotationDeg:function(b,c,d){b=THREE.Math.degToRad(b);c=THREE.Math.degToRad(c);d=void 0===d?this.rotation.roll:THREE.Math.degToRad(d);this.setRotation(b,c,d)},serialize:function(){return{position:this.position.toArray(),rotation:this.rotation.toDegTriple()}}};var a="angle color height photometricProfile strength size type width".split(" ");
WALK.Light=function(b){this._name=b.name;this._type=b.type||"spot";if(void 0!==b.strength)var c=b.strength;else a:{switch(this._type){case "point":case "spot":case "area":c=25;break a;case "sun":c=8;break a;default:console.assert(!1)}c=void 0}this._strength=c;if(void 0!==b.color)c=(new THREE.Color).fromArray(b.color);else a:{switch(this._type){case "point":case "spot":case "area":c=new THREE.Color(1,.88,.799);break a;case "sun":c=new THREE.Color(1,.8,.638);break a;default:console.assert(!1)}c=void 0}this._color=
c;if(void 0!==b.size)c=b.size;else a:{switch(this._type){case "point":case "spot":case "area":c=.1;break a;case "sun":c=.02;break a;default:console.assert(!1)}c=void 0}this._size=c;this._width=void 0!==b.width?b.width:.2;this._height=void 0!==b.height?b.height:.2;this._angle=void 0!==b.angle?b.angle:140;this._photometricProfile=void 0!==b.photometricProfile?b.photometricProfile:null;!0===b.doNotImport?this.doNotImport=!0:(this.doNotImport={},b.doNotImport&&WALK.copyProperties(b.doNotImport,a,this.doNotImport));
this.instances=[]};WALK.Light.prototype={constructor:WALK.Light,forEachLightInstance:function(b){for(var c=0;c<this.instances.length;c+=1)b(this.instances[c])},get name(){return this._name},set name(b){this._name=b;this._updated()},get type(){return this._type},set type(b){this._type=b;this._updated()},get size(){return this._size},set size(b){this._size=b;this._updated()},get width(){return this._width},set width(b){this._width=b;this._updated()},get height(){return this._height},set height(b){this._height=
b;this._updated()},get angle(){return this._angle},set angle(b){this._angle=b;this._updated()},get color(){return this._color},setColorRGB:function(b,c,d){this._color.setRGB(b,c,d);this._updated()},get strength(){return this._strength},set strength(b){this._strength=b;this._updated()},get photometricProfile(){return this._photometricProfile},set photometricProfile(b){this._photometricProfile=b;this._updated()},setDoNotImport:function(b,c){this.doNotImport[b]=c;this._updated()},addInstance:function(b,
c){c=void 0===c?[0,-90,0]:c;b=(new THREE.Vector3).fromArray(b);c=(new WALK.Euler).setFromDegTriple(c);c=new WALK.LightInstance(this,b,c);this.instances.push(c);this.dispatchEvent({type:"instanceAdded",instance:c,target:this})},removeInstance:function(b){WALK.removeFromArray(b,this.instances);this.dispatchEvent({type:"instanceRemoved",instance:b,target:this})},serialize:function(){return{name:this.name,type:this.type,angle:this.angle,strength:this.strength,photometricProfile:this.photometricProfile,
size:this.size,width:this.width,height:this.height,color:this.color.roundChannels().toArray(),doNotImport:this.doNotImport,instances:this.instances.map(function(b){return b.serialize()})}},_updated:function(){this.dispatchEvent({type:"updated",target:this})}};THREE.EventDispatcher.prototype.apply(WALK.Light.prototype);WALK.Light.iterateLightInstances=function(b,c){for(var d=1,e=0;e<b.length;e+=1)for(var f=b[e],g=0;g<f.instances.length;g+=1,d+=1)c(f,f.instances[g],d)}})();(function(){WALK.LightProbe=function(a){this.id=a.id;this.position=new THREE.Vector3;a.position&&this.position.fromArray(a.position);this._filteredCubeTexture=null;this._filteredCubeTextureNoLod={};this._mirrorCubeTexture=null;this._boxEnabled=a.box?!("enabled"in a.box)||a.box.enabled:!1;this.boxMin=new THREE.Vector3;this.boxMax=new THREE.Vector3;a.box&&(this.boxMin.fromArray(a.box.min),this._setClampedBoxMax(a.box.max[0],a.box.max[1],a.box.max[2]))};WALK.LightProbe.prototype={constructor:WALK.LightProbe,
setFilteredTexture:function(a){this._filteredCubeTexture&&this._filteredCubeTexture.dispose();this._filteredCubeTexture=a},setFilteredTextureNoLod:function(a,b){this._filteredCubeTextureNoLod[b]&&this._filteredCubeTextureNoLod[b].dispose();this._filteredCubeTextureNoLod[b]=a},isBoundingBoxInitialized:function(){return!this.boxMin.equals(this.boxMax)},resetBoundingBox:function(){this.boxMin.set(0,0,0);this.boxMax.set(0,0,0)},isBoundingBoxEnabled:function(){return this._boxEnabled},disableBoundingBox:function(){this._boxEnabled=
!1;this.dispatchEvent({type:"boundsUpdated",target:this})},enableBoundingBox:function(){this._boxEnabled=!0;this.isBoundingBoxInitialized()||this.dispatchEvent({type:"boundsInit",target:this});this.dispatchEvent({type:"boundsUpdated",target:this})},getFilteredTexture:function(){return this._filteredCubeTexture},getFilteredTextureNoLod:function(a){return this._filteredCubeTextureNoLod[a]},setMirrorTexture:function(a){this._mirrorCubeTexture&&this._mirrorCubeTexture.dispose();this._mirrorCubeTexture=
a},setPosition:function(a,b,c){this.position.set(a,b,c);this.dispatchEvent({type:"positionUpdated",target:this})},texturesReady:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},getMirrorTexture:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},_setClampedBoxMin:function(a,b,c){a>this.boxMax.x-.1&&(a=this.boxMax.x-.1);b>this.boxMax.y-.1&&(b=this.boxMax.y-.1);c>this.boxMax.z-.1&&(c=this.boxMax.z-
.1);this.boxMin.set(a,b,c)},setBoxMin:function(a,b,c){this._setClampedBoxMin(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},_setClampedBoxMax:function(a,b,c){a<this.boxMin.x+.1&&(a=this.boxMin.x+.1);b<this.boxMin.y+.1&&(b=this.boxMin.y+.1);c<this.boxMin.z+.1&&(c=this.boxMin.z+.1);this.boxMax.set(a,b,c)},setBoxMax:function(a,b,c){this._setClampedBoxMax(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},serialize:function(){var a={id:this.id,position:this.position.toArray()};
this.isBoundingBoxInitialized()&&(a.box={enabled:this._boxEnabled,min:this.boxMin.toArray(),max:this.boxMax.toArray()});return a},dispose:function(){this._filteredCubeTexture&&(this._filteredCubeTexture.dispose(),this._filteredCubeTexture=null);for(var a in this._filteredCubeTextureNoLod)this._filteredCubeTextureNoLod.hasOwnProperty(a)&&this._filteredCubeTextureNoLod[a].dispose();this._filteredCubeTextureNoLod={};this._mirrorCubeTexture&&(this._mirrorCubeTexture.dispose(),this._mirrorCubeTexture=
null)}};THREE.EventDispatcher.prototype.apply(WALK.LightProbe.prototype)})();(function(){function a(e){return null!==e&&void 0!==e}function b(e){e.configure()}function c(e){e.visitSubtree(b)}function d(e){function f(){k=new THREE.Vector3;var r=new THREE.Box3;e.visitSubtree(function(n){(n=n.mesh)&&r.union(n.geometry.boundingBox)});r.center(k);h.elements[12]=-k.x;h.elements[13]=-k.y;h.elements[14]=-k.z}var g=new THREE.Matrix4,h=new THREE.Matrix4,k,q=new THREE.Vector3,p=new WALK.Euler;return function(r,n){k||f();if(e.config.faceCamera)return q.copy(n).sub(k).normalize(),p.setFromDirection(q),
"yaw"===e.config.faceCamera&&(p.pitch=0),g.makeRotationFromEuler(p),e.animationMatrix.identity().setPosition(k).multiply(g).multiply(h),!1;console.assert(e.config.rotate);p.yaw=WALK.normalizeRotation(p.yaw+2*Math.PI*e.config.rotationSpeed*r);g.makeRotationFromEuler(p);e.animationMatrix.identity().setPosition(k).multiply(g).multiply(h);return!0}}WALK.NodeConfig=function(e){var f=this;this.name=e.name;this._editable=e.editable||!1;this._setsDisableCollisions=a(e.disableCollisions);this._disableCollisions=
e.disableCollisions||!1;this._setsHideInViews=a(e.hideInViews);this.hideInViews=null;e.hideInViews&&(this.hideInViews=e.hideInViews,this.hideInViews.sort());this._lightmapResolution=(this._setsLightmapResolution=a(e.lightmapResolution))?e.lightmapResolution:null;this._ground=a(e.ground)?e.ground:!1;this._faceCamera=e.faceCamera||null;this._rotate=e.rotate||!1;this._rotationSpeed=e.rotationSpeed||.1;this._isolateShadows=a(e.isolateShadows)?e.isolateShadows:!1;this.nodes=[];var g={type:"updated",target:this};
this._updated=function(){return f.dispatchEvent(g)}};WALK.NodeConfig.prototype.constructor=WALK.NodeConfig;THREE.EventDispatcher.prototype.apply(WALK.NodeConfig.prototype);WALK.NodeConfig.prototype._configUpdated=function(){this.nodes.forEach(c);this._updated()};WALK.NodeConfig.prototype.addNode=function(e){this.nodes.push(e)};WALK.NodeConfig.prototype.isOnHideInViews=function(e){return-1!==this.hideInViews.indexOf(e)};WALK.NodeConfig.prototype.addToHideInViews=function(e){for(var f=[],g=0;g<arguments.length;++g)f[g-
0]=arguments[g];console.assert(this.setsHideInViews);f=$jscomp.makeIterator(f);for(g=f.next();!g.done;g=f.next())g=g.value,console.assert(!this.isOnHideInViews(g)),this.hideInViews.push(g);this._updated()};WALK.NodeConfig.prototype.removeFromHideInViews=function(e){if(this.hideInViews)for(var f=0;f<this.hideInViews.length;)this.hideInViews[f]===e?this.hideInViews.splice(f,1):f+=1;this._updated()};WALK.NodeConfig.prototype.serialize=function(){return{name:this.name,disableCollisions:this.setsDisableCollisions?
this.disableCollisions:null,hideInViews:this.setsHideInViews?this.hideInViews:null,lightmapResolution:this.setsLightmapResolution?this.lightmapResolution:null,ground:this.ground?!0:null,faceCamera:this.faceCamera,rotate:this.rotate?!0:null,rotationSpeed:this.rotate?this.rotationSpeed:null,isolateShadows:this.isolateShadows?!0:null}};Object.defineProperty(WALK.NodeConfig.prototype,"setsDisableCollisions",{get:function(){return this._setsDisableCollisions},set:function(e){this._setsDisableCollisions=
e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"disableCollisions",{get:function(){return this._disableCollisions},set:function(e){console.assert(this._setsDisableCollisions);this._disableCollisions=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"editable",{get:function(){return this._editable||this.faceCamera||this.rotate},set:function(e){this._editable=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"ground",{get:function(){return this._ground},
set:function(e){this._ground=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"faceCamera",{get:function(){return this._faceCamera},set:function(e){this._faceCamera=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"rotationSpeed",{get:function(){return this._rotationSpeed},set:function(e){0===e&&(e=
.01);this._rotationSpeed=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsLightmapResolution",{get:function(){return this._setsLightmapResolution},set:function(e){this._setsLightmapResolution=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"lightmapResolution",{get:function(){return this._lightmapResolution},set:function(e){console.assert(this._setsLightmapResolution);this._lightmapResolution=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,
"isolateShadows",{get:function(){return this._isolateShadows},set:function(e){this._isolateShadows=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsHideInViews",{get:function(){return this._setsHideInViews},set:function(e){this._setsHideInViews=e;null===this.hideInViews&&(this.hideInViews=[]);this._configUpdated()}});WALK.Node=function(e,f,g){this.id=g.id;this.initialLightProbeId=void 0===g.lightProbeId?null:g.lightProbeId;this.parent=e;this.config=f;this.children=[];
this.shadowsIsolatedWithin=this.lightmapResolution=this.hideInViews=this.animationMatrix=this.ground=this.disableCollisions=this._facesCnt=this.mesh=null;this.editable=!1;f.addNode(this);this.configure()};WALK.Node.prototype.constructor=WALK.Node;WALK.Node.prototype.configure=function(){this.ground=(this.disableCollisions=this.config.setsDisableCollisions?this.config.disableCollisions:this.parent?this.parent.disableCollisions:!1)?!1:this.config.ground;this.isAnimatedRoot?(this.animationMatrix=new THREE.Matrix4,
this.update=d(this)):this.animationMatrix=this.parent?this.parent.animationMatrix:null;this.hideInViews=this.config.setsHideInViews?this.config.hideInViews:this.parent?this.parent.hideInViews:null;this.lightmapResolution=this.config.setsLightmapResolution?this.config.lightmapResolution:this.parent?this.parent.lightmapResolution:null;this.shadowsIsolatedWithin=this.config.isolateShadows?this.config.name:this.parent&&this.parent.shadowsIsolatedWithin?this.parent.shadowsIsolatedWithin:null;this.editable=
this.config.editable;this.parent&&(this.editable=this.editable||this.parent.editable)};WALK.Node.prototype.visitSubtree=function(e){e(this);var f=this.children;if(f)for(var g=0;g<f.length;g+=1)f[g].visitSubtree(e)};WALK.Node.prototype.facesInSubtree=function(){var e=this;null===e._facesCnt&&(e._facesCnt=0,e.visitSubtree(function(f){f.mesh&&(e._facesCnt+=f.mesh.geometry.vertexCnt/3)}));return e._facesCnt};WALK.Node.prototype.hide=function(){this.visitSubtree(function(e){e.mesh&&(e.mesh.visible=!1)})};
WALK.Node.prototype.show=function(){this.visitSubtree(function(e){e.mesh&&(e.mesh.visible=!0)})};Object.defineProperty(WALK.Node.prototype,"isAnimatedRoot",{get:function(){return this.config.faceCamera||this.config.rotate}});WALK.Node.prototype.serialize=function(){var e={id:this.id,children:this.children.map(function(g){return g.serialize()})},f=this.mesh;f&&(e.lightProbeId=f.lightProbe?f.lightProbe.id:null,e.mesh=!0);return e};Object.defineProperty(WALK.Node.prototype,"type",{get:function(){return this.config.name}});
Object.defineProperty(WALK.Node.prototype,"highlightMix",{set:function(e){this.visitSubtree(function(f){f.mesh&&(f.mesh.highlightMix=e)})}});Object.defineProperty(WALK.Node.prototype,"selected",{set:function(e){this.visitSubtree(function(f){f.mesh&&(f.mesh.selected=e)})}});Object.defineProperty(WALK.Node.prototype,"selectedSecondary",{set:function(e){this.visitSubtree(function(f){f.mesh&&(f.mesh.selectedSecondary=e)})}})})();(function(){WALK.Mesh=function(a,b,c){this._visible=!0;THREE.Mesh.call(this,b,c);this.node=a;this.useFaces16=!1;this.quantUv0Max=this.quantUv0Range=this.quantVertexMax=this.quantVertexRange=this.transformByteOffset=this.uv1CoordVOffset=this.uv1CoordUOffset=this.uv1CoordVScale=this.uv1CoordUScale=this.lightMapIdx=this.uv1ByteOffset=this.uv0ByteOffset=this.normalByteOffset=this.vertexCnt=this.vertexByteOffset=this.faceCnt=this.faceByteOffset=0;this.lightMap=null;this.autoLightmapResolution=-1;this.lightProbe=
null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.selected=this.highlightMix=null;this.selectedSecondary=!1;this.visibilityId=null;this.cameraDistance=0;var d=this.matrix=this.matrixWorld=null;Object.defineProperty(this,"matrixWorld",{get:function(){return d||this.node.animationMatrix},set:function(e){d=e}});this.sharedBuffersDebug=0;this._mergedMesh=null};WALK.Mesh.prototype=Object.create(THREE.Mesh.prototype);WALK.Mesh.prototype.constructor=WALK.Mesh;WALK.Mesh.prototype.clone=void 0;WALK.Mesh.prototype.updateMatrixWorld=
function(){};WALK.Mesh.prototype.uv0InBuffers=function(){return-1!==this.uv0ByteOffset};WALK.Mesh.prototype.uv1InBuffers=function(){return-1!==this.uv1ByteOffset};WALK.Mesh.prototype.quantVertexFactor=function(){return this.quantVertexRange/this.quantVertexMax};WALK.Mesh.prototype.quantUv0Disabled=function(){return 0===this.quantUv0Max};WALK.Mesh.prototype.quantUv0Factor=function(){return this.quantUv0Range/this.quantUv0Max};Object.defineProperty(WALK.Mesh.prototype,"hideInViews",{get:function(){return this.node.hideInViews},
set:function(a){console.assert(!1)}});Object.defineProperty(WALK.Mesh.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this._mergedMesh&&!WALK.EDIT_MODE&&(this._mergedMesh.visible=a))}});WALK.MergedMesh=function(a,b){this._visible=!0;THREE.Mesh.call(this,a,b);this.anyLogicalMeshHasUvs=!1;this.lightProbe=this.lightMap=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.hideInViews=null;this.matrixAutoUpdate=this.rotationAutoUpdate=
!1;this.center=null;this.cameraDistance=0;this.matrix=this.matrixWorld=null;this.logicalMeshes=[]};WALK.MergedMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.MergedMesh.prototype.constructor=WALK.MergedMesh;WALK.MergedMesh.prototype.clone=void 0;WALK.MergedMesh.prototype.updateMatrixWorld=function(){};WALK.MergedMesh.prototype.addLogicalMesh=function(a){this.logicalMeshes.push(a);a._mergedMesh=this};Object.defineProperty(WALK.MergedMesh.prototype,"visible",{get:function(){return this._visible},
set:function(a){if(a!==this._visible){this._visible=a;for(var b=0;b<this.logicalMeshes.length;b+=1)this.logicalMeshes[b]._visible=a}}})})();(function(){WALK.SkyMesh=function(a,b,c,d){var e=this;THREE.Mesh.call(this,b,c);d&&this.position.fromArray(d);this.autoPosition=!d;this.name=a;var f={type:"updated",target:this};this._updated=function(){return e.dispatchEvent(f)}};WALK.SkyMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.SkyMesh.prototype.constructor=WALK.SkyMesh;WALK.SkyMesh.prototype.clone=void 0;WALK.SkyMesh.prototype.serialize=function(){var a={name:this.name};this.autoPosition||(a.center=this.position.toArray());this.isEquirect?
(a.type="equirect",a.yawRotation=this.yawRotationDeg,a.texture=this.material.map?this.material.map.serialize():null):a.type="procedural";return a};Object.defineProperty(WALK.SkyMesh.prototype,"yawRotationDeg",{get:function(){return THREE.Math.radToDeg(this.rotation.y)},set:function(a){a=THREE.Math.degToRad(a);this.rotation.y=a;this.updateMatrixWorld();this._updated()}});Object.defineProperty(WALK.SkyMesh.prototype,"isEquirect",{get:function(){return this.material instanceof WALK.EquirectSkyMaterial}});
Object.defineProperty(WALK.SkyMesh.prototype,"radius",{get:function(){return this.scale.x},set:function(a){this.scale.set(a,a,a);this.updateMatrixWorld(!0);this._updated()}})})();(function(){var a=1E3,b={internal:!1,position:[0,0,0],rotation:[0,0],hideFromMenu:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME};WALK.View=function(c){var d=this;void 0===c&&(c=b);this.id=void 0!==c.id?c.id:a++;this.name=c.name||"view"+this.id;this.internal=c.internal||!1;c.position&&(this.position=new THREE.Vector3(c.position[0],c.position[1],c.position[2]));c.rotation&&(this.rotation=new WALK.Euler(WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[0])),WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[1])),
0));this.hideFromMenu=c.hideFromMenu||!1;this.sky=c.sky||WALK.EDITOR_CONTROLLED_SKY_NAME;this.mode=c.mode||"fps";this.distance=c.distance;this.panPrimary=c.panPrimary;this.noPan=c.noPan;this.noRotate=c.noRotate;this.noPitchRotate=c.noPitchRotate;this.minDistance=void 0===c.minDistance?1:c.minDistance;this.maxDistance=void 0===c.maxDistance?100:c.maxDistance;this.minUpAngle=void 0===c.minUpAngle?-Math.PI/2:c.minUpAngle;this.maxUpAngle=void 0===c.maxUpAngle?Math.PI/2:c.maxUpAngle;this.minSideAngle=
void 0===c.minSideAngle?-Math.PI:c.minSideAngle;this.maxSideAngle=void 0===c.maxSideAngle?Math.PI:c.maxSideAngle;c.target&&(this.target=new THREE.Vector3(c.target[0],c.target[1],c.target[2]));this.fov=c.fov;var e={type:"updated",target:this};this._updated=function(){return d.dispatchEvent(e)}};WALK.View.prototype={constructor:WALK.View,isTop:function(){return"orbit"===this.mode&&this.panPrimary&&this.noPitchRotate},isOrbit:function(){return"orbit"===this.mode&&!this.isTop()},usesDefaultSky:function(){return this.sky===
WALK.DEFAULT_SKY_NAME},switchSky:function(){this.usesDefaultSky()?this.sky=WALK.EDITOR_CONTROLLED_SKY_NAME:this.sky=WALK.DEFAULT_SKY_NAME;this._updated()},setName:function(c){this.name=c;this._updated()},setYaw:function(c){this.rotation.yaw=c;this._updated()},setMinUpAngle:function(c){c!==this.minUpAngle&&(this.minUpAngle=c,this._updated())},setMaxUpAngle:function(c){c!==this.maxUpAngle&&(this.maxUpAngle=c,this._updated())},setMinSideAngle:function(c){c!==this.minSideAngle&&(this.minSideAngle=c,this._updated())},
setMaxSideAngle:function(c){c!==this.maxSideAngle&&(this.maxSideAngle=c,this._updated())},setHideFromMenu:function(c){c!==this.hideFromMenu&&(this.hideFromMenu=c,this._updated())},setMinDistance:function(c){c!==this.minDistance&&(this.minDistance=c,this._updated())},setMaxDistance:function(c){c!==this.maxDistance&&(this.maxDistance=c,this._updated())},serialize:function(){var c=this,d={id:this.id,name:this.name,mode:this.mode,rotation:this.rotation.toDegTriple().slice(0,2),hideFromMenu:this.hideFromMenu||
!1,sky:this.sky};this.position&&(d.position=this.position.toArray());this.target&&(d.target=this.target.toArray());-Infinity!==this.minSideAngle&&(d.minSideAngle=this.minSideAngle);Infinity!==this.maxSideAngle&&(d.maxSideAngle=this.maxSideAngle);"distance minDistance maxDistance panPrimary noPan noRotate noPitchRotate minUpAngle maxUpAngle fov".split(" ").forEach(function(e){void 0!==c[e]&&(d[e]=c[e])});return d}};THREE.EventDispatcher.prototype.apply(WALK.View.prototype)})();(function(){WALK.Mirror=function(a,b,c){THREE.Object3D.call(this);this.name="mirror_"+this.id;this.scene=a;this.mirrorCamera=b.clone();this.renderTargetParams={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!0};this.texture=null;c=c||{};this.matrixNeedsUpdate=!0;this.clipBias=void 0!==c.clipBias?c.clipBias:0;a=void 0!==c.color?new THREE.Color(c.color):new THREE.Color(8355711);this.textureMatrix=new THREE.Matrix4;this.mirrorWorldPosition=new THREE.Vector3;
this.mirrorRotationMatrix=new THREE.Matrix4;this.mirrorNormal=new THREE.Vector3;this.cameraWorldPosition=new THREE.Vector3;this.cameraRotationMatrix=new THREE.Matrix4;this.mirrorToCamera=new THREE.Vector3;this.cameraFrustum=null;this.material=new WALK.MirrorMaterial(a,this.textureMatrix)};WALK.Mirror.prototype=Object.create(THREE.Object3D.prototype);WALK.Mirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix();this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera;a.renderTemp();
a.material.uniforms.mirrorSampler.value=a.tempTexture;this.render();this.matrixNeedsUpdate=!0;a.material.uniforms.mirrorSampler.value=a.texture;a.camera=b;a.updateTextureMatrix()};WALK.Mirror.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.mirrorRotationMatrix.extractRotation(this.matrixWorld);this.mirrorNormal.set(0,0,1);this.mirrorNormal.applyMatrix4(this.mirrorRotationMatrix)};
WALK.Mirror.prototype.updateCameraPosition=function(a,b){this.cameraWorldPosition.setFromMatrixPosition(a.matrixWorld);this.cameraRotationMatrix.extractRotation(a.matrixWorld);this.matrixNeedsUpdate=!0;this.cameraFrustum=b};WALK.Mirror.prototype.inFrustum=function(){this.mirrorToCamera.subVectors(this.cameraWorldPosition,this.mirrorWorldPosition);return this.mirrorToCamera.angleTo(this.mirrorNormal)<Math.PI/2&&this.cameraFrustum.intersectsBox(this.parent.geometry.boundingBox)};WALK.Mirror.prototype.updateTextureMatrix=
function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector4,e=new THREE.Plane,f=new THREE.Vector4;return function(){a.copy(this.mirrorWorldPosition).sub(this.cameraWorldPosition).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);c.set(0,0,-1);c.applyMatrix4(this.cameraRotationMatrix);c.add(this.cameraWorldPosition);b.copy(this.mirrorWorldPosition).sub(c).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);this.up.set(0,-1,0);this.up.applyMatrix4(this.cameraRotationMatrix);
this.up.reflect(this.mirrorNormal).negate();this.mirrorCamera.position.copy(a);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(b);this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);e.setFromNormalAndCoplanarPoint(this.mirrorNormal,
this.mirrorWorldPosition);e.applyMatrix4(this.mirrorCamera.matrixWorldInverse);d.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var g=this.mirrorCamera.projectionMatrix;f.x=(Math.sign(d.x)+g.elements[8])/g.elements[0];f.y=(Math.sign(d.y)+g.elements[9])/g.elements[5];f.z=-1;f.w=(1+g.elements[10])/g.elements[14];d.multiplyScalar(2/d.dot(f));g.elements[2]=d.x;g.elements[6]=d.y;g.elements[10]=d.z+1-this.clipBias;g.elements[14]=d.w}}();WALK.Mirror.prototype.configure=function(a,b,c,d){this.mirrorCamera.aspect=
c;this.mirrorCamera.fov=d;this.mirrorCamera.updateProjectionMatrix();null!==this.texture&&this.texture.dispose();this.material.mirrorSampler=this.texture};WALK.Mirror.prototype.render=function(a){this.material.visible&&(this.matrixNeedsUpdate&&(this.updateTextureMatrix(),this.matrixNeedsUpdate=!1),this.material.visible=!1,a.render(this.scene,this.mirrorCamera,this.texture,!0),this.material.visible=!0)};WALK.Mirror.prototype.renderTemp=function(a){this.matrixNeedsUpdate&&this.updateTextureMatrix();
a.render(this.scene,this.mirrorCamera,this.tempTexture,!0)}})();(function(){function a(e,f,g){g=g||"id";for(var h=0;h<e.length;h+=1)if(e[h].hasOwnProperty(g)&&e[h][g]===f)return!1;return!0}function b(e,f,g){g=g||"id";for(var h=0;h<e.length;h+=1)if(e[h][g]===f)return e[h];return null}function c(e,f){e=e.name.toUpperCase();f=f.name.toUpperCase();return e<f?-1:e>f?1:0}var d=0;WALK.Scene=function(e){function f(){q.dispatchEvent(p)}function g(){q.dispatchEvent(r);f()}function h(n){n=n.target;var m=q._mainAnimatedMaterials.has(n);n.isAnimated&&!m?q._mainAnimatedMaterials.add(n):
!n.isAnimated&&m&&q._mainAnimatedMaterials.delete(n);f()}function k(){q._animatedRootNodes.length=0;q.visitAllNodes(function(n){n.isAnimatedRoot&&q._animatedRootNodes.push(n)});f()}var q=this,p={type:"updated",target:this},r={type:"anyViewUpdated",target:this};this.id=d++;this._headLight=!1;this.threeScene=new THREE.Scene;this.autoAddLightProbes=!0;this.autoTour={disabled:!1,startOnLoad:!1};this.canStartAutoTour=function(){return!this.autoTour.disabled&&1<this.visibleViews().length};this.startAutoTourOnLoad=
function(){return this.canStartAutoTour()&&this.autoTour.startOnLoad};this.disableProgressiveLoader=!1;this.camera=e;this._colorMap=null;this.materials=[];this._mainAnimatedMaterials=new Set;this._disabledMaterials=[];this._sortedMaterials=null;this.nodeConfigs=[];this._nodeConfigsLookup={};this.nodes=[];this._animatedRootNodes=[];this._nodeLookup={};this.gpuMeshes=[];this.mirrors=[];this._animatableAuxiliaryObjects=new Set;this.boundingBox=new THREE.Box3;this._sumLogicalMeshCenter=new THREE.Vector3;
this._logicalNonemptyMeshCount=0;this._center=new THREE.Vector3;this.skyMeshes=[];this.hideViewsMenu=!1;this.views=[];this.lights=[];this.lightProbes=[];this.cameraVolumes=[];this.minimapConfig=null;this.serialize=function(){return{disableProgressiveLoader:this.disableProgressiveLoader,autoTour:this.autoTour,camera:this.camera.serialize(),materials:this.materials.map(function(n){return n.serialize()}),nodeConfigs:this.nodeConfigs.map(function(n){return n.serialize()}),nodes:this.nodes.map(function(n){return n.serialize()}),
lights:this.lights.map(function(n){return n.serialize()}),lightProbes:this.lightProbes.map(function(n){return n.serialize()}),cameraVolumes:this.cameraVolumes.map(function(n){return n.serialize()}),autoAddLightProbes:!1,views:this.views.filter(function(n){return!n.internal}).map(function(n){return n.serialize()}),skies:this.skyMeshes.filter(function(n){return n.name!==WALK.DEFAULT_SKY_NAME}).map(function(n){return n.serialize()}),minimap:this.minimapConfig.serialize()}};this.addMaterial=function(n){this.materials.push(n);
n.addEventListener("updated",h);n.isAnimated&&this._mainAnimatedMaterials.add(n);this.camera.colorMapReady()&&void 0!==n.colorMap&&(n.colorMap=this.camera.colorMap);void 0!==n.cameraExposure&&(n.cameraExposure=this.camera.exposure);void 0!==n.cameraGamma&&(n.cameraGamma=this.camera.gamma);void 0!==n.headLight&&(n.headLight=this.headLight)};this.replaceMaterial=function(n,m){var l=this.materials.indexOf(n);void 0===this._disabledMaterials[l]&&(this._disabledMaterials[l]=new Map);this._disabledMaterials[l].set(n.type,
n);var u=this._disabledMaterials[l].get(m);u||(u=WALK.createMaterialOfType(m),u.addEventListener("updated",h),u.name=n.name,0===this.lightProbes.length&&(u.disableLightProbeTmp=!0));this.materials[l]=u;f();for(m=0;m<this.gpuMeshes.length;m+=1)this.gpuMeshes[m].material===n&&(this.gpuMeshes[m].material=u);n.isAnimated&&this._mainAnimatedMaterials.delete(n);u.isAnimated&&this._mainAnimatedMaterials.add(u);this._sortedMaterials=null;u.setUniforms();return u};this.addNodeConfig=function(n){this.nodeConfigs.push(n);
this._nodeConfigsLookup[n.name]=n;n.addEventListener("updated",k)};this.findNodeConfig=function(n){return this._nodeConfigsLookup.hasOwnProperty(n)?this._nodeConfigsLookup[n]:null};this.addNode=function(n){var m=this;this.nodes.push(n);n.visitSubtree(function(l){m._nodeLookup[l.id]=l;l.isAnimatedRoot&&m._animatedRootNodes.push(l)})};this.findNode=function(n){return this._nodeLookup[n]};this.visitAllNodes=function(n){for(var m=0;m<this.nodes.length;m+=1)this.nodes[m].visitSubtree(n)};this.visitMeshesWithMaterial=
function(n,m){this.visitAllNodes(function(l){(l=l.mesh)&&l.material===n&&m(l)})};this.sortedMaterials=function(){null===this._sortedMaterials&&(this._sortedMaterials=this.materials.slice(0).sort(c));return this._sortedMaterials};this._updateSceneCenterWithGpuMesh=function(){var n=new THREE.Vector3;return function(m){if(m.logicalMeshes)for(var l=0;l<m.logicalMeshes.length;l+=1){var u=m.logicalMeshes[l].geometry.boundingBox;u.empty()||(u.center(n),this._sumLogicalMeshCenter.add(n),++this._logicalNonemptyMeshCount)}else m=
m.geometry.boundingBox,m.empty()||(m.center(n),this._sumLogicalMeshCenter.add(n),++this._logicalNonemptyMeshCount);this._logicalNonemptyMeshCount&&this._center.copy(this._sumLogicalMeshCenter).divideScalar(this._logicalNonemptyMeshCount)}}();this.addGpuMesh=function(n){if(n.material.planarReflector){var m=new WALK.Mirror(this.threeScene,this.camera,{clipBias:0,color:8355711,debugMode:!1});m.material.name=n.material.name;var l=n.geometry;console.assert(l.boundingBox);var u=l.boundingBox,v=Math.sqrt(Math.pow(u.max.x-
u.min.x,2)+Math.pow(u.max.z-u.min.z,2)),t=u.max.y-u.min.y;v&&t?(v=new THREE.Mesh(new THREE.PlaneBufferGeometry(v,t),m.material),v.rotation.y=Math.atan2(l.normals[0],l.normals[2]),u.center(v.position),v.geometry.boundingBox=u,v.add(m),m=v):(WALK.log("mirror with 0 dimension"),m=null);this.mirrors.push(m.children[0]);this.addAuxiliaryObject(m)}else this.addAuxiliaryObject(n);this.gpuMeshes.push(n);this.boundingBox.union(n.geometry.boundingBox);this._updateSceneCenterWithGpuMesh(n)};this.addAuxiliaryObject=
function(n,m){m=void 0===m?!1:m;this.threeScene.add(n);m&&this._animatableAuxiliaryObjects.add(n);f()};this.removeAuxiliaryObject=function(n){this.threeScene.remove(n);this._animatableAuxiliaryObjects.delete(n);f()};this.addSkyMesh=function(n){var m=n.material;this.skyMeshes.push(n);this.camera.colorMapReady()&&(m.colorMap=this.camera.colorMap);void 0!==m.cameraExposure&&(m.cameraExposure=this.camera.exposure);void 0!==m.cameraGamma&&(m.cameraGamma=this.camera.gamma);n.addEventListener("updated",
f);this.dispatchEvent({type:"skyMeshAdded",skyMesh:n,target:this})};this.removeSkyMesh=function(n){WALK.removeFromArray(n,this.skyMeshes);this.dispatchEvent({type:"skyMeshRemoved",skyMesh:n,target:this});n.geometry.dispose();n.material.map&&n.material.map.dispose();n.material.dispose()};this.findSkyMesh=function(n){return b(this.skyMeshes,n,"name")};this.addLight=function(n){console.assert(a(this.lights,n.name,"name"));this.lights.push(n);n.addEventListener("updated",f);n.addEventListener("instanceAdded",
f);n.addEventListener("instanceRemoved",f);f();this.dispatchEvent({type:"lightAdded",light:n,target:this})};this.removeLight=function(n){WALK.removeFromArray(n,this.lights);f();this.dispatchEvent({type:"lightRemoved",light:n,target:this})};this.addLightProbe=function(n){console.assert(a(this.lightProbes,n.id));this.lightProbes.push(n);n.addEventListener("positionUpdated",f);n.addEventListener("boundsUpdated",f);f();this.dispatchEvent({type:"lightProbeAdded",lightProbe:n,target:this})};this.removeLightProbe=
function(n){WALK.removeFromArray(n,this.lightProbes);for(var m=0;m<this.gpuMeshes.length;m+=1)this.gpuMeshes[m].lightProbe===n&&(this.gpuMeshes[m].lightProbe=null);f();this.dispatchEvent({type:"lightProbeRemoved",lightProbe:n,target:this});n.dispose()};this.findLightProbe=function(n){return b(this.lightProbes,n)};this.closestLightProbe=function(n){for(var m=null,l=Infinity,u=$jscomp.makeIterator(this.lightProbes),v=u.next();!v.done;v=u.next()){v=v.value;var t=n.distanceTo(v.position);t<l&&(l=t,m=
v)}return m};this.addCameraVolume=function(n){console.assert(a(this.cameraVolumes,n.id));this.cameraVolumes.push(n);n.addEventListener("updated",f);f();this.dispatchEvent({type:"cameraVolumeAdded",cameraVolume:n,target:this})};this.removeCameraVolume=function(n){WALK.removeFromArray(n,this.cameraVolumes);f();this.dispatchEvent({type:"cameraVolumeRemoved",cameraVolume:n,target:this});n.dispose()};this.findCameraVolume=function(n){return b(this.cameraVolumes,n)};this.shiftCameraVolume=function(n,m){WALK.shiftItem(this.cameraVolumes,
n,m);this.dispatchEvent({type:"cameraVolumeShifted",cameraVolume:n,target:this})};this.findView=function(n){return b(this.views,n)};this.findViewByName=function(n){return b(this.views,n,"name")};this.visibleViews=function(){return WALK.filter(this.views,function(n){return!n.hideFromMenu})};this.addView=function(n){console.assert(a(this.views,n.id));this.views.push(n);n.addEventListener("updated",g);f();this.dispatchEvent({type:"viewAdded",view:n,target:this})};this.removeView=function(n){WALK.removeFromArray(n,
this.views);this.nodeConfigs.forEach(function(m){m.removeFromHideInViews(n.id)});f();this.dispatchEvent({type:"viewRemoved",view:n,target:this})};this.shiftView=function(n,m){WALK.shiftItem(this.views,n,m);this.dispatchEvent({type:"viewShifted",view:n,target:this})};this.hasLightMap=function(){return void 0!==WALK.find(this.materials,function(n){return n.lightMapped})};this.adjustSkiesAndCameraFarToSpanWholeScene=function(){for(var n=function(D,I){var J=Math.max(Math.abs(D.min.x-I.x),Math.abs(D.max.x-
I.x)),Q=Math.max(Math.abs(D.min.y-I.y),Math.abs(D.max.y-I.y));D=Math.max(Math.abs(D.min.z-I.z),Math.abs(D.max.z-I.z));return Math.sqrt(J*J+Q*Q+D*D)},m=function(D,I){var J=0;D.forEach(function(Q){if("orbit"===Q.mode){var T=void 0===Q.maxDistance?Q.distance:Q.maxDistance;T=Q.target&&T?Q.target.distanceTo(I)+T:void 0}else"fps"===Q.mode&&(T=Q.position?Q.position.distanceTo(I):void 0);T&&T>J&&(J=T)});return J},l=0,u=0;u<this.skyMeshes.length;u+=1){var v=this.skyMeshes[u];v.autoPosition&&v.position.copy(this.center);
var t=void 0;if(this.boundingBox.empty())t=0;else{t=n(this.boundingBox,v.position);var B=m(this.views,v.position);t=Math.max(t,B)}t+=WALK.SKY_DISTANCE_TO_SCENE;v.radius=t;l=Math.max(l,t)}this.camera.setFar(Math.max(this.camera.far,2*l));WALK.log("Camera far set to "+this.camera.far)};e.addEventListener("colorMapUpdated",function(){var n=e.colorMap;q.materials.forEach(function(m){void 0!==m.colorMap&&(m.colorMap=n);m.setUniforms()});q.skyMeshes.forEach(function(m){m.material.colorMap=n});f()});e.addEventListener("updated",
f);this.disableLightProbesForMaterials=function(){for(var n=0;n<this.materials.length;n+=1)this.materials[n].disableLightProbeTmp=!0,this.materials[n].setUniforms()};this.enableLightProbesForMaterials=function(){for(var n=0;n<this.materials.length;n+=1)this.materials[n].disableLightProbeTmp=!1,this.materials[n].setUniforms()};this.getAnimatedMaterials=function(){var n=!1,m=new Map;return function(){function l(D){D instanceof THREE.Mesh&&D.material.isAnimated&&m.set(D.material,u)}for(var u=!n,v=$jscomp.makeIterator(q._mainAnimatedMaterials),
t=v.next();!t.done;t=v.next())m.set(t.value,u);v=$jscomp.makeIterator(q._animatableAuxiliaryObjects);for(t=v.next();!t.done;t=v.next())t.value.traverse(l);v=$jscomp.makeIterator(m);for(t=v.next();!t.done;t=v.next()){t=$jscomp.makeIterator(t.value);var B=t.next().value;t.next().value===n&&m.delete(B)}n=u;return m.keys()}}();this.getAnimatedRootNodes=function(){return this._animatedRootNodes};e.addEventListener("exposureUpdated",function(n){var m=e.exposure;q.materials.forEach(function(l){void 0!==
l.cameraExposure&&(l.cameraExposure=m)});q.skyMeshes.forEach(function(l){l=l.material;void 0!==l.cameraExposure&&(l.cameraExposure=m)})});e.addEventListener("gammaUpdated",function(n){var m=e.gamma;q.materials.forEach(function(l){void 0!==l.cameraGamma&&(l.cameraGamma=m)});q.skyMeshes.forEach(function(l){l=l.material;void 0!==l.cameraGamma&&(l.cameraGamma=m)})})};WALK.Scene.prototype={constructor:WALK.Scene,get center(){return this._center},get headLight(){return this._headLight},set headLight(e){e!==
this._headLight&&(this._headLight=e,this.materials.forEach(function(f){f.headLight=e;f.setUniforms()}))}};THREE.EventDispatcher.prototype.apply(WALK.Scene.prototype);WALK.createMaterialOfType=function(e){return"water"===e?new WALK.StandardMaterialWater:new WALK.StandardMaterial}})();(function(){WALK.BufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this._length=a.length;this.releaseOnLoadedToGpu=!0;this.divisor=c||0;this.glType=this.buffer=null};WALK.BufferAttribute.prototype={constructor:WALK.BufferAttribute,get length(){return this._length}}})();(function(){function a(b,c,d,e,f){d=new WALK.BufferAttribute(d,e,f||0);b.addAttribute(c,d)}THREE.BufferGeometry.prototype.addTriangleOrderAttribute=function(){if(void 0===this.getAttribute("order")){for(var b=this.getAttribute("position").length/3,c=new Float32Array(b),d=0;d<b;d+=1)c[d]=d%3;this.addAttribute("order",new WALK.BufferAttribute(c,1))}};THREE.BufferGeometry.prototype.convertNormalsToSpherical=function(){console.assert(void 0===this.getAttribute("sphericalNormal"));var b=this.getAttribute("normal");
console.assert(!b.buffer);b=b.array;for(var c=b.length/3,d=WALK.DETECTOR.ios?new Int16Array(2*c):new Int8Array(2*c),e=0;e<c;e+=1){var f=3*e,g=2*e,h=Math.atan2(b[f+1],b[f])/Math.PI;d[g]=WALK.Math.toSnorm8(2*(Math.acos(b[f+2])/Math.PI-.5));d[g+1]=WALK.Math.toSnorm8(h)}delete this.attributes.normal;this.addAttribute("sphericalNormal",new WALK.BufferAttribute(d,2))};THREE.BufferGeometry.prototype.changePosition=function(b){var c=this.getAttribute("position"),d=c.length/3;c=c.array;for(var e=0;e<3*d;e+=
3)c[e]+=b.x,c[e+1]+=b.y,c[e+2]+=b.z};THREE.BufferGeometry.prototype.clone=function(){console.error("WALK.BufferGeometry cloning not supported")};WALK.Geometry=function(){THREE.BufferGeometry.call(this);this.isInstanced=!1;this.instanceCount=0;this.index=null;this.indexUint=!0;this.uvs0=this.normals=this.vertices=null;this.isUvs0Repeating=!1;this.uvs1=null;this.vertexOffset=this.vertexCnt=this.indexOffset=this.indexCnt=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this.gpuSize=
0};WALK.Geometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.Geometry.prototype.constructor=WALK.Geometry;WALK.Geometry.prototype.allocateCoreBuffers=function(b){console.assert(!this.vertices);b&&(65536>=this.vertexCnt?(this.indexUint=!1,this.index=new Uint16Array(this.indexCnt),this.gpuSize+=2*this.indexCnt):(this.indexUint=!0,this.index=new Uint32Array(this.indexCnt),this.gpuSize+=4*this.indexCnt));this.vertices=new Float32Array(3*this.vertexCnt);this.gpuSize+=12*this.vertexCnt;
this.normals=WALK.DETECTOR.ios?new Int16Array(2*this.vertexCnt):new Int8Array(2*this.vertexCnt);this.gpuSize+=2*this.vertexCnt};WALK.Geometry.prototype.addCoreAttributes=function(){this.index&&(a(this,"index",this.index,1),this.index=null);a(this,"position",this.vertices,3);this.vertices=null;a(this,"sphericalNormal",this.normals,2);this.normals=null};WALK.Geometry.prototype.allocateUv0=function(){console.assert(!this.uvs0);this.uvs0=new Float32Array(2*this.vertexCnt);this.gpuSize+=8*this.vertexCnt};
WALK.Geometry.prototype.addUv0Attribute=function(){a(this,"uv",this.uvs0,2);this.uvs0=null};WALK.Geometry.prototype.allocateUv1=function(){console.assert(!this.uvs1);this.uvs1=new Uint16Array(2*this.vertexCnt);this.gpuSize+=4*this.vertexCnt};WALK.Geometry.prototype.addUv1Attribute=function(){a(this,"uv2",this.uvs1,2);this.uvs1=null};WALK.Geometry.prototype.computeBoundingBox=void 0;WALK.Geometry.prototype.computeBoundingSphere=void 0;WALK.InstancedGeometry=function(b,c){THREE.BufferGeometry.call(this);
this.parent=b;this.ownsGpuBuffers=c;this.isInstanced=!0;this.instanceCount=0;this.transforms2=this.transforms1=this.transforms0=this.uvs1Mod=null;this.vertexOffset=this.indexOffset=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this._gpuSize=0};WALK.InstancedGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.InstancedGeometry.prototype.constructor=WALK.InstancedGeometry;WALK.InstancedGeometry.prototype.allocateCoreBuffers=function(b){console.assert(!this.transforms0);
this.parent.vertices||this.parent.allocateCoreBuffers(b);b=4*this.instanceCount;this.transforms0=new Float32Array(b);this.transforms1=new Float32Array(b);this.transforms2=new Float32Array(b);this._gpuSize+=12*b};WALK.InstancedGeometry.prototype.addCoreAttributes=function(){this.parent.attributes.position||this.parent.addCoreAttributes();for(var b=$jscomp.makeIterator(Object.keys(this.parent.attributes)),c=b.next();!c.done;c=b.next())c=c.value,this.addAttribute(c,this.parent.attributes[c]);a(this,
"t0",this.transforms0,4,1);a(this,"t1",this.transforms1,4,1);a(this,"t2",this.transforms2,4,1);this.transforms2=this.transforms1=this.transforms0=null};WALK.InstancedGeometry.prototype.allocateUv0=function(){this.parent.uvs0||this.parent.allocateUv0()};WALK.InstancedGeometry.prototype.addUv0Attribute=function(){this.parent.attributes.uv||this.parent.addUv0Attribute();this.addAttribute("uv",this.parent.attributes.uv)};WALK.InstancedGeometry.prototype.allocateUv1=function(){console.assert(!this.uvs1Mod);
this.parent.uvs1||this.parent.allocateUv1();this.uvs1Mod=new Float32Array(4*this.instanceCount);this._gpuSize+=16*this.instanceCount};WALK.InstancedGeometry.prototype.addUv1Attribute=function(){this.parent.attributes.uv2||this.parent.addUv1Attribute();this.addAttribute("uv2",this.parent.attributes.uv2);a(this,"uv2Mod",this.uvs1Mod,4,1);this.uvs1Mod=null};WALK.InstancedGeometry.prototype.computeBoundingBox=void 0;WALK.InstancedGeometry.prototype.computeBoundingSphere=void 0;Object.defineProperty(WALK.InstancedGeometry.prototype,
"index",{get:function(){return this.parent.index}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertices",{get:function(){return this.parent.vertices}});Object.defineProperty(WALK.InstancedGeometry.prototype,"normals",{get:function(){return this.parent.normals}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs0",{get:function(){return this.parent.uvs0}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs1",{get:function(){return this.parent.uvs1}});Object.defineProperty(WALK.InstancedGeometry.prototype,
"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertexCnt",{get:function(){return this.parent.vertexCnt},set:function(b){this.parent.vertexCnt=b}});Object.defineProperty(WALK.InstancedGeometry.prototype,"indexCnt",{get:function(){return this.parent.indexCnt},set:function(b){this.parent.indexCnt=b}});Object.defineProperty(WALK.InstancedGeometry.prototype,"gpuSize",{get:function(){return this.ownsGpuBuffers?this._gpuSize+this.parent.gpuSize:
this._gpuSize}});Object.defineProperty(WALK.InstancedGeometry.prototype,"isUvs0Repeating",{get:function(){return this.parent.isUvs0Repeating},set:function(b){this.parent.isUvs0Repeating=b}});WALK.SubGeometry=function(b,c,d,e,f,g,h){THREE.BufferGeometry.call(this);this.indexCnt=b;this.vertexCnt=c;this.parent=d;this.vertexOffset=f;this.indexOffset=e;this.boundingBox=g;this.boundingSphere=h;this.isInstanced=d.isInstanced;this.instanceId=0;this.instanceCount=1};WALK.SubGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);
WALK.SubGeometry.prototype.constructor=WALK.SubGeometry;Object.defineProperty(WALK.SubGeometry.prototype,"attributes",{get:function(){return this.parent.attributes}});Object.defineProperty(WALK.SubGeometry.prototype,"attributesKeys",{get:function(){return this.parent.attributesKeys}});Object.defineProperty(WALK.SubGeometry.prototype,"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(WALK.SubGeometry.prototype,"isUvs0Repeating",{get:function(){return this.parent.isUvs0Repeating}});
WALK.SubGeometry.prototype.computeBoundingBox=void 0;WALK.SubGeometry.prototype.computeBoundingSphere=void 0;WALK.SubGeometry.prototype.addTriangleOrderAttribute=function(){this.parent.addTriangleOrderAttribute()}})();(function(){function a(f){f.dispatchEvent({type:"updated",target:f})}var b=null,c=null,d=new THREE.Vector3,e=new THREE.Quaternion;WALK.CameraVolume=function(f){this.id=f.id;this.name=f.name;this._type=f.type;console.assert(0<=WALK.CameraVolume.CameraVolumeTypes.indexOf(this._type));this.position=(new THREE.Vector3).fromArray(f.position);this.rotation=(new WALK.Euler).setFromDegTriple(f.rotation);this.scale=(new THREE.Vector3).fromArray(f.scale);this.exposure=f.exposure;this.gamma=f.gamma;this._inverse=
new THREE.Matrix4;this._inverseDirty=!0};WALK.CameraVolume.CameraVolumeTypes=["cube","sphere"];WALK.CameraVolume.prototype={constructor:WALK.CameraVolume,getVolumeGeometry:function(){b||(b=new THREE.BoxBufferGeometry(2,2,2),b.addTriangleOrderAttribute(),b.convertNormalsToSpherical(),c=new THREE.IcosahedronBufferGeometry(1,2),c.addTriangleOrderAttribute(),c.convertNormalsToSpherical());return"sphere"===this._type?c:b},setName:function(f){this.name=f;a(this)},setPosition:function(f,g,h){this.position.set(f,
g,h);this._inverseDirty=!0;a(this)},setRotation:function(f,g,h){this.rotation.yaw=WALK.normalizeRotation(f);this.rotation.pitch=WALK.normalizeRotation(g);this.rotation.roll=WALK.normalizeRotation(h);this._inverseDirty=!0;a(this)},setRotationDeg:function(f,g,h){f=THREE.Math.degToRad(f);g=THREE.Math.degToRad(g);h=THREE.Math.degToRad(h);this.setRotation(f,g,h)},setScale:function(f,g,h){this.scale.set(f,g,h);this._inverseDirty=!0;a(this)},setExposure:function(f){this.exposure=f;a(this)},setGamma:function(f){this.gamma=
f;a(this)},worldCoordinatesInside:function(f){this._inverseDirty&&(this._inverseDirty=!1,this._inverse.compose(this.position,e.setFromEuler(this.rotation),this.scale),this._inverse.getInverse(this._inverse));d.copy(f).applyMatrix4(this._inverse);return"sphere"===this._type?1>=d.lengthSq():1>=Math.abs(d.x)&&1>=Math.abs(d.y)&&1>=Math.abs(d.z)},serialize:function(){return{id:this.id,name:this.name,type:this._type,position:this.position.toArray(),rotation:this.rotation.toDegTriple(),scale:this.scale.toArray(),
exposure:this.exposure,gamma:this.gamma}},dispose:function(){}};THREE.EventDispatcher.prototype.apply(WALK.CameraVolume.prototype)})();(function(){function a(p){d&&g===p.id||(d=new THREE.SphereBufferGeometry(1,32,16),d.convertNormalsToSpherical(),e=new THREE.PlaneBufferGeometry(1,1),e.convertNormalsToSpherical(),f=new THREE.CylinderBufferGeometry(.5,.5,1,16,1),h||(h=new THREE.Matrix4,h.makeRotationX(Math.PI/2)),f.applyMatrix(h),f.convertNormalsToSpherical(),g=p.id)}function b(p){var r=p.icon&&WALK.ICONS[p.icon],n=r?r.value:p.text,m=r?r.fontFamily:"Open Sans",l=p.color||"#4c9ed9";var u=p.opacity;void 0===u||1<=u?u=l:(k.setStyle(l),
u="rgba("+(255*k.r|0)+","+(255*k.g|0)+","+(255*k.b|0)+","+u+")");var v=u;u=p.textColor||"#ffffff";var t=void 0!==p.opacity&&1>p.opacity,B="sphere"===p.type;r=[r||"",n,m,v,u,B,20,p.borderRadius||0,t].join("_");var D=q.get(r);if(D)return D.usedTimes++,[l,u,r,D.texture];D=document.getElementById("anchor-canvas");D||(D=document.createElement("canvas"),D.id="anchor-canvas");if(B){B=D;var I=n;B.width=512;B.height=512;B=B.getContext("2d");B.font="400 128px "+m;I=B.measureText(I).width;I=Math.floor(c/I*128);
I=Math.min(I,c);B.font="400 "+I+"px "+m;m=B}else{B=$jscomp;I=B.makeIterator;var J=D,Q=WALK.SPRITE_ANCHOR_FONT_SIZE,T=J.getContext("2d");T.font="400 "+Q+"px "+m;for(var M=n,z=n.length-1,A;;){A=T.measureText(M).width;A+=40;if(2048>=A)break;M=n.substring(0,z)+"...";--z}J.width=A;J.height=1.5*Q;T=J.getContext("2d");T.font="400 "+Q+"px "+m;n=I.call(B,[T,M]);m=n.next().value;n=n.next().value}m.fillStyle=v;p.borderRadius?(v=m,B=D.width,I=D.height,p=.5*p.borderRadius*Math.min(B,I),v.beginPath(),v.moveTo(0+
p,0),v.lineTo(0+B-p,0),v.quadraticCurveTo(0+B,0,0+B,0+p),v.lineTo(0+B,0+I-p),v.quadraticCurveTo(0+B,0+I,0+B-p,0+I),v.lineTo(0+p,0+I),v.quadraticCurveTo(0,0+I,0,0+I-p),v.lineTo(0,0+p),v.quadraticCurveTo(0,0,0+p,0),v.closePath(),v.fill()):m.fillRect(0,0,D.width,D.height);m.fillStyle=u;m.textAlign="center";m.textBaseline="middle";m.shadowColor="black";m.shadowBlur=16;m.fillText(n,D.width/2,D.height/2);p=new WALK.Texture(D);p.width=D.width;p.height=D.height;p.hasAlpha=t;p.minFilter=GLC.LINEAR;p.loaded=
!0;p.needsUpdate=!0;q.set(r,{usedTimes:1,texture:p});return[l,u,r,p]}var c=512-2*Math.floor(512*(.5-.5*Math.sin(70/180*Math.PI/2))),d=null,e,f,g=null,h,k=new THREE.Color,q=new Map;WALK.Anchor=function(p,r){a(p);var n=new THREE.Vector3;n.fromArray(r.position);var m=$jscomp.makeIterator(b(r)),l=m.next().value,u=m.next().value,v=m.next().value;m=m.next().value;this._textureSignature=v;var t=new THREE.Color;t.setStyle(l);t.convertGammaToLinear();Object.defineProperty(this,"color",{get:function(){return t}});
var B=new THREE.Color;B.setStyle(u);B.convertGammaToLinear();Object.defineProperty(this,"textColor",{get:function(){return B}});if("sphere"===r.type)l=d,u=new WALK.AnchorMaterial,v=p.closestLightProbe(n),u.bumpTexture=m,u.disableLightProbe=null===v||!v.texturesReady(),u.headLight=!0,p=[r.radius,r.radius,r.radius];else{l=e;u=new WALK.AnchorSpriteMaterial;v=null;u.disableLightProbe=!0;u.headLight=!1;u.specularOff=1;p=[m.width/m.height*r.height,r.height,1];var D=new THREE.Mesh(f,null)}u.baseColorTexture=
m;u.configureTransparency();u.setUniforms();THREE.Mesh.call(this,l,u);this.position.copy(n);this.scale.fromArray(p);this.updateMatrixWorld(!0);this.lightProbe=v;D?(D.position.copy(n),n=Math.max(p[0],p[1]),D.scale.fromArray([n,n,r.height]),D.updateMatrixWorld(!0),this.colliderMesh=D):this.colliderMesh=this;this.colliderMesh.visibilityId=null;this.colliderMesh.anchor=this;this.extension=null};WALK.Anchor.prototype=Object.create(THREE.Mesh.prototype);WALK.Anchor.prototype.dispose=function(){var p=this.material;
p.dispose();var r=this._textureSignature,n=q.get(r),m=n.texture;console.assert(p.baseColorTexture===m);n.usedTimes--;0===n.usedTimes&&(m.dispose(),q.delete(r))};WALK.Anchor.prototype.enableLightProbe=function(){if(this.lightProbe){console.assert(this.lightProbe.texturesReady());var p=this.material;p.disableLightProbe=!1;p.setUniforms()}}})();(function(){function a(d){return(d.boundingBox.max.z-d.boundingBox.min.z)/2}var b=null,c={sphere:null,head:null,torso:null,displayPortrait:null,displayLandscape:null,cylinder:null};WALK.setAvatarGeometries=function(d){for(var e=$jscomp.makeIterator(["head","torso","displayPortrait","displayLandscape"]),f=e.next();!f.done;f=e.next())f=f.value,d.has(f)||console.assert(!1,'Avatar "'+f+'" geometry is missing'),c[f]=d.get(f)};WALK.Avatar=function(d,e,f){THREE.Object3D.call(this);this.uuid=e;this.displayName=
f.displayName;this._scene=d;this._lastLightProbeCheckPosition=new THREE.Vector3(0,0,0);this.colliders=[];c.plane&&b===d.id||(c.sphere=new THREE.SphereBufferGeometry(.08,32,16),c.sphere.convertNormalsToSpherical(),c.cylinder=new THREE.CylinderBufferGeometry(.005,.005,1,3),c.cylinder.convertNormalsToSpherical(),b=d.id);this._haveLightProbe=0<this._scene.lightProbes.length;var g=f.color,h=this._haveLightProbe;e=new WALK.StandardMaterial;e.baseColor.setStyle(g).convertGammaToLinear();e.roughness=.7;e.metallic=
1;e.highlight=new THREE.Color(16777215);e.highlightMix=0;h||(e.disableLightProbe=!0,e.headLight=!0);e.setUniforms();this._body=new THREE.Object3D;this._head=new THREE.Mesh(c.head,e);this._head.rotation.order="ZXY";this._torso=new THREE.Mesh(c.torso,e);this._torso.position.z=-(c.torso.boundingBox.max.z+a(c.head)+.05);g=f.displayName;h=f.color;this._displayNameAnchor=new WALK.Anchor(d,{type:"sprite",position:[0,0,.1+a(c.head)],height:.1,text:g,textColor:h,opacity:0});d=this._haveLightProbe;g=new WALK.StandardMaterial;
g.headLight=!1;g.baseColor.setRGB(0,0,0);g.roughness=.001;g.metallic=0;d||(g.disableLightProbe=!0);g.setUniforms();this._displayMaterial=g;this._displayLandscape=new THREE.Mesh(c.displayLandscape,this._displayMaterial);this._displayPortrait=new THREE.Mesh(c.displayPortrait,this._displayMaterial);e=new THREE.Mesh(c.sphere,e);e.scale.set(.4,.4,.4);e.visible=!1;this._pointer=e;this._pointerLeaderStartOffset=new THREE.Vector3(0,.3,-.35);e=f.color;d=new WALK.StandardMaterial;d.headLight=!1;d.baseColor.setStyle(e).convertGammaToLinear();
d.transparent=!0;d.opacity=.5;d.emissive=!0;d.disableLightProbe=!0;d.setUniforms();e=new THREE.Mesh(c.cylinder,d);e.visible=!1;this._pointerLeader=e;this._body.add(this._torso);this._head.add(this._displayLandscape);this._head.add(this._displayPortrait);this._body.add(this._head);this.add(this._body);this.add(this._displayNameAnchor);this.add(this._pointerLeader);this.add(this._pointer);e=$jscomp.makeIterator([this._torso,this._displayLandscape,this._displayPortrait,this._head]);for(d=e.next();!d.done;d=
e.next())d=d.value,d.visibilityId=null,this.colliders.push(d);f.position&&this.position.fromArray(f.position);this.updateMatrixWorld(!0);this._setClosestLightProbe();this._videoTexture1=this._videoTexture0=null;this._landscape=!0;this._displayLandscape.visible=!0;this._displayPortrait.visible=!1;this._soundThreshold=140;this._maxHighlight=.5;this._highlightStepDown=.05};WALK.Avatar.prototype=Object.create(THREE.Object3D.prototype);WALK.Avatar.prototype.constructor=WALK.Avatar;WALK.Avatar.prototype.switchToPortrait=
function(){this._landscape&&(this._landscape=!1,this._displayLandscape.visible=!1,this._displayPortrait.visible=!0,this._head.rotation.y=Math.PI/2,this._torso.position.z-=.05)};WALK.Avatar.prototype.switchToLandscape=function(){this._landscape||(this._landscape=!0,this._displayLandscape.visible=!0,this._displayPortrait.visible=!1,this._head.rotation.y=0,this._torso.position.z+=.05)};WALK.Avatar.prototype.hideBody=function(){this._head.visible=!1;this._torso.visible=!1;this._displayNameAnchor.visible=
!1};WALK.Avatar.prototype._updated=function(){this.dispatchEvent({type:"avatarUpdated",target:this})};WALK.Avatar.prototype.rotate=function(d,e){this._body.rotation.z=d;this._head.rotation.x=e};WALK.Avatar.prototype.setOrientation=function(){this._videoTexture0.width<this._videoTexture0.height?this.switchToPortrait():this.switchToLandscape()};WALK.Avatar.prototype.setVideoTexture0=function(d){var e=this;this._videoTexture0&&(this._videoTexture0.dispose(),this._videoTexture0=null);this._haveLightProbe&&
(this._displayMaterial.disableLightProbe=!1);this._displayMaterial.baseColorTexture=null;this._updated();d?d.addLoadedListener(function(){e._videoTexture0=d;e.setOrientation();e._displayMaterial.disableLightProbe=!0;e._displayMaterial.baseColorTexture=d;d.addResizedListener(function(){e.setOrientation();e._updated()});e._updated()}):(this.switchToLandscape(),this._updated())};WALK.Avatar.prototype.getVideoTexture0=function(){return this._videoTexture0};WALK.Avatar.prototype.setVideoTexture1=function(d){var e=
this;this._videoTexture1&&(this._videoTexture1.dispose(),this._videoTexture1=null,this._updated());d&&d.addLoadedListener(function(){e._videoTexture1=d;e._updated()})};WALK.Avatar.prototype.getVideoTexture1=function(){return this._videoTexture1};WALK.Avatar.prototype.getMainMaterial=function(){return this._head.material};WALK.Avatar.prototype._setClosestLightProbe=function(){var d=this._scene.closestLightProbe(this.position);d!==this._head.lightProbe&&(this._head.lightProbe=d,this._torso.lightProbe=
d,this._displayLandscape.lightProbe=d,this._displayPortrait.lightProbe=d,this._pointer.lightProbe=d,this._pointerLeader.lightProbe=d)};WALK.Avatar.prototype.setPositionFromArray=function(d){this.position.fromArray(d);.5<this._lastLightProbeCheckPosition.distanceTo(this.position)&&(this._lastLightProbeCheckPosition.copy(this.position),this._setClosestLightProbe(this.position))};WALK.Avatar.prototype.placePointer=function(d,e,f){var g=new THREE.Matrix4,h=new THREE.Vector3,k=new THREE.Vector3,q=new THREE.Vector3,
p=new THREE.Vector3,r=new THREE.Matrix4,n=new THREE.Matrix4;n.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);var m=new THREE.Matrix4;return function(l,u,v){this._pointer.position.set(l-this.position.x,u-this.position.y,v-this.position.z);this._pointer.visible=!0;g.makeRotationZ(this._body.rotation.z);h.set(this._pointerLeaderStartOffset.x,this._pointerLeaderStartOffset.y,this._pointerLeaderStartOffset.z);h.applyMatrix4(g);k.set(this.position.x,this.position.y,this.position.z).add(h);q.set(l,u,v);p.set(l,u,
v).sub(k);m.makeScale(1,p.length(),1);r.lookAt(k,q,THREE.Object3D.DefaultUp);r.multiply(n);m.multiplyMatrices(r,m);p.divideScalar(2).add(h);m.setPosition(p);this._pointerLeader.matrix.identity();this._pointerLeader.applyMatrix(m);this._pointerLeader.visible=!0}}();WALK.Avatar.prototype.hidePointer=function(){this._pointerLeader.visible=!1;this._pointer.visible=!1};WALK.Avatar.prototype.onSoundVolumeUpdated=function(d){null!==d&&(d=this._computeHighlighMix(d),this.getMainMaterial().highlightMix!==
d&&(this.getMainMaterial().highlightMix=d,WALK.getViewer().requestFrame()))};WALK.Avatar.prototype.onSoundSwitchedOff=function(){0<this.getMainMaterial().highlightMix&&(this.getMainMaterial().highlightMix=0,WALK.getViewer().requestFrame())};WALK.Avatar.prototype._computeHighlighMix=function(d){var e=this.getMainMaterial().highlightMix;if(d<this._soundThreshold)return 0<e?Math.max(0,e-this._highlightStepDown):0;d=(d-this._soundThreshold)/(255-this._soundThreshold)*this._maxHighlight;return d>e?d:Math.max(d,
e-this._highlightStepDown)};WALK.Avatar.prototype.dispose=function(){this._head.material.dispose();this._displayMaterial.dispose();this._videoTexture0&&this._videoTexture0.dispose();this._videoTexture1&&this._videoTexture1.dispose();this._displayNameAnchor.dispose();this.dispatchEvent({type:"dispose"})}})();(function(){function a(k,q,p,r,n){p=new THREE.SphereBufferGeometry(p,32,16);p.changePosition(r);p.computeBoundingSphere();p.convertNormalsToSpherical();r=new WALK.Mesh(null,p,q);q.lightMapped&&(r.lightMap=n);k.camera.getWorldPosition(f);r.lightProbe=k.closestLightProbe(f);r.frustumCulled=!1;r.userData.hideFromLightProbes=!0;return r}function b(k){c.setRGB(k,k,k);k=WALK.ColorUtils.hdrEncode(c,d);var q=new Uint8Array(4);q[0]=Math.round(255*d.r);q[1]=Math.round(255*d.g);q[2]=Math.round(255*d.b);q[3]=
Math.round(255*k);k=new WALK.DataTexture(q,1,1);k.magFilter=GLC.NEAREST;k.minFilter=GLC.NEAREST;k.anisotropy=WALK.NO_ANISOTROPY;k.hasAlpha=!0;k.isRgbm=!0;k.loaded=!0;k.needsUpdate=!0;return k}var c,d,e,f,g=new THREE.Matrix4,h=new THREE.Vector2;WALK.MaterialPicker=function(k,q,p,r,n,m,l){function u(E){t.forEach(function(K){return K(E)})}var v=this;this.lightMap=null;this.meshes=[];var t=[],B=Math.max(2*r.camera.near,.1);c||(c=new THREE.Color,d=new THREE.Color,f=new THREE.Vector3,e=new THREE.Vector3,
f=new THREE.Vector3);var D=r.camera.aspect,I=Math.tan(THREE.Math.degToRad(r.camera.fov/2))*B,J=-I;D=Math.abs(D*I-D*J);I=Math.abs(I-J);var Q=.01*D,T=(D-k.length*Q-Q)/(2*k.length);T=Math.min(T,WALK.MATERIAL_PICKER_BALL_MAX_SIZE/2*D);var M=k.length/2*-(2*T+Q)+T+Q;J=document.getElementById("menu-bar").getBoundingClientRect().top;var z=-I/2+(window.innerHeight-J)/window.innerHeight*I+T+Q;k.some(function(E){return E.lightMapped})&&(m=m.measureIncidentLuma(),0>m&&(m=1),this.lightMap=b(m));k.forEach(function(E,
K){if(E){e.set(M,z,-B);var H=a(r,E,T,e,v.lightMap);M+=2*T+Q;var G=null;if(q){G=new THREE.Matrix4;G.multiply(g.makeTranslation(q.x,q.y,q.z));E=n.cameraWorldPosition();h.x=E.x-q.x;h.y=E.y-q.y;E=G;var O=E.multiply,Y=g.makeRotationZ;var W=Math.abs(h.y)>Math.abs(h.x)?0<h.x?0:-Math.PI:0<h.y?Math.PI/2:-Math.PI/2;O.call(E,Y.call(g,W));G.multiply(g.makeRotationX(-Math.PI/2));G.multiply(g.makeScale(p,p,p));G.multiply(g.makeTranslation(2.1*(K+1),0,0));G.multiply(g.makeScale(1/T,1/T,1/T));G.multiply(g.makeTranslation(-e.x,
-e.y,-e.z))}v.meshes.push(H);t.push(function(ka){ka&&G?(H.matrix=G,H.matrixWorld=G):(H.matrix=r.camera.matrix,H.matrixWorld=r.camera.matrixWorld)})}});var A=function(){return u(!0)},y=function(){return u(!1)};l.addEventListener("modeEnabled",A);l.addEventListener("modeDisabled",y);this.dispose=function(){t.length=0;l.removeEventListener("modeEnabled",A);l.removeEventListener("modeDisabled",y);this.meshes.forEach(function(E){return E.geometry.dispose()});this.meshes=null;this.lightMap&&(this.lightMap.dispose(),
this.lightMap=null)};u(l.modeIsEnabled())}})();(function(){var a=function(b,c,d){function e(){n.set({x:c.min.x,y:c.min.y},{x:c.max.x,y:c.max.y})}function f(){var u=n.center(),v=Math.abs(Math.sin(p)),t=Math.abs(Math.cos(p)),B=Math.abs(n.max.x-n.min.x),D=Math.abs(n.max.y-n.min.y),I=B*t+D*v;v=B*v+D*t;l.set({x:u.x-I/2,y:u.y+v/2},{x:u.x+I/2,y:u.y-v/2})}function g(){var u=Math.abs(c.min.x-c.max.x),v=Math.abs(c.min.y-c.max.y);u=n.size().x/u;v=n.size().y/v;u>v?m.set(1,v/u):m.set(u/v,1)}var h=b.name||"level",k=b.slicePlaneHeight,q=b.farPlaneHeight,p=b.rotation||
0,r=!!b.cropRange,n=b.cropRange?new THREE.Box2((new THREE.Vector2).fromArray(b.cropRange.min),(new THREE.Vector2).fromArray(b.cropRange.max)):new THREE.Box2,m=new THREE.Vector2(1,1),l=new THREE.Box2;r&&g();this.setRange=function(u,v,t){u>n.max[t]&&(u=n.max[t]);v<n.min[t]&&(v=n.min[t]);n.min[t]=u;n.max[t]=v;f();g();d()};this.serialize=function(){var u=r?{min:n.min.toArray(),max:n.max.toArray()}:null;return{name:h,slicePlaneHeight:k,farPlaneHeight:q,cropRange:u,rotation:p}};Object.defineProperty(this,
"name",{get:function(){return h},set:function(u){h=u?u.trim()||"level":"level";d()}});Object.defineProperty(this,"slicePlaneHeight",{get:function(){return k},set:function(u){u>=q&&(k=u,d())}});Object.defineProperty(this,"farPlaneHeight",{get:function(){return q},set:function(u){u<=k&&(q=u,d())}});Object.defineProperty(this,"crop",{get:function(){return r},set:function(u){(r=u)||e();f();g();d()}});Object.defineProperty(this,"cropRange",{get:function(){n.empty()&&e();return n}});Object.defineProperty(this,
"visibleRange",{get:function(){l.empty()&&f();return l}});Object.defineProperty(this,"ratio",{get:function(){0!==m.x&&0!==m.y&&isNaN(m.x)&&isNaN(m.y)||g();return m}});Object.defineProperty(this,"rotation",{get:function(){return p},set:function(u){p=u;r||e();f();g();d()}});Object.defineProperty(this,"rotationDeg",{get:function(){return THREE.Math.radToDeg(this.rotation)},set:function(u){this.rotation=THREE.Math.degToRad(u)}})};WALK.MinimapConfig=function(b,c,d){function e(){return new a({name:"level0",
slicePlaneHeight:d?d:c.min.z+WALK.FALLBACK_CAMERA_HEIGHT,farPlaneHeight:c.min.z},c,k)}function f(){return m.map(function(l){return l.serialize()})}var g=this;b=void 0!==b?b:{enabled:!1,outlineColor:[0,0,0],outlineThickness:1,fillEnabled:!0,levels:[]};var h={type:"updated",target:this},k=function(){return g.dispatchEvent(h)},q=b.enabled,p=(new THREE.Color).fromArray(b.outlineColor),r=b.outlineThickness,n=b.fillEnabled,m=b.levels.map(function(l){return new a(l,c,k)});this.addLevel=function(l){var u=
m.length;if(0===u)m.push(e());else{var v=m,t=v.push;var B="level"+u;var D=m[u-1];u=D.slicePlaneHeight+(c.max.z-D.slicePlaneHeight)/2;var I=D.farPlaneHeight;D=D.rotation;l=l.crop?{min:l.cropRange.min.toArray(),max:l.cropRange.max.toArray()}:null;B=new a({name:B,slicePlaneHeight:u,farPlaneHeight:I,cropRange:l,rotation:D},c,k);t.call(v,B)}k()};this.removeLevel=function(l){WALK.removeFromArray(l,m);0===m.length&&m.push(e());k()};this.shiftLevel=function(l,u){WALK.shiftItem(m,l,u);k()};this.setOutlineColorRGB=
function(l,u,v){p.setRGB(l,u,v);k()};this.serialize=function(){return{enabled:this.enabled,outlineColor:this.outlineColor.toArray(),outlineThickness:this.outlineThickness,fillEnabled:this.fillEnabled,levels:f()}};Object.defineProperty(this,"enabled",{get:function(){return q},set:function(l){l&&0===m.length&&this.addLevel();q=l;k()}});Object.defineProperty(this,"outlineColor",{get:function(){return p}});Object.defineProperty(this,"outlineThickness",{get:function(){return r},set:function(l){r=l;k()}});
Object.defineProperty(this,"fillEnabled",{get:function(){return n},set:function(l){n=l;k()}});Object.defineProperty(this,"levels",{get:function(){return m}})};THREE.EventDispatcher.prototype.apply(WALK.MinimapConfig.prototype)})();(function(){function a(){var b=new Set,c=[];this.add=function(d){d instanceof RegExp?c.push(d):b.add(d)};this.matchesAny=function(d){return b.has(d)?!0:c.some(function(e){return e.test(d)})}}WALK.MergeConfig=function(){this._editableNodeTypes=new a;this._editableMaterialNames=new a;this._allMaterialsEditable=!1;this.setNodeTypeEditable=function(b){this._editableNodeTypes.add(b)};this.setMaterialEditable=function(b){this._editableMaterialNames.add(b)};this.setAllMaterialsEditable=function(){this._allMaterialsEditable=
!0};this.isMaterialEditable=function(b){return this._allMaterialsEditable||this._editableMaterialNames.matchesAny(b)};this.isNodeTypeEditable=function(b){return this._editableNodeTypes.matchesAny(b)}}})();(function(){function a(){function c(p,r,n){return(0<=p?p-1:p+r/n)*n}var d=this,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3;this.objects=[];var q=null;this.vertices=[];this.normals=[];this.uvs=[];this.startObject=function(p){q={name:p||"",vertices:[],normals:[],uvs:[],hasUvs:!1};this.objects.push(q)};this.addFace=function(p,r,n,m,l,u,v,t,B){var D=this.vertices.length;p=c(p,D,3);r=c(r,D,3);n=c(n,D,3);D=d.vertices;var I=q.vertices;I.push(D[p+0],
D[p+1],D[p+2]);I.push(D[r+0],D[r+1],D[r+2]);I.push(D[n+0],D[n+1],D[n+2]);void 0!==v?(p=this.normals.length,v=c(v,p,3),t=c(t,p,3),B=c(B,p,3),p=d.normals,r=q.normals,r.push(p[v+0],p[v+1],p[v+2]),r.push(p[t+0],p[t+1],p[t+2]),r.push(p[B+0],p[B+1],p[B+2])):(B=d.vertices,t=q.normals,e.fromArray(B,p),f.fromArray(B,r),g.fromArray(B,n),k.subVectors(g,f),h.subVectors(e,f),k.cross(h),k.normalize(),t.push(k.x,k.y,k.z),t.push(k.x,k.y,k.z),t.push(k.x,k.y,k.z));void 0!==m?(B=this.uvs.length,m=c(m,B,2),l=c(l,B,2),
u=c(u,B,2),B=d.uvs,t=q.uvs,t.push(B[m+0],B[m+1]),t.push(B[l+0],B[l+1]),t.push(B[u+0],B[u+1]),q.hasUvs=!0):(u=q.uvs,u.push(0,0),u.push(0,0),u.push(0,0))}}function b(c){if(void 0!==c&&""!==c)return parseInt(c,10)}WALK.loadGeometriesFromObj=function(c,d,e){WALK.ajaxGet(c,!1,function(f){var g=f,h=/^[og]\s*(.+)?/,k=/^mtllib /,q=/^usemtl /,p=/^usemap /;f=new a;-1!==g.indexOf("\r\n")&&(g=g.replace(/\r\n/g,"\n"));-1!==g.indexOf("\\\n")&&(g=g.replace(/\\\n/g,""));g=g.split("\n");var r;g=$jscomp.makeIterator(g);
for(r=g.next();!r.done;r=g.next()){var n=r.value;if(0!==n.length&&"\x00"!==n){var m=n.charAt(0);if("#"!==m)if("v"===m)switch(r=n.split(/\s+/),r[0]){case "v":f.vertices.push(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]));7<=r.length&&console.assert(!1,"obj with vertex colors is not supported");break;case "vn":f.normals.push(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]));break;case "vt":f.uvs.push(parseFloat(r[1]),parseFloat(r[2]))}else if("f"===m){n=n.substr(1).trim().split(/\s+/);r=[];n=
$jscomp.makeIterator(n);for(m=n.next();!m.done;m=n.next())m=m.value,0<m.length&&(m=m.split("/"),r.push(m));n=r[0];m=1;for(var l=r.length-1;m<l;m++){var u=r[m],v=r[m+1];f.addFace(b(n[0]),b(u[0]),b(v[0]),b(n[1]),b(u[1]),b(v[1]),b(n[2]),b(u[2]),b(v[2]))}}else"l"===m?console.assert(!1,"line geometry is not supported"):"p"===m?console.assert(!1,"obj point geometry not supported"):null!==(r=h.exec(n))?(r=(" "+r[0].substr(1).trim()).substr(1),f.startObject(r)):q.test(n)||k.test(n)||p.test(n)||"s"!==m&&console.warn('OBJLoader: Unexpected line: "'+
n+'"')}}h=new Map;f=$jscomp.makeIterator(f.objects);for(k=f.next();!k.done;k=f.next())k=k.value,0!==k.vertices.length&&(q=new THREE.BufferGeometry,q.addAttribute("position",new WALK.BufferAttribute(new Float32Array(k.vertices),3)),0<k.normals.length&&q.addAttribute("normal",new WALK.BufferAttribute(new Float32Array(k.normals),3)),!0===k.hasUvs&&q.addAttribute("uv",new WALK.BufferAttribute(new Float32Array(k.uvs),2)),q.convertNormalsToSpherical(),q.computeBoundingBox(),q.computeBoundingSphere(),h.set(k.name,
q));return d(h)},e)}})();(function(){WALK.KTXLoader=function(){this._parser=WALK.KTXLoader.parse};WALK.KTXLoader.prototype=Object.create(WALK.CompressedTextureLoader.prototype);WALK.KTXLoader.parse=function(a){var b=[],c=new Int32Array(a,0,16);67305985===c[3]&&console.assert("Big endian machines not supported");console.assert(0===c[4]);console.assert(1===c[5]);console.assert(0===c[6]);if(35842===c[7]){console.assert(6408===c[8]);var d=GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG}else 36196===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_ETC1_WEBGL):
33776===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_S3TC_DXT1_EXT):33779===c[7]?(console.assert(6408===c[8]),d=GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT):console.error("Unknown KTX glInternalFormat: "+c[7]);var e=c[9],f=c[10];console.assert(0===(e&e-1));console.assert(0===(f&f-1));console.assert(0===c[11]);console.assert(0===c[12]);console.assert(1===c[13]);var g=c[14];c=c[15];console.assert(0===c%4);c=64+c;for(var h=new DataView(a,0),k=e,q=f,p=0;p<g;++p){var r=h.getUint32(c,!0);c+=4;var n=new Uint8Array(a,
c,r);b.push({data:n,width:k,height:q});c+=r+(3-(r+3)%4);k=Math.max(k/2,1);q=Math.max(q/2,1)}console.assert(c===a.byteLength);return{format:d,width:e,height:f,mipmapCount:g,mipmaps:b}}})();(function(){function a(f,g,h,k,q){f({wasmBinary:g}).then(function(p){function r(n,m,l){var u=0===Math.log2(m)%1&&0===Math.log2(l)%1;return k.dxtTextures?n?h.BC3:h.BC1:k.pvrtcTextures&&m===l&&u?n?h.PVRTC1_4_RGBA:h.PVRTC1_4_RGB:k.etc1Textures&&!n?h.ETC1:k.astcTextures?h.ASTC_4x4:h.RGBA32}p.initializeBasis();q(function(n){var m=new p.BasisFile(new self.Uint8Array(n));n=function(T){m.close();m.delete();throw T;};var l=m.getHasAlpha(),u=m.getNumImages(),v=m.getNumLevels(0),t=m.getImageWidth(0,0),B=m.getImageHeight(0,
0);0!==t&&0!==B&&0!==u&&0!==v||n("Invalid .basis file");1<u&&n("Missing multiple images handling");u=r(l,t,B);t=u.formatIdx;m.startTranscoding()||n("startTranscoding failed");B=[];for(var D=0;D<v;++D){var I=m.getImageWidth(0,D),J=m.getImageHeight(0,D),Q=m.getImageTranscodedSizeInBytes(0,D,t);Q=new self.Uint8Array(new self.ArrayBuffer(Q));m.transcodeImage(Q,0,D,t,0,l)||n(".transcodeImage failed");B.push({data:Q,width:I,height:J})}m.close();m.delete();return{gpuFormat:u.gpuFormat,mipmaps:B}})})}function b(f,
g,h,k){var q=new window.Worker(f),p=null,r={processItem:function(l){console.assert(!p);p=l;q.postMessage(l.texBuffer,[l.texBuffer])},terminate:function(){console.assert(!p);q.terminate()}},n=function(l){throw"Worker error @L"+l.lineno+": "+l.message;};q.addEventListener("error",n);var m=function(){q.removeEventListener("error",n);q.removeEventListener("message",m);q.addEventListener("error",function(l){l="Worker error @L"+l.lineno+": "+l.message;p&&(p.onError(l),p=null)});q.addEventListener("message",
function(l){console.assert(p);p.onSuccess(l.data);p=null;k(r)});h();k(r)};q.addEventListener("message",m);q.postMessage(g)}function c(f,g,h,k){function q(){u.deferRun();0!==l.length&&(0<m.length?(m.pop().processItem(l.pop()),q()):n<k&&!r&&(n++,r=!0,b(p,h,function(){r=!1},function(v){m.push(v);q()})))}f="\nself.importScripts("+JSON.stringify(f)+");\nconst initBasis = "+a.toString()+";\nconst basisFormats = "+JSON.stringify(e)+";\nconst glDetector = "+JSON.stringify({astcTextures:g.gl.astcTextures,
dxtTextures:g.gl.dxtTextures,etc1Textures:g.gl.etc1Textures,pvrtcTextures:g.gl.pvrtcTextures})+";\n\nfunction initHandler(evt) {\n  self.removeEventListener('message', initHandler);\n\n  const wasmBinary = evt.data;\n  initBasis(BASIS, wasmBinary, basisFormats, glDetector,\n            decodeTexBuffer => {\n    self.addEventListener('message', function(evt) {\n        const texBuffer = evt.data;\n        const texDatas = decodeTexBuffer(texBuffer);\n        // second argument to transfer ownership to the main thread\n        self.postMessage(texDatas, texDatas.mipmaps.map(t => t.data.buffer));\n    });\n    self.postMessage({}); // communicate end of init\n  });\n}\n\nself.addEventListener('message', initHandler);\n";
var p=window.URL.createObjectURL(new window.Blob([f])),r=!1,n=0,m=[],l=[],u=new WALK.DeferringExecutorOnce(function(){for(var v=$jscomp.makeIterator(m),t=v.next();!t.done;t=v.next())t.value.terminate();n-=m.length;m.length=0},5E3);return function(v,t,B){l.push({texBuffer:v,onSuccess:t,onError:B});q()}}function d(f,g){WALK.ajaxGet(WALK.getViewerAssetUrl("lib/basis/basis_transcoder.wasm"),!0,function(h){var k=WALK.getViewerAssetUrl("lib/basis/basis_transcoder.js"),q=f.BASIS_DECODE_WORKERS;if(0>=q){var p=
window.document.createElement("script");p.addEventListener("load",function n(){p.removeEventListener("load",n);a(window.BASIS,h,e,f.gl,function(m){g(function(l,u,v){try{u(m(l))}catch(t){v(t)}})})});p.src=k;window.document.head.appendChild(p)}else g(c(k,f,h,q))},function(h){throw h;})}var e=function(){function f(g,h){return{formatIdx:g,gpuFormat:h}}return{ETC1:f(0,GLC.COMPRESSED_RGB_ETC1_WEBGL),BC1:f(2,GLC.COMPRESSED_RGB_S3TC_DXT1_EXT),BC3:f(3,GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT),PVRTC1_4_RGB:f(8,GLC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG),
PVRTC1_4_RGBA:f(9,GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),ASTC_4x4:f(10,GLC.COMPRESSED_RGBA_ASTC_4x4_KHR),RGBA32:f(13,GLC.RGBA)}}();WALK.createBasisLoader=function(f){function g(p){k=p;h.forEach(function(r){return k.apply(null,$jscomp.arrayFromIterable(r))});h.length=0}if(!window.WebAssembly||!(f.gl.pvrtcTextures||f.gl.etc1Textures||f.gl.dxtTextures||f.gl.astcTextures))return null;var h=[],k=function(p){for(var r=[],n=0;n<arguments.length;++n)r[n-0]=arguments[n];h.push(r)},q=!1;return{load:function(p,
r,n){var m=new WALK.CompressedTexture;q||(q=!0,d(f,g));p(function(l){k(l,function(u){m.format=u.gpuFormat;u=u.mipmaps;m.mipmaps=u;m.width=u[0].width;m.height=u[0].height;m.generateMipmaps=!1;m.minFilter=1===u.length?GLC.LINEAR:GLC.LINEAR_MIPMAP_LINEAR;m.flipY=!1;m.needsUpdate=!0;r(m)},n)},n);return m}}}})();(function(){function a(){var h={};this.cacheKey=function(k,q,p,r,n){return k+"@"+q+"@"+p+"@"+r+"@"+n};this.get=function(k){return h[k]};this.insert=function(k,q){h[k]=q}}function b(h,k){return function(q,p){WALK.queueAjaxGet(h,k,!0,q,p)}}function c(h,k,q){return function(p,r){b(h,k)(function(n){WALK.decrypt(n,q,p,r)},r)}}function d(h,k,q,p,r,n){function m(u){l.image=u;l.width=u.width;l.height=u.height;r(l)}var l=new WALK.Texture;l.format=q;q=g?function(u){createImageBitmap(u,{premultiplyAlpha:"none",
imageOrientation:l.flipY?"flipY":"none"}).then(m).catch(n)}:m;void 0!==p?c(h,k,p)(function(u){u=new Uint8Array(u);var v=k.endsWith("png")?"image/png":"image/jpeg";u=new Blob([u],{type:v});u=(window.URL||window.webkitURL).createObjectURL(u);var t=new Image;t.onload=function(){m(t)};t.src=u},n):WALK.queueImageGet(h,k,q,n);return l}function e(h,k,q,p,r,n){var m=new WALK.VideoTexture;m.format=q;WALK.queueVideoGet(h,k,function(l){m.video=l;m.width=l.videoWidth;m.height=l.videoHeight;THREE.Math.isPowerOfTwo(m.width)&&
THREE.Math.isPowerOfTwo(m.height)||(m.wrapS=GLC.CLAMP_TO_EDGE,m.wrapT=GLC.CLAMP_TO_EDGE);r(m);p&&m.pause()},n);return m}function f(h,k){!1===h.importGpuCompress&&(k.importGpuCompress=!1);!1===h.importAutoScale&&(k.importAutoScale=!1)}var g=!1;WALK.TextureLoader=function(h,k,q,p,r,n,m){function l(T){var M=T.id,z=T.webFormats;console.assert(z&&0<z.length,"No web format for texture: "+T.id+"."+T.rawExt);if(T.video)return h+"video/"+z[0]+"/"+M+"."+T.stdExt;var A=h+"img/",y=k.ios&&T.rgbm;if(Q&&!y){if(!k.mobile&&
-1<z.indexOf("large/basis"))return A+"large/basis/"+M+".basis";if(-1<z.indexOf("small/basis"))return A+"small/basis/"+M+".basis"}if(k.gl.pvrtcTextures&&!y&&-1<z.indexOf("small/pvr"))return A+"small/pvr/"+M+".ktx";if(k.gl.etc1Textures&&-1<z.indexOf("small/etc1"))return A+"small/etc1/"+M+".ktx";if(k.gl.dxtTextures&&-1<z.indexOf("large/dxt"))return A+"large/dxt/"+M+".ktx";y=-1<z.indexOf("small/std");return!(-1<z.indexOf("large/std"))||k.mobile&&y?A+"small/std/"+M+"."+T.stdExt:A+"large/std/"+M+"."+T.stdExt}
function u(T){--D.texturesToLoad;T.needsUpdate=!0;q(T);T.notifyLoaded()}function v(){--D.texturesToLoad;p()}function t(){--D.texturesToLoad;r()}function B(T,M,z,A,y){var E=new WALK.DataTexture;WALK.queueAjaxGet(T,M,!0,function(K){K=new Uint8Array(K,0,K.byteLength);var H=K[1];E.image.width=Math.pow(2,K[0]);E.image.height=Math.pow(2,H);E.format=z;E.type=GLC.UNSIGNED_BYTE;E.image.data=K.subarray(2);A&&A(E);E=null},y);return E}var D=this,I=new a,J=new WALK.KTXLoader,Q=!WALK.NO_BASIS&&WALK.createBasisLoader(k);
n&&(I.insert=function(){});this.texturesToLoad=0;this.clearCache=function(){I=null};this.load=function(T,M,z,A,y){var E=M.alpha?GLC.RGBA:GLC.RGB,K=l(M),H=/\.basis$/.test(K),G=/\.ktx$/.test(K),O=/\.buf$/.test(K),Y=M.video,W=!(G||O||Y),ka=M.passphrase,la=I.cacheKey(K,z,A,y,E),oa=I.get(la);if(oa)return f(M,oa),oa;D.texturesToLoad+=1;O?oa=B(T,K,E,u,v):H?(T=void 0===ka?b(T,K):c(T,K,ka),oa=Q.load(T,u,v)):G?oa=J.load(T,K,u,v):W?oa=d(T,K,E,ka,u,v):(console.assert(Y),oa=e(WALK.LOAD_PRIORITY.VIDEO,K,E,m,u,
t));oa.hasAlpha=!!M.alpha;oa.isRgbm=!!M.rgbm;z&&(oa.wrapS=GLC.REPEAT,oa.wrapT=GLC.REPEAT);A&&!Y?(oa.minFilter=GLC.LINEAR_MIPMAP_LINEAR,oa.generateMipmaps=!G):(oa.minFilter=GLC.LINEAR,oa.generateMipmaps=!1);y&&(oa.anisotropy=y);I.insert(la,oa);oa.id=M.id;oa.name=M.name;oa.webFormats=M.webFormats;f(M,oa);M.rawExt&&(oa.rawExt=M.rawExt);oa.stdExt=M.stdExt;return oa}}})();(function(){function a(e,f,g){for(var h=0;h<f.length;h+=1){var k=f[h],q=e[k];void 0!==q&&(g["_"+k]=q)}}var b="doubleSided name opacity parallaxCorrection parallaxMode parallaxScale parallaxMinLayers parallaxMaxLayers planarReflector".split(" "),c="bumpScale emissive emissionStrength envMapProject metallic roughness alphaInLowerHalf chromaKeyEnabled".split(" "),d="baseColor bumpScale bumpTexture doubleSided emissive metallic opacity roughness".split(" ");WALK.MaterialLoader=function(e,f,g){var h=WALK.DETECTOR;
this.load=function(k,q){for(var p=new Map,r=0,n=0;n<k.length;n+=1){var m,l=k[n];var u=WALK.createMaterialOfType(l.type);if("water"===u.type)u.name=l.name,l.normalTexture&&(u.normalTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,l.normalTexture,!0,!1,WALK.DEFAULT_ANISOTROPY)),l.baseColor&&u.baseColor.fromArray(l.baseColor),void 0!==l.opacity&&(u.opacity=l.opacity),a(l,["wavesSpeed","wavesScale","refractionFactor"],u),u.setUniforms();else{WALK.copyProperties(l,b,u);a(l,c,u);l.baseColor&&(u.baseColor.fromArray(l.baseColor),
u.baseColor.roundChannels());if(m=l.baseColorTextureCorrection)u._baseColorTextureCorrection=!0,void 0!==m.contrast&&(u._baseColorTextureContrast=m.contrast),u.baseColorTextureHslOffset.h=m.hslOffset[0],u.baseColorTextureHslOffset.s=m.hslOffset[1],u.baseColorTextureHslOffset.l=m.hslOffset[2];if(m=l.baseColorTexture){if(m.atlasId){var v=f[m.atlasId].getAtlasEntry(m.id,m.name,m.atlasOffset[0],m.atlasOffset[1],m.atlasScale[0],m.atlasScale[1]);null!==v.rawExt&&v.rawExt!==m.rawExt&&console.warn("Atlas entries with not matching rawExt "+
m.name);v.rawExt=m.rawExt;null!==v.stdExt&&v.stdExt!==m.stdExt&&console.warn("Atlas entries with not matching stdExt "+m.name);v.stdExt=m.stdExt;!1===m.importGpuCompress&&(v.importGpuCompress=!1);!1===m.importAutoScale&&(v.importAutoScale=!1);m=v}else m=e.load(WALK.LOAD_PRIORITY.DIFFUSE,m,!0,!0,WALK.DEFAULT_ANISOTROPY);m.isCutout=null;u.baseColorTexture=m}l.roughnessTexture&&(u.roughnessTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,l.roughnessTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));l.metallicTexture&&
(u.metallicTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,l.metallicTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));l.bumpTexture&&h.gl.standardDerivatives&&(u.bumpTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,l.bumpTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));l.doNotImport&&WALK.copyProperties(l.doNotImport,d,u.doNotImport);l.chromaKeyColor&&(u.chromaKeyColor.fromArray(l.chromaKeyColor),u.chromaKeyColor.roundChannels());l.chromaKeyDelta&&u._chromaKeyDelta.fromArray(l.chromaKeyDelta);l.uvOffsetScale&&(l=l.uvOffsetScale,
u.setUvOffsetAndScale(l[0],l[1],l[2],l[3]))}if(!g.isMaterialEditable(u.name)){l=u.hash();m=p.get(l)||[];v=$jscomp.makeIterator(m);for(var t=v.next();!t.done;t=v.next())if(t=t.value,t.canMerge(u)){r+=1;t.merged=!0;u=t;break}u.merged||(m.push(u),p.set(l,m))}q.addMaterial(u);u.merged||u.setUniforms()}WALK.log("Have "+k.length+" materials and "+(k.length-r)+" merged materials.")}}})();(function(){WALK.SkyLoader=function(a){function b(d,e,f){var g=new THREE.SphereBufferGeometry(1,64,64);return new WALK.SkyMesh(d,g,e,f)}function c(d){var e=new WALK.ProceduralSkyMaterial;return b(d.name,e,d.center)}this.loadSkyTexture=function(d,e){d.material.map&&d.material.map.dispose();d.material.map=a.load(WALK.LOAD_PRIORITY.SKY,e,!1,!1,WALK.NO_ANISOTROPY);d.yawRotationDeg=0};this.loadSingleSky=function(d,e){if("procedural"===d.type||void 0===d.type)d=c(d);else if("equirect"===d.type){var f=new WALK.EquirectSkyMaterial;
f.map=a.load(WALK.LOAD_PRIORITY.SKY,d.texture,!1,!1,WALK.NO_ANISOTROPY);f=b(d.name,f,d.center);f.geometry.applyMatrix((new THREE.Matrix4).makeScale(1,1,-1));f.rotation.x=Math.PI/2;f.yawRotationDeg=d.yawRotation||0;d=f}else console.warn("Unknown sky type: ",d.type),d=c(d);e.addSkyMesh(d)};this.load=function(d,e){this.loadSingleSky({name:WALK.DEFAULT_SKY_NAME,type:"procedural"},e);for(var f=0;f<d.length;f+=1)this.loadSingleSky(d[f],e)}}})();(function(){WALK.LightmapLoader=function(a,b,c){function d(){--f;if(0===f)e.onComplete()}var e=this,f=b;this.lightmaps=[];this.onComplete=null;this.load=function(){var g;if(g=WALK.DETECTOR.webp)g=void 0!==c&&void 0!==c.formats?0<=c.formats.indexOf("webp"):!1;g={id:null,name:null,stdExt:g?"webp":"png",webFormats:["large/std"],alpha:!0,rgbm:!0};for(var h=0;h<b;h+=1){g.id=g.name="lightmap-rgbm"+h;var k=a.load(WALK.LOAD_PRIORITY.LIGHTMAP,g,!1,!1,WALK.NO_ANISOTROPY);k.addLoadedListener(d);this.lightmaps.push(k)}}}})();(function(){WALK.TextureAtlasLoader=function(a,b){this.atlases={};this.load=function(c){for(var d=0;d<c.length;++d){var e=a.load(WALK.LOAD_PRIORITY.DIFFUSE,c[d],!1,!0,WALK.DEFAULT_ANISOTROPY);e.flipY=!1;e.enableAtlas(b);this.atlases[c[d].id]=e}}}})();(function(){WALK.BufferLoader=function(a,b){var c={};this.onHaveBuffer=this.onFailure=this.onProgress=null;this._buffersDone={};this.buffers={meshes:null,transforms:null,bounds:null,faces16:null,faces:null,vertices:null,normals:null,uvs0:null,uvs1:null};this.haveAllBuffers=function(){for(var d in this.buffers)if(this.buffers.hasOwnProperty(d)&&null===this.buffers[d])return!1;return!0};this.haveCoreBuffers=function(){var d=this.buffers;return d.faces16&&d.faces&&d.vertices&&d.normals&&d.transforms};
this.releaseCoreBuffers=function(){var d=this.buffers;d.faces16=d.faces=d.vertices=d.normals=null};this.load=function(){function d(k){return function(q){f.buffers[k]=q;f.onHaveBuffer()}}function e(k){return function(q){c[k]=q.loaded;f.onProgress()}}var f=this,g=WALK.LOAD_PRIORITY.CORE_RESOURCE,h={meshes:g,transforms:g,bounds:g,faces16:g,faces:g,vertices:g,normals:g,uvs0:b?g:WALK.LOAD_PRIORITY.UV0,uvs1:b?g:WALK.LOAD_PRIORITY.LIGHTMAP};(function(){for(var k in f.buffers)if(f.buffers.hasOwnProperty(k)){var q=
h[k];console.assert(void 0!==q);WALK.queueAjaxGet(q,a+k+".buf",!0,d(k),f.onFailure,e(k),!0)}})()};this.totalDone=function(){var d=0,e;for(e in c)c.hasOwnProperty(e)&&(d+=c[e]);return d}}})();(function(){function a(c,d,e){var f=new Int32Array(c);c=new Float32Array(c);var g=new Float32Array(d),h={},k=f[0],q=f[1],p=2;for(d=0;p<f.length;){var r={nodeId:f[p],materialIdx:f[p+1],useFaces16:1===f[p+2],faceByteOffset:f[p+3],faceCnt:f[p+4],vertexByteOffset:f[p+5],vertexCnt:f[p+6],normalByteOffset:f[p+7],uv0ByteOffset:f[p+8],uv1ByteOffset:f[p+9],lightMapIdx:f[p+10],uv1CoordUScale:c[p+11],uv1CoordVScale:c[p+12],uv1CoordUOffset:f[p+13],uv1CoordVOffset:f[p+14],transformByteOffset:f[p+15],boundsByteOffset:f[p+
16],quantVertexRange:c[p+17],quantVertexMax:f[p+18],quantUv0Range:c[p+19],quantUv0Max:f[p+20],autoLightmapResolution:2<=k?f[p+21]:-1,useInstances:!1,hasCopies:!1,isMasterCopy:!1};r.boundingBox=new THREE.Box3;r.boundingSphere=new THREE.Sphere;a:{for(var n=r.boundingBox,m=r.boundingSphere,l=r.boundsByteOffset/4,u=0;6>u;++u)if(!isFinite(g[l+u]))break a;n.max.x=g[l];n.max.y=g[l+1];n.max.z=g[l+2];n.min.x=g[l+3];n.min.y=g[l+4];n.min.z=g[l+5];n.center(m.center);m.radius=g[l+6]}d=Math.max(d,r.lightMapIdx+
1);WALK.DETECTOR.gl.instances&&(n=r.vertexByteOffset,h.hasOwnProperty(n)?(n=h[n],m=n[0],m.isMasterCopy=!0,m.hasCopies=!0,r.hasCopies=!0,n.push(r)):h[n]=[r]);e.push(r);p+=q}e=$jscomp.makeIterator(Object.values(h));for(f=e.next();!f.done;f=e.next())if(f=f.value,c=f.length,1<c&&500<c*f[0].faceCnt)for(f=$jscomp.makeIterator(f),c=f.next();!c.done;c=f.next())c.value.useInstances=!0;return d}var b=function(c,d,e,f,g){this.meshPropsSet=new Set;this.meshPropsSet.add(c);this.material=d;this.lightMap=e;this.lightProbe=
f;this.hideInViews=g;this.anyLogicalMeshHasUvs=-1!==c.uv0ByteOffset;this.sharedGeometryId=c.useInstances?c.vertexByteOffset:null};b.prototype.canUseLightMap=function(c){return null===this.lightMap||null===c||this.lightMap===c};WALK.MeshMaker=function(c,d,e,f){function g(m){var l=[],u=new Map;k.forEach(function(v){var t=c.findNode(v.nodeId),B=c.materials[v.materialIdx],D=null;null!==t.initialLightProbeId&&(D=c.findLightProbe(t.initialLightProbeId));var I=null;-1!==v.lightMapIdx&&(I=m[v.lightMapIdx]);
var J=t.hideInViews||[];if(t.editable||1!==B.opacity)l.push(new b(v,B,I,D,J));else{var Q=v.useInstances?v.vertexByteOffset:null;t=u.get(B)||[];for(var T=$jscomp.makeIterator(t),M=T.next();!M.done;M=T.next()){M=M.value;var z;if(z=M.lightProbe===D&&M.canUseLightMap(I)&&M.sharedGeometryId===Q)a:if(z=M.hideInViews,z.length!==J.length)z=!1;else{for(var A=0;A<z.length;A+=1)if(z[A]!==J[A]){z=!1;break a}z=!0}if(z){null!==I&&(M.lightMap=I);M.anyLogicalMeshHasUvs=M.anyLogicalMeshHasUvs||-1!==v.uv0ByteOffset;
M.meshPropsSet.add(v);return}}v=new b(v,B,I,D,J);t.push(v);u.set(B,t);l.push(v)}});return l}var h=this,k=[],q=d.byteLength,p=0,r=0,n=0;this.mergedMeshes=[];this.lightmapCount=this.geometryDownloadSize=this.coreGeometryDownloadSize=0;this.createMeshes=function(m){var l=m?m[0]:null,u=g(m);m={};u=$jscomp.makeIterator(u);for(var v=u.next();!v.done;v=u.next()){var t=v.value;v=t.sharedGeometryId;if(null!==v){var B=m[v],D=!1;B||(B=new WALK.Geometry,D=!0,m[v]=B);v=new WALK.InstancedGeometry(B,D)}else v=new WALK.Geometry;
B=new WALK.MergedMesh(v,t.material);B.lightProbe=t.lightProbe;B.lightMap=t.lightMap||l;B.hideInViews=t.hideInViews;B.anyLogicalMeshHasUvs=t.anyLogicalMeshHasUvs;this.mergedMeshes.push(B);t=$jscomp.makeIterator(t.meshPropsSet);for(D=t.next();!D.done;D=t.next()){D=D.value;var I,J=v;if(f){var Q=3*D.faceCnt;var T=D.vertexCnt}else Q=0,T=3*D.faceCnt;if(J.isInstanced)var M=I=0;else I=J.indexCnt,M=J.vertexCnt;M=new WALK.SubGeometry(Q,T,J,I,M,D.boundingBox,D.boundingSphere);J.boundingBox.union(D.boundingBox);
WALK.Math.spheresUnion(D.boundingSphere,J.boundingSphere);J.isInstanced?(M.instanceId=J.instanceCount,J.instanceCount+=1,J.indexCnt=Q,J.vertexCnt=T):(J.indexCnt+=Q,J.vertexCnt+=T);Q=M;T=c.findNode(D.nodeId);Q=new WALK.Mesh(T,Q,B.material);Q.lightMap=B.lightMap;Q.lightProbe=B.lightProbe;Q.autoLightmapResolution=D.autoLightmapResolution;Q.useFaces16=D.useFaces16;Q.faceByteOffset=D.faceByteOffset;Q.faceCnt=D.faceCnt;Q.vertexByteOffset=D.vertexByteOffset;Q.vertexCnt=D.vertexCnt;Q.normalByteOffset=D.normalByteOffset;
Q.uv0ByteOffset=D.uv0ByteOffset;Q.uv1ByteOffset=D.uv1ByteOffset;Q.lightMapIdx=D.lightMapIdx;Q.uv1CoordUScale=D.uv1CoordUScale;Q.uv1CoordVScale=D.uv1CoordVScale;Q.uv1CoordUOffset=D.uv1CoordUOffset;Q.uv1CoordVOffset=D.uv1CoordVOffset;Q.transformByteOffset=D.transformByteOffset;Q.quantVertexRange=D.quantVertexRange;Q.quantVertexMax=D.quantVertexMax;Q.quantUv0Range=D.quantUv0Range;Q.quantUv0Max=D.quantUv0Max;D.hasCopies&&(Q.sharedBuffersDebug=D.isMasterCopy?1:2);p+=1;B.addLogicalMesh(Q);T.mesh=Q}}WALK.log("Have "+
p+" meshes and "+this.mergedMeshes.length+" merged meshes.")};this.lightmapCount=a(d,e,k);d=e=null;(function(){for(var m=0,l=0,u=0,v=0,t=0,B=0,D=0,I=$jscomp.makeIterator(k),J=I.next();!J.done;J=I.next()){J=J.value;var Q=J.vertexCnt;r+=Q;n+=J.faceCnt;m=Math.max(m,J.faceByteOffset+3*J.faceCnt*(J.useFaces16?2:4));l=Math.max(l,J.vertexByteOffset+3*Q*WALK.Math.minBytesToHold(J.quantVertexMax)+3&-4);u=Math.max(u,J.normalByteOffset+2*Q);v=Math.max(v,J.transformByteOffset+64);t=Math.max(t,J.boundsByteOffset+
28);-1!==J.uv0ByteOffset&&(B=Math.max(B,J.uv0ByteOffset+2*Q*WALK.Math.minBytesToHold(J.quantVertexMax)+3&-4));-1!==J.uv1ByteOffset&&(D=Math.max(D,J.uv1ByteOffset+4*Q))}h.coreGeometryDownloadSize=q+m+l+u+v+t;h.geometryDownloadSize+=h.coreGeometryDownloadSize+B+D})();WALK.log("Have "+r+" vertices, "+n+" faces and "+this.lightmapCount+" lightmaps.")}})();(function(){function a(l,u,v,t,B,D,I){var J=0;for(v*=3;J<v;J+=3){var Q=l[J+u]*B,T=l[J+u+1]*B,M=l[J+u+2]*B;D[I+J]=t[0]*Q+t[1]*T+t[2]*M+t[3];D[I+J+1]=t[4]*Q+t[5]*T+t[6]*M+t[7];D[I+J+2]=t[8]*Q+t[9]*T+t[10]*M+t[11]}}function b(l,u,v,t,B,D){var I=0;for(v*=2;I<v;I+=2){var J=(l[I+u]/254+.5)*Math.PI,Q=Math.PI/127*l[I+u+1],T=Math.sin(J),M=T*Math.cos(Q);Q=T*Math.sin(Q);J=Math.cos(J);T=t[0]*M+t[1]*Q+t[2]*J;var z=t[4]*M+t[5]*Q+t[6]*J;J=2*(Math.acos(t[8]*M+t[9]*Q+t[10]*J)/Math.PI-.5);Q=Math.atan2(z,T)/Math.PI;
B[D+I]=WALK.Math.toSnorm8(J);B[D+I+1]=WALK.Math.toSnorm8(Q)}}function c(l){return 0!==l.instanceId||!1===l.parent.ownsGpuBuffers}function d(l,u,v,t,B,D){var I=!1,J=0;for(v*=2;J<v;J+=1){var Q=l[J+u]*t;B[D+J]=Q;if(0>Q||1<Q)I=!0}return I}function e(l,u,v,t,B){var D=!1,I=0;for(v*=2;I<v;I+=1){var J=l[I+u];t[B+I]=J;if(0>J||1<J)D=!0}return D}function f(l,u,v,t,B,D,I,J,Q){var T=0;for(v*=2;T<v;T+=2){var M=l[T+u],z=l[T+u+1];0!==M||0!==z?(J[Q+T]=Math.round(M*t)+D,J[Q+T+1]=Math.round(z*B)+I):(J[Q+T]=0,J[Q+T+
1]=0)}}function g(l,u,v,t,B){function D(){for(;J<l.length;){var T=l[J];if(0!==Q||u(T)){for(;Q<T.logicalMeshes.length;){var M=T.logicalMeshes[Q];v(M);Q+=1;if(I.shouldInterrupt(M.vertexCnt)){setTimeout(D,0);return}}t(T);J+=1;Q=0}else J+=1}B()}var I=new m(5E4),J=0,Q=0;D()}function h(l,u){u.geometry.allocateCoreBuffers(l);return!0}function k(l){return l.anyLogicalMeshHasUvs?(l.geometry.allocateUv0(),!0):!1}function q(l){return l.lightMap?(l.geometry.allocateUv1(),!0):!1}function p(l,u,v,t,B){var D=4*
B.instanceId;B=B.parent.uvs1Mod;B[D]=v/65535;B[D+1]=t/65535;B[D+2]=l/65535;B[D+3]=u/65535}function r(l,u){var v=u.parent;u=4*u.instanceId;var t=v.transforms0;t[u]=l[0];t[u+1]=l[1];t[u+2]=l[2];t[u+3]=l[3];t=v.transforms1;t[u]=l[4];t[u+1]=l[5];t[u+2]=l[6];t[u+3]=l[7];v=v.transforms2;v[u]=l[8];v[u+1]=l[9];v[u+2]=l[10];v[u+3]=l[11]}var n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0]),m=function(l){this.minVerticesUntilTimeCall=l;this.verticesCount=0;this.timer=new WALK.Timer};m.prototype.shouldInterrupt=
function(l){this.verticesCount+=l;return this.verticesCount>this.minVerticesUntilTimeCall&&10<this.timer.elapsedMSec()?(this.verticesCount=0,this.timer.reset(),!0):!1};WALK.asyncFillIndexedUv0=function(l,u,v,t){var B=new Uint16Array(l),D=new Float32Array(l);g(u,k,function(I){if(I.uv0InBuffers()){var J=I.geometry;if(!c(J)){var Q=J.vertexOffset;J=J.parent;if(I.quantUv0Disabled()?e(D,I.uv0ByteOffset/4,I.vertexCnt,J.uvs0,2*Q):d(B,I.uv0ByteOffset/2,I.vertexCnt,I.quantUv0Factor(),J.uvs0,2*Q))J.isUvs0Repeating=
!0}}},v,t)};WALK.asyncFillIndexedUv1=function(l,u,v,t){var B=new Uint16Array(l);g(u,q,function(D){if(D.uv1InBuffers()){var I=D.uv1CoordUScale,J=D.uv1CoordVScale,Q=D.uv1CoordUOffset,T=D.uv1CoordVOffset,M=D.geometry;if(M.isInstanced){p(I,J,Q,T,M);if(c(M))return;I=J=1;Q=T=0}f(B,D.uv1ByteOffset/2,D.vertexCnt,I,J,Q,T,M.parent.uvs1,2*M.vertexOffset)}},v,t)};WALK.asyncFillIndexedCoreGeometry=function(l,u,v,t){var B=l.faces16?new Uint16Array(l.faces16):null,D=l.faces?new Uint32Array(l.faces):null,I=new Int8Array(l.vertices),
J=new Int16Array(l.vertices),Q=new Int32Array(l.vertices),T=new Int8Array(l.normals);g(u,h.bind(null,!0),function(M){var z=M.geometry,A=z.parent,y=new Float32Array(l.transforms,M.transformByteOffset,16);if(z.isInstanced){r(y,z);if(c(z))return;y=n}switch(WALK.Math.minBytesToHold(M.quantVertexMax)){case 1:var E=I;var K=M.vertexByteOffset;break;case 2:E=J;K=M.vertexByteOffset/2;break;case 4:E=Q,K=M.vertexByteOffset/4}var H=z.vertexOffset;a(E,K,M.vertexCnt,y,M.quantVertexFactor(),A.vertices,3*H);b(T,
M.normalByteOffset,M.vertexCnt,y,A.normals,2*H);A=A.index;z=z.indexOffset;M.useFaces16?(K=M.faceByteOffset/2,y=B):(K=M.faceByteOffset/4,y=D);E=K;for(M=K+3*M.faceCnt;E<M;E+=1,z+=1)A[z]=y[E]+H},v,t)};WALK.asyncFillNotIndexedGeometry=function(l,u,v,t){var B=l.faces16?new Uint16Array(l.faces16):null,D=l.faces?new Uint32Array(l.faces):null,I=new Int8Array(l.vertices),J=new Int16Array(l.vertices),Q=new Int32Array(l.vertices),T=new Int8Array(l.normals),M=new Uint16Array(l.uvs0),z=new Float32Array(l.uvs0),
A=l.uvs1?new Uint16Array(l.uvs1):null;g(u,function(y){h(!1,y);k(y);q(y);return!0},function(y){var E=y.geometry,K=y.geometry.parent,H=new Float32Array(l.transforms,y.transformByteOffset,16);if(y.uv0InBuffers()&&K.uvs0)var G=K.uvs0;if(y.uv1InBuffers()&&K.uvs1){var O=K.uvs1;var Y=y.uv1CoordUScale;var W=y.uv1CoordVScale;var ka=y.uv1CoordUOffset;var la=y.uv1CoordVOffset}if(E.isInstanced){r(H,E);O&&p(Y,W,ka,la,E);if(c(E))return;H=n;Y=W=1;ka=la=0}if(y.useFaces16){E=B;var oa=y.faceByteOffset/2}else E=D,oa=
y.faceByteOffset/4;switch(WALK.Math.minBytesToHold(y.quantVertexMax)){case 1:var ra=I;var Ba=y.vertexByteOffset;break;case 2:ra=J;Ba=y.vertexByteOffset/2;break;case 4:ra=Q,Ba=y.vertexByteOffset/4}var ma=y.quantUv0Disabled();if(ma)var Ga=y.uv0ByteOffset/4;else{var aa=y.quantUv0Factor();Ga=y.uv0ByteOffset/2}var S=3*y.geometry.vertexOffset,R=2*y.geometry.vertexOffset,Z=y.quantVertexFactor(),ca=K.vertices,na=K.normals,Aa=y.normalByteOffset,Ca=y.uv1ByteOffset/2,qa=oa;for(y=oa+3*y.faceCnt;qa<y;qa+=1,S+=
3,R+=2){oa=E[qa];a(ra,Ba+3*oa,1,H,Z,ca,S);b(T,Aa+2*oa,1,H,na,R);if(G){var fa=Ga+2*oa;if(ma?e(z,fa,1,G,R):d(M,fa,1,aa,G,R))K.isUvs0Repeating=!0}O&&f(A,Ca+2*oa,1,Y,W,ka,la,O,R)}},v,t)}})();(function(){function a(k,q){k.forEach(function(p){q.addView(new WALK.View(p))})}function b(k){if(0!==k.length&&k[0].position)return k[0].position[2]}function c(k,q,p){k.forEach(function(r){p.isNodeTypeEditable(r.name)&&(r.editable=!0);q.addNodeConfig(new WALK.NodeConfig(r))})}function d(k,q){k.forEach(function(p){var r=new WALK.Light(p);p=p.instances;for(var n=0;n<p.length;n+=1){var m=p[n];r.addInstance(m.position,m.rotation)}q.addLight(r)})}function e(k,q){k.forEach(function(p){q.addLightProbe(new WALK.LightProbe(p))})}
function f(k,q,p){p=p.camera;k&&(k.fov&&(p.defaultFov=k.fov),k.exposure&&(p.defaultExposure=k.exposure),k.gamma&&(p.defaultGamma=k.gamma),k.lutTexture&&(q=q.load(WALK.LOAD_PRIORITY.COLORMAP,k.lutTexture,!1,!1,WALK.NO_ANISOTROPY),q.flipY=!1,p.colorMap=q),p.autoPath=!!k.autoPath,p.autoClimb=!!k.autoClimb,p.autoExposure=!!k.autoExposure,p.fixedHeight=k.fixedHeight,void 0!==k.autoExposureDarkness&&(p.autoExposureDarkness=k.autoExposureDarkness),k.moveMaxSpeed&&(p.moveMaxSpeed=k.moveMaxSpeed),p.updateProjectionMatrix())}
function g(k,q){function p(r,n){var m=q.findNodeConfig(n.config),l=new WALK.Node(r,m,n);void 0!==n.children&&(l.children=n.children.map(function(u){return p(l,u)}));return l}k.forEach(function(r){q.addNode(p(null,r))})}function h(){var k=null;WALK.DETECTOR.whatsApp?k="WhatsApp":WALK.DETECTOR.facebookApp&&(k="Facebook app");null===k?WALK.USER_MSG.error("Scene failed to load. Reload the page to retry."):WALK.USER_MSG.error("Scene failed to load. Open the scene outside of "+k+' by copying the link to the native web browser: <div class="message-scrollable-line"><a href="'+
(window.location+'" taget="_blank">'+window.location+"</a></div>"))}WALK.SceneLoader=function(k,q,p,r,n){var m=!p&&WALK.DETECTOR.gl.indexUint,l=!p&&!WALK.DEBUG_SHARED_BUFFERS,u=new WALK.Timer;this.onComplete=this.onReadyToDisplay=this.onTextureLoaded=this.onMeshBuffersLoaded=this.onProgress=null;this.panoramas=[];this.load=function(){function v(){if(void 0!==aa.total)G.onProgress(aa)}function t(){la||(la=!0,G.onReadyToDisplay(k))}function B(R){0===R.name.indexOf("lightmap-rgbm")?aa.texturesDone+=
12582912:aa.texturesDone+=524288;v();G.onTextureLoaded(R);S()}function D(){console.warn("Failed to load video texture");S()}function I(){if(0===O.texturesToLoad&&ra){O.clearCache();for(var R=0,Z=$jscomp.makeIterator(W.mergedMeshes),ca=Z.next();!ca.done;ca=Z.next())R+=ca.value.geometry.gpuSize;WALK.log("Total GPU geometry buffers size "+R+" bytes");O=Y=W=null;WALK.defer(function(){t();G.onComplete(k)})}}function J(){Ba&&oa&&ka&&(S=I,Ga&&k.materials.forEach(function(R){R.lightMapped||(R.lightMapped=
!0,R.setUniforms())}),S())}function Q(R){R.geometry.addUv1Attribute();G.onMeshBuffersLoaded(R)}function T(){Y.buffers.uvs1&&(S=J,WALK.asyncFillIndexedUv1(Y.buffers.uvs1,W.mergedMeshes,Q,function(){Y.buffers.uvs1=null;Ba=!0;S()}))}function M(R){R.geometry.addUv0Attribute();G.onMeshBuffersLoaded(R)}function z(){Y.buffers.uvs0&&(S=T,WALK.asyncFillIndexedUv0(Y.buffers.uvs0,W.mergedMeshes,M,function(){Y.buffers.uvs0=null;ra=!0;S()}))}function A(){ka=!0;0===k.views.length&&k.addView(new WALK.View({id:0,
name:"Start place",hideFromMenu:!0,position:k.center.toArray(),rotation:[0,0],internal:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME}));if(!p&&!k.disableProgressiveLoader){var R=1E3*WALK.PROGRESSIVE_LOADER_AFTER_SEC-u.elapsedMSec();0>=R?t():setTimeout(t,R)}S()}function y(R){k.addGpuMesh(R)}function E(R){R.geometry.addCoreAttributes();var Z=R.logicalMeshes;console.assert(!Z[0].node.editable||1===Z.length);Z[0].node.editable||!l?Z.forEach(y):y(R);G.onMeshBuffersLoaded(R)}function K(R){R.geometry.uvs0&&R.geometry.addUv0Attribute();
R.geometry.uvs1&&R.geometry.addUv1Attribute();E(R)}function H(){if(m){if(!Y.haveCoreBuffers())return;WALK.log("Using indexed geometry");S=z;WALK.asyncFillIndexedCoreGeometry(Y.buffers,W.mergedMeshes,E,A)}else{if(!Y.haveAllBuffers())return;S=J;WALK.asyncFillNotIndexedGeometry(Y.buffers,W.mergedMeshes,K,function(){Ba=ra=!0;A()})}Y&&Y.releaseCoreBuffers()}var G=this,O=null,Y=null,W=null,ka=!1,la=!1,oa=!1,ra=!1,Ba=!1,ma=null,Ga=!1,aa={total:void 0,texturesDone:0,totalDone:function(){return this.texturesDone+
Y.totalDone()}};u.reset();var S=function(){if(ma&&Y.buffers.meshes&&Y.buffers.bounds){S=H;void 0!==ma.autoAddLightProbes&&(k.autoAddLightProbes=ma.autoAddLightProbes);k.disableProgressiveLoader=ma.disableProgressiveLoader||!1;void 0!==ma.autoTour&&(k.autoTour.disabled=ma.autoTour.disabled||!1,k.autoTour.startOnLoad=ma.autoTour.startOnLoad||!1);d(ma.lights,k);e(ma.lightProbes||[],k);ma.cameraVolumes&&ma.cameraVolumes.forEach(function(ca){return k.addCameraVolume(new WALK.CameraVolume(ca))});O=new WALK.TextureLoader(q,
WALK.DETECTOR,B,h,D,!1,!0);f(ma.camera,O,k);var R=new WALK.TextureAtlasLoader(O,n);R.load(ma.atlases||[]);(new WALK.MaterialLoader(O,R.atlases,r)).load(ma.materials||[],k);(new WALK.SkyLoader(O)).load(ma.skies||[],k);null===k.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)&&console.error("A sky with name "+WALK.EDITOR_CONTROLLED_SKY_NAME+" is missing.");a(ma.views||[],k);ma.hideViewsMenu&&(k.hideViewsMenu=!0);c(ma.nodeConfigs,k,r);g(ma.nodes,k);W=new WALK.MeshMaker(k,Y.buffers.meshes,Y.buffers.bounds,
m);R=null;if(0!==W.lightmapCount){Ga=!0;var Z=new WALK.LightmapLoader(O,W.lightmapCount,ma.lightmap);Z.onComplete=function(){oa=!0;S()};Z.load();R=Z.lightmaps;Z=null}else oa=!0;W.createMeshes(R);aa.total=W.geometryDownloadSize+524288*(O.texturesToLoad-W.lightmapCount)+12582912*W.lightmapCount;ma.panoramas&&(G.panoramas=ma.panoramas);k.minimapConfig=new WALK.MinimapConfig(ma.minimap,k.boundingBox,b(ma.views||[]));ma=null;S()}};WALK.queueAjaxGet(WALK.LOAD_PRIORITY.CORE_RESOURCE,q+"scene.json",!1,function(R){ma=
R;S()},h);Y=new WALK.BufferLoader(q,!m);Y.onProgress=v;Y.onFailure=h;Y.onHaveBuffer=function(){S()};Y.load()};this.elapsedLoadTimeSec=function(){return u.elapsedSec()}}})();(function(){var a=!1;WALK.decrypt=function(b,c,d,e){function f(){a=!0;var g=CryptoJS.lib.WordArray.create(b),h=g.clone();h.sigBytes=16;h.clamp();g.words.splice(0,4);g.sigBytes-=16;var k=CryptoJS.enc.Base64.parse(c);h=CryptoJS.AES.decrypt({ciphertext:g},k,{iv:h,mode:CryptoJS.mode.CFB});g=h.sigBytes;h=h.words;k=new Uint8Array(g);for(var q=0,p=0;q!==g;){var r=h[p++];k[q++]=(r&4278190080)>>>24;if(q===g)break;k[q++]=(r&16711680)>>>16;if(q===g)break;k[q++]=(r&65280)>>>8;if(q===g)break;k[q++]=r&255}d(k.buffer)}
a?f():WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/crypto-js.min.js"),f,function(){return WALK.USER_MSG.error("Cannot load required library")})}})();(function(){function a(c,d,e,f){for(var g=[],h=0;6>h;h+=1){var k=f?new THREE.OrthographicCamera(-1,1,1,-1,c,d):new THREE.PerspectiveCamera(90,1,c,d);e.add(k);g.push(k)}g[0].up.set(0,-1,0);b.set(1,0,0);g[0].lookAt(b);g[1].up.set(0,-1,0);b.set(-1,0,0);g[1].lookAt(b);g[2].up.set(0,0,1);b.set(0,1,0);g[2].lookAt(b);g[3].up.set(0,0,-1);b.set(0,-1,0);g[3].lookAt(b);g[4].up.set(0,-1,0);b.set(0,0,1);g[4].lookAt(b);g[5].up.set(0,-1,0);b.set(0,0,-1);g[5].lookAt(b);return g}var b=new THREE.Vector3;WALK.CubeCamera=
function(c,d){THREE.Object3D.call(this);this.sideCameras=a(c,d,this,!1)};WALK.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.CubeCamera.prototype.constructor=WALK.CubeCamera;WALK.OrthoCubeCamera=function(c,d){THREE.Object3D.call(this);this.sideCameras=a(c,d,this,!0)};WALK.OrthoCubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.OrthoCubeCamera.prototype.constructor=WALK.OrthoCubeCamera})();(function(){WALK.CubeMapFilterShader={uniforms:{gloss:{type:"f",value:.9},face:{type:"f",value:0},mipSize:{type:"f",value:128},envMap:{type:"t",value:null}},vertexShader:WALK.getShader("cubemap_filter_vertex.glsl"),fragmentShader:WALK.getShader("cubemap_filter_fragment.glsl")}})();(function(){function a(q,p,r){for(var n=!0;n;){q.readPixels(p,p,r);for(var m=0;m<p*p*4;m+=4)if(0!==r[m]||0!==r[m+1]||0!==r[m+2]){n=!1;break}if(n){console.warn("Cube face has all pixels black.");break}}}function b(q,p){var r=new Set;q.traverse(function(n){if(n instanceof THREE.Mesh&&n.visible){var m=n.material;n.userData.hideFromLightProbes||m.hideFromLightProbes?(p.add(n),n.visible=!1):r.has(m)||(r.add(m),m.configureTransparency&&(m.transparent=!1,m.blending=THREE.NoBlending,m.depthWrite=!0),void 0!==
m.hdrOutput&&(m.hdrOutput=!0),void 0!==m.specularOff&&(m.specularOff+=1))}});r=null}function c(q,p){var r=new Set;q.traverse(function(n){if(n instanceof THREE.Mesh){var m=n.material;m.forceObjectUniformsRefresh&&m.forceObjectUniformsRefresh();n.visible?r.has(m)||(r.add(m),void 0!==m.hdrOutput&&(m.hdrOutput=!1),m.configureTransparency&&m.configureTransparency(),void 0!==m.specularOff&&--m.specularOff):p.has(n)&&(n.visible=!0)}});r=null}function d(q,p){var r={format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,
stencilBuffer:!1,generateMipmaps:!1};this.renderer=q;this.scene=p;this.threeScene=p.threeScene;this.aabbQueryMaterial=new WALK.AabbQueryMaterial;this.filterPass=new THREE.ShaderPass(WALK.CubeMapFilterShader,"envMap");p=WALK.LIGHT_PROBE_MAX_MIP_SIZE;this.pixelBuf=new Uint8Array(p*p*4);this.targetCubeRaw=q.createRenderTargetCube(p,p,r);r.depthBuffer=!1;this.targetFiltered=q.createRenderTarget(p,p,r);this.autoClearAlter=new WALK.AutoClearAlter(q);this.dispose=function(){this.targetCubeRaw.dispose();
this.targetFiltered.dispose();this.aabbQueryMaterial.dispose();this.filterPass.material.dispose();this.pixelBuf=null}}function e(q,p){var r=p.geometry.boundingSphere.center;if(null===p.lightProbe||r.distanceTo(q.position)<r.distanceTo(p.lightProbe.position))p.lightProbe=q}function f(q,p){for(var r=0;r<p.length;r+=1)e(q,p[r])}function g(q,p){WALK.log("No visible light probe found for "+p.length+" objects. Assigning the closest ones.");for(var r=0;r<p.length;r+=1)for(var n=0;n<q.length;n+=1)e(q[n],
p[r])}var h=function(){var q=null;return function(p,r){var n=null,m=0;r*=r;console.assert(r<Math.pow(2,16));null===q&&(q=new Uint16Array(65536));for(var l=0;l<4*r;l+=4)q[256*p[l]+p[l+1]]+=1;q[0]>.7*r&&(m=q[0]);q[0]=0;for(p=1;p<q.length;p+=1)q[p]>m&&(m=q[p],n=Math.floor(p/256)+p%256/255),q[p]=0;return n}}(),k=function(){var q=null;return function(p,r,n){var m=p.renderer,l=p.aabbQueryMaterial,u=p.pixelBuf,v=p.targetCubeRaw;null===q&&(q=new WALK.OrthoCubeCamera(.01,255));q.position.copy(r.position);
q.updateMatrixWorld();var t;for(t=0;6>t;t+=1){v.activeCubeFace=t;l.axis=Math.floor(t/2);m.renderMeshes(p.scene.gpuMeshes,l,q.sideCameras[t],v);a(m,v.width,u);var B=h(u,v.width);if(null===B){WALK.log("failed to find light probe bound");break}switch(t){case 0:n.boxMax.x=r.position.x+B;break;case 1:n.boxMin.x=r.position.x-B;break;case 2:n.boxMax.y=r.position.y+B;break;case 3:n.boxMin.y=r.position.y-B;break;case 4:n.boxMax.z=r.position.z+B;break;case 5:n.boxMin.z=r.position.z-B}}6!==t&&(WALK.log("Light probe bounds: X["+
n.boxMin.x.toFixed(2)+":"+n.boxMax.x.toFixed(2)+"] Y["+n.boxMin.y.toFixed(2)+":"+n.boxMax.y.toFixed(2)+"] Z["+n.boxMin.z.toFixed(2)+":"+n.boxMax.z.toFixed(2)+"]"),n.resetBoundingBox())}}();d.prototype.constructor=d;WALK.LightProbeMaker=function(q,p,r,n,m){function l(I,J){D.position.copy(I.position);D.updateMatrixWorld();var Q;if((Q=n)&&!(Q=m))a:{Q=q.gpuMeshes;for(var T=0;T<Q.length;T+=1){var M=Q[T];if(M.lightProbe===I&&M.material.envMapMirror){Q=!0;break a}}Q=!1}(T=Q)&&WALK.log("Mirror texture needed for the light probe.");
B.reset();Q=t.renderer;t.autoClearAlter.set(!0,!0,!1);if(T){var z=t.renderer;T=WALK.LIGHT_PROBE_MIRROR_SIZE;T=z.createRenderTargetCube(T,T,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(M=0;6>M;M+=1)T.activeCubeFace=M,z.render(t.threeScene,D.sideCameras[M],T);z.deallocateRenderTargetRenderingBuffers(T);z=T;I.setMirrorTexture(z)}J&&k(t,D,I);J=t.renderer;T=t.targetCubeRaw;for(M=0;6>M;M+=1)T.activeCubeFace=M,J.render(t.threeScene,D.sideCameras[M],
T);t.autoClearAlter.restore();Q.enableScissorTest(!0);t.autoClearAlter.set(!1,!1,!1);r&&(z=Q.createCubeTexture(t.targetFiltered.width,!0),I.setFilteredTexture(z));for(J=0;J<WALK.LIGHT_PROBE_MIPS_COUNT;J+=1){T=J;T=Math.pow(2,WALK.log2(t.targetFiltered.width)-T);Q.setScissor(0,0,T,T);t.filterPass.uniforms.mipSize.value=T;t.filterPass.uniforms.gloss.value=WALK.LIGHT_PROBE_GLOSS_FOR_MIP[J];r||(z=Q.createCubeTexture(T,!1),I.setFilteredTextureNoLod(z,J));M=t.filterPass;var A=t.targetCubeRaw,y=t.targetFiltered,
E=t.pixelBuf,K=r?J:0,H=z;if(WALK.DEBUG_LIGHT_PROBE_MIPS)for(var G=E,O=255*K/WALK.LIGHT_PROBE_MIPS_COUNT,Y=0;Y<4*T*T;Y+=4)G[Y]=O,G[Y+1]=O,G[Y+2]=O,G[Y+3]=31.875;for(G=0;6>G;G+=1)WALK.DEBUG_LIGHT_PROBE_MIPS||(M.uniforms.face.value=G,M.render(Q,y,A),a(Q,T,E)),Q.copyBufferToCubeFaceMip(K,T,G,E,H)}Q.enableScissorTest(!1);t.autoClearAlter.restore();WALK.log("Cube generation time "+B.elapsedSec())}var u,v=q.threeScene,t=new d(p,q),B=new WALK.Timer,D=new WALK.CubeCamera(.15,q.camera.far);this.assignLightProbesToObjects=
function(){B.reset();void 0===u&&(u=new WALK.ObjectVisibilityQuery(p,q.gpuMeshes,q.camera.far));for(var I=0;I<q.gpuMeshes.length;I+=1)q.gpuMeshes[I].lightProbe=null;for(I=0;I<q.lightProbes.length;I+=1){var J=q.lightProbes[I],Q=u.findVisibleObjects(J.position);WALK.log("Have visible objects "+Q.length);f(J,Q)}WALK.log("Light probe assigment time "+B.elapsedSec());g(q.lightProbes,WALK.filter(q.gpuMeshes,function(T){return null===T.lightProbe}))};this.findBounds=function(I){D.position.copy(I.position);
D.updateMatrixWorld();t.autoClearAlter.set(!0,!0,!1);k(t,D,I);t.autoClearAlter.restore()};this.createLightProbeTexture=function(I,J){var Q=new Set;b(v,Q);l(I,J);c(v,Q)};this.createAllLightProbeTextures=function(){var I=new Set;b(v,I);for(var J=0;J<q.lightProbes.length;J+=1)l(q.lightProbes[J],!1);c(v,I)};this.dispose=function(){t.dispose();u&&u.dispose()}}})();(function(){function a(e){if(e.empty())return 0;e.size(d);return d.x*d.y*d.z}function b(e){if(e.empty())return 0;e.size(d);e=d.x*d.y;return 1>d.x||1>d.y||1.9>d.z||1.5>e?0:e*d.z}function c(e){var f=[],g=[];f.push(e);this.addFilledBox=function(k){g.push(k)};this.findBestFilledBoxes=function(){function k(l){return l[1]}function q(l){l=l[0];l=l.max.x<m.min.x+.2||l.min.x>m.max.x-.2||l.max.y<m.min.y+.2||l.min.y>m.max.y-.2||l.max.z<m.min.z+.2||l.min.z>m.max.z-.2?!1:!0;return!l}var p=[],r=[];for(g.forEach(function(l){r.push([l,
a(l)])});0<r.length&&10>p.length;){var n=WALK.indexOfMax(r,k);var m=r[n][0];p.push(m);r=r.filter(q)}return p};this.isEnclosedInFilledBox=function(k){return WALK.any(g,function(q){q=q.min.x-.1<=k.min.x&&k.max.x<=q.max.x+.1&&q.min.y-.1<=k.min.y&&k.max.y<=q.max.y+.1&&q.min.z-.1<=k.min.z&&k.max.z<=q.max.z+.1?!0:!1;return q})};this.findLargestEmptyBox=function(){var k=WALK.indexOfMax(f,a);return null!==k?f[k]:null};var h=function(){var k=[];k[0]=new THREE.Box3;k[1]=new THREE.Box3;k[2]=new THREE.Box3;k[3]=
new THREE.Box3;k[4]=new THREE.Box3;k[5]=new THREE.Box3;return function(q,p,r){k[0].max.copy(q.max);k[0].min.copy(q.min);k[0].min.z=p.max.z;k[1].max.copy(q.max);k[1].max.z=p.min.z;k[1].min.copy(q.min);k[2].max.copy(q.max);k[2].min.copy(q.min);k[2].min.x=p.max.x;k[3].max.copy(q.max);k[3].max.x=p.min.x;k[3].min.copy(q.min);k[4].max.copy(q.max);k[4].min.copy(q.min);k[4].min.y=p.max.y;k[5].max.copy(q.max);k[5].max.y=p.min.y;k[5].min.copy(q.min);var n=WALK.indexOfMax(k,b);0!==b(k[n])&&(r.push(k[n].clone()),
0===n?q.max.z=p.max.z:1===n?q.min.z=p.min.z:2===n?q.max.x=p.max.x:3===n?q.min.x=p.min.x:4===n?q.max.y=p.max.y:5===n&&(q.min.y=p.min.y),h(q,p,r))}}();this.split=function(k){for(var q=[],p=0;p<f.length;p+=1){var r=f[p];r.isIntersectionBox(k)?h(r,k,q):q.push(r)}f=q}}var d;WALK.arrangeLightProbes=function(e,f,g){function h(D){var I=new WALK.LightProbe({id:e.lightProbes.length});D.center(I.position);I.position.z=D.min.z+1.3;I.enableBoundingBox();I.boxMin.copy(D.min);I.boxMax.copy(D.max);e.lightProbes.push(I)}
var k=new c(e.boundingBox.clone()),q=new THREE.Box3,p=new THREE.Box3,r=new THREE.Vector3,n=new WALK.Timer;d=new THREE.Vector3;for(var m=new WALK.LightProbe({id:0}),l=0;200>l;l+=1){var u=k.findLargestEmptyBox();if(null===u)break;u.center(m.position);m.position.z=u.min.z+1.3;m.enableBoundingBox();p.makeEmpty();for(var v=0;5>v;v+=1){f.findBounds(m);if(!m.isBoundingBoxInitialized())break;q.set(m.boxMin,m.boxMax);var t=b(q);if(0===t)break;if(k.isEnclosedInFilledBox(q))break;q.center(r);r.z=q.min.z+1.3;
var B=m.position.distanceToSquared(r);a(p)<t&&.25>B&&p.set(q.min,q.max);if(.04>B)break;m.position.copy(r)}p.empty()?(u.center(q.min),u.center(q.max),k.split(q)):(k.addFilledBox(p.clone()),k.split(p))}WALK.log("Light probes arrangement time "+n.elapsedSec());f=k.findBestFilledBoxes();(f.reduce(function(D,I){return D+a(I)},0)>.2*a(e.boundingBox)||g)&&f.forEach(h);0===e.lightProbes.length&&g&&h(e.boundingBox)}})();/*
 Copyright (C) 2015-present Shapespark
*/
(function(){function a(q){return document.getElementById(q)}function b(q,p){q=document.getElementsByClassName(q);for(var r=0;r<q.length;r+=1)p(q[r])}function c(q){var p=[];b(q,function(n){p.push(n)});for(var r=0;r<p.length;r+=1)p[r].classList.remove(q)}function d(q,p){q.style.display=p?"":"none"}function e(q,p){d(a(q),p)}function f(q,p){b(q,function(r){d(r,p)})}function g(q){d(q,!0);q.style.opacity=0;WALK.defer(function(){q.style.opacity=1})}function h(){var q=document.getElementById("qr-code-canvas");
q?q.remove():(q=document.createElement("canvas"),q.setAttribute("id","qr-code-canvas"),document.body.appendChild(q),QRCode.toCanvas(q,window.location.toString()))}function k(q){q.style.opacity=0;var p=window.getComputedStyle(q).transitionDuration;if(p){var r=parseFloat(p);-1===p.indexOf("ms")&&(r*=1E3);setTimeout(function(){d(q,!1);q.style.opacity=1},r)}else d(q,!1),q.style.opacity=1}WALK.focusWalkCanvas=function(){WALK.DETECTOR.ios||a("walk-canvas").focus()};WALK.Menu=function(q,p,r,n,m){function l(fa){return function(va){va.stopPropagation();
fa();WALK.focusWalkCanvas()}}function u(fa,va){fa.addEventListener("click",l(va))}function v(fa,va){u(a(fa),va)}function t(fa){if(fa){var va=null===ra?[]:ra.visibleViews(),sa;for(sa=0;sa<va.length&&va[sa]!==fa;sa+=1);fa=a("view-list-items").children;if(sa<fa.length)return fa[sa]}return null}function B(fa){return function(){fa.classList.remove("active-view");fa.classList.remove("next-active-view")}}function D(){for(var fa=a("view-list-items").children,va=0;va<fa.length;va+=1)fa[va].classList.remove("active-view"),
fa[va].classList.remove("next-active-view")}function I(){a("tour-button").classList.add("tour-on")}function J(){a("tour-button").classList.remove("tour-on");D()}function Q(){ma.isRunning()?ma.stop():ma.start()}function T(){return ma.isRunning()?(ma.stop(),!0):!1}function M(fa){D();(fa=t(fa.view))&&fa.classList.add("next-active-view")}function z(fa){if(fa=t(fa.view))fa.classList.remove("next-active-view"),fa.classList.add("active-view"),setTimeout(B(fa),WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)}function A(fa){return l(function(){var va=
T();Ba.switchToView(fa,va?0:void 0)})}function y(){var fa=a("info-bar"),va=a("info-bar-slide"),sa=a("view-list"),Fa=a("view-list-slide"),Ta=a("menu-bar"),U=a("menu-bar-slide"),pa=a("menu-bar-folder");d(pa,ra&&!Z);if(la.visible){fa.style.pointerEvents=null;va.style.left=0;sa.style.pointerEvents=null;Fa.style.top=0;Ta.style.pointerEvents=null;U.style.right=0;pa.style.pointerEvents=null;pa.children[0].style.transform="";if(null!==la.cover){Ta=la.cover.title;Fa=la.cover.author;U=la.cover.authorHref;sa=
la.cover.engineLogoOn;fa=la.cover.engineLogoText;va=la.cover.engineLogoUrl;pa=la.cover.authorLogoUrl;la.cover.authorLogo&&(pa=WALK.getExtraAssetUrl(la.cover.authorLogo.path));var Da=a("author-logo"),wa=Da.firstElementChild;pa?(U&&(Da.href=U),wa.src=pa):(d(Da,!1),wa.removeAttribute("src"));pa=null===ra||null!==qa;e("info-text",pa&&(Ta||Fa));pa&&(WALK.setTextContent(a("info-title"),Ta),WALK.setTextContent(a("info-author"),Fa),U&&(a("info-author").href=U));Ta=Ta?Ta:"3D scene";Fa&&(Ta+=" by "+Fa);document.title=
Ta;Fa=a("engine-logo");d(Fa,sa);sa&&(fa&&(sa=a("engine-logo-text"),d(sa,!0),WALK.setTextContent(sa,fa)),va&&(Fa.href=va))}fa=null===ra?[]:ra.visibleViews();va=a("view-list-items");e("view-list",0<fa.length&&!Z);if(0<fa.length){sa=va.children[0];for(B(sa)();1!==va.children.length;)va.removeChild(va.children[va.children.length-1]);for(Fa=0;Fa<fa.length;Fa+=1)Ta=fa[Fa],Ta.hideFromMenu||(WALK.setTextContent(sa,Ta.name),sa.onclick=A(Ta),va.appendChild(sa),sa=sa.cloneNode(!0))}e("menu-buttons",ra&&!Z);
ra&&ra.canStartAutoTour()&&!ca?e("tour-button",!0):(ma&&ma.isRunning()&&ma.stop(),e("tour-button",!1))}else Da=a("menu-bar-content"),fa.style.pointerEvents="none",va.style.left=-va.offsetWidth+"px",sa.style.pointerEvents="none",Fa.style.top=-Fa.offsetHeight+"px",Ta.style.pointerEvents="none",pa.style.pointerEvents="auto",U.style.right=-Da.offsetWidth+"px",pa.children[0].style.transform="rotate(180deg)";fa=la.helpVisible;WALK.DETECTOR.mobile?e("mobile-help",fa):(e("desktop-help",fa),fa&&(fa=a("desktop-help-switch"),
va=a("desktop-help-content"),sa=Ca?1:0,fa.children[sa].classList.add("selected"),d(va.children[sa],!0),fa.children[1-sa].classList.remove("selected"),d(va.children[1-sa],!1)))}function E(){la.visible=!na}function K(){la.helpVisible=!Aa}function H(){Ca=!1;y()}function G(){Ca=!0;y()}function O(){var fa=T();Ba.switchToPreviousVisibleView(fa?0:void 0)}function Y(){var fa=T();Ba.switchToNextVisibleView(fa?0:void 0)}function W(fa){if(!(fa.ctrlKey||fa.altKey||fa.metaKey)){var va=fa.target||fa.srcElement;
va=va.nodeType===Node.ELEMENT_NODE?va.nodeName.toUpperCase():"";if(!/INPUT|SELECT|TEXTAREA/.test(va))if(67===fa.keyCode&&WALK.DEBUG)fa.shiftKey?WALK.DETECTOR.gl.extension("WEBGL_lose_context").restoreContext():WALK.DETECTOR.gl.extension("WEBGL_lose_context").loseContext();else if(null!==ra){switch(fa.keyCode){case 27:T();break;case 70:S&&n();break;case 76:R&&m();break;case 72:K();break;case 77:E();break;case 86:aa&&r();break;case 80:WALK.NO_SCREENSHOTS||(fa.shiftKey?Ga.monoScreenToLocalImage(!0,4E3,
2E3):Ga.monoScreenToLocalImage(!1,window.innerWidth,window.innerHeight));break;case 85:WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/qrcode.js"),h);break;case 219:O();break;case 221:Y()}va=fa.keyCode-48;if(1<=va&&9>=va){--va;var sa=null===ra?[]:ra.visibleViews();va=sa.length>va?sa[va]:null;null!==va&&A(va)(fa)}}}}function ka(fa){switch(fa.action){case WALK.GAMEPAD_ACTION.PREVIOUS:O();break;case WALK.GAMEPAD_ACTION.NEXT:Y()}}var la=this,oa={type:"visibilityChanged"},ra=null,Ba=null,ma=null,
Ga=null,aa=!1,S=!1,R=!1,Z=!1,ca=!1,na=!0,Aa=!1,Ca=!1,qa=null;this.cover=null;Object.defineProperty(this,"visible",{get:function(){var fa=ca&&WALK.DETECTOR.mobile;return na&&!fa},set:function(fa){var va=this.visible;na=fa;va!==this.visible&&this.dispatchEvent(oa);y()}});Object.defineProperty(this,"helpVisible",{get:function(){var fa=ca&&WALK.DETECTOR.mobile;return Aa&&!fa&&!Z},set:function(fa){Aa=fa;y()}});this.updateCover=function(fa){this.cover=fa;null!==qa&&clearTimeout(qa);qa=setTimeout(function(){qa=
null;y()},5E3);y()};this.refresh=function(){y()};this.onFullScreenChange=function(fa){};this.onPointerLockChange=function(fa){Z=fa;y()};this.onVrChange=function(fa){var va=this.visible;ca=fa;va!==this.visible&&this.dispatchEvent(oa);y()};this.onResize=function(){if(!this.visible){var fa=a("info-bar-slide"),va=a("menu-bar-slide"),sa=a("view-list-slide");fa.style.transition="none";va.style.transition="none";sa.style.transition="none";y();fa.style.transition="";va.style.transition="";sa.style.transition=
""}};this.enablePlayButton=function(fa){var va=a("play-button");va.addEventListener("click",fa);d(va,!0)};this.setVrSupported=function(fa){aa=fa;f("vr-specific",fa)};this.setFullScreenSupported=function(){(S=!q)&&f("fullscreen-specific",!0)};this.setPointerLockSupported=function(){R=!q};this.addExtraButton=function(fa){var va=a("tour-button"),sa=document.createElement("img");sa.src=fa;fa=document.createElement("div");fa.className="menu-button menu-item ui-hoverable ui-panel";fa.appendChild(sa);va.parentNode.insertBefore(fa,
va);return fa};this.removeExtraButton=function(fa){fa.remove()};this.getExtraButonIcon=function(fa){return fa.firstElementChild};this.sceneLoadStarted=function(){e("play-button",!1);e("primary-progress",!0)};this.loadProgress=function(fa){fa=fa.totalDone()/fa.total;if(null===ra){var va=Math.max(314.159*(1-fa),0);a("primary-progress-done").style.strokeDashoffset=va}fa=Math.floor(100*fa);a("secondary-progress-done").style.width=fa+"%"};this.sceneReadyToDisplay=function(fa,va,sa,Fa){ra=fa;Ba=va;Ba.addEventListener("teleportStarted",
M);Ba.addEventListener("teleportDone",z);ma=sa;ma.addEventListener("tourStarted",I);ma.addEventListener("tourStopped",J);Ga=Fa;k(a("cover-image"));k(a("primary-progress"));g(a("secondary-progress"));ra.addEventListener("viewAdded",y);ra.addEventListener("viewRemoved",y);ra.addEventListener("viewShifted",y);document.body.style.backgroundImage="none";document.body.style.backgroundColor="#000";y()};this.sceneLoadComplete=function(){e("secondary-progress",!1)};this.init=function(){q&&(f("viewer-specific",
!1),f("editor-specific",!0));b("ui-panel",function(sa){u(sa,function(){})});WALK.DETECTOR.mobile&&c("ui-hoverable");var fa=a("author-logo"),va=fa.firstElementChild;va.onload=function(){d(fa,!0)};va.onerror=function(){d(fa,!1)};document.addEventListener("keydown",W,!1);v("help-button",K);v("fullscreen-button",n);v("vr-button",r);v("tour-button",Q);v("menu-bar-folder",E);v("view-list-folder",E);v("basic-desktop-help-option",H);v("advanced-desktop-help-option",G);v("close-desktop-help-button",K);v("close-mobile-help-button",
K);p.addEventListener("actionActivated",ka);y()};this.contextLost=function(){ra=Ba=ma=Ga;y()}};THREE.EventDispatcher.prototype.apply(WALK.Menu.prototype)})();(function(){var a=null;WALK.Popup=function(b,c,d){var e=!1,f=document.getElementById("ext-html-label"),g=f.querySelector("#ext-html-label-content");this.close=function(h){e?(f.classList.add("ui-out"),WALK.focusWalkCanvas(),window.setTimeout(function(){f.classList.remove("ext-html-label-topleft");f.classList.remove("ext-html-label-horizontal-center");f.classList.remove("ext-html-label-vertical-center");f.classList.remove("ext-html-label-center");f.classList.remove("ui-out");g.innerHTML="";f.style.display=
"none";d&&d();h&&h();e=!1},400)):h()};this.open=function(){var h=this;if(!e){if(b instanceof Node)g.appendChild(b);else{var k=WALK.getExtraAssetUrl("").slice(0,-1);k=b.replace(/\$EXTRA_ASSETS/g,k);g.innerHTML=k}g.style.padding=c.padding||void 0===c.padding?"":0;f.style.display="";c.centerVertically?c.centerHorizontally?f.classList.add("ext-html-label-center"):f.classList.add("ext-html-label-vertical-center"):c.centerHorizontally?f.classList.add("ext-html-label-horizontal-center"):f.classList.add("ext-html-label-topleft");
f.classList.add("ui-out");f.classList.remove("ext-html-label-animated");WALK.preventClosureCompilerDeadCodeRemoval(f.offsetHeight);f.classList.add("ext-html-label-animated");f.classList.remove("ui-out");f.querySelector("#ext-html-label-close").onclick=function(){h.close()};e=!0}}};WALK.openPopup=function(b,c,d){var e=new WALK.Popup(b,c,d);null!==a?a.close(function(){return e.open()}):e.open();return a=e}})();(function(){WALK.USER_MSG=new function(){this.hideInfo=function(){document.getElementById("info-message").style.display="none"};this.info=function(a,b){var c=document.getElementById("info-message");c.innerHTML=a;c.style.display="";setTimeout(this.hideInfo,b||15E3);console.info(a)};this.error=function(a){var b=document.getElementById("error-message");b.innerHTML=a;b.style.display="";console.error(a)}}})();(function(){function a(h,k){return Math.abs(h.x-k.x)<Number.EPSILON&&Math.abs(h.y-k.y)<Number.EPSILON&&Math.abs(h.z-k.z)<Number.EPSILON}function b(h,k){h.addEventListener("click",function(q){q.stopPropagation();k();WALK.focusWalkCanvas()})}function c(h,k,q){var p=Math.sin(k);k=Math.cos(k);h.set((h.x-q.x)*k-(h.y-q.y)*p+q.x,(h.x-q.x)*p+(h.y-q.y)*k+q.y,h.z)}function d(h){var k=document.createElement("canvas");k.width=h;k.height=h;var q=60*Math.PI/180,p=-q/2-Math.PI/2;q=q/2-Math.PI/2;var r=k.getContext("2d");
r.beginPath();r.arc(h/2,h/2,4,0,2*Math.PI);r.fillStyle="rgb(0, 220, 255)";r.fill();r.moveTo(h/2,h/2);r.arc(h/2,h/2,12,p,q,!0);r.lineTo(h/2,h/2);r.arc(h/2,h/2,90,p,q);r.lineTo(h/2,h/2);r.fillStyle="rgba(0, 220, 255, 0.5)";r.fill();return k}function e(h,k){function q(){r=!0;var u=p.width,v=p.height;m!==u||l!==v?(m=u,l=v,k(),window.requestAnimationFrame(q)):0<n?(--n,window.requestAnimationFrame(q)):r=!1}if("ResizeObserver"in window)(new ResizeObserver(k)).observe(h);else{var p=window.getComputedStyle(h),
r,n,m,l;(new MutationObserver(function(){n=60;r||q()})).observe(h,{attributes:!0});window.addEventListener("resize",function(){n=60;r||q()})}}var f=function(h,k){var q=document.createElement("div"),p=d(200);q.style.width="200px";q.style.height="200px";q.style.position="absolute";q.style.pointerEvents="none";q.style.zIndex="2";q.style.opacity="1";q.style.transition="opacity 0.5s";q.id="minimap-camera";q.appendChild(p);this.update=function(r,n){q.style.left=r.x/h*100+"%";q.style.top=r.y/k*100+"%";q.style.transform=
"translate(-100px, -100px) rotate("+n+"rad)"};this.show=function(){q.style.opacity="1"};this.hide=function(){q.style.opacity="0"};this.getContainer=function(){return q}},g=function(h,k,q,p){function r(){u.style.transform="translate("+m.x+","+m.y+")"}function n(){u.style.width=v.width;u.style.height=v.height}var m={x:0,y:0},l=document.createElement("canvas");l.width=3*h;l.height=3*k;l.style.position="absolute";l.style.maxWidth="100%";l.style.maxHeight="100%";var u=document.createElement("div");u.classList.add("minimap-content-controller");
var v=window.getComputedStyle(l);p.appendChild(l);p.appendChild(u);e(q,n);this.add=function(t){u.appendChild(t)};this.clear=function(){u.innerHTML=""};this.updateOffset=function(t){m.x=50-t.x/h*100+"%";m.y=50-t.y/k*100+"%";r()};this.addOffset=function(){r()};this.removeOffset=function(){u.style.transform=""};this.updateRatio=function(t){window.requestAnimationFrame(function(){var B=Math.abs(Math.sin(t.rotation)),D=Math.abs(Math.cos(t.rotation));l.width=3*(h*t.ratio.x*D+k*t.ratio.y*B);l.height=3*(h*
t.ratio.x*B+k*t.ratio.y*D);n()})}};WALK.Minimap=function(h,k,q,p){function r(){oa=k.minimapConfig.levels.map(function(wa){return{level:wa,canvas:null,tab:null}})}function n(){oa.forEach(function(wa){wa.tab=document.createElement("div");wa.tab.classList.add("minimap-tab");wa.tab.innerText=wa.level.name;wa.tab.addEventListener("click",function(){H.selectLevel(wa.level);WALK.focusWalkCanvas()});fa.appendChild(wa.tab)})}function m(wa){la=wa;W.show();oa.forEach(function(Ha){Ha.level===wa?Ha.tab.classList.add("minimap-tab-current"):
Ha.tab.classList.remove("minimap-tab-current")})}function l(wa){oa.forEach(function(Ha){Ha.canvas&&(Ha.canvas.style.opacity=Ha.level===wa?"1":"0",Ha.canvas.style.zIndex=Ha.level===wa?"1":"0");Ha.level===wa?Ha.tab.classList.add("minimap-tab-active"):Ha.tab.classList.remove("minimap-tab-active")})}function u(){var wa=oa.find(function(Ha){return Ha.level===la})?la:oa[oa.length-1].level;H.selectLevel(wa,!0)}function v(wa){var Ha=oa.filter(function(Xa){return Xa.level.slicePlaneHeight<wa.slicePlaneHeight}).sort(function(Xa,
Ka){return Ka.level.slicePlaneHeight-Xa.level.slicePlaneHeight})[0],Ia=oa.filter(function(Xa){return Xa.level.slicePlaneHeight>wa.slicePlaneHeight}).sort(function(Xa,Ka){return Xa.level.slicePlaneHeight-Ka.level.slicePlaneHeight})[0];Ba=Ha?wa.slicePlaneHeight-(wa.slicePlaneHeight-Ha.level.slicePlaneHeight)/2:-Infinity;ma=Ia?wa.slicePlaneHeight-(wa.slicePlaneHeight-Ia.level.slicePlaneHeight)/2:Infinity}function t(wa){return oa.reduce(function(Ha,Ia){return Math.abs(Ia.level.slicePlaneHeight-wa.z)<
Math.abs(Ha.level.slicePlaneHeight-wa.z)?Ia:Ha}).level}function B(wa,Ha){la&&(wa||Ha||(wa=p.getCameraPosition(),Ha=p.getCameraRotation()),Fa.set(wa.x,wa.y),c(Fa,la.rotation,la.cropRange.center()),Ta.set(THREE.Math.mapLinear(Fa.x,la.visibleRange.max.x,la.visibleRange.min.x,U.max,U.min),THREE.Math.mapLinear(Fa.y,la.visibleRange.max.y,la.visibleRange.min.y,pa.max,pa.min)),W.update(Ta,-1*Ha.z+-1*la.rotation),Y&&ka.updateOffset(Ta))}function D(){Y=!0;Aa.classList.add("minimap-container-minimized");Ca.classList.add("minimap-wrapper-minimized");
ka.addOffset();B()}function I(){Y=!1;Aa.classList.remove("minimap-container-minimized");Ca.classList.remove("minimap-wrapper-minimized");ka.removeOffset()}function J(){G=!0;Ca.style.transform="translate(-101%, 0)"}function Q(){p.menuVisible?Y&&(640>window.innerWidth||640>window.innerHeight)?(I(),G=!1,Ca.style.transform=""):G?(G=!1,Ca.style.transform=""):J():J()}function T(){G&&p.menuVisible&&(640>window.innerWidth||640>window.innerHeight)||Q()}function M(wa,Ha,Ia){var Xa=new THREE.Vector3;Ha.addEventListener("click",
function(Ka){var gb=Ha.getBoundingClientRect(),bb=(Ka.clientX-gb.left)/gb.width;Ka=(Ka.clientY-gb.top)/gb.height;0!==wa.data[4*(Math.round(bb*aa)+Math.round(Ka*S)*aa)+3]&&(Xa.set(THREE.Math.mapLinear(bb,0,1,Ia.visibleRange.min.x,Ia.visibleRange.max.x),THREE.Math.mapLinear(Ka,0,1,Ia.visibleRange.min.y,Ia.visibleRange.max.y),Ia.slicePlaneHeight),c(Xa,-1*Ia.rotation,Ia.cropRange.center()),bb=new WALK.View({position:[Xa.x,Xa.y,Xa.z]}),q.switchToView(bb),Ia!==la&&m(Ia));WALK.focusWalkCanvas()})}function z(){ka.add(W.getContainer());
na.style.display="";Aa.style.display="";1<oa.length&&(fa.style.display="",Ca.classList.add("minimap-wrapper-tabs"))}function A(){ka.clear();fa.innerHTML="";fa.style.display="none";Aa.style.display="none";na.style.display="none";Ca.classList.remove("minimap-wrapper-tabs")}function y(wa){var Ha=document.createElement("canvas");Ha.width=aa;Ha.height=S;Ha.style.transition="opacity 0.5s";var Ia=h.createMinimapImageDataComponents(k.minimapConfig,wa,aa,S),Xa=Ia.minimapImageData;Ia=Ia.walkableImageData;Ha.getContext("2d").putImageData(Xa,
0,0);M(Ia,Ha,wa);ka.add(Ha);return Ha}function E(){if(!(R&&Z&&ca&&na&&Aa&&Ca&&qa))return!0}function K(){E()||(ka=new g(aa,S,Ca,qa),W=new f(aa,S),640>window.innerWidth||640>window.innerHeight?J():D(),b(R,D),b(Z,I),b(ca,J),b(na,Q),p.onMenuVisibilityChanged(T),O=!0,r(),n(),u(),z())}var H=this,G=!1,O=!1,Y=!1,W=null,ka=null,la=null,oa=[],ra=!1,Ba=-Infinity,ma=Infinity;p.onViewSwitchStarted(function(){return ra=!0});p.onViewSwitchDone(function(){return ra=!1});var Ga=h.calculateRenderSize(700),aa=Ga.width,
S=Ga.height,R=document.getElementById("minimap-button-minimize"),Z=document.getElementById("minimap-button-maximize"),ca=document.getElementById("minimap-button-close"),na=document.getElementById("minimap-button-toggle"),Aa=document.getElementById("minimap-container"),Ca=document.getElementById("minimap-wrapper"),qa=document.getElementById("minimap-content"),fa=document.getElementById("minimap-tabs"),va=new THREE.Vector3(0,0,0),sa=new THREE.Vector3(0,0,0),Fa=new THREE.Vector2,Ta=new THREE.Vector2,
U={min:0,max:aa},pa={min:0,max:S},Da={type:"minimapLevelSelected",target:this,level:null};THREE.EventDispatcher.prototype.apply(WALK.Minimap.prototype);this.selectLevel=function(wa,Ha){Ha=void 0===Ha?!1:Ha;var Ia=oa.filter(function(Xa){return Xa.level===wa})[0];Ha&&m(wa);Ia.canvas||(Ia.canvas=y(wa));wa===la?W.show():W.hide();l(wa);v(wa);B();ka.updateRatio(wa);Da.level=wa;this.dispatchEvent(Da)};this.update=function(){if(!E()){var wa=p.getCameraPosition(),Ha=p.getCameraRotation();if(!1===a(va,wa)||
!1===a(sa,Ha)){B(wa,Ha);if(!ra&&(wa.z>ma||wa.z<Ba)){var Ia=t(wa);v(Ia);H.selectLevel(Ia,!0)}va.set(wa.x,wa.y,wa.z);sa.set(Ha.x,Ha.y,Ha.z)}}};k.minimapConfig.enabled&&K();k.minimapConfig.addEventListener("updated",function(){O?k.minimapConfig.enabled?(A(),r(),n(),u(),z()):A():K()});p._onMeetingJoined(J)}})();(function(){WALK.Timer=function(){this.clock=performance||Date;this.reset()};WALK.Timer.prototype={constructor:WALK.Timer,reset:function(){this.startMS=this.clock.now()},elapsedMSec:function(){return this.clock.now()-this.startMS},elapsedSec:function(){return.001*this.elapsedMSec()}};WALK.Perf=function(){var a=new WALK.Timer,b=[];this.begin=function(){a.reset()};this.end=function(){b.push(a.elapsedSec());0===b.length%100&&(b.sort(),console.log("Best "+b[0]+" Median "+b[Math.floor(.5*b.length)]+" 95 "+
b[Math.floor(.95*b.length)]))}};WALK.DeferringExecutorOnce=function(a,b){function c(){d=null;a()}var d=null;this.deferRun=function(){null!==d&&clearTimeout(d);d=setTimeout(c,b)}};WALK.DeferringExecutorInterval=function(a,b){function c(){a()}var d=null;this.deferRun=function(){null!==d&&clearInterval(d);d=setInterval(c,b)}}})();(function(){WALK.AnimationController=function(a,b,c){function d(){m(a.vrEnabled())}function e(){m(!1)}var f=this,g=new THREE.Clock,h=!1,k=!1,q=!1,p=0,r=!1,n=function(){k||(h||g.getDelta(),k=!0,a.vrEnabled()?a.requestAnimationFrame(d):requestAnimationFrame(e))};var m=function(l){r&&(k=!1,q?(console.assert(!l),c(g.getDelta(),p)?(p+=1,n()):q=!1):(h=!0,b(g.getDelta(),l),WALK.ALWAYS_RENDER&&f.requestFrame(),h=!1,k||(q=!0,p=0,n())))};this.requestFrame=function(){r&&(q=!1,n())};this.disable=function(){r=
!1};this.enable=function(){r=!0;k=!1;this.requestFrame()};this.isEnabled=function(){return r}}})();(function(){WALK.ExposureController=function(a,b,c){var d=a.camera,e=!1,f=0,g,h,k,q=new WALK.Timer,p=function(m){k=m;f=m-d.exposure;h=Math.sign(f);f=Math.abs(f);g=f/1};this.adaptExposure=function(){if(e&&d.autoExposure){q.reset();var m=c.measureReflectedLuma();0>m?f=0:(p(Math.log2(d.autoExposureDarkness/m)),.3>f&&(f=0))}};this.exposureNeedsUpdate=function(){return 0<f};var r=new THREE.Vector3(Infinity,Infinity,Infinity),n=function(){return function(){if(!e||!d.autoExposure){for(var m=a.cameraVolumes.length-
1;0<=m;--m){var l=a.cameraVolumes[m];if(l.worldCoordinatesInside(r)){p(l.exposure);d.setGamma(l.gamma);return}}p(d.defaultExposure);d.setGamma(d.defaultGamma)}}}();a.addEventListener("cameraVolumeAdded",function(m){m.cameraVolume.addEventListener("updated",n);n()});a.addEventListener("cameraVolumeShifted",n);a.addEventListener("cameraVolumeRemoved",function(m){m.cameraVolume.removeEventListener("cameraVolumeUpdated",n);n()});d.addEventListener("updated",n);this.update=function(m){var l=b.cameraWorldPosition();
r.equals(l)||(r.copy(l),n());this.exposureNeedsUpdate()&&(m=Math.min(g*m,f),f-=m,1E-5>f?(f=0,d.exposure=k):d.exposure+=m*h)};this.updateWithoutDelay=function(){this.update(1)};this.enableAutoExposure=function(){e=!0;f=0};this.disableAutoExposure=function(){e=!1;n()}}})();(function(){function a(b,c){for(var d=0,e=0,f=0;65536>f;++f){var g=4*f;g=b[g]+255*b[g+1];0!==g&&(e+=1,c[g]+=1,d=Math.max(d,g))}if(256>e)return-1;f=b=0;for(g=1;g<=d;++g)if(c[g]+b<.3*e)b+=c[g],c[g]=0;else break;for(g=d;0<=g;--g)if(c[g]+f<.1*e)f+=c[g],c[g]=0;else break;g=0;for(var h=1;h<=d;++h)g+=c[h]*Math.log(h/255),c[h]=0;return Math.exp(g/(e-b-f))}WALK.LumaMeter=function(b,c){function d(r){f||(console.assert(!f),f=b.createRenderTarget(256,256,{minFilter:GLC.NEAREST,magFilter:GLC.NEAREST,format:GLC.RGBA,
stencilBuffer:!1,generateMipmaps:!1}),g=new WALK.AutoClearAlter(b),h=new Uint8Array(262144),k=new Uint32Array(65280),q=new WALK.LumaMaterial(!0),p=new WALK.LumaMaterial(!1));r=r?q:p;g.set(!0,!0,!1);var n=c.gpuMeshes.filter(function(m){return!m.material.transparent});b.renderMeshes(n,r,e,f);b.readPixels(256,256,h);b.setRenderTarget(null);g.restore();return a(h,k)}var e=c.camera,f,g,h,k,q,p;this.measureIncidentLuma=function(){return d(!0)};this.measureReflectedLuma=function(){return d(!1)}}})();(function(){WALK.AccumulatePass=function(){var a={uniforms:{inputBuffer:{type:"t",value:null},weight:{type:"f",value:1}},vertexShader:WALK.getShader("accumulate_vertex.glsl"),fragmentShader:WALK.getShader("accumulate_fragment.glsl")};THREE.ShaderPass.call(this,a,"inputBuffer");this.material.depthTest=!1;this.material.depthWrite=!1;this.material.blending=THREE.CustomBlending;this.material.blendEquation=GLC.FUNC_ADD;this.material.blendDst=GLC.ONE_MINUS_SRC_ALPHA;this.material.blendSrc=GLC.SRC_ALPHA};
WALK.AccumulatePass.prototype=Object.create(THREE.ShaderPass.prototype);WALK.AccumulatePass.prototype.constructor=WALK.AccumulatePass})();(function(){function a(d,e,f,g,h){var k=d/e,q=Math.tan(.5*THREE.Math.degToRad(h.fov));q=h.near*q/h.zoom;var p=-q,r=p*k;k*=q;d=(k-r)/d;e=(q-p)/e;h.projectionMatrix.makeFrustum(r-f*d,k-f*d,p-g*e,q-g*e,h.near,h.far)}function b(d,e,f,g,h){var k=h.top,q=h.bottom,p=h.left,r=h.right;d=(r-p)/d;e=(q-k)/e;h.projectionMatrix.makeOrthographic(p-f*d,r-f*d,k-g*e,q-g*e,h.near,h.far)}function c(){var d={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:WALK.getShader("copy_opaque_vertex.glsl"),fragmentShader:WALK.getShader("copy_opaque_fragment.glsl")};
d=new THREE.ShaderPass(d);d.renderToScreen=!0;return d}WALK.SsaaRenderer=function(d,e,f){void 0===f&&(f=e.camera);var g,h,k=0,q=[[.375,.4375],[.625,.0625],[.875,.1875],[.125,.0625],[.375,.6875],[.875,.4375],[.625,.5625],[.375,.9375],[.625,.3125],[.125,.5625],[.125,.8125],[.375,.1875],[.875,.9375],[.875,.6875],[.125,.3125],[.625,.8125]],p=new WALK.AccumulatePass,r=c(),n=new WALK.AutoClearAlter(d);if(f instanceof THREE.PerspectiveCamera)var m=a;else f instanceof THREE.OrthographicCamera?m=b:(console.error("Unsupported camera type"),
m=void 0);var l=m;this.reset=function(){k=0};this.renderSample=function(u,v){console.assert(k<q.length);n.set(!0,!0,!1);l(h.width,h.height,q[k][0]-.5,q[k][1]-.5,f);u?d.renderMeshes(u,v,f,g,!0):(console.assert(!1===(void 0!==v&&void 0===u),"Passing overrideMaterial without passing meshes is not implemented"),d.render(e.threeScene,f,g,!0));n.restore();n.set(!1,!1,!1);p.uniforms.weight.value=1/(k+1);p.render(d,h,g);n.restore();f.updateProjectionMatrix();k+=1};this.renderedSamplesCount=function(){return k};
this.allSamplesRendered=function(){return k===q.length};this.renderAllSamples=function(u,v){for(;!this.allSamplesRendered();)this.renderSample(u,v)};this.renderAccumulatedSamplesToScreen=function(){n.set(!0,!0,!1);r.render(d,void 0,h);n.restore()};this.copyAccumulatedSamplesToBuffer=function(){var u=h.width,v=h.height,t=new Uint8Array(u*v*4);d.readPixels(u,v,t);return t};this.setTargets=function(u,v){console.assert(u.width===v.width&&u.height===v.height);g=u;h=v};this.dispose=function(){p.material.dispose()}}})();(function(){function a(b){return b.split("\n").map(function(c,d){return d+1+": "+c}).join("\n")}WALK.createWebGLShader=function(b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);var e=!1===b.getShaderParameter(c,b.COMPILE_STATUS);e&&console.error("Shader failed to compile.");if(e||WALK.LOG_INFO)b=b.getShaderInfoLog(c),""!==b&&console.warn("Shader info log: ",b,a(d));return c}})();(function(){WALK.WebGLState=function(a){var b=Array(16).fill(0),c=Array(16).fill(null),d=b.map(function(){return 0}),e=null,f=null,g=null,h=null,k=null,q=null,p=null,r=null,n=null,m=null,l=null,u=null,v=null,t=null,B=null,D=null;this.resetAttributeStates=function(){for(var I=0,J=b.length;I<J;I++)b[I]=0};this.disableAttributeStates=function(){for(var I=0,J=b.length;I<J;I++)a.disableVertexAttribArray(I),b[I]=0};this.enableAttributeArray=function(I){2!==b[I]&&(a.enableVertexAttribArray(I),b[I]=2)};this.disableAttributeArray=
function(I,J){1!==b[I]&&(a.disableVertexAttribArray(I),b[I]=1);c[I]!==J&&(2===J.length?a.vertexAttrib2fv(I,J):3===J.length?a.vertexAttrib3fv(I,J):4===J.length&&a.vertexAttrib4fv(I,J),c[I]=J)};this.resetAttributeDivisors=function(){for(var I=0,J=d.length;I<J;I++)d[I]&&(a.vertexAttribDivisor(I,0),d[I]=0)};this.setAttributeDivisor=function(I,J){a.vertexAttribDivisor(I,J);d[I]=J};this.setBlending=function(I){var J=I.blending;J!==e&&(J===THREE.NoBlending?a.disable(a.BLEND):J===THREE.AdditiveBlending?(a.enable(a.BLEND),
a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):J===THREE.SubtractiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):J===THREE.MultiplyBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):J===THREE.CustomBlending?a.enable(a.BLEND):(a.enable(a.BLEND),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),e=J);if(J===THREE.CustomBlending){J=
I.blendEquation;var Q=I.blendEquationAlpha||J,T=I.blendSrc,M=I.blendDst,z=I.blendSrcAlpha||T;I=I.blendDstAlpha||M;if(J!==f||Q!==k)a.blendEquationSeparate(J,Q),f=J,k=Q;if(T!==g||M!==h||z!==q||I!==p)a.blendFuncSeparate(T,M,z,I),g=T,h=M,q=z,p=I}else p=q=k=h=g=f=null};this.setDepthTest=function(I){r!==I&&(I?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),r=I)};this.setDepthWrite=function(I){n!==I&&(a.depthMask(I),n=I)};this.setColorWrite=function(I){m!==I&&(a.colorMask(I,I,I,I),m=I)};this.setDoubleSided=
function(I){l!==I&&(I?a.disable(a.CULL_FACE):a.enable(a.CULL_FACE),l=I)};this.setFlipSided=function(I){u!==I&&(I?a.frontFace(a.CW):a.frontFace(a.CCW),u=I)};this.setViewport=function(I,J,Q,T){if(v!==I||t!==J||B!==Q||D!==T)a.viewport(I,J,Q,T),v=I,t=J,B=Q,D=T}}})();(function(){function a(d,e){var f=e.index0AttributeName,g=d.createProgram(),h=WALK.createWebGLShader(d,d.VERTEX_SHADER,e.generateVertexShader()),k=WALK.createWebGLShader(d,d.FRAGMENT_SHADER,e.generateFragmentShader());d.attachShader(g,h);d.attachShader(g,k);void 0!==f&&d.bindAttribLocation(g,0,f);d.linkProgram(g);f=d.getProgramInfoLog(g).trim();!1===d.getProgramParameter(g,d.LINK_STATUS)&&console.error("Shader link error: "+d.getError(),"validate status: ",d.getProgramParameter(g,d.VALIDATE_STATUS));
""!==f&&"\x00"!==f&&console.warn("program info log: "+f);d.deleteShader(h);d.deleteShader(k);h={};k=0;for(f=b.length;k<f;k++){var q=b[k];h[q]=d.getUniformLocation(g,q)}this.transformUniformCache=h;h=e.uniforms;k={i:[],f:[],v2:[],v3:[],c:[],v4:[],m4:[],t:[]};var p;for(r in h)h.hasOwnProperty(r)&&(f=d.getUniformLocation(g,r))&&(q=h[r].type,console.assert(k.hasOwnProperty(q)),"i"===q||"f"===q||"t"===q?p=null:"v2"===q?p=[null,null]:"v3"===q||"c"===q?p=[null,null,null]:"v4"===q?p=[null,null,null,null]:
"m4"===q?p=null:console.assert(!1),k[q].push({id:r,value:p,location:f}));this.materialUniformCache=k;e=e.attributes;p={};var r=0;for(h=e.length;r<h;r++)k=e[r],p[k]=d.getAttribLocation(g,k);this.attributes=p;this.attributesKeys=Object.keys(this.attributes);this.id=c++;this.usedTimes=1;this.program=g;return this}var b="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition".split(" "),c=0;WALK.WebGLProgramStore=function(d){var e=new Map;this.assignProgramToMaterial=function(f){console.assert(f instanceof
WALK.BaseMaterial);var g=f.generateProgramId(),h=e[g];h?h.usedTimes++:(h=new a(d,f),e[g]=h);f.program&&this.resetProgramAssignment(f);f.program=h};this.resetProgramAssignment=function(f){var g=f.program;f.program=null;--g.usedTimes;if(0===g.usedTimes){for(var h in e)if(e.hasOwnProperty(h)&&e[h]===g){delete e[h];break}d.deleteProgram(g.program)}}}})();(function(){function a(){this.texture=null;this.locked=!1;this.usedCount=0}function b(c){for(var d=[],e=0;e<c;e+=1)d[e]=new a;return d}WALK.WebGLTextureSlotter=function(c){var d=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),e=b(d);this.setSlot=function(f,g){var h=f.__webglSlot;if(null!==h){var k=e[h];k.usedCount+=1;k.locked=k.locked||g;return!1}for(var q=Infinity,p=0;p<d;p+=1)k=e[p],!k.locked&&k.usedCount<q&&(q=k.usedCount,h=p);null===h&&(console.warn("Not enough texture units"),h=0);k=e[h];k.texture&&
(k.texture.__webglSlot=null);k.texture=f;k.usedCount=1;k.locked=g;f.__webglSlot=h;return!0};this.unlockAllSlots=function(){for(var f=0;f<d;f+=1)e[f].locked=!1};this.freeSlot=function(f){if(null!==f.__webglSlot){var g=e[f.__webglSlot];f.__webglSlot=null;g.texture=null;g.locked=!1;g.usedCount=0}}};WALK.WebGLTextureSlotterSequential=function(c){var d=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),e=0;this.setSlot=function(f,g){e===d&&(console.warn("Not enough texture units"),e=0);f.__webglSlot=e;g&&(e+=1);
return!0};this.unlockAllSlots=function(){e=0};this.freeSlot=function(f){f.__webglSlot=null}}})();(function(){function a(d,e){d.drawArraysInstanced=function(f){for(var g=[],h=0;h<arguments.length;++h)g[h-0]=arguments[h];return e.drawArraysInstancedANGLE.apply(e,$jscomp.arrayFromIterable(g))};d.drawElementsInstanced=function(f){for(var g=[],h=0;h<arguments.length;++h)g[h-0]=arguments[h];return e.drawElementsInstancedANGLE.apply(e,$jscomp.arrayFromIterable(g))};d.vertexAttribDivisor=function(f){for(var g=[],h=0;h<arguments.length;++h)g[h-0]=arguments[h];return e.vertexAttribDivisorANGLE.apply(e,
$jscomp.arrayFromIterable(g))}}function b(d,e){for(var f={HALF_FLOAT_OES:"OES_texture_half_float",COMPRESSED_RGB_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT3_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT5_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGB_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",
COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_ETC1_WEBGL:"WEBGL_compressed_texture_etc1",COMPRESSED_RGBA_ASTC_4x4_KHR:"WEBGL_compressed_texture_astc"},g=$jscomp.makeIterator(Object.entries(GLC)),h=g.next();!h.done;h=g.next()){var k=$jscomp.makeIterator(h.value);h=k.next().value;k=k.next().value;var q=f[h];void 0!==q?(q=e.gl.extension(q))&&console.assert(q[h]===k):console.assert(d[h]===k)}}function c(d){return WALK.DETECTOR.gl.disableTextureSlotReuse?new WALK.WebGLTextureSlotterSequential(d):
new WALK.WebGLTextureSlotter(d)}WALK.WebGLRenderer=function(d,e){function f(aa,S){if(!WALK.DETECTOR.gl.webgl2)return aa;if(S===GLC.FLOAT){if(aa===GLC.RGB)return e.RGB32F;console.assert("Missing mapping")}return aa}function g(){O=!!WALK.DETECTOR.gl.instances;E=y=null;K=-1;G=H=null;!WALK.DETECTOR.gl.webgl2&&O&&a(e,WALK.DETECTOR.gl.instances);Y=new WALK.WebGLState(e);W=new WALK.WebGLProgramStore(e);e.clearColor(0,0,0,1);e.clearDepth(1);e.clearStencil(0);e.enable(e.DEPTH_TEST);e.depthFunc(e.LEQUAL);e.frontFace(e.CCW);
e.cullFace(e.BACK);e.enable(e.CULL_FACE);e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);Y.setViewport(0,0,d.width,d.height);e.clearColor(Q.r,Q.g,Q.b,T);WALK.DETECTOR.ie||e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE)}function h(aa){aa=aa.target;aa.removeEventListener("dispose",h);delete aa.__webglInit;aa=aa.attributes;for(var S in aa)if(aa.hasOwnProperty(S)){var R=aa[S];void 0!==R.buffer&&(e.deleteBuffer(R.buffer),delete R.buffer)}Y.disableAttributeStates();
H=null}function k(aa){aa=aa.target;aa.removeEventListener("dispose",k);ra.freeSlot(aa);aa.__webglTexture&&(e.deleteTexture(aa.__webglTexture),aa.__webglTexture=null)}function q(aa){aa=aa.target;aa.removeEventListener("dispose",q);ra.freeSlot(aa);e.deleteTexture(aa.__webglTexture);aa.__webglTexture=null;aa.__webglFramebuffer&&A.deallocateRenderTargetRenderingBuffers(aa)}function p(aa){aa=aa.target;aa.removeEventListener("dispose",p);W.resetProgramAssignment(aa)}function r(aa,S,R){var Z=R.attributes,
ca=S.attributes;S=S.attributesKeys;R=16*(R.instanceId||0);for(var na=0,Aa=S.length;na<Aa;na++){var Ca=S[na],qa=ca[Ca];if(0<=qa){var fa=Z[Ca];if(void 0!==fa){Ca=fa.itemSize;var va=fa.glType;e.bindBuffer(e.ARRAY_BUFFER,fa.buffer);fa=fa.divisor||0;Y.enableAttributeArray(qa);e.vertexAttribPointer(qa,Ca,va,!1,0,R*fa);O&&Y.setAttributeDivisor(qa,fa)}else Y.disableAttributeArray(qa,aa.defaultAttributeValues[Ca])}}}function n(aa,S){var R=WALK.DETECTOR;e.texParameteri(aa,e.TEXTURE_WRAP_S,S.wrapS);e.texParameteri(aa,
e.TEXTURE_WRAP_T,S.wrapT);e.texParameteri(aa,e.TEXTURE_MAG_FILTER,S.magFilter);e.texParameteri(aa,e.TEXTURE_MIN_FILTER,S.minFilter);var Z=R.gl.extension("EXT_texture_filter_anisotropic");Z&&1<S.anisotropy&&e.texParameterf(aa,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(S.anisotropy,R.gl.maxAnisotropy))}function m(aa,S){var R=aa.material,Z=S.material,ca=R.program,na=Z.program;return ca&&na&&ca.id!==na.id?ca.id-na.id:R.id-Z.id||aa.id-S.id}function l(aa,S){var R=aa.material.transparentRenderOrder-S.material.transparentRenderOrder;
return R?R:S.cameraDistance-aa.cameraDistance||aa.id-S.id}function u(aa,S,R){if(R||!1!==aa.visible){aa instanceof THREE.Mesh&&(!1===aa.frustumCulled||!0===ka.intersectsObject(aa))&&((S||aa.material).transparent?(!0===A.sortObjects&&(aa.cameraDistance=ka.nearPlaneDistanceToCenter(aa)),z.push(aa)):M.push(aa));for(var Z=0,ca=aa.children.length;Z<ca;Z++)u(aa.children[Z],S,R)}}function v(aa){Y.setDoubleSided(aa.side===THREE.DoubleSide);Y.setFlipSided(aa.side===THREE.BackSide)}function t(aa){aa.__webglTexture||
(aa.addEventListener("dispose",k),aa.__webglTexture=e.createTexture());e.activeTexture(e.TEXTURE0+aa.__webglSlot);e.bindTexture(e.TEXTURE_2D,aa.__webglTexture);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,aa.flipY);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,aa.premultiplyAlpha);e.pixelStorei(e.UNPACK_ALIGNMENT,aa.unpackAlignment);var S=aa.image,R=THREE.Math.isPowerOfTwo(S.width)&&THREE.Math.isPowerOfTwo(S.height),Z=aa.format,ca=aa.type,na=f(Z,ca);n(e.TEXTURE_2D,aa);var Aa=aa.mipmaps;if(aa instanceof WALK.DataTexture)if(0<
Aa.length&&R){for(var Ca=0,qa=Aa.length;Ca<qa;Ca++)S=Aa[Ca],e.texImage2D(e.TEXTURE_2D,Ca,na,S.width,S.height,0,Z,ca,S.data),aa.releaseOnLoadedToGpu&&(S.data=null);aa.generateMipmaps=!1}else e.texImage2D(e.TEXTURE_2D,0,na,S.width,S.height,0,Z,ca,S.data),aa.releaseOnLoadedToGpu&&(S.data=null);else if(aa instanceof WALK.CompressedTexture)for(Ca=0,qa=Aa.length;Ca<qa;Ca++)S=Aa[Ca],aa.format!==GLC.RGBA&&aa.format!==GLC.RGB?e.compressedTexImage2D(e.TEXTURE_2D,Ca,na,S.width,S.height,0,S.data):e.texImage2D(e.TEXTURE_2D,
Ca,na,S.width,S.height,0,Z,ca,S.data),aa.releaseOnLoadedToGpu&&(S.data=null);else if(0<Aa.length&&R){Ca=0;for(qa=Aa.length;Ca<qa;Ca++)S=Aa[Ca],e.texImage2D(e.TEXTURE_2D,Ca,na,Z,ca,S);aa.releaseOnLoadedToGpu&&(aa.mipmaps=null);aa.generateMipmaps=!1}else e.texImage2D(e.TEXTURE_2D,0,na,Z,ca,aa.image),aa.releaseOnLoadedToGpu&&(aa.image=null);aa.generateMipmaps&&R&&e.generateMipmap(e.TEXTURE_2D);aa.needsUpdate=!1}function B(aa){Y.setBlending(aa);Y.setDepthTest(aa.depthTest);Y.setDepthWrite(aa.depthWrite);
Y.setColorWrite(aa.colorWrite)}function D(aa,S,R){if(R){var Z=R;B(Z);v(Z)}for(var ca=0,na=aa.length;ca<na;ca+=1){var Aa=aa[ca],Ca=Aa.geometry,qa=Aa.material;try{R?R.doNotOverrideSide&&qa&&v(qa):(Z=qa,B(Z),v(Z));var fa=qa=void 0,va=void 0,sa=void 0,Fa=void 0,Ta=Z;if(!1!==Ta.visible&&0!==Ca.vertexCnt){var U=S,pa=Ta;pa.programNeedsUpdate&&(W.assignProgramToMaterial(pa),pa.addEventListener("dispose",p),pa.programNeedsUpdate=!1);console.assert(!pa.morphTargets);var Da=!1,wa=!1,Ha=pa.program,Ia=Ha.transformUniformCache,
Xa=pa.uniforms;Ha.id!==y&&(e.useProgram(Ha.program),y=Ha.id,wa=Da=!0);pa.id!==K&&(K=pa.id,wa=!0);if(Da||U!==G)e.uniformMatrix4fv(Ia.projectionMatrix,!1,U.projectionMatrix.elements),U!==G&&(G=U),console.assert(pa instanceof WALK.BaseMaterial),null!==Ia.cameraPosition&&(oa.setFromMatrixPosition(U.matrixWorld),e.uniform3f(Ia.cameraPosition,oa.x,oa.y,oa.z)),null!==Ia.viewMatrix&&e.uniformMatrix4fv(Ia.viewMatrix,!1,U.matrixWorldInverse.elements);pa.refreshPerObjectUniforms&&pa.refreshPerObjectUniforms(Aa,
Xa)&&(wa=!0);if(wa){var Ka=wa=Da=pa=void 0,gb=void 0,bb=void 0,eb=void 0,ib=void 0,V=void 0,ia=void 0,za=void 0,ua=void 0,Ea=void 0,Na=Ha,ea=Xa;Ea=Na.materialUniformCache.i;Ka=0;for(wa=Ea.length;Ka<wa;Ka+=1)ua=Ea[Ka],za=ua.id,ia=ea[za].value,ua.value!==ia&&(e.uniform1i(ua.location,ia),ua.value=ia);Ea=Na.materialUniformCache.f;Ka=0;for(wa=Ea.length;Ka<wa;Ka+=1)ua=Ea[Ka],za=ua.id,ia=ea[za].value,ua.value!==ia&&(e.uniform1f(ua.location,ia),ua.value=ia);Ea=Na.materialUniformCache.v2;Ka=0;for(wa=Ea.length;Ka<
wa;Ka+=1)if(ua=Ea[Ka],za=ua.id,ia=ea[za].value,V=ia.x,ib=ia.y,ua.value[0]!==V||ua.value[1]!==ib)e.uniform2f(ua.location,V,ib),ua.value[0]=V,ua.value[1]=ib;Ea=Na.materialUniformCache.v3;Ka=0;for(wa=Ea.length;Ka<wa;Ka+=1)if(ua=Ea[Ka],za=ua.id,ia=ea[za].value,V=ia.x,ib=ia.y,eb=ia.z,ua.value[0]!==V||ua.value[1]!==ib||ua.value[2]!==eb)e.uniform3f(ua.location,V,ib,eb),ua.value[0]=V,ua.value[1]=ib,ua.value[2]=eb;Ea=Na.materialUniformCache.c;Ka=0;for(wa=Ea.length;Ka<wa;Ka+=1)if(ua=Ea[Ka],za=ua.id,ia=ea[za].value,
V=ia.r,ib=ia.g,eb=ia.b,ua.value[0]!==V||ua.value[1]!==ib||ua.value[2]!==eb)e.uniform3f(ua.location,V,ib,eb),ua.value[0]=V,ua.value[1]=ib,ua.value[2]=eb;Ea=Na.materialUniformCache.v4;Ka=0;for(wa=Ea.length;Ka<wa;Ka+=1)if(ua=Ea[Ka],za=ua.id,ia=ea[za].value,V=ia.x,ib=ia.y,eb=ia.z,bb=ia.w,ua.value[0]!==V||ua.value[1]!==ib||ua.value[2]!==eb||ua.value[3]!==bb)e.uniform4f(ua.location,V,ib,eb,bb),ua.value[0]=V,ua.value[1]=ib,ua.value[2]=eb,ua.value[3]=bb;Ea=Na.materialUniformCache.m4;Ka=0;for(wa=Ea.length;Ka<
wa;Ka+=1)ua=Ea[Ka],za=ua.id,e.uniformMatrix4fv(location,!1,ea[za].value.elements);Ea=Na.materialUniformCache.t;Ka=0;for(wa=Ea.length;Ka<wa;Ka+=1)if(ua=Ea[Ka],za=ua.id,gb=ea[za].value,Da=ra.setSlot(gb,!0),pa=gb.__webglSlot,ua.value!==pa&&(e.uniform1i(ua.location,pa),ua.value=pa),Da||gb.needsUpdate)if(gb.isCube){if(bb=gb,e.activeTexture(e.TEXTURE0+bb.__webglSlot),e.bindTexture(e.TEXTURE_CUBE_MAP,bb.__webglTexture),bb.needsUpdate){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,bb.flipY);var ba=bb instanceof WALK.CompressedTexture,
Qa=bb.image,Oa=bb.format,Sa=bb.type,db=f(Oa,Sa);n(e.TEXTURE_CUBE_MAP,bb);for(eb=0;6>eb;eb++)if(ba){var fb=Qa[eb].mipmaps;ib=0;for(var Ra=fb.length;ib<Ra;ib++){var Cb=fb[ib];bb.format!==GLC.RGBA&&bb.format!==GLC.RGB?e.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+eb,ib,db,Cb.width,Cb.height,0,Cb.data):e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+eb,ib,db,Cb.width,Cb.height,0,Oa,Sa,Cb.data);bb.releaseOnLoadedToGpu&&(Cb.data=null)}}else e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+eb,0,db,Oa,Sa,Qa[eb]),
bb.releaseOnLoadedToGpu&&(Qa[eb]=null);bb.generateMipmaps&&e.generateMipmap(e.TEXTURE_CUBE_MAP);bb.needsUpdate=!1}}else bb=gb,bb.needsUpdate?t(bb):(e.activeTexture(e.TEXTURE0+bb.__webglSlot),e.bindTexture(e.TEXTURE_2D,bb.__webglTexture));ra.unlockAllSlots()}pa=void 0;Da=Ia;Aa.matrixWorld?(ma.multiplyMatrices(U.matrixWorldInverse,Aa.matrixWorld),pa=ma):pa=U.matrixWorldInverse;e.uniformMatrix4fv(Da.modelViewMatrix,!1,pa.elements);Da.normalMatrix&&(Ga.getNormalMatrix(pa),e.uniformMatrix3fv(Da.normalMatrix,
!1,Ga.elements));null!==Ia.modelMatrix&&(Aa.matrixWorld?e.uniformMatrix4fv(Ia.modelMatrix,!1,Aa.matrixWorld.elements):e.uniformMatrix4fv(Ia.modelMatrix,!1,Ba));var Fb=Ha;U=!1;if(Ca.id!==H||Fb.id!==y)H=Ca.id,U=!0;console.assert(Aa instanceof THREE.Mesh);var Vb=e.TRIANGLES,Ob=Ca.attributes.index;if(Ob){var mc=Ob.glType;Fa=Ca.indexUint?4:2;U&&(r(Ta,Fb,Ca),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,Ob.buffer));void 0!==Ca.indexOffset?(sa=Ca.indexCnt,va=Fa*Ca.indexOffset):(sa=Ob.length,va=0);Ca.isInstanced?e.drawElementsInstanced(Vb,
sa,mc,va,Ca.instanceCount):e.drawElements(Vb,sa,mc,va)}else{U&&r(Ta,Fb,Ca);var sb=Ca.attributes.position;void 0!==Ca.vertexOffset?(fa=Ca.vertexCnt,qa=Ca.vertexOffset):(fa=sb.length/sb.itemSize,qa=0);Ca.isInstanced?e.drawArraysInstanced(Vb,qa,fa,Ca.instanceCount):e.drawArrays(Vb,qa,fa)}O&&Y.resetAttributeDivisors()}}catch(nc){console.error("Failed to render material "+(Z?Z.name:"null")+": "+nc.stack)}}}function I(aa,S){e.bindRenderbuffer(e.RENDERBUFFER,aa);S.depthBuffer?(e.renderbufferStorage(e.RENDERBUFFER,
e.DEPTH_STENCIL,S.width,S.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,aa)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,S.width,S.height)}function J(aa,S){S.addEventListener("dispose",q);S.__webglTexture=e.createTexture();var R=S.format,Z=S.type,ca=f(R,Z);ra.setSlot(S,!1);e.activeTexture(e.TEXTURE0+S.__webglSlot);if(aa){e.bindTexture(e.TEXTURE_CUBE_MAP,S.__webglTexture);n(e.TEXTURE_CUBE_MAP,S);for(aa=0;6>aa;aa++){S.__webglFramebuffer[aa]=e.createFramebuffer();
S.__webglRenderbuffer[aa]=e.createRenderbuffer();e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+aa,0,ca,S.width,S.height,0,R,Z,null);var na=e.TEXTURE_CUBE_MAP_POSITIVE_X+aa,Aa=S.__webglTexture;e.bindFramebuffer(e.FRAMEBUFFER,S.__webglFramebuffer[aa]);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,na,Aa,0);I(S.__webglRenderbuffer[aa],S)}S.generateMipmaps&&e.generateMipmap(e.TEXTURE_CUBE_MAP)}else S.__webglFramebuffer=e.createFramebuffer(),S.__webglRenderbuffer=S.shareDepthFrom?S.shareDepthFrom.__webglRenderbuffer:
e.createRenderbuffer(),e.bindTexture(e.TEXTURE_2D,S.__webglTexture),n(e.TEXTURE_2D,S),e.texImage2D(e.TEXTURE_2D,0,ca,S.width,S.height,0,R,Z,null),R=e.TEXTURE_2D,Z=S.__webglTexture,e.bindFramebuffer(e.FRAMEBUFFER,S.__webglFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,R,Z,0),S.shareDepthFrom?S.depthBuffer&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,S.__webglRenderbuffer):I(S.__webglRenderbuffer,S),S.generateMipmaps&&e.generateMipmap(e.TEXTURE_2D);
e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null)}var Q=new THREE.Color(0),T=0,M=[],z=[];this.domElement=d;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;var A=this,y,E,K,H,G,O,Y,W,ka=new WALK.Frustum,la=new THREE.Matrix4,oa=new THREE.Vector3;g();b(e,WALK.DETECTOR);this.webGLContextRestored=function(){g()};this.context=e;this.state=Y;var ra=c(e),Ba=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setCanvasSize=function(aa,
S){d.width=aa;d.height=S;null===E&&this.setViewport(0,0,aa,S)};this.setViewport=function(aa,S,R,Z){Y.setViewport(aa,S,R,Z)};this.setScissor=function(aa,S,R,Z){e.scissor(aa,S,R,Z)};this.enableScissorTest=function(aa){aa?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST)};this.setClearColor=function(aa,S){Q.copy(aa);T=void 0!==S?S:1;e.clearColor(Q.r,Q.g,Q.b,T)};this.getClearColor=function(){return Q};this.getClearAlpha=function(){return T};this.clear=function(aa,S,R){var Z=0;aa&&(Z|=e.COLOR_BUFFER_BIT);
S&&(Z|=e.DEPTH_BUFFER_BIT);R&&(Z|=e.STENCIL_BUFFER_BIT);e.clear(Z)};this.clearColor=function(){e.clear(e.COLOR_BUFFER_BIT)};this.clearDepth=function(){e.clear(e.DEPTH_BUFFER_BIT)};this.clearStencil=function(){e.clear(e.STENCIL_BUFFER_BIT)};this.deallocateRenderTargetRenderingBuffers=function(aa){if(aa.isCube)for(var S=0;6>S;S++)e.deleteFramebuffer(aa.__webglFramebuffer[S]),e.deleteRenderbuffer(aa.__webglRenderbuffer[S]);else e.deleteFramebuffer(aa.__webglFramebuffer),e.deleteRenderbuffer(aa.__webglRenderbuffer);
aa.__webglFramebuffer=null;aa.__webglRenderbuffer=null};var ma=new THREE.Matrix4,Ga=new THREE.Matrix3;this.setRenderTarget=function(aa){if(aa){var S=aa.isCube?aa.__webglFramebuffer[aa.activeCubeFace]:aa.__webglFramebuffer;var R=aa.x;var Z=aa.y;var ca=aa.width;aa=aa.height}else S=null,Z=R=0,ca=d.width,aa=d.height;S!==E&&(e.bindFramebuffer(e.FRAMEBUFFER,S),E=S);Y.setViewport(R,Z,ca,aa)};this.render=function(aa,S,R,Z){this.renderMeshes(aa.children,aa.overrideMaterial,S,R,Z)};this.renderMeshes=function(aa,
S,R,Z,ca,na){H=null;K=-1;G=null;R.matrixWorldInverse.getInverse(R.matrixWorld);la.multiplyMatrices(R.projectionMatrix,R.matrixWorldInverse);ka.setFromMatrix(la);M.length=0;z.length=0;na=void 0===na?!1:na;for(var Aa=0;Aa<aa.length;Aa+=1)u(aa[Aa],S,na);!0===A.sortObjects&&(M.sort(m),z.sort(l));this.setRenderTarget(Z);(this.autoClear||ca)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);D(M,R,S);D(z,R,S);Z&&Z.generateMipmaps&&(aa=ra.setSlot(Z,!1),e.activeTexture(e.TEXTURE0+
Z.__webglSlot),Z.isCube?(aa&&e.bindTexture(e.TEXTURE_CUBE_MAP,Z.__webglTexture),e.generateMipmap(e.TEXTURE_CUBE_MAP)):(aa&&e.bindTexture(e.TEXTURE_2D,Z.__webglTexture),e.generateMipmap(e.TEXTURE_2D)));Y.setDepthTest(!0);Y.setDepthWrite(!0);Y.setColorWrite(!0);Y.resetAttributeStates()};this.uploadNewBuffers=function(aa){var S=aa.geometry;aa=S.attributes;var R=S.attributesKeys;void 0===S.__webglInit&&(S.__webglInit=!0,S.addEventListener("dispose",h));console.assert(S instanceof THREE.BufferGeometry);
S=0;for(var Z=R.length;S<Z;S+=1){var ca=R[S],na=aa[ca];ca="index"===ca?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(na.buffer)!0===na.needsUpdate&&console.assert(!1);else{na.buffer=e.createBuffer();e.bindBuffer(ca,na.buffer);var Aa=na.array;WALK.DETECTOR.ios&&ca===e.ARRAY_BUFFER&&console.assert(0===na.itemSize*Aa.BYTES_PER_ELEMENT%4);e.bufferData(ca,Aa,e.STATIC_DRAW);Aa instanceof Float32Array?na.glType=e.FLOAT:Aa instanceof Int8Array?na.glType=e.BYTE:Aa instanceof Int16Array?na.glType=e.SHORT:Aa instanceof
Uint16Array?na.glType=e.UNSIGNED_SHORT:Aa instanceof Uint32Array?na.glType=e.UNSIGNED_INT:console.assert(!1);na.releaseOnLoadedToGpu&&(na.array=null);na.needsUpdate=!1}}};this.uploadTexture=function(aa){ra.setSlot(aa,!1);t(aa)};this.copyBufferToCubeFaceMip=function(aa,S,R,Z,ca){ra.setSlot(ca,!1);e.activeTexture(e.TEXTURE0+ca.__webglSlot);e.bindTexture(e.TEXTURE_CUBE_MAP,ca.__webglTexture);e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,aa,e.RGBA,S,S,0,e.RGBA,e.UNSIGNED_BYTE,Z)};this.createCubeTexture=
function(aa,S){var R=new WALK.Texture;R.isCube=!0;R.minFilter=S?GLC.LINEAR_MIPMAP_NEAREST:GLC.LINEAR;R.generateMipmaps=!1;R.needsUpdate=!1;R.addEventListener("dispose",k);R.__webglTexture=e.createTexture();ra.setSlot(R,!1);e.activeTexture(e.TEXTURE0+R.__webglSlot);e.bindTexture(e.TEXTURE_CUBE_MAP,R.__webglTexture);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,
e.TEXTURE_MAG_FILTER,e.LINEAR);S?e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var Z=0;6>Z;Z+=1)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,e.RGBA,aa,aa,0,e.RGBA,e.UNSIGNED_BYTE,null);S&&e.generateMipmap(e.TEXTURE_CUBE_MAP);return R};this.createFrameBufferRenderTarget=function(aa){return new WALK.WebGLRenderTargetVR(aa)};this.createRenderTarget=function(aa,S,R){aa=new WALK.WebGLRenderTarget(aa,
S,R);J(!1,aa);return aa};this.createRenderTargetCube=function(aa,S,R){aa=new WALK.WebGLRenderTargetCube(aa,S,R);J(!0,aa);return aa};this.readPixels=function(aa,S,R){e.readPixels(0,0,aa,S,e.RGBA,e.UNSIGNED_BYTE,R)}}})();(function(){var a={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!1};WALK.createRenderer=function(b,c){void 0===c.alpha&&(c.alpha=!0);void 0===c.depth&&(c.depth=!0);void 0===c.stencil&&(c.stencil=!1);void 0===c.premultipliedAlpha&&(c.premultipliedAlpha=!0);void 0===c.antialias&&(c.antialias=!0);void 0===c.preserveDrawingBuffer&&(c.preserveDrawingBuffer=!1);try{var d=(WALK.FORCE_WEBGL1?null:b.getContext("webgl2",c))||b.getContext("webgl",c)||b.getContext("experimental-webgl",
c)}catch(e){d=null}c=d;if(!c)return null;WALK.DETECTOR.resetGlDetector(c);WALK.DETECTOR.gl.reportToConsole();return new WALK.WebGLRenderer(b,c)};WALK.createWebwalkRenderer=function(b){if(b=WALK.createRenderer(b,{antialias:!WALK.FORCE_FXAA}))b.autoClear=!0,b.autoClearColor=!1,b.autoClearDepth=!0,b.autoClearStencil=!1,b.sortObjects=!0;return b};WALK.Renderer=function(b,c,d,e){var f=null,g,h,k=d.camera,q=d.threeScene,p=function(){var r=new WALK.Frustum,n=new THREE.Matrix4;return function(m){if(0!==d.mirrors.length){m.matrixWorldInverse.getInverse(m.matrixWorld);
n.multiplyMatrices(m.projectionMatrix,m.matrixWorldInverse);r.setFromMatrix(n);for(var l=0;l<d.mirrors.length;l+=1){var u=d.mirrors[l];u.updateCameraPosition(m,r);u.inFrustum()&&u.render(b)}}}}();this.resize=function(r){if(!r){var n=window.innerWidth;var m=window.innerHeight;var l=n*window.devicePixelRatio;var u=m*window.devicePixelRatio;k.aspect=l/u;k.updateProjectionMatrix();b.setCanvasSize(l,u);b.domElement.style.width=n+"px";b.domElement.style.height=m+"px";g&&(g.configureTarget(l,u,a),h.setTargets(g.renderTarget1,
g.renderTarget2));f&&f.uniforms.resolution.value.set(1/l,1/u)}n=u;r?(r=l/2,l=70):(r=l,l=k.fov);m=r/n;for(u=0;u<d.mirrors.length;u+=1)d.mirrors[u].configure(r,n,m,l)};this.renderIdle=function(r,n){0===n&&(e.adaptExposure(),h&&h.reset());if(e.exposureNeedsUpdate())return this.renderToScreen(r,!1),!0;if(!h)return!1;h.renderSample();4<=h.renderedSamplesCount()&&h.renderAccumulatedSamplesToScreen();return!h.allSamplesRendered()};this.renderToScreen=function(r,n){e.update(r);n?c.render(q,k.matrixWorld,
p):(p(k),f?g.render(r):b.render(q,k))};this.enableAutoExposure=function(){e.enableAutoExposure()};this.disableAutoExposure=function(){e.disableAutoExposure()};(function(){if(WALK.DETECTOR.gl.antialiasPostprocess){g=new THREE.EffectComposer(b);if(!WALK.DETECTOR.gl.antialiasNative){WALK.log("using FXAA");b.autoClear=!1;f=new THREE.ShaderPass(THREE.FXAAShader);f.clear=!1;f.renderToScreen=!0;f.material.depthTest=!1;f.material.depthWrite=!1;f.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight);
var r=new THREE.RenderPass(q,k);g.addPass(r);g.addPass(f)}h=new WALK.SsaaRenderer(b,d)}})()}})();(function(){function a(c,d,e){var f=[],g=[],h=[{totalFovFraction:.25,count:2},{totalFovFraction:.25,count:16},{totalFovFraction:.375,count:48},{totalFovFraction:.125,count:8}];(function(){for(var k=0,q=0,p=0,r=0;r<h.length;r++){var n=h[r],m=n.totalFovFraction*c/n.count;console.assert(m===Math.floor(m),"Height ("+m+")must be an integer");var l=n.totalFovFraction*Math.PI/2/n.count,u=b(e,4*d,4*m,GLC.LINEAR,!0);g.push(u);for(var v=0;v<n.count;v++)f.push({fov:l,fovOffset:k+(v+.5)*l,height:m,yOffset:q+
v*m,renderTarget:u});k+=n.count*l;q+=n.count*m;p+=n.totalFovFraction}console.assert(1===p,"Invalid fractions sum");console.assert(k===Math.PI/2,"Invalid fov definition for rectangles");console.assert(q===c,"Invalid rectangles height")})();this.getRectangleHeight=function(k){return f[k].height};this.getRectangleOffset=function(k){return f[k].yOffset};this.getRectangleFov=function(k){return f[k].fov};this.getRectangleFovOffset=function(k){return f[k].fovOffset};this.getRectangleRenderTarget=function(k){return f[k].renderTarget};
this.dispose=function(){g.forEach(function(k){k.dispose()});f.length=0;g.length=0};this.getRectangleCount=function(){return f.length}}var b=function(c,d,e,f,g){return c.createRenderTarget(d,e,{format:GLC.RGBA,magFilter:f,minFilter:f,depthBuffer:g,stencilBuffer:!1,generateMipmaps:!1})};WALK.ScreenshotTaker=function(c,d,e){function f(){var l=(document.body.offsetWidth-document.body.offsetHeight*q)/2,u=l+"px";l=Math.max(l,0)+"px";p.style.width=l;r.style.width=l;n.style.left=u;n.style.right=u}function g(l,
u,v,t,B,D){var I=d.camera.near,J=d.camera.far;console.assert(0===v%512,"Invalid width for stereo panorama");var Q=v/2,T=new THREE.Vector3(0,-1,0),M=Q/2,z=2*Math.PI/512,A=v/512,y=-A,E=Symbol("Bottom"),K=Symbol("Top"),H=Math.floor(u/z)*z,G=I*Math.tan(z/2),O=new THREE.PerspectiveCamera;O.up.set(0,0,1);var Y=new a(M,A,c),W=Y.getRectangleCount(),ka=new THREE.Vector3,la=new THREE.Vector3,oa=new THREE.Vector3,ra=new THREE.Matrix4,Ba=function(Aa,Ca,qa,fa){Ca=-(Ca*z-H);Aa=Aa===K?-Y.getRectangleFovOffset(qa):
Y.getRectangleFovOffset(qa);ka.set(fa,0,0).applyMatrix4(ra.makeRotationZ(Ca));O.position.copy(l).add(ka);la.copy(T).applyMatrix4(ra.makeRotationX(Aa)).applyMatrix4(ra.makeRotationZ(Ca));oa.copy(O.position).add(la);O.lookAt(oa);qa=I*Math.tan(Y.getRectangleFov(qa)/2);fa=G*Math.cos(Aa);O.projectionMatrix.makeFrustum(-fa,fa,-qa,qa,I,J);O.updateMatrix();O.updateMatrixWorld()},ma=b(c,v,2*Q,GLC.NEAREST,!1);ma.width=A;var Ga=new WALK.AccumulatePass,aa=function(Aa){ma.dispose();Y.dispose();Ga.dispose();B(Aa)},
S=[{hemisphere:K,eyeOffset:.03,parallaxOffset:y,targetYOffset:Q},{hemisphere:E,eyeOffset:.03,parallaxOffset:y,targetYOffset:Q},{hemisphere:K,eyeOffset:-.03,parallaxOffset:A,targetYOffset:0},{hemisphere:E,eyeOffset:-.03,parallaxOffset:A,targetYOffset:0}],R=function(Aa,Ca){Ca++;if(512===Ca){Aa++;if(Aa===S.length)return[-1,-1];Ca=0}return[Aa,Ca]},Z=512*S.length,ca=Math.ceil(Z/100),na=function(Aa,Ca){for(var qa=S[Aa].hemisphere,fa=S[Aa].eyeOffset,va=S[Aa].parallaxOffset,sa=S[Aa].targetYOffset,Fa=0;Fa<
W;Fa++){Ba(qa,Ca,Fa,fa);var Ta=Y.getRectangleRenderTarget(Fa);c.render(d.threeScene,O,Ta);var U=Y.getRectangleHeight(Fa),pa=Y.getRectangleOffset(Fa);ma.y=qa===K?sa+M+pa:sa+M-pa-U;ma.x=(Ca*A+va+v)%v;ma.height=U;Ga.render(c,ma,Ta)}D()?aa(null):(qa=$jscomp.makeIterator(R(Aa,Ca)),Aa=qa.next().value,Ca=qa.next().value,-1===Aa?(qa=new Uint8Array(2*v*Q*4),c.readPixels(v,2*Q,qa),aa(qa)):(0===Ca%ca&&t({done:512*Aa+Ca,total:Z}),setTimeout(function(){return na(Aa,Ca)},0)))};na(0,0)}function h(l,u,v,t){var B=
new WALK.CubeCamera(d.camera.near,d.camera.far);B.rotateZ(u);B.position.copy(l);B.updateMatrixWorld();l=c.createRenderTargetCube(4096,4096,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(u=0;6>u;u+=1)l.activeCubeFace=u,c.render(d.threeScene,B.sideCameras[u],l);B=b(c,v,t,GLC.NEAREST,!0);u={uniforms:{panoramaCube:{type:"t",value:null}},vertexShader:WALK.getShader("cube_to_equirect_vertex.glsl"),fragmentShader:WALK.getShader("cube_to_equirect_fragment.glsl")};
u=new THREE.ShaderPass(u,"panoramaCube");u.render(c,B,l);u.dispose();l.dispose();l=new Uint8Array(v*t*4);c.readPixels(v,t,l);B.dispose();return l}function k(l,u){var v=b(c,l,u,GLC.NEAREST,!0);l=b(c,l,u,GLC.NEAREST,!1);u=new WALK.SsaaRenderer(c,d);u.setTargets(v,l);u.renderAllSamples();var t=u.copyAccumulatedSamplesToBuffer();v.dispose();l.dispose();u.dispose();return t}var q=null,p=null,r=null,n=null,m=new THREE.Vector3;this.markArea=function(l){function u(t,B){t.style.zIndex=1;t.style.pointerEvents=
"none";t.style.position="absolute";t.style.top=0;t.style.bottom=0;t.style[B]=0;t.style.backgroundColor="rgba(0, 0, 0, 0.5)"}function v(t){t.style.zIndex=1;t.style.pointerEvents="none";t.style.position="absolute";t.style.boxSizing="border-box";t.style.top=0;t.style.bottom=0;t.style.border="4px solid rgba(35, 181, 233, 0.5)"}n||(p=document.createElement("div"),u(p,"left"),r=document.createElement("div"),u(r,"right"),n=document.createElement("div"),v(n),document.body.appendChild(p),document.body.appendChild(r),
document.body.appendChild(n),window.addEventListener("resize",f));q=l;f()};this.unmarkArea=function(){n&&(p.remove(),r.remove(),n.remove(),window.removeEventListener("resize",f),n=r=p=q=null)};this.monoScreenToBuffer=function(l,u,v){return l?h(e.cameraWorldPosition(),e.getYawAngle(),u,v):k(u,v)};this.stereoPanoramaToBuffer=function(l,u,v,t){g(e.cameraWorldPosition(),e.getYawAngle(),l,u,v,t)};this.monoScreenToDataUrl=function(l,u,v){l=this.monoScreenToBuffer(l,u,v);for(var t=0;t<v;++t)for(var B=0;B<
u;++B){var D=4*(t*u+B);if(t<v/2)for(var I=4*((v-t-1)*u+B),J=0;3>J;++J){var Q=l[D+J];l[D+J]=l[I+J];l[I+J]=Q}l[D+3]=255}l=new Uint8ClampedArray(l);l=new ImageData(l,u,v);t=document.createElement("canvas");t.width=u;t.height=v;t.getContext("2d").putImageData(l,0,0);return t.toDataURL("image/jpeg")};this.monoScreenToLocalImage=function(l,u,v){l=this.monoScreenToDataUrl(l,u,v);navigator.msSaveOrOpenBlob?fetch(l).then(function(t){return t.blob()}).then(function(t){return navigator.msSaveOrOpenBlob(t,"screen.jpg")}):
(u=document.createElement("a"),document.body.appendChild(u),u.style.cssText="display: none",u.href=l,u.download="screenshot",u.click(),window.URL.revokeObjectURL(l),u.parentNode.removeChild(u))};this.coverToServer=function(l,u){var v=k(l,u);WALK.ajaxPost("screenshot?width="+l+"&height="+u,"application/binary",v)};this.monoPanoramaToServer=function(l,u){l.position?m.fromArray(l.position):m.copy(e.cameraWorldPosition());var v=void 0!==l.width?l.width:8E3,t=void 0!==l.height?l.height:4E3,B=$jscomp,D=
B.makeIterator;var I=Math.min(WALK.MAX_PANORAMA_SIZE,WALK.DETECTOR.gl.maxRenderBufferSize);if(v<=I&&t<=I)v=[v,t];else{var J=v/t;v=v>t?[I,Math.floor(I/J)]:[Math.floor(I*J),I]}t=D.call(B,v);v=t.next().value;t=t.next().value;B=void 0!==l.rotation?THREE.Math.degToRad(l.rotation):0;B=h(m,B,v,t);WALK.ajaxPost("panorama?width="+v+"&height="+t+"&name="+l.name,"application/binary",B,u,u)}}})();(function(){function a(h){var k=new WALK.OutlineMaterial(new THREE.Color(0,0,0),1),q=new WALK.StandardMaterial;h.hasLightMap()?q.lightMapped=!0:q.specularOff=!0;q.setUniforms();return{outlineMaterial:k,planMaterial:q}}function b(h,k,q){for(var p=0;p<q;++p)for(var r=0;r<k;++r){var n=4*(p*k+r);if(p<q/2)for(var m=4*((q-p-1)*k+r),l=0;4>l;++l){var u=h[n+l];h[n+l]=h[m+l];h[m+l]=u}}}function c(h,k){console.assert(0===k%4,"id passed does not point to alpha channel");return 0!==h[k+3]}function d(h,k){console.assert(0===
k%4,"id passed does not point to alpha channel");return 255>h[k+3]}function e(h,k,q){return 255>h[q+3]&&h[q+3]>=h[k+3]}function f(h,k,q){return h.createRenderTarget(k,q,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1})}function g(h,k){var q={uniforms:{tColor:{type:"t",value:null},tAlpha:{type:"t",value:null},colorFill:{type:"c",value:null}},vertexShader:WALK.getShader("minimap_add_alpha_vertex.glsl"),fragmentShader:WALK.getShader("minimap_add_alpha_fragment.glsl")};
q=new THREE.ShaderPass(q,"tColor");q.uniforms.tAlpha.value=h;k&&(q.material.condDefine(!0,"USE_ALPHA_FROM_COLOR"),q.uniforms.colorFill.value=k);return q}WALK.MinimapRenderer=function(h,k){function q(m,l,u,v,t,B){var D=new Uint8Array(l.width*l.height*4),I=new WALK.AutoClearAlter(h);I.set(!0,!0,!1);v=v?k.gpuMeshes.filter(function(Q){return!Q.material.transparent}):k.gpuMeshes;if(t){t=f(h,l.width,l.height);var J=f(h,l.width,l.height);m=new WALK.SsaaRenderer(h,k,m);m.setTargets(t,J);m.renderAllSamples(v,
u);u=g(t,B);I.restore();I.set(!0,!0,!1);u.render(h,l,J);I.restore();h.readPixels(l.width,l.height,D);t.dispose();J.dispose();m.dispose()}else h.renderMeshes(v,u,m,l),I.restore(),h.readPixels(l.width,l.height,D);b(D,l.width,l.height);return D}function p(m,l,u,v){var t=k.boundingBox;u=Math.max(u,v);t=Math.max(t.size().x,t.size().y);n.outlineMaterial.setUniform("thickness","f",m/(u/t*.1));n.outlineMaterial.setUniform("color","c",l)}var r=new THREE.Color(1,1,1),n=a(k);this.createMinimapImageDataComponents=
function(m,l,u,v){p(m.outlineThickness,r,u,v);var t=l.cropRange.center(),B=f(h,u,v),D=new THREE.OrthographicCamera(l.visibleRange.min.x-t.x,l.visibleRange.max.x-t.x,l.visibleRange.min.y-t.y,l.visibleRange.max.y-t.y,0,10);D.rotation.set(0,0,-1*l.rotation);D.position.set(t.x,t.y,l.slicePlaneHeight);D.updateMatrixWorld(!0);l=l.slicePlaneHeight-l.farPlaneHeight;D.near=0;D.far=l;D.updateProjectionMatrix();l=q(D,B,n.planMaterial,!0,!0);if(0<k.minimapConfig.outlineThickness){D.near=0;D.far=.1;D.updateProjectionMatrix();
var I=q(D,B,n.outlineMaterial,!0,!0,m.outlineColor);if(k.minimapConfig.fillEnabled){D=I;m=m.outlineColor;var J=void 0;J=void 0===J?.02:J;t=new Uint8Array(D.length);J*=D.length/4;for(var Q=[-4,4,4*-u,4*u],T=0;T<D.length;T+=4)if(0===t[T]&&d(D,T)){var M=D,z=[],A=[],y=T,E=A;t[y]=1;for(E.push(y);A.length;){y=A.pop();z.push(y);E=M;for(var K=A,H=0;H<Q.length;++H){var G=y+Q[H];if(G=0===t[G]&&e(E,y,G)){G=y+Q[H];var O=K;t[G]=1;O.push(G)}}}M=z;if(M.length<J)for(z=m,A=D,y=0;y<M.length;++y)A[M[y]]=255*z.r,A[M[y]+
1]=255*z.g,A[M[y]+2]=255*z.b,A[M[y]+3]=255}}D=I;for(m=0;m<l.length;m+=4)if(c(D,m)){t=D[m+3]/255;for(J=0;3>J;++J)l[m+J]=l[m+J]*(1-t)+D[m+J]*t;l[m+3]=255}}B.dispose();B=new Uint8Array(l.length);for(D=0;D<l.length;D+=4)if(c(l,D)&&(!I||d(I,D)))for(m=0;4>m;++m)B[D+m]=255;l=new Uint8ClampedArray(l.buffer);l=new ImageData(l,u,v);B=new Uint8ClampedArray(B.buffer);u=new ImageData(B,u,v);return{minimapImageData:l,walkableImageData:u}};this.getCollisionData=function(m,l,u){var v={x:{min:0,max:l},y:{min:0,max:u}},
t={x:{min:k.boundingBox.min.x,max:k.boundingBox.max.x},y:{min:k.boundingBox.max.y,max:k.boundingBox.min.y}};p(m.outlineThickness,m.outlineColor,l,u);var B=h.createRenderTarget(l,u,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1}),D=new THREE.OrthographicCamera(k.boundingBox.min.x,k.boundingBox.max.x,k.boundingBox.max.y,k.boundingBox.min.y,0,10);D.position.set(0,0,m.slicePlaneHeight);D.updateMatrixWorld(!0);D.near=0;D.far=.1;D.updateProjectionMatrix();
m=q(D,B,n.outlineMaterial,!0);B.dispose();B=new Uint8ClampedArray(m.buffer);return{collisionImageData:new ImageData(B,l,u),canvasRange:v,sceneRange:t}};this.calculateRenderSize=function(m){var l=k.boundingBox.size().y/k.boundingBox.size().x;return{width:1>l?m:Math.round(1/l*m),height:1>l?Math.round(m*l):m}}}})();(function(){WALK.InteractionDispatcher=function(a,b,c,d,e,f,g,h){function k(J,Q){J=J?e:d;for(var T=0;T<J.length;T+=1)if(J[T](Q.object,Q.point,Q.distance))return!0;return!1}function q(){return b.findIntersectionAtPosition(0,0,!0,u)}function p(){k(!1,u)}function r(J,Q,T){h&&h.reset();return b.findIntersectionAtPosition(J,Q,!0,B)?k(T,B):!1}function n(J){h&&h.reset();J.action===WALK.GAMEPAD_ACTION.TRIGGER&&r(0,0,!1)}function m(J,Q){for(var T=0;T<f.length&&!f[T](J,Q);T+=1);}var l=!1,u=new WALK.RayIntersection,
v=null;h&&h.setGazeHandlers(q,p);var t=new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.INTERACTION_DISPATCHER);a=t.callbacks;var B=new WALK.RayIntersection,D=null,I=null;a.onPointerMove=function(J,Q){console.assert(l);0!==f.length&&(D=J,I=Q,c());return!1};a.onClick=function(J,Q){return r(J,Q,!1)};a.onDoubleClick=function(J,Q){return r(J,Q,!0)};g.addEventListener("actionActivated",n);this.handleHover=function(){if(l&&0!==f.length){var J=b.findObstacleMeshAtPosition(D,I,!0);null===J?v&&(m(v,!1),
v=null):J!==v&&(v&&m(v,!1),m(J,!0),v=J)}};this.enable=function(){l=!0;t.enable();console.assert(null===v)};this.disable=function(){l=!1;null!==v&&(m(v,!1),v=null);t.disable()};this.dispose=function(){this.disable();g.removeEventListener("actionActivated",n)};this.enable()}})();(function(){function a(ea,ba){return na.renderIdle(ea,ba)}function b(ea,ba){ba&&ia.update();sa.update(ea);Xa&&ca.minimapConfig.enabled&&Xa.update();Ga.enableCollisions&&!ba&&Aa.handleCollisions(ea);fa&&fa.handleHover();va.update(ea);Ba.update(ea);Ca&&Ca.updateCameraHeight(ea);qa&&qa.updateCameraHeight();ba&&!sa.teleportingToPoint&&(oa.update(),ma.requestFrame());Fa&&(ba&&!ia.hasGamepads()?Fa.update(ea):Fa.reset());for(var Qa=!1,Oa=$jscomp.makeIterator(ca.getAnimatedRootNodes()),Sa=Oa.next();!Sa.done;Sa=
Oa.next())Sa.value.update(ea,Ba.cameraWorldPosition())&&(Qa=!0);Oa=$jscomp.makeIterator(ca.getAnimatedMaterials());for(Sa=Oa.next();!Sa.done;Sa=Oa.next())Sa=Sa.value,Sa.isPlaying&&(Sa.update(ea),Qa=!0);Qa&&ma.requestFrame();pa&&pa.update(ea);Ea._update(ea);na.renderToScreen(ea,ba);wa&&wa.animate()}function c(ea){ea.view&&(Ca&&Ca.disable(),fa&&fa.disable())}function d(ea){!Ca||Ca.isEnabled()||oa.vrEnabled()||Ca.enable();if(qa&&oa.vrEnabled())qa.onTeleportDone();ea.view&&fa&&fa.enable();oa.vrEnabled()&&
Ba.hmdReset()}function e(){if("hidden"===document.visibilityState){if(ca)for(var ea=$jscomp.makeIterator(ca.getAnimatedMaterials()),ba=ea.next();!ba.done;ba=ea.next())ba.value.sleepAnimation()}else if("visible"===document.visibilityState&&ca){ea=$jscomp.makeIterator(ca.getAnimatedMaterials());for(ba=ea.next();!ba.done;ba=ea.next())ba.value.wakeAnimation();ma.requestFrame()}}function f(){WALK.DETECTOR.ios&&(document.documentElement.style.height=window.innerHeight+"px",0!==document.body.scrollTop&&
window.scrollTo(0,0));na.resize(oa.vrEnabled());ma.requestFrame();za.onResize()}function g(){return document.pointerLockElement===W||document.mozPointerLockElement===W||document.webkitPointerLockElement===W}function h(){return document.fullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}function k(){if(g()){Ba.mousePressLook=!1;za.onPointerLockChange(!0);var ea=WALK.GAZE_IN_POINTER_LOCK;ea?V.enableMode():V.disableMode();
Ea.anchorsVisible=ea}else Ba.mousePressLook=!0,za.onPointerLockChange(!1),V.disableMode(),Ea.anchorsVisible=!0;wa&&dat.GUI.toggleHide()}function q(){if(h())za.onFullScreenChange(!0),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary");else za.onFullScreenChange(!1)}function p(){var ea=document.body;return void 0!==document.fullscreenEnabled||void 0!==document.webkitFullscreenEnabled||void 0!==document.mozFullScreenEnabled||void 0!==document.msFullscreenEnabled?
!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled):void 0!==ea.mozRequestFullScreen||void 0!==ea.webkitRequestFullscreen||void 0!==ea.msRequestFullscreen||void 0!==ea.requestFullscreen}function r(ea){la.uploadNewBuffers(ea);ma&&ma.requestFrame()}function n(ea){la.uploadTexture(ea);ea.isAtlas()?ea.forEachAtlasEntry(function(ba){console.assert(null===ba.isCutout);Ha.isCutoutTexture(ba)}):null===ea.isCutout&&Ha.isCutoutTexture(ea);
ma&&ma.requestFrame()}function m(ea){ea=[];var ba=[],Qa=[];ea.push(Ea._clickListener.bind(Ea));var Oa=Ea._createHoverListener();Oa&&Qa.push(Oa);va=new WALK.ClickNavigator(ca,Aa,Ba,sa);ba.push(va.onMeshClicked);ka||ea.push(va.onMeshClicked);fa=new WALK.InteractionDispatcher(aa,Aa,function(){ma.requestFrame()},ea,ba,Qa,ia,Fa)}function l(){Ca&&Ca.disable();qa&&qa.enable();Ba.mouseControlsPitch=!1;Ba.hmdReset();sa.onVrChange(!0);V.enableMode();za.onVrChange(!0);Ea._vrChange(!0);f()}function u(ea){ma.isEnabled()&&
(ea?l():(Ba.resetRollAngle(),Ba.resetPitchAngle(),Ba.mouseControlsPitch=!0,console.assert(!oa.vrEnabled()),qa&&qa.disable(),Ca&&Ca.enable(),sa.onVrChange(!1),V.disableMode(),za.onVrChange(!1),Ea._vrChange(!1),f(),setTimeout(f,1E3)))}function v(ea){ka||WALK.DETECTOR.mobile&&!WALK.ALLOW_MOBILE_VR||(WALK.DETECTOR.ios||WALK.DETECTOR.mobile&&WALK.DETECTOR.firefox)&&WALK.DETECTOR.inCrossOriginIframe||za.setVrSupported(ea)}function t(ea,ba){if(qa&&null!==ba)qa.onHmdPositionUpdate(ba);Ba.onHmdUpdate(ea,ba)}
function B(ea,ba){ea&&Ba.cameraWorldPosition().set(ea[0],ea[1],ea[2]);ba&&(ea=new WALK.Euler,ea.setFromDegTriple(ba),Ba.setYawAngle(ea.yaw),Ba.setPitchAngle(ea.pitch))}function D(ea){for(var ba=0;ba<ea.length;ba+=1)if(!ea[ba].lightProbe)return!1;return!0}function I(ea,ba,Qa){Aa=new WALK.Collider(ea,ba,Qa);ba.visitAllNodes(function(Oa){Oa.mesh&&Aa.addStaticObstacle(Oa.mesh)})}function J(){var ea=THREE.Scene.prototype.add;THREE.Object3D.prototype.add=function(ba){ba instanceof THREE.Mesh&&la.uploadNewBuffers(ba);
ea.call(this,ba)}}function Q(ea){var ba=WALK.urlHashGetArgument("view"),Qa=null;ba&&(Qa=ea.findViewByName(ba));return Qa||ea.views[0]}function T(ea){function ba(){ma.requestFrame()}ca=ea;ca.adjustSkiesAndCameraFarToSpanWholeScene();ca.headLight=WALK.HEAD_LIGHT;ca.addEventListener("updated",function(){return ma.requestFrame()});ca.addEventListener("anyViewUpdated",function(){return za.refresh()});ca.disableLightProbesForMaterials();Ba.enable();ca.threeScene.updateMatrixWorld(!0);oa.setCameraFar(ca.camera.far);
na=new WALK.Renderer(la,oa,ca,R);Ka=new WALK.MinimapRenderer(la,ca);aa=new WALK.PointerEventDispatcher(la.domElement,ka);if((ea=Ga.enableCollisions)||ka)I(la,ca,Ba),Ba.orbit.collider=Aa;sa=new WALK.Teleport(ca,Ba,Aa,ma,Ka);sa.addEventListener("teleportStarted",c);sa.addEventListener("teleportDone",d);U=new WALK.AutoTour(ca,sa);ea&&ca.camera.autoClimb&&(Ca=new WALK.StepsClimber(Aa,Ba,ma));ea&&(qa=new WALK.VRHeightController(Ba,Aa));sa.switchToView(Q(ca),0);R.updateWithoutDelay();Ta=new WALK.HashChangeTeleport(ca,
sa);Ia=new WALK.ScreenshotTaker(la,ca,Ba);ea&&!0!==WALK.NO_GAZE_TELEPORT&&(Fa=new WALK.GazePointer(ca,Ba,ba,V));Ea._sceneReadyToDisplay(la,ca,Ba,sa,U,Aa,Ia,S,V,aa,ma,ra);m(ea);document.addEventListener("visibilitychange",e);window.addEventListener("resize",function(){WALK.DETECTOR.ios?setTimeout(f,1E3):f()},!1);p()&&za.setFullScreenSupported();WALK.DETECTOR.mobile||WALK.DETECTOR.opera||void 0===document.pointerLockElement&&void 0===document.mozPointerLockElement&&void 0===document.webkitPointerLockElement||
za.setPointerLockSupported();za.sceneReadyToDisplay(ca,sa,U,Ia);f();WALK.DEBUG&&WALK.DebugUI&&(wa=new WALK.DebugUI(ca,Ba,f,ma));WALK.focusWalkCanvas();WALK.DEBUG_SHARED_BUFFERS&&(ca.threeScene.overrideMaterial=new WALK.DebugMaterial);ca.startAutoTourOnLoad()&&U.start();ma.enable();oa.vrEnabled()&&l();ib=Da.elapsedLoadTimeSec()}function M(ea){ka||WALK.urlHashContains("nostats")||0!==gb||za.cover.sendStats&&WALK.ajaxPost("./stats/"+ea,null,null)}function z(ea,ba){function Qa(Ra){function Cb(){db.delete(Fb);
null!==ea.findLightProbe(Fb.id)&&(ba.assignLightProbesToObjects(),ba.createLightProbeTexture(Fb,!1),ma.requestFrame())}var Fb=Ra.target;Ra=db.get(Fb);void 0===Ra&&(Ra=new WALK.DeferringExecutorOnce(Cb,1E3),db.set(Fb,Ra));Ra.deferRun()}function Oa(Ra){Ra=Ra.target;ba.createLightProbeTexture(Ra,!0);if(!Ra.isBoundingBoxInitialized()){var Cb=Ra.boxMax;Ra.boxMin.copy(Ra.position).addScalar(-1);Cb.copy(Ra.position).addScalar(1);Ra.enableBoundingBox()}}function Sa(Ra){for(Ra=0;Ra<ea.materials.length;Ra+=
1)ea.materials[Ra].forceObjectUniformsRefresh()}var db=new Map;ea.addEventListener("lightProbeAdded",function(Ra){Ra=Ra.lightProbe;ba.assignLightProbesToObjects();ba.createLightProbeTexture(Ra,!0);Ra.isBoundingBoxInitialized()||Ra.disableBoundingBox();Ra.addEventListener("boundsInit",Oa);Ra.addEventListener("positionUpdated",Qa);Ra.addEventListener("boundsUpdated",Sa)});ea.addEventListener("lightProbeRemoved",function(){ba.assignLightProbesToObjects()});for(var fb=0;fb<ea.lightProbes.length;fb+=1)ea.lightProbes[fb].addEventListener("positionUpdated",
Qa),ea.lightProbes[fb].addEventListener("boundsInit",Oa),ea.lightProbes[fb].addEventListener("boundsUpdated",Sa)}function A(ea,ba,Qa){function Oa(db){if(db===ea.length)Qa();else{var fb=ea[db],Ra=fb.name;Sa.has(Ra)?Oa(db+1):(Sa.add(Ra),ba.monoPanoramaToServer(fb,function(){return Oa(db+1)}))}}var Sa=new Set;Oa(0)}function y(ea){function ba(){if(Ga.onSceneLoaded)Ga.onSceneLoaded(new WALK.EditorHooks(ea,za,Ba,sa,pa,ra,Ia,ma,Xa));za.sceneLoadComplete();for(var Ra=$jscomp.makeIterator(ea.getAnimatedMaterials()),
Cb=Ra.next();!Cb.done;Cb=Ra.next())Cb.value.play();Ea._sceneLoadComplete();ma.requestFrame();Ra=Da.elapsedLoadTimeSec();M("loaded?readyToDisplayTime="+ib.toFixed(1)+"&loadTime="+Ra.toFixed(1));Da=null}var Qa=WALK.urlHashContains("headless");Ha.dispose();Ha=null;if(0<ea.lightProbes.length||ka){var Oa=new WALK.LightProbeMaker(ea,la,WALK.DETECTOR.gl.textureLod,WALK.DETECTOR.gl.mirrorCubeMaps,ka);0===ea.lightProbes.length&&ka&&ea.autoAddLightProbes&&WALK.arrangeLightProbes(ea,Oa,Qa);if(0<ea.lightProbes.length){D(ea.gpuMeshes)||
(console.warn("Some objects do not have light probes assigned, this is not optimal."),Oa.assignLightProbesToObjects());var Sa;for(Sa=0;Sa<ea.views.length&&"orbit"===ea.views[Sa].mode;Sa+=1);Sa===ea.views.length&&(Sa=0);sa.executeWithViewVisibilitySettings(ea.views[Sa],function(){Oa.createAllLightProbeTextures()});ea.enableLightProbesForMaterials()}}ea.hasLightMap()&&na.enableAutoExposure();if(ka){Oa?z(ea,Oa):console.warn("Cube maps support is required in the edit mode");Sa=new WALK.LightControls(ea,
ma);var db=new WALK.LightProbeControls(ea,ma),fb=new WALK.CameraVolumeControls(ea,ma);pa=new WALK.EditorSelector(aa,ea,la,Aa,Sa,db,fb,ma,Ba);Ga.sendCoverToServer&&Ia.coverToServer(WALK.EDITOR_COVER_WIDTH,WALK.EDITOR_COVER_HEIGHT);B(Ga.forcedInitialCameraPosition,Ga.forcedInitialCameraRotation)}else Oa&&(Oa.dispose(),Oa=null);Xa=new WALK.Minimap(Ka,ea,sa,Ea);ka&&Qa?A(Da.panoramas,Ia,ba):ba()}function E(){bb&&(bb=!1,Da.load(),za.sceneLoadStarted(),WALK.SHOW_HELP_ON_LOAD&&(za.helpVisible=!0),M("play"))}
function K(ea){za.updateCover(ea);ra.updateConfig(ea.extensions||[]);WALK.DETECTOR.canForceBrotliBuffers=!0===ea.canForceBrotliBuffers;1===ea.webwalkLogMode?(WALK.logInfoMessages(),WALK.initLoggingToServer(!0)):2===ea.webwalkLogMode&&WALK.initLoggingToServer(!1);ka||ra.startExtensions();Ea._viewerConfigLoaded(ea);if(ea.language){var ba=WALK.STRINGS[ea.language];ba?WALK.updateViewerStrings(ba):console.log("Unknown language: "+ea.language)}Ha=new WALK.CutoutTextureDetector(la);Z=new WALK.TextureCropper(la);
bb=!0;ea=new WALK.Scene(Ba.camera());void 0!==Ga.assetsUrl&&null!==Ga.assetsUrl&&(WALK.ASSETS_URL=Ga.assetsUrl);Da=new WALK.SceneLoader(ea,WALK.ASSETS_URL,ka,ua,Z);S=new WALK.LumaMeter(la,ea);R=new WALK.ExposureController(ea,Ba,S);Da.onProgress=za.loadProgress;Da.onTextureLoaded=n;Da.onMeshBuffersLoaded=r;Da.onReadyToDisplay=T;Da.onComplete=y;WALK.AUTO_PLAY||eb||0<gb?E():WALK.HIDE_PLAY||za.enablePlayButton(E)}function H(ea){ea.preventDefault();gb+=1;ma.disable();!ka&&null===Da&&gb<=WALK.CONTEXT_LOST_RESTORE_LIMIT?
(ra.stopExtensions(),Ea._contextLost(),Ta.dispose(),Ta=null,fa.dispose(),fa=null,va&&(va.dispose(),va=null),za.contextLost()):WALK.USER_MSG.error("Graphics context lost, reload to retry.")}function G(ea){ea.preventDefault();!ka&&null===Da&&gb<=WALK.CONTEXT_LOST_RESTORE_LIMIT&&(WALK.USER_MSG.info("Graphics context switched, reloading the scene to use the new context.",5E3),WALK.DETECTOR.resetGlDetector(la.context),WALK.DETECTOR.gl.reportToConsole(),la.webGLContextRestored(),K(za.cover))}function O(){WALK.ajaxGet(WALK.COVER_JSON_URL,
!1,function(ea){WALK.DETECTOR.onAsyncPropertiesDetected(function(){K(ea)})},function(ea,ba){var Qa="Failed to initialize the scene.";401==ea&&void 0!==ba&&(Qa=ba);WALK.USER_MSG.error(Qa)})}function Y(ea){J();Ga=ea;if(la=WALK.createWebwalkRenderer(W))if(WALK.DETECTOR.gl.missingCapabilities)WALK.USER_MSG.error(WALK.DETECTOR.gl.missingCapabilities);else{W.addEventListener("webglcontextlost",H,!1);W.addEventListener("webglcontextrestored",G,!1);za.init();ra=new WALK.ExtensionManager;ea=null;try{WALK.VR_LO?
WebXRConfig.cardboardConfig.BUFFER_SCALE*=.5:WALK.VR_HI&&(WebXRConfig.cardboardConfig.BUFFER_SCALE*=1.5),ea=new WebXRPolyfill(WebXRConfig)}catch(ba){WALK.log("Failed to initialize WebXR polyfill")}oa=new WALK.VRManager(la,ia,ea,v,t,function(ba){ba?ma.disable():ma.enable()},u);ma=new WALK.AnimationController(oa,b,a);ma.disable();ea=new WALK.Camera;Ba=new WALK.Controls(ea,W,ia,ma);Ba.mousePressLook=!0;WALK.FLIP_MOUSE&&(Ba.flipMouseLook=!0);Ba.disable();O();WALK.getExtraAssetUrl=function(ba){return ba.startsWith("extra-assets/")?
WALK.ASSETS_URL+ba:WALK.ASSETS_URL+"extra-assets/"+ba}}else WALK.USER_MSG.error(window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a> or your browser has WebGL disabled.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a>.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>')}
var W=document.getElementById("walk-canvas"),ka=WALK.EDIT_MODE,la,oa,ra,Ba,ma,Ga,aa,S,R,Z,ca,na,Aa,Ca,qa,fa,va,sa,Fa,Ta,U,pa,Da=null,wa=null,Ha,Ia,Xa,Ka,gb=0,bb=!1,eb=!1,ib,V=new WALK.GazeModeObserver;var ia=new WALK.GamepadManager;var za=new WALK.Menu(ka,ia,function(){oa.vrEnabled()?oa.disableVr():(U.isRunning()&&U.stop(),oa.enableVr(la.context))},function(){if(h())h()&&(document.exitFullScreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,
document.exitFullScreen&&document.exitFullScreen());else{var ea=document.body;(ea.mozRequestFullScreen||ea.webkitRequestFullscreen||ea.msRequestFullscreen||ea.requestFullscreen).call(ea);document.addEventListener("fullscreenchange",q,!1);document.addEventListener("mozfullscreenchange",q,!1);document.addEventListener("webkitfullscreenchange",q,!1);document.addEventListener("MSFullscreenChange",q,!1)}},function(){g()?g()&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||
document.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()):(W.requestPointerLock=W.requestPointerLock||W.mozRequestPointerLock||W.webkitRequestPointerLock,W.requestPointerLock(),document.addEventListener("pointerlockchange",k,!1),document.addEventListener("mozpointerlockchange",k,!1),document.addEventListener("webkitpointerlockchange",k,!1))});var ua=new WALK.MergeConfig;ka&&ua.setAllMaterialsEditable();var Ea=new WALK.Viewer(ka,za,ua);var Na={FontAwesomeSolid:"\uf2b9",FontAwesomeRegular:"\uf2b9",
FontAwesomeBrands:"\uf293"};WALK.loadFontFamilies=function(ea,ba,Qa){function Oa(Ra){Ra?++db:++fb;db+fb===ea.length&&(0===fb?ba():Qa&&Qa())}if(0===ea.length)ba();else{var Sa={};ea.forEach(function(Ra){console.assert(Na[Ra],"Font "+JSON.stringify(Ra)+" is not supported.");Sa[Ra]=Na[Ra]});var db=0,fb=0;WebFont.load({custom:{families:ea,testStrings:Sa},timeout:1E4,fontactive:function(){Oa(!0)},fontinactive:function(Ra){console.error("Cannot load font: "+Ra);Oa(!1)}})}};WALK.getViewerAssetUrl=function(){var ea=
function(){for(var ba=document.getElementsByTagName("script"),Qa=0;Qa<ba.length;++Qa){var Oa=ba[Qa].src.match(/^(.*\/)walk(\.min)?\.js$/);if(Oa)return Oa[1]}console.error("Cannot determine webwalk URL.");return"/webwalk/"}();return function(ba){return ea+ba}}();WALK.initEditMode=function(ea){var ba=document.createElement("base");ba.target="_blank";document.head.appendChild(ba);WALK.loadFontFamilies(Object.keys(Na),function(){Y(ea)})};WALK.init=function(ea){ka||Y(ea)};WALK.play=function(){bb?E():eb=
!0};WALK.getViewer=function(){return Ea};WALK.Extensions={}})();(function(){WALK.STRINGS.English={help:{basic:"BASIC",advanced:"ADVANCED",mouse:"Mouse",or:"or",keyboard:"Keyboard",vrTeleport:"VR teleport",holdLeftButton:"Hold the left button",clickLeftButton:"Click the left button",lookAround:"Look around",walkToClickedPlace:"Walk to the clicked place",selectMaterialLightObject:"Select material, light, object",scroll:"Scroll",walkStraight:"Walk straight",walkStraightAndLookAround:"Walk straight and look around",walkStraightAndSideways:"Walk straight and sideways",
changeHeight:"Change height",switchView:"Switch view",screenshot:"Screenshot",illuminationPreview:"Illumination preview",hideShowMenu:"Hide/show menu",hideShowMousePointer:"Hide/show mouse pointer",vrMode:"VR Mode",gazeAtFixedPlace:"Gaze at a fixed place",clickControllerButton:"Click a controller button",teleport:"Teleport",touch:"Touch"}}})();(function(){WALK.STRINGS.Chinese={help:{basic:"\u57fa\u672c",advanced:"\u9ad8\u7ea7",mouse:"\u6ed1\u9f20",or:"\u6216",keyboard:"\u952e\u76d8",vrTeleport:"VR \u4f20\u9001",holdLeftButton:"\u6309\u4f4f\u5de6\u952e",clickLeftButton:"\u5355\u6309\u5de6\u952e",lookAround:"\u8c03\u6574\u89c6\u89d2",walkToClickedPlace:"\u8d70\u53bb\u6307\u5b9a\u5730\u70b9",selectMaterialLightObject:"\u9009\u62e9\u6750\u8d28\uff0c\u706f\u5149\uff0c\u7269\u4f53",scroll:"\u6ed1\u8f6e",walkStraight:"\u76f4\u8d70",walkStraightAndLookAround:"\u8c03\u6574\u89c6\u89d2",
walkStraightAndSideways:"\u79fb\u52a8",changeHeight:"\u8c03\u6574\u9ad8\u5ea6",switchView:"\u79fb\u52a8\u81f3\u6307\u5b9a\u89c6\u89d2",screenshot:"\u622a\u56fe",illuminationPreview:"\u7167\u660e\u9884\u89c8",hideShowMenu:"\u9690\u85cf/\u663e\u793a\u83dc\u5355",hideShowMousePointer:"\u9690\u85cf/\u663e\u793a\u9f20\u6807",vrMode:"VR \u6a21\u5f0f",gazeAtFixedPlace:"\u51dd\u89c6\u4e00\u4e2a\u56fa\u5b9a\u7684\u5730\u65b9",clickControllerButton:"\u5355\u51fb\u63a7\u5236\u5668\u6309\u94ae",teleport:"\u4f20\u9001",
touch:"\u89e6\u78b0"}}})();(function(){WALK.STRINGS.French={help:{basic:"BASIQUES",advanced:"AVANC\u00c9S",mouse:"Souris",or:"ou",keyboard:"Clavier",vrTeleport:"T\u00e9l\u00e9portation VR",holdLeftButton:"Maintenez le bouton gauche",clickLeftButton:"Cliquez sur le bouton gauche",lookAround:"Regardez autour",walkToClickedPlace:"D\u00e9placez-vous jusqu\u2019\u00e0 l\u2019endroit cliqu\u00e9",selectMaterialLightObject:"S\u00e9lectionnez le mat\u00e9riel, la lumi\u00e8re, l\u2019objet",scroll:"D\u00e9filement",walkStraight:"Allez tout droit",
walkStraightAndLookAround:"Allez tout droit et regardez autour",walkStraightAndSideways:"Allez tout droit et de c\u00f4t\u00e9",changeHeight:"Changez la hauteur",switchView:"Changez de vue",screenshot:"Capture d\u2019\u00e9cran",illuminationPreview:"Aper\u00e7u de l\u2019\u00e9clairage",hideShowMenu:"Masquer / Afficher le menu",hideShowMousePointer:"Masquer / Afficher le pointeur de la souris",vrMode:"Mode RV",gazeAtFixedPlace:"Fixez un endroit pr\u00e9cis",clickControllerButton:"Appuyez sur un bouton du contr\u00f4leur",
teleport:"T\u00e9l\u00e9portation",touch:"Touchez"}}})();(function(){WALK.STRINGS.German={help:{basic:"GRUNDLAGEN",advanced:"ERWEITERT",mouse:"Maus",or:"oder",keyboard:"Tastatur",vrTeleport:"VR-Teleport",holdLeftButton:"Linke Maustaste gedr\u00fcckt halten",clickLeftButton:"Klick auf die linke Maustaste",lookAround:"Umschauen",walkToClickedPlace:"Zum angeklickten Punkt bewegen",selectMaterialLightObject:"Material, Licht, Objekt ausw\u00e4hlen",scroll:"Mausrad",walkStraight:"Geradeaus gehen",walkStraightAndLookAround:"Geradeaus gehen und umsehen",walkStraightAndSideways:"Geradeaus und seitw\u00e4rts gehen",
changeHeight:"H\u00f6he \u00e4ndern",switchView:"Ansicht wechseln",screenshot:"Bildschirmfoto",illuminationPreview:"Beleuchtungsvorschau",hideShowMenu:"Men\u00fc aus- / einblenden",hideShowMousePointer:"Mauszeiger aus-/einblenden",vrMode:"VR-Modus",gazeAtFixedPlace:"Blick auf einem Punkt fixieren",clickControllerButton:"Controller Taste dr\u00fccken",teleport:"Teleportieren",touch:"Tippen"}}})();(function(){WALK.STRINGS.Spanish={help:{basic:"B\u00c1SICO",advanced:"AVANZADO",mouse:"Rat\u00f3n",or:"o",keyboard:"Teclado",vrTeleport:"Teletransporte VR",holdLeftButton:"Mant\u00e9n presionado el bot\u00f3n izquierdo",clickLeftButton:"Haz clic en el bot\u00f3n izquierdo",lookAround:"Mira a tu alrededor",walkToClickedPlace:"Camina hasta el lugar donde hiciste clic",selectMaterialLightObject:"Selecciona material, luz, objeto",scroll:"Despl\u00e1zate",walkStraight:"Camina en l\u00ednea recta",walkStraightAndLookAround:"Camina en l\u00ednea recta y mira a tu alrededor",
walkStraightAndSideways:"Camina recto y de lado",changeHeight:"Cambiar altura",switchView:"Cambiar vista",screenshot:"Captura de pantalla",illuminationPreview:"Vista previa de iluminaci\u00f3n",hideShowMenu:"Ocultar / mostrar men\u00fa",hideShowMousePointer:"Ocultar / mostrar el puntero del rat\u00f3n",vrMode:"Modo VR",gazeAtFixedPlace:"Mira a un punto fijo",clickControllerButton:"Pulsa un bot\u00f3n del mando",teleport:"Teletransporte",touch:"Tocar"}}})();(function(){WALK.STRINGS.Korean={help:{basic:"\uae30\ubcf8 \uc870\uc791\ubc95",advanced:"\uc0c1\uc138 \uc870\uc791\ubc95",mouse:"\ub9c8\uc6b0\uc2a4",or:"\ud639\uc740",keyboard:"\ud0a4\ubcf4\ub4dc",vrTeleport:"VR \uc774\ub3d9",holdLeftButton:"\uc88c\uce21 \ubc84\ud2bc \ub4dc\ub798\uadf8",clickLeftButton:"\uc88c\uce21 \ubc84\ud2bc \ud074\ub9ad",lookAround:"\uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",walkToClickedPlace:"\ud074\ub9ad\ud55c \uacf3\uc73c\ub85c \uc774\ub3d9",selectMaterialLightObject:"\uc7ac\uc9c8, \uc870\uba85, \uc0ac\ubb3c \uc120\ud0dd",
scroll:"\uc2a4\ud06c\ub864",walkStraight:"\uc9c1\uc9c4 \uc774\ub3d9",walkStraightAndLookAround:"\uc9c1\uc9c4 \uc774\ub3d9 / \uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",walkStraightAndSideways:"\uc9c1\uc9c4 \uc774\ub3d9 / \uc606\uc73c\ub85c \uc774\ub3d9",changeHeight:"\ub192\uc774 \uc870\uc808",switchView:"\ubdf0 \uc120\ud0dd",screenshot:"\uc2a4\ud06c\ub9b0\uc0f7",illuminationPreview:"\uc77c\ub8e8\ubbf8\ub124\uc774\uc158 \ud504\ub9ac\ubdf0",hideShowMenu:"\uba54\ub274 On/Off",hideShowMousePointer:"\ub9c8\uc6b0\uc2a4 \ud3ec\uc778\ud130 On/Off",
vrMode:"VR \ubaa8\ub4dc",gazeAtFixedPlace:"\ud2b9\uc815 \uc7a5\uc18c \ubc14\ub77c\ubcf4\uae30",clickControllerButton:"\ucee8\ud2b8\ub864\ub7ec \ubc84\ud2bc \ud074\ub9ad",teleport:"\ud154\ub808\ud3ec\ud2b8",touch:"\ud130\uce58"}}})();(function(){WALK.STRINGS.Polish={help:{basic:"PODSTAWOWE",advanced:"ZAAWANSOWANE",mouse:"Myszka",or:"lub",keyboard:"Klawiatura",vrTeleport:"Teleportacja VR",holdLeftButton:"Przytrzymaj lewy przycisk",clickLeftButton:"Naci\u015bnij lewy przycisk",lookAround:"Rozgl\u0105daj si\u0119",walkToClickedPlace:"Id\u017a do naci\u015bni\u0119tego miejsca",selectMaterialLightObject:"Wybierz materia\u0142, \u015bwiat\u0142o, obiekt",scroll:"Przewi\u0144",walkStraight:"Id\u017a prosto",walkStraightAndLookAround:"Id\u017a prosto i rozgl\u0105daj si\u0119",
walkStraightAndSideways:"Id\u017a prosto i na boki",changeHeight:"Zmie\u0144 wysoko\u015b\u0107",switchView:"Zmie\u0144 widok",screenshot:"Zrzut ekranu",illuminationPreview:"Podgl\u0105d o\u015bwietlenia",hideShowMenu:"Schowaj/poka\u017c menu",hideShowMousePointer:"Schowaj/poka\u017c kursor myszki",vrMode:"Tryb VR",gazeAtFixedPlace:"Patrz w ustalone miejsce",clickControllerButton:"Naci\u015bnij przycisk kontrolera",teleport:"Teleportacja",touch:"Dotyk"}}})();(function(){WALK.STRINGS.Portuguese={help:{basic:"B\u00c1SICO",advanced:"AVAN\u00c7ADO",mouse:"Mouse",or:"ou",keyboard:"Teclado",vrTeleport:"Teletransporte VR",holdLeftButton:"Mantenha pressionado o bot\u00e3o esquerdo",clickLeftButton:"Clique com o bot\u00e3o esquerdo",lookAround:"Olhe ao redor",walkToClickedPlace:"Ande at\u00e9 o lugar que foi clicado",selectMaterialLightObject:"Selecione material, luz, objeto",scroll:"Rolagem",walkStraight:"Ande em frente",walkStraightAndLookAround:"Ande em frente e olhe ao redor",
walkStraightAndSideways:"Ande em frente e para os lados",changeHeight:"Variar altura",switchView:"Alternar entre cenas",screenshot:"Captura de imagem",illuminationPreview:"Visualiza\u00e7\u00e3o de ilumina\u00e7\u00e3o",hideShowMenu:"Ocultar/mostrar menu",hideShowMousePointer:"Ocultar/mostrar a seta do mouse",vrMode:"Modo VR",gazeAtFixedPlace:"Olhe para um lugar fixo",clickControllerButton:"Clique num bot\u00e3o controlador",teleport:"Teletransporte",touch:"Toque"}}})();(function(){WALK.STRINGS.Turkish={help:{basic:"Basit",advanced:"\u0130leri D\u00fczey",mouse:"Fare",or:"veya",keyboard:"Klavye",vrTeleport:"VR I\u015f\u0131nlanma",holdLeftButton:"Sol tu\u015fa bas\u0131l\u0131 tut",clickLeftButton:"Sol tu\u015fa t\u0131kla",lookAround:"\u00c7evrene bak",walkToClickedPlace:"T\u0131klad\u0131\u011f\u0131n alana y\u00fcr\u00fc",selectMaterialLightObject:"Materyal, \u0131\u015f\u0131k veya obje se\u00e7",scroll:"A\u015fa\u011f\u0131 kayd\u0131r",walkStraight:"D\u00fcz y\u00fcr\u00fc",
walkStraightAndLookAround:"D\u00fcz y\u00fcr\u00fc ve \u00e7evrene bak\u0131n",walkStraightAndSideways:"D\u00fcz ve yanlana do\u011fru y\u00fcr\u00fc",changeHeight:"Y\u00fckseklik de\u011fi\u015ftir",switchView:"G\u00f6r\u00fcn\u00fcm de\u011fi\u015ftir",screenshot:"Ekran G\u00f6r\u00fcnt\u00fcs\u00fc",illuminationPreview:"Ayd\u0131nlatma \u00f6nizlemesi",hideShowMenu:"Men\u00fcy\u00fc g\u00f6ster/gizle",hideShowMousePointer:"\u0130mleci g\u00f6ster/gizle",vrMode:"VR Modu",gazeAtFixedPlace:"Bir noktaya kitlenerek bak",
clickControllerButton:"Kumanda butonuna t\u0131kla",teleport:"I\u015f\u0131nlan",touch:"Dokun"}}})();(function(){function a(){for(var c=document.querySelectorAll("[data-strings]"),d=0;d<c.length;++d){var e=c.item(d);a:{var f=e.getAttribute("data-strings").split(".");for(var g=b,h=0;h<f.length;h++)if(g=g[f[h]],!g){f=null;break a}f="string"===typeof g?g:null}e.textContent=f}}var b=WALK.cloneObject(WALK.STRINGS[WALK.DEFAULT_LANGUAGE]);WALK.updateViewerStrings=function(c){function d(e,f,g){Object.keys(f).forEach(function(h){var k=""===g?h:g+"."+h;if(void 0===e[h])console.warn("Viewer string "+k+" doesn\u2019t exist");
else if(typeof e[h]!==typeof f[h])console.error(k+" should be "+typeof e[h]);else switch(typeof f[h]){case "string":e[h]=f[h];break;case "object":d(e[h],f[h],k)}})}d(b,c,"");a()};WALK.getViewerStrings=function(){return WALK.readOnlyCopy(b)};a()})();(function(){WALK.ExtensionManager=function(){this.extensionTypes=WALK.Extensions};WALK.ExtensionManager.getExtensionDefinition=function(a){return WALK.Extensions[a].definition};WALK.ExtensionManager.prototype={constructor:WALK.ExtensionManager,updateConfig:function(a){this.extensions=[];a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this._createExtensionFromConfig(b.value)},_createExtensionFromConfig:function(a){function b(e,f){return e.some(function(g){return g.name===f&&g.config.type===
a.type})}a.name=a.name.toString();for(var c=a.name,d=2;b(this.extensions,a.name);)a.name=c+d.toString(),d+=1;c=new this.extensionTypes[a.type](a);this.extensions.push(c);return c},startExtensions:function(){var a=this;this._loadFontAwesomeIfNeeded(function(){for(var b=0;b<a.extensions.length;b+=1)a.extensions[b].start()})},_loadFontAwesomeIfNeeded:function(a){var b=this,c=this.extensions.map(function(d){return b._getFonts(d.config)}).concat(WALK.FONT_FAMILIES_TO_LOAD).reduce(function(d,e){return d.concat(e)},
[]).filter(function(d,e,f){return e===f.indexOf(d)});0<c.length&&!WALK.EDIT_MODE?WALK.loadFontFamilies(c,a,a):a()},_getFonts:function(a){for(var b=[],c=$jscomp.makeIterator(this.extensionTypes[a.type].definition.properties),d=c.next();!d.done;d=c.next())if(d=d.value,"trigger"===d.type&&a[d.id])d=a[d.id],(d=d.icon&&WALK.ICONS[d.icon].fontFamily)&&b.push(d);else if("list"===d.type&&"trigger"===d.elementType&&a[d.id]){d=$jscomp.makeIterator(a[d.id]);for(var e=d.next();!e.done;e=d.next())e=e.value,(e=
e.icon&&WALK.ICONS[e.icon].fontFamily)&&b.push(e)}return b},stopExtensions:function(){for(var a=0;a<this.extensions.length;a+=1)this.extensions[a].stop()},getEditableExtensionDefinitions:function(){for(var a=[],b=$jscomp.makeIterator(Object.entries(this.extensionTypes||{})),c=b.next();!c.done;c=b.next()){var d=$jscomp.makeIterator(c.value);c=d.next().value;d=d.next().value;d.definition.hideFromEditor||a.push({type:c,definition:d.definition})}return a},getEditableExtensions:function(){for(var a=[],
b=$jscomp.makeIterator(this.extensions),c=b.next();!c.done;c=b.next())c=c.value,c.definition.hideFromEditor||a.push(c);return a},addExtension:function(a){a=this._createExtensionFromConfig(a);a.start();return a},removeExtension:function(a){a.stop();for(var b=0;b<this.extensions.length;b+=1)if(this.extensions[b]===a){this.extensions.splice(b,1);break}},getConfig:function(){return this.extensions.map(function(a){return a.config})},getExtension:function(a,b){for(var c=$jscomp.makeIterator(this.extensions),
d=c.next();!d.done;d=c.next())if(d=d.value,d.type===a&&d.name===b)return d;console.error("Unrecognized extension "+a+" "+b+", supported types: "+Object.keys(this.extensionTypes))}}})();(function(){function a(){}function b(h){console.error("This extension cannot be triggered on/off")}function c(h,k){var q=new THREE.Vector3,p=new THREE.Vector3;if(k&&"node"!==k.type){q.fromArray(k.position);var r=k.radius}else r=WALK.Extensions.MaterialPicker.VR_RADIUS;this.getPosition=function(n){k&&"node"!==k.type||(p.copy(h.getCameraPosition()),p.sub(n),p.normalize().multiplyScalar(r),q.copy(n).add(p));return q};this.getRadius=function(){return r}}function d(h){var k=$jscomp.makeIterator(h.split(":"));
h=k.next().value;k=k.next().value;return[h,k]}var e=WALK.EDIT_MODE,f={"\uf2b9":"address-book","\uf2bb":"address-card","\uf1fe":"area-chart","\uf047":"arrows","\uf062":"arrow-up","\uf063":"arrow-down","\uf2a2":"assistive-listening-systems","\uf069":"asterisk","\uf29e":"audio-description","\uf1fa":"at","\uf0c9":"bars","\uf0f3":"bell","\uf02d":"book","\uf02e":"bookmark","\uf0a1":"bullhorn","\uf1ec":"calculator","\uf030":"camera","\uf080":"chart-bar","\uf200":"chart-pie","\uf0c2":"cloud","\uf013":"cog",
"\uf075":"comment","\uf14e":"compass","\uf09d":"credit-card","\uf05b":"crosshairs","\uf019":"download","\uf0e0":"envelope","\uf08e":"external-link","\uf06e":"eye","\uf1fb":"eye-dropper","\uf008":"film","\uf024":"flag","\uf07b":"folder","\uf06b":"gift","\uf025":"headphones","\uf015":"home","\uf03e":"image","\uf090":"sign-in","\uf129":"info","\uf0eb":"lightbulb","\uf0d0":"magic","\uf076":"magnet","\uf041":"map-marker","\uf276":"map-pin","\uf277":"map-signs","\uf1fc":"paint-brush","\uf040":"pencil",
"\uf095":"phone","\uf128":"question","\uf064":"share","\uf1e0":"share-alt","\uf07a":"shopping-cart","\uf1de":"sliders","\uf005":"star","\uf0e4":"tachometer","\uf02b":"tag","\uf03d":"video","\uf0ad":"wrench","\uf04b":"play","\uf16a":"youtube","\uf27d":"vimeo","\uf09a":"facebook","\uf099":"twitter","\uf16d":"instagram"},g=new function(){var h=new Map;this.onNodeTypeClicked=function(k,q){function p(n){return function(m,l,u){var v=h.get(n);console.assert(v,"listenerMulti not found for "+n);v.listeners.forEach(function(t){try{t(m,
l,u)}catch(B){console.error(B)}});return!0}}var r=h.get(k);r?r.listeners.push(q):(r=p(k),h.set(k,{listenerMulti:r,listeners:[q]}),WALK.getViewer().onNodeTypeClicked(k,r))};this.removeOnNodeTypeClicked=function(k,q){var p=h.get(k);console.assert(p,"listenerMulti not registered for "+k);q=p.listeners.indexOf(q);console.assert(0<=q,"listener not registered for "+k);p.listeners.splice(q,1);0===p.listeners.length&&(WALK.getViewer().removeOnNodeTypeClicked(k,p.listenerMulti),h.delete(k))}};WALK.Extension=
function(h){function k(n){return q.definition.properties.some(function(m){return m.id===n})}var q=this;this.triggers=[];var p=[];this.definition=this.constructor.definition;this.viewerApi=WALK.getViewer();this.running=!1;var r=[];this.config=WALK.readOnlyCopy(function(n){n=WALK.cloneObject(n);if(void 0!==n.anchor&&void 0===n.trigger&&!k("anchor")&&k("trigger")){var m=n.anchor;m.icon&&m.icon.font&&(m.icon=f[m.icon.value]);n.trigger=m;n.anchor=void 0}m=$jscomp.makeIterator(q.definition.properties);
for(var l=m.next();!l.done;l=m.next())l=l.value,void 0===n[l.id]&&void 0!==l.defaultValue&&(n[l.id]=l.defaultValue);return n}(h));Object.defineProperty(this,"name",{get:function(){return this.config.name}});Object.defineProperty(this,"type",{get:function(){return this.config.type}});Object.defineProperty(this,"vrCompatible",{get:function(){return this.definition.vrCompatible},configurable:!0});this.cloneConfig=function(){return WALK.cloneObject(this.config)};this.updateConfig=function(n){this.stop();
this.config=WALK.readOnlyCopy(n);this.start()};this.doStop=this.doStart=a;this.trigger=b;this.start=function(){this.running||(this.doStart(),this.running=!0)};this.stop=function(){if(this.running){this.doStop();for(var n=$jscomp.makeIterator(p),m=n.next();!m.done;m=n.next())this.viewerApi.removeAnchor(m.value);n=$jscomp.makeIterator(r);for(m=n.next();!m.done;m=n.next())m=m.value,g.removeOnNodeTypeClicked(m[0],m[1]);r.length=0;this.triggers.length=0;p.length=0;this.running=!1}};this._vrChanged=function(n){n&&
!this.vrCompatible?this.stop():n||this.vrCompatible||this.start()};this.addTrigger=function(n,m){"node"===n.type?(n=n.nodeType,r.push([n,m]),g.onNodeTypeClicked(n,m),this.triggers.push.apply(this.triggers,$jscomp.arrayFromIterable(this.viewerApi.findNodesOfType(n)))):(m=this.viewerApi.addAnchor(n,m),m.extension=this,p.push(m),this.triggers.push(m))};this.viewerApi.onVrChange(this._vrChanged.bind(this))};WALK.Extensions.HtmlLabel=function(h){var k=this;WALK.Extension.call(this,h);var q=null,p=function(){WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping&&
(k.viewerApi.wakeAnimatedMaterials(),WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping=!1)},r=function(m){if(m instanceof HTMLVideoElement||m instanceof HTMLIFrameElement)return!0;m=$jscomp.makeIterator(m.children);for(var l=m.next();!l.done;l=m.next())if(r(l.value))return!0;return!1},n=function(){q=null;WALK.Extensions.HtmlLabel._activeLabel===k&&(WALK.Extensions.HtmlLabel._activeLabel=null,p())};this.trigger=function(m){var l=WALK.Extensions.HtmlLabel._activeLabel===this;!0===m&&l||!1===m&&
!l||(l?(console.assert(null!==q),q.close()):(WALK.Extensions.HtmlLabel._activeLabel=this,q=this.viewerApi.openPopup(this.config.content,this.config,n),m=document.createElement("div"),m.innerHTML=this.config.content,r(m)?WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping||(k.viewerApi.sleepAnimatedMaterials(),WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping=!0):p()))};this.doStart=function(){var m=this;m.viewerApi.onSceneReadyToDisplay(function(){m.config.trigger&&m.addTrigger(m.config.trigger,
function(){return m.trigger()})})};this.doStop=function(){null!==q&&q.close()}};WALK.Extensions.HtmlLabel.definition={name:"HTML label",properties:[{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"content",type:"textArea",label:"Content",optional:!0,defaultValue:"Content to display..."},{id:"centerHorizontally",type:"bool",label:"Center horizontally",defaultValue:!1},{id:"centerVertically",type:"bool",label:"Center vertically",defaultValue:!1},{id:"padding",type:"bool",label:"Padding",
defaultValue:!0}],vrCompatible:!1};WALK.Extensions.HtmlLabel._activeLabel=null;WALK.Extensions.HtmlLabel._animatedMaterialsAreSleeping=!1;WALK.Extensions.Audio=function(h){function k(){p.trigger()}function q(){var B=p.config;B.trigger&&p.addTrigger(B.trigger,k);B.menuButton&&(u=r.addMenuButton(m.src),u.addEventListener("click",k),v=r.getMenuButtonIcon(u));if(B.autoplay)p.viewerApi.onNextPageInteraction(function(){k()})}h.url&&!h.file&&(h.file={file:h.url.split("/").pop(),url:h.url},delete h.url);
h.file.path&&h.file.url&&delete h.file.url;WALK.Extension.call(this,h);var p=this,r=this.viewerApi,n=null,m=null,l=null,u=null,v=null,t=!1;this.trigger=function(B){!0===B&&t||!1===B&&!t||(t?l.pause():(p.config.playRewinds&&(l.currentTime=0),l.play()))};this.doStart=function(){WALK.log("Audio start");this.config.menuButton&&!n&&(n=WALK.preloadImage(r.getViewerAssetUrl("img/audio-on.svg")),m=WALK.preloadImage(r.getViewerAssetUrl("img/audio-off.svg")));l=document.createElement("audio");this.config.file&&
(this.config.file.path?l.src=WALK.getExtraAssetUrl(this.config.file.path):this.config.file.url&&(l.src=this.config.file.url));l.src&&(l.loop=this.config.loop,l.addEventListener("play",function(){t=!0;v&&(v.src=n.src)}),l.addEventListener("pause",function(){t=!1;v&&(v.src=m.src)}),document.body.appendChild(l),r.onSceneReadyToDisplay(q))};this.doStop=function(){WALK.log("Audio stop");t=!1;u&&(this.viewerApi.removeMenuButton(u),v=u=null);l.pause();l.remove();l=null}};WALK.Extensions.Audio.definition=
{name:"Audio",properties:[{id:"file",type:"file",label:"File",fileType:"audio"},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!1},{id:"playRewinds",type:"bool",label:"Play rewinds",defaultValue:!1},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"menuButton",type:"bool",label:"Show menu button",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.MaterialPicker=function(h){function k(){return(l.config.toReplace?[l.config.toReplace]:
[]).concat(l.config.toPick||[])}function q(){return k().map(function(B){return l.viewerApi.findMaterial(B)})}function p(B){l.viewerApi.apiUserChangeState(t,B.name)}function r(B,D){console.assert(B===t);if(B=l.viewerApi.findMaterial(D))for(D=0;D<u.length;D+=1)l.viewerApi.setMaterialForMesh(B,u[D])}function n(B,D,I){l.triggerAtPosition(void 0,D)}function m(){l.config.trigger&&l.addTrigger(l.config.trigger,n);u=l.viewerApi.findMeshesWithMaterial(l.config.toReplace||[])}WALK.Extension.call(this,h);var l=
this,u=[],v=new c(l.viewerApi,l.config.trigger),t="MaterialPicker:"+this.name;this.config.materials&&(h=WALK.cloneObject(this.config),0<h.materials.length&&(h.toReplace=h.materials[0],h.toPick=h.materials.slice(1)),h.materials=void 0,this.config=WALK.readOnlyCopy(h));l.viewerApi.isSceneReadyToDisplay()||k().map(function(B){l.viewerApi.setMaterialEditable(B)});this.trigger=function(B){!1!==B&&l.viewerApi.openMaterialPicker(q(),p)};this.triggerAtPosition=function(B,D){!1!==B&&l.viewerApi.openMaterialPicker(q(),
p,null,v.getPosition(D),v.getRadius())};this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(m);this.viewerApi.onApiUserStateChanged(t,r)};this.doStop=function(){var B=l.viewerApi.findMaterial(l.config.toReplace);B&&p(B);this.viewerApi.removeOnApiUserStateChanged(t,r)}};WALK.Extensions.MaterialPicker.VR_RADIUS=.07;WALK.Extensions.MaterialPicker.definition={name:"Material picker",properties:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toPick",type:"list",elementType:"material",
label:"Materials to pick"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.MaterialComboPicker=function(h){function k(){for(var E=new Set,K=$jscomp.makeIterator(A),H=K.next();!H.done;H=K.next()){H=$jscomp.makeIterator(H.value);for(var G=H.next();!G.done;G=H.next())G=G.value,E.add(G.toReplace),E.add(G.toUse)}return E}function q(){for(var E=[A[0][0].toReplace],K=$jscomp.makeIterator(A),H=K.next();!H.done;H=K.next())E.push(H.value[0].toUse);return E}function p(){return q().map(function(E){return z.findMaterial(E)})}
function r(){if(-1!==y)for(var E=0;E<A[y].length;++E){var K=A[y][E],H=z.findMaterial(K.toUse);K=z.findMaterial(K.toReplace);H.setUvOffsetAndScale(Q[H]);H.setUniforms();H=$jscomp.makeIterator(I[y][E]);for(var G=H.next();!G.done;G=H.next())z.setMaterialForMesh(K,G.value)}}function n(E,K){z.apiUserChangeState(M,K)}function m(E,K){console.assert(E===M);r();if(0!==K)for(y=K-1,E=0;E<A[y].length;++E){var H=A[y][E];K=z.findMaterial(H.toUse);var G=Q[K];K.setUvOffsetAndScale(G.x,G.y,G.z*(H.uvScale?H.uvScale[0]:
J[0]),G.w*(H.uvScale?H.uvScale[1]:J[1]));K.setUniforms();H=$jscomp.makeIterator(I[y][E]);for(G=H.next();!G.done;G=H.next())z.setMaterialForMesh(K,G.value)}}function l(){WALK.Extensions.MaterialComboPicker._menuPopup.close();WALK.Extensions.MaterialComboPicker._menuPopup=null}function u(){WALK.Extensions.MaterialComboPicker._pickerOpened=!1}function v(E,K,H){WALK.Extensions.MaterialComboPicker._menuPopup&&l();E=p();z.openMaterialPicker(E,n,u,T.getPosition(K),T.getRadius());WALK.Extensions.MaterialComboPicker._pickerOpened=
!0}function t(){for(var E=$jscomp.makeIterator(D.config.triggers),K=E.next();!K.done;K=E.next())D.addTrigger(K.value,v);for(E=0;E<A.length;++E){I[E]=[];K=$jscomp.makeIterator(A[E]);for(var H=K.next();!H.done;H=K.next()){H=H.value;var G=H.toUse;I[E].push(z.findMeshesWithMaterial(H.toReplace));H=z.findMaterial(G);Q.has(H)||(G=new THREE.Vector4,Q[H]=H.getUvOffsetAndScale(G))}}}function B(){var E=WALK.Extensions.MaterialComboPicker._startedPickers;console.assert(0<E.length);WALK.Extensions.MaterialComboPicker._pickerOpened&&
z.closeMaterialPicker();if(WALK.Extensions.MaterialComboPicker._menuPopup)l();else{var K=document.createElement("div");K.innerHTML='\n        <div class="ext-material-combo-picker-menu-title">\n          <img src="'+z.getViewerAssetUrl("img/sliders-horizontal.svg")+'">\n        </div>\n        <ul class="ext-material-combo-picker-menu-list">\n          <li class="ext-material-combo-picker-menu-item"></li>\n        </ul>';for(var H=K.getElementsByClassName("ext-material-combo-picker-menu-list")[0],
G=H.getElementsByClassName("ext-material-combo-picker-menu-item")[0],O={},Y=0;Y<E.length;O={$jscomp$loop$prop$picker$186:O.$jscomp$loop$prop$picker$186},++Y)0<Y&&(G=G.cloneNode(!0),H.appendChild(G)),O.$jscomp$loop$prop$picker$186=E[Y],WALK.setTextContent(G,O.$jscomp$loop$prop$picker$186.name),G.addEventListener("click",function(W){return function(){W.$jscomp$loop$prop$picker$186._openFromMenu()}}(O));WALK.Extensions.MaterialComboPicker._menuPopup=WALK.openPopup(K,{centerHorizontally:!0,centerVertically:!0},
function(){WALK.Extensions.MaterialComboPicker._menuPopup=null})}}WALK.Extension.call(this,h);var D=this,I=[],J=[1,1],Q=new Map,T=new c(D.viewerApi),M="MaterialComboPicker:"+this.name,z=this.viewerApi,A=D.config.options,y=-1;z.isSceneReadyToDisplay()||k().forEach(function(E){z.setMaterialEditable(E)});this._openFromMenu=function(){l();var E=p();z.openMaterialPicker(E,n);WALK.Extensions.MaterialComboPicker._pickerOpened=!0};this.doStart=function(){z.onSceneReadyToDisplay(t);z.onApiUserStateChanged(M,
m);var E=WALK.Extensions.MaterialComboPicker._startedPickers;E.push(this);1===E.length&&(E=z.addMenuButton(z.getViewerAssetUrl("img/sliders-horizontal.svg")),E.addEventListener("click",B),WALK.Extensions.MaterialComboPicker._menuButton=E)};this.doStop=function(){r();this.viewerApi.removeOnApiUserStateChanged(M,m);var E=WALK.Extensions.MaterialComboPicker._startedPickers;E.splice(E.indexOf(this),1);0===E.length&&(z.removeMenuButton(WALK.Extensions.MaterialComboPicker._menuButton),WALK.Extensions.MaterialComboPicker._menuButton=
null)}};WALK.Extensions.MaterialComboPicker.definition={name:"Material combo picker",hideFromEditor:!0,properties:[{id:"triggers",type:"list",label:"Triggers",elementType:"trigger"},{id:"options",type:"list",label:"Options",elementType:{type:"list",label:"option",elementType:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toUse",type:"material",label:"Material to use"},{id:"uvScale",type:"list",label:"UV Scale",elementType:"float"}]}}],vrCompatible:!0};WALK.Extensions.MaterialComboPicker._startedPickers=
[];WALK.Extensions.MaterialComboPicker._menuButton=null;WALK.Extensions.MaterialComboPicker._menuPopup=null;WALK.Extensions.MaterialComboPicker._pickerOpened=!1;WALK.Extensions.VideoTextureControl=function(h){function k(){var n=r.baseColorTexture,m=p.config;n.loop=m.loop;if(!m.autoplay)r.pause(),n.muted=m.muted;else if(!m.muted)p.viewerApi.onNextPageInteraction(function(){n.muted=!1});m.trigger&&p.addTrigger(m.trigger,function(){return p.trigger()})}function q(){var n=p.config;(r=p.viewerApi.findMaterial(n.material))?
r.baseColorTexture&&r.baseColorTexture instanceof WALK.VideoTexture?r.baseColorTexture.addLoadedListener(k):(console.error("Material '"+n.material+"' for video texture control '"+(n.name+"' does not have a video texture")),r=null):console.error("Material '"+n.material+"' for video texture control '"+(n.name+"' does not exist"))}WALK.Extension.call(this,h);var p=this,r=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.trigger=function(n){!0===
n&&r.isPlaying||!1===n&&!r.isPlaying||(r.isPlaying?r.pause():(p.config.playRewinds&&r.rewind(),r.play()))};this.doStart=function(){this.viewerApi.onSceneLoadComplete(q)};this.doStop=function(){r&&(r.baseColorTexture.muted=!0,r.pause(),r=null)}};WALK.Extensions.VideoTextureControl.definition={name:"Video texture control",properties:[{id:"material",type:"material",label:"Material with video"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},
{id:"playRewinds",type:"bool",label:"Play rewinds",defaultValue:!1},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"muted",type:"bool",label:"Muted",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.OpenWebsite=function(h){WALK.Extension.call(this,h);var k=this;this.trigger=function(){k.viewerApi.openUrl(k.config.url,k.config.newWindow)};this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(function(){k.config.trigger&&k.addTrigger(k.config.trigger,function(){return k.trigger()})})}};
WALK.Extensions.OpenWebsite.definition={name:"Open URL",properties:[{id:"url",type:"text",label:"URL"},{id:"newWindow",type:"bool",label:"New window",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.ChangeView=function(h){WALK.Extension.call(this,h);var k=this,q=0;this.trigger=function(){k.viewerApi.switchToView(k.config.views[q],void 0,k.config.doNotMoveCamera);q=(q+1)%k.config.views.length};this.doStart=function(){var p=this.viewerApi;
q=0;p.onSceneReadyToDisplay(function(){k.config.trigger&&k.addTrigger(k.config.trigger,function(){return k.trigger()})})}};WALK.Extensions.ChangeView.definition={name:"Change view",properties:[{id:"views",type:"list",elementType:"view",label:"Views to toggle"},{id:"doNotMoveCamera",type:"bool",label:"Do not move camera",defaultValue:!1},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.HideAnchors=function(h){function k(u){l.src=u?r.src:n.src}WALK.Extension.call(this,
h);var q=this,p=q.viewerApi,r=WALK.preloadImage(p.getViewerAssetUrl("img/anchors-on.svg")),n=WALK.preloadImage(p.getViewerAssetUrl("img/anchors-off.svg")),m=null,l=null;this.trigger=function(u){!0===u&&p.anchorsVisible||!1===u&&!p.anchorsVisible||(p.anchorsVisible=!p.anchorsVisible)};this.doStart=function(){p=q.viewerApi;p.onAnchorsVisibilityChanged(k);m=p.addMenuButton(r.src);l=p.getMenuButtonIcon(m);m.addEventListener("click",function(){return q.trigger()});var u=q.config;p.onSceneReadyToDisplay(function(){return p.anchorsVisible=
u.visibleOnStart})};this.doStop=function(){p.removeAnchorsVisibilityChangedListener(k);p.removeMenuButton(m);l=m=null;p.anchorsVisible=!0}};WALK.Extensions.HideAnchors.definition={name:"Hide triggers",properties:[{id:"visibleOnStart",type:"bool",label:"Visible on start",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.Script=function(h){function k(){q.trigger()}WALK.Extension.call(this,h);var q=this;this.trigger=function(){try{(new Function('"use strict"; '+q.config.code))()}catch(p){console.error("Script extension error: "+
p)}};this.doStart=function(){var p=this;if(this.config.trigger)this.viewerApi.onSceneReadyToDisplay(function(){return p.addTrigger(p.config.trigger,k)});else k()}};WALK.Extensions.Script.definition={name:"Script",properties:[{id:"code",type:"textArea",label:"Code",defaultValue:"\x3c!-- Put your JavaScript code here. If a trigger is set, the code is executed when the trigger is clicked. Otherwise the code is executed when a page is loaded --\x3e"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],
vrCompatible:!0};WALK.Extensions.ProjectionScreen=function(h){function k(){var J=I.getVideoTexture1();B.baseColorTexture=J?J:D}function q(){WALK.log("Presentation stop");I&&(I.uuid===t.myUuid&&t.stopShareScreen(),I.removeEventListener("dispose",q),I.removeEventListener("avatarUpdated",k));I=null;B.baseColorTexture=D;u.triggers[0].material.highlightMix=0}function p(){(new WALK.Popup("In a 3D meeting this trigger will start a screen sharing on the "+(u.config.material+" material. Outside of a 3D meeting the trigger will be hidden."),
{padding:!0,centerVertically:!0,centerHorizontally:!0})).open()}function r(){var J=t.myUuid;I&&I.getVideoTexture1()?I.uuid===J&&(WALK.log("Requesting presentation stop"),u.viewerApi.apiUserChangeState(v,null)):(WALK.log("Requesting screen share "+J),t.startShareScreen(function(){u.viewerApi.apiUserChangeState(v,J)},function(){u.viewerApi.apiUserChangeState(v,null)},function(){}))}function n(J,Q){console.assert(J===v);Q?(I&&I.uuid!==Q&&(WALK.log("Changing presenting user"),q()),I||(WALK.log("New presenting user "+
Q),(I=u.viewerApi.findAvatar(Q)||null)?(I.addEventListener("dispose",q),I.addEventListener("avatarUpdated",k),J=u.triggers[0].material,J.highlight=I.getMainMaterial().baseColor,J.setUniforms(),J.highlightMix=.7,k()):console.log("Cannot attach presentation stream of a user "+Q+" The user was not found."))):q()}function m(){n(v,u.viewerApi.getApiUserState(v))}function l(J){var Q=u.config;(B=u.viewerApi.findMaterial(Q.material))?(t=J,D=B.baseColorTexture,u.addTrigger(Q.trigger,r),u.viewerApi.onApiUserStateChanged(v,
n),u.viewerApi._onAvatarListChanged(m)):(console.error("Material for a projection screen is missing"),B=null)}WALK.Extension.call(this,h);var u=this,v="ProjectionScreen:"+this.name,t=null,B=null,D=null,I=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){e?u.addTrigger(u.config.trigger,p):this.viewerApi._onMeetingJoined(l)};this.doStop=function(){e||(this.viewerApi._removeOnMeetingJoined(l),t&&(this.viewerApi.removeOnApiUserStateChanged(v,
n),this.viewerApi._removeOnAvatarListChanged(m)),B=t=null)}};WALK.Extensions.ProjectionScreen.definition={name:"Meeting projection screen",properties:[{id:"material",type:"material",label:"Material to project on"},{id:"trigger",type:"trigger",label:"Trigger"}],vrCompatible:!0};WALK.Extensions.SwitchObjects=function(h){WALK.Extension.call(this,h);var k=this,q=this.viewerApi,p,r;if(!q.isSceneReadyToDisplay()){h=$jscomp.makeIterator(this.config.nodeTypes);for(var n=h.next();!n.done;n=h.next())q.setNodeTypeEditable(n.value)}this.trigger=
function(){if(0!==k.config.nodeTypes.length){for(var m=$jscomp.makeIterator(r),l=m.next();!l.done;l=m.next())l.value.hide();p+=1;if(p===k.config.nodeTypes.length){if(k.config.hideAllAfterLast){p=-1;r.length=0;q.requestFrame();return}p=0}r=q.findNodesOfType(k.config.nodeTypes[p]);m=$jscomp.makeIterator(r);for(l=m.next();!l.done;l=m.next())l.value.show();q.requestFrame()}};this.doStart=function(){var m=this;q.onSceneReadyToDisplay(function(){for(var l=0;l<m.config.nodeTypes.length;++l)if(0<l||m.config.hideAllOnStart){var u=
q.findNodesOfType(m.config.nodeTypes[l]),v=$jscomp.makeIterator(u);for(u=v.next();!u.done;u=v.next())u.value.hide()}if(0<m.config.nodeTypes.length&&!m.config.hideAllOnStart)for(p=0,r=q.findNodesOfType(m.config.nodeTypes[0]),l=$jscomp.makeIterator(r),u=l.next();!u.done;u=l.next())u.value.show();else p=-1,r=[];m.config.trigger&&m.addTrigger(m.config.trigger,function(){return k.trigger()});q.requestFrame()})};this.doStop=function(){for(var m=0;m<this.config.nodeTypes.length;++m)if(m!==p){var l=q.findNodesOfType(this.config.nodeTypes[m]);
l=$jscomp.makeIterator(l);for(var u=l.next();!u.done;u=l.next())u.value.show()}q.requestFrame()}};WALK.Extensions.SwitchObjects.definition={name:"Switch objects",properties:[{id:"nodeTypes",type:"list",elementType:"nodeType",label:"Objects to switch"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"hideAllOnStart",type:"bool",label:"Hide all on start",defaultValue:!1},{id:"hideAllAfterLast",type:"bool",label:" Hide all after last",defaultValue:!1}],vrCompatible:!0};WALK.Extensions.VideoStream=
function(h){function k(){function v(t){var B=document.createElement("video");B.classList.add("video-js");B.autoplay=!0;B.muted=!0;B.type="application/x-mpegURL";if(Hls.isSupported()){var D=new Hls;D.loadSource(t);D.attachMedia(B)}else B.canPlayType("application/vnd.apple.mpegurl")?B.src=t:console.log("No Hls support");return l.createStreamTextureFromHtmlVideo(B)}(function(){var t=v(u.config.streamUrl);t.addLoadedListener(function(){m=!1;u.running&&(console.log(t),p=r.baseColorTexture,r.baseColorTexture=
t,u.viewerApi.onNextPageInteraction(function(){t.muted=!1}),n=!0)});m=!0;t.play();return!0})()}function q(){var v=u.config;(r=l.findMaterial(v.material))?r.baseColorTexture?WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/Hls.js"),function(){v.trigger&&u.addTrigger(v.trigger,function(){return u.trigger()});!v.autoplay&&v.trigger||u.trigger()},function(){return WALK.USER_MSG.error("Cannot load required library")}):(console.error("Material '"+v.material+"' for stream texture control '"+(v.name+
"' does not have a stream texture")),r=null):console.error("Material '"+v.material+"' for stream texture control '"+(v.name+"' does not exist"))}WALK.Extension.call(this,h);var p=null,r=null,n=!1,m=!1,l=WALK.getViewer(),u=this;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.trigger=function(v){m||(n||m?!0===v&&r.isPlaying||!1===v&&!r.isPlaying||(r.isPlaying?r.pause():(u.config.playRewinds&&r.rewind(),r.play())):!1!==v&&k())};this.doStart=function(){this.viewerApi.onSceneLoadComplete(q)};
this.doStop=function(){if(r){if(n){n=!1;var v=r.baseColorTexture;r.baseColorTexture=p;v.dispose();p=null}r=null}}};WALK.Extensions.VideoStream.definition={name:"Video Stream",properties:[{id:"material",type:"material",label:"Material with stream"},{id:"streamUrl",type:"text",label:"Stream URL"},{id:"trigger",type:"trigger",label:"Trigger",defaultValue:!1,optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},{id:"playRewinds",type:"bool",label:"Play rewinds",defaultValue:!1}],vrCompatible:!0};
WALK.Extensions.MultiTrigger=function(h){function k(){return r.config.extensions.map(function(l){var u=$jscomp.makeIterator(d(l));l=u.next().value;u=u.next().value;return n.getExtension(l,u)}).filter(function(l){return l})}function q(l,u,v){l=$jscomp.makeIterator(k());for(v=l.next();!v.done;v=l.next()){v=v.value;try{v.triggerAtPosition?v.triggerAtPosition(m,u):v.trigger(m)}catch(t){console.error("Failed to trigger an extension "+t)}}m=!m}function p(){var l=r.config;l.trigger&&r.addTrigger(l.trigger,
q)}WALK.Extension.call(this,h);var r=this,n=this.viewerApi,m=!0;Object.defineProperty(this,"vrCompatible",{get:function(){for(var l=$jscomp.makeIterator(k()),u=l.next();!u.done;u=l.next())if(!u.value.vrCompatible)return!1;return!0}});this.doStart=function(){n.onSceneReadyToDisplay(p);m=!0}};WALK.Extensions.MultiTrigger.definition={name:"Multi trigger",getListElementsToAdd:function(h,k,q){console.assert("extensions"===h);var p=new Set(k.map(function(r){return d(r)[0]}));return q.getEditableExtensions().filter(function(r){return r.trigger!==
b&&("VideoTextureControl"===r.type||"SwitchObjects"===r.type||!p.has(r.type))}).map(function(r){return r.type+":"+r.name})},formatListElement:function(h){var k=$jscomp.makeIterator(d(h));h=k.next().value;k=k.next().value;return WALK.ExtensionManager.getExtensionDefinition(h).name+": "+k},properties:[{id:"extensions",type:"list",elementType:"string",label:"Extensions to trigger",elementLabel:"extension"},{id:"trigger",type:"trigger",label:"Trigger",defaultValue:!1,optional:!0}]}})();var MeetingUiUtils$$module$extensions$MeetingUiUtils={};
(function(){function a(d){d.style.display=""}function b(d){d.style.display="none"}function c(d){var e=null,f=null;this.showDismiss=!0;this.onDismiss=this.onClose=null;this.position=c.DEFAULT;this.modal=this.foremost=!1;this.open=function(){null===f&&(this.modal?(e=document.createElement("div"),e.className="modal-backdrop",document.body.appendChild(e),f=document.createElement("div"),e.appendChild(f)):(f=document.createElement("div"),document.body.appendChild(f)),this.update(d))};this.hide=function(){e?
b(e):b(f)};this.unhide=function(){e?a(e):a(f)};this.update=function(g){var h=this,k=this.showDismiss?'<div class="ext-popup-close-button-panel ui-close-hoverable">\n           <div class="ext-popup-close-button"></div>\n         </div>':"",q=function(){switch(h.position){case c.TOP:return"ui-top ui-center";case c.DEFAULT:return"ui-upper-half-center";case c.CENTER:return"ui-all-center";default:return console.log("Invalid popup position: "+h.position),"ui-all-center"}}();f.innerHTML='\n       <div class="ext-popup '+
q+" "+(this.foremost?"ui-foremost":"")+'">\n         <div class="ext-popup-content">\n           '+g+"\n         </div>"+k+"\n       </div>";this.showDismiss&&(f.getElementsByClassName("ext-popup-close-button-panel")[0].onclick=function(){return h.dismiss()})};this.getElementsByClassName=function(g){return f.getElementsByClassName(g)};this.dismiss=function(){if(null!==f&&(this.close(),this.onDismiss))this.onDismiss()};this.close=function(){if(null!==f&&(this.modal?(document.body.removeChild(e),e=
null):document.body.removeChild(f),f=null,this.onClose))this.onClose()}}c.CENTER="center";c.DEFAULT="default";c.TOP="top";MeetingUiUtils$$module$extensions$MeetingUiUtils={removeChildren:function(d){for(;d.firstChild;)d.removeChild(d.firstChild)},addClickHandler:function(d,e){document.getElementById(d).onclick=e},addChangeHandler:function(d,e){document.getElementById(d).onchange=e},show:a,hide:b,setVisibility:function(d,e){e?a(d):b(d)},setButtonHighlight:function(d,e){e?d.classList.add("ext-meeting-button-highlight"):
d.classList.remove("ext-meeting-button-highlight")},highlightInput:function(d){d.classList.add("ext-meeting-input-missing");window.setTimeout(function(){d.classList.remove("ext-meeting-input-missing")},200)},highlightText:function(d){d.classList.add("ext-meeting-text-highlighted");window.setTimeout(function(){d.classList.remove("ext-meeting-text-highlighted")},200)},UiPopup:c,showMessage:function(d,e){var f="";e&&(f='<h3 class="ext-meeting-dialog-title">'+e+"</h3>");var g=new c(f+('\n      <div class="ext-meeting-dialog-message">\n        '+
d+'\n      </div>\n      <div class="ext-meeting-dialog-buttons">\n        <button class="ext-meeting-button">\n          Close\n        </button>\n      </div>\n    '));g.showDismiss=!1;g.foremost=!0;g.modal=!0;g.open();g.getElementsByClassName("ext-meeting-button")[0].onclick=function(){g.close()}},showIframePopup:function(d,e,f){var g=new c('\n      <div class="ext-meeting-dialog-iframe-container">\n        <h3 class="ext-meeting-dialog-title">'+d+'</h3>\n        <iframe src="'+e+'" class="ext-meeting-dialog-iframe">\n        </iframe>\n        <div>\n          <div class="ext-meeting-dialog-buttons">\n            <button class="ext-meeting-button">\n              Close\n            </button>\n          </div>\n        </div>\n      <div>\n    ');
g.showDismiss=!1;g.position=c.CENTER;g.onClose=f;g.open();var h=g.getElementsByClassName("ext-meeting-dialog-iframe")[0];h.style.visibility="hidden";h.onload=function(){h.style.visibility="visible"};g.getElementsByClassName("ext-meeting-button")[0].onclick=function(){return g.close()}}}})();var module$extensions$MeetingUiUtils={get MeetingUiUtils(){return MeetingUiUtils$$module$extensions$MeetingUiUtils}};var SoundUtils$$module$extensions$SoundUtils={};
(function(){function a(){null===b&&(b=new (window.AudioContext||window.webkitAudioContext));return b}var b=null,c=function(e,f,g){this._frequencyDiv=f;this._noSoundThreshold=g;this._maxFrequencyIndex=this._minFrequencyIndex=-1;this._noSoundCalls=0;this._source=null;this._analyser=a().createAnalyser();this._analyser.fftSize=2*this._frequencyDiv;this._analyser.smoothingTimeConstant=.5;e=new MediaStream([e.mediaStreamTrack]);this._source=a().createMediaStreamSource(e);this._source.connect(this._analyser);
e=a().sampleRate/this._frequencyDiv;this._minFrequencyIndex=Math.floor(c._minVoiceFrequency/e);this._maxFrequencyIndex=Math.floor(c._maxVoiceFrequency/e);this._dataArray=new Uint8Array(this._maxFrequencyIndex+1)};c.prototype.measureSoundVolume=function(){var e=this._getOverallSoundVolume();return this._shouldSkipNoSoundNotification(e)?null:e};c.prototype.dispose=function(){null!==this._source&&(this._source.disconnect(),this._source=null)};c.prototype._getOverallSoundVolume=function(){this._analyser.getByteFrequencyData(this._dataArray);
for(var e=0,f=this._minFrequencyIndex;f<=this._maxFrequencyIndex;f++)this._dataArray[f]>e&&(e=this._dataArray[f]);return e};c.prototype._shouldSkipNoSoundNotification=function(e){if(e<this._noSoundThreshold)return this._noSoundCalls++,this._noSoundCalls<c._skippedNoSoundCalls;this._noSoundCalls=0;return!1};c._minVoiceFrequency=85;c._maxVoiceFrequency=350;c._skippedNoSoundCalls=3;var d=function(e,f,g,h){this._width=e;this._height=f;this._bottomMargin=void 0!==h?h:0;this._volumeRect=null;this._rectId=
d._baseRectId+d._counter;d._counter++;this._noSoundThreshold=g;this._lengthCoef=e/(255-this._noSoundThreshold)};d.prototype.getHTML=function(){this._volumeRect=null;return'\n        <svg style="filter: drop-shadow(0px 0px 1px black);\n                    margin-bottom: '+this._bottomMargin.toString()+'px;"\n             width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n          <rect id="'+this._rectId+'"\n                x = "'+(this._width/2-1).toString()+
'" y = "0"\n                width="'+(1).toString()+'"\n                height="'+this._height.toString()+'"\n                fill="red"/>\n        </svg>\n      '};d.prototype.getEmptyHTML=function(){return'\n        <svg width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n        </svg>\n      '};d.prototype.update=function(e){null===this._volumeRect&&(this._volumeRect=document.getElementById(this._rectId));console.assert(null!==this._volumeRect,"Volume visualizer HTML not attached to any element");
if(null!==e){var f=this._getColor(e),g=Math.max(d._minimalDisplayedValue,Math.max(e,this._noSoundThreshold)-this._noSoundThreshold);e=this._width/2-g*this._lengthCoef/2;g*=this._lengthCoef;this._volumeRect.setAttribute("fill",f);this._volumeRect.setAttribute("x",e.toString());this._volumeRect.setAttribute("width",g.toString())}};d.prototype._getColor=function(e){return e<this._noSoundThreshold?"red":e<d._lowSoundThreshold?"orange":"green"};d._counter=0;d._baseRectId="ext-meeting-mic-bar-";d._lowSoundThreshold=
180;d._minimalDisplayedValue=20;SoundUtils$$module$extensions$SoundUtils={VolumeMeter:c,VolumeVisualizer:d}})();var module$extensions$SoundUtils={get SoundUtils(){return SoundUtils$$module$extensions$SoundUtils}};var MeetingStarter$$module$extensions$MeetingStarter;
(function(){function a(p,r){return p?r[0].toUpperCase()+r.slice(1):r[0].toLowerCase()+r.slice(1)}function b(p,r){var n=void 0!==r;n=a(!0,p.name)+(n?" and "+a(!1,r.name):"");p=p.error.name;console.assert(void 0===r||r.error.name===p);return"NotFoundError"===p?n+" not found":"NotAllowedError"===p?n+" blocked":"Error"===p?"Error":n+" not available"}function c(p,r){var n=void 0!==r,m=n?"they are":"it is",l=n?"them":"it",u=p.error.name;return"NotFoundError"===u?"Check if your "+(a(!1,p.name)+(n?" and "+
a(!1,r.name):""))+" "+(n?"are":"is")+" properly connected.":"NotAllowedError"===u?WALK.DETECTOR.mobile?WALK.DETECTOR.ios?"Unblock "+l+" by clicking "+(n?p.unblockIcon+" and "+r.unblockIcon:"the "+p.unblockIcon)+" "+(n?"buttons":"button")+".":"Unblock "+l+" in the browser settings for this webpage.":"Unblock "+l+" by clicking the "+(n?r.unblockIcon:p.unblockIcon)+" button in the browser\u2019s address bar and refresh the webpage.":"Error"===u?"Your browser doesn't support video meetings. Open the meeting link in another browser.":
"If "+m+" connected, close all other applications using "+(l+" and refresh the webpage.")}var d={name:"mic"},e={name:"camera",facingMode:"user"},f=function(p,r,n,m){this._firstErrorDiv=document.getElementById(p);this._secondErrorDiv=document.getElementById(r);this._devicePreview1=n;this._devicePreview2=m};f.prototype._reset=function(){this._devicePreview1.setErrorDiv(null);this._devicePreview2.setErrorDiv(null);MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(this._firstErrorDiv);MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(this._secondErrorDiv)};
f.prototype._displayAndLogErrorMessage=function(p,r,n){function m(v){if(void 0!==v)return v.device}var l=b(r.device,m(n)),u=c(r.device,m(n));p.innerHTML='\n        <div class="ext-meeting-join-error-title">'+l+'</div>\n        <div class="ext-meeting-join-error-description">'+u+"</div>\n      ";r.setErrorDiv(p);r.device.logError();void 0!==n&&(n.setErrorDiv(p),n.device.logError())};f.prototype.update=function(){this._reset();var p=this._devicePreview1.device.error,r=this._devicePreview2.device.error;
if(null!==p||null!==r)null!==p&&null!==r?p.name===r.name?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1,this._devicePreview2):(this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1),this._displayAndLogErrorMessage(this._secondErrorDiv,this._devicePreview2)):null!==p?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1):this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview2)};var g=function(p,r){this._name=p;this._active=
!1;this._unblockIcon=r;this._error=this._track=this._trackOptions=null};g.prototype.logError=function(){null!==this._error&&WALK.log("Can't create local "+this.name+" track : "+(this._error.name+", "+this._error.message))};g.prototype._getLabel=function(){return this._track?this._track.mediaStreamTrack.label:null};g.prototype.getId=function(){return this._trackOptions&&this._trackOptions.deviceId?this._trackOptions.deviceId.exact:null};g.prototype.getErrorMessageInfo=function(){if(null===this._error)return null;
var p=b(this),r=c(this);return{title:p,description:r}};$jscomp.global.Object.defineProperties(g.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},track:{configurable:!0,enumerable:!0,get:function(){return this._track},set:function(p){this._track=p}},active:{configurable:!0,enumerable:!0,get:function(){return this._active},set:function(p){this._active=p}},unblockIcon:{configurable:!0,enumerable:!0,get:function(){return this._unblockIcon}},error:{configurable:!0,enumerable:!0,
get:function(){return this._error},set:function(p){this._error=p}},trackOptions:{configurable:!0,enumerable:!0,get:function(){return this._trackOptions},set:function(p){this._trackOptions=p}}});var h=function(p,r,n,m,l,u,v){this._device=new g(p,v);this._width=n;this._height=m;this._toggleButton=document.getElementById(l);this._previewContainer=document.getElementById(u);this._errorDiv=null;this._meetingStarter=r;MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler(this._toggleButton.id,
this._onToggleButtonClicked.bind(this));this._onStoppedBound=this._onStopped.bind(this);this._twilioCreateTrackFunction=null};h.prototype.isAvailable=function(){return null!==this._device.track};h.prototype.dispose=function(){null!==this._device.track&&this._device.track.removeListener("stopped",this._onStoppedBound);this._close()};h.prototype._pauseMonitoringTrackBeforeReset=function(){this._device.track.removeListener("stopped",this._onStoppedBound)};h.prototype._resumeMonitoringTrackAfterReset=
function(){this._device.track.addListener("stopped",this._onStoppedBound)};h.prototype.setErrorDiv=function(p){this._errorDiv=p};h.prototype.showInTestNeededMode=function(){this.setError({name:"Test needed"})};h.prototype.showInPreviewMode=function(){this.setError({name:"Initializing"});this.setToggleButtonVisibility(!0)};h.prototype.createTrack=function(p){var r=this;return new Promise(function(n,m){var l=p?p:r._device.trackOptions;r._twilioCreateTrackFunction(WALK.cloneObject(l)).then(function(u){r.setTrack(u,
l)}).catch(function(u){r.setTrack(null,l,u)}).finally(function(){r._toggleButton.disabled=!1;n()})})};h.prototype.updateTrackDeviceId=function(p){var r=function(m,l){return(m=m.find(function(u){return u.label===l}))?m.deviceId:null};if(this._device.track&&!this._device.trackOptions.deviceId){var n=this._device._getLabel();p=r(p,n);console.assert(null!==p,"deviceId not found");this._device.trackOptions={name:this._device.trackOptions.name,deviceId:{exact:p}}}};h.prototype.setTrack=function(p,r,n){r&&
(this._device.trackOptions=r);null!==p&&void 0!==n?console.assert("Invalid setTrack parameters : track and error set"):null===p&&void 0===n&&console.assert("Invalid setTrack parameters : track and error not set");this._disposeTrack();this._device.track=p;null!==this._device.track?(this._device.track.on("stopped",this._onStoppedBound),this._device.active=!0,this._showTrack(),this.setError(null)):(this._device.active=!1,this._hideTrack(),this.setError(n));this._meetingStarter.updateErrorMessage();this._updateToggleButtonState()};
h.prototype.setError=function(p){this._device.error=p};h.prototype.restartTrack=function(p){var r=this;this._toggleButton.disabled=!0;this.isAvailable()?(this._pauseMonitoringTrackBeforeReset(),this._device.trackOptions=p,this._device.track.restart(WALK.cloneObject(p)).then(function(){r._resumeMonitoringTrackAfterReset();r._meetingStarter.updateErrorMessage();r._toggleButton.disabled=!1}).catch(function(n){WALK.log("Second attempt to create track,device: "+r._device.name);window.setTimeout(function(){return r.createTrack(p)},
1E3)})):this.createTrack(p)};h.prototype.setToggleButtonVisibility=function(p){MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton,p)};h.prototype._updateToggleButtonState=function(){this._device.active?(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(this._toggleButton,!1),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[0],!0),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[1],
!1)):(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(this._toggleButton,!0),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[0],!1),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[1],!0))};h.prototype._disposeTrack=function(){if(null!==this._device.track){var p=this._device.track;p.removeListener("stopped",this._onStoppedBound);p.detach();p.stop()}this._device.track=null};h.prototype._onStopped=
function(){null!==this._device.track&&this.setTrack(null,null,{name:"NotReadableError",message:"Stopped"})};h.prototype._close=function(){MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(this._previewContainer)};h.prototype._setPreviewInnerHTML=function(p){this._close();this._previewContainer.innerHTML=p;MeetingUiUtils$$module$extensions$MeetingUiUtils.show(this._previewContainer)};h.prototype._setPreviewElement=function(p){this._close();null!==p&&(p.style.width=this._width.toString()+
"px",p.style.height=this._height.toString()+"px",this._previewContainer.appendChild(p),MeetingUiUtils$$module$extensions$MeetingUiUtils.show(this._previewContainer))};h.prototype._showTrack=function(){this._device.active=!0;this._device.track.enable()};h.prototype._hideTrack=function(){this._device.active=!1};h.prototype._onToggleButtonClicked=function(){var p=this;this.isAvailable()?(this._device.active?this._onSwitchOff():this._onSwitchOn(),this._updateToggleButtonState()):this.createTrack().then(function(){p._device.error&&
MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightText(p._errorDiv)})};h.prototype._onSwitchOff=function(){this._hideTrack();this._device.track.disable()};h.prototype._onSwitchOn=function(){this._showTrack();this._device.track.enable()};$jscomp.global.Object.defineProperties(h.prototype,{device:{configurable:!0,enumerable:!0,get:function(){return this._device}}});var k=function(p,r,n,m,l){p=h.call(this,"Camera",p,r,n,m,l,'<span class="fa-video-slash"></span>')||this;p._twilioCreateTrackFunction=
Twilio.Video.createLocalVideoTrack;p._device.trackOptions=e;return p};$jscomp.inherits(k,h);k.prototype.showInTestNeededMode=function(){h.prototype.showInTestNeededMode.call(this);this._showPlaceholder()};k.prototype.showInPreviewMode=function(){h.prototype.showInPreviewMode.call(this);this._showPlaceholder()};k.prototype._showPlaceholder=function(){this._setPreviewInnerHTML('\n        <div class="ext-meeting-join-camera-preview-placeholder">\n          <span class="fa-video absolute-center"></span>\n        </div>\n      ')};
k.prototype._hideTrack=function(){h.prototype._hideTrack.call(this);this._showPlaceholder()};k.prototype._showTrack=function(){h.prototype._showTrack.call(this);this._setPreviewElement(this._device.track.attach())};k.prototype._onSwitchOff=function(){h.prototype._onSwitchOff.call(this);this.setTrack(null,null,null)};var q=function(p,r,n,m,l){p=h.call(this,"Microphone",p,r,n,m,l,'<span class="fa-microphone-slash"></span>')||this;p._noSoundThreshold=80;p._volumeVisualizer=new SoundUtils$$module$extensions$SoundUtils.VolumeVisualizer(r,
n,p._noSoundThreshold);p._volumeMeter=null;p._measurementIntervalId=null;p._twilioCreateTrackFunction=Twilio.Video.createLocalAudioTrack;p._device.trackOptions=d;return p};$jscomp.inherits(q,h);q.prototype.showInTestNeededMode=function(){h.prototype.showInTestNeededMode.call(this);this._setPreviewElement(null)};q.prototype.showInPreviewMode=function(){h.prototype.showInPreviewMode.call(this);this._setPreviewElement(null)};q.prototype.dispose=function(){this._isMeasurementActive()&&this._stopMeasurement();
h.prototype.dispose.call(this)};q.prototype._measure=function(){this._volumeVisualizer.update(this._volumeMeter.measureSoundVolume())};q.prototype._hideTrack=function(){h.prototype._hideTrack.call(this);this._isMeasurementActive()&&this._stopMeasurement();this._setPreviewElement(null)};q.prototype._showTrack=function(){h.prototype._showTrack.call(this);this._setPreviewInnerHTML(this._volumeVisualizer.getHTML());this._startMeasurement()};q.prototype._startMeasurement=function(){var p=this;this._volumeMeter=
new SoundUtils$$module$extensions$SoundUtils.VolumeMeter(this._device.track,512,this._noSoundThreshold);this._measurementIntervalId=setInterval(function(){return p._measure()})};q.prototype._stopMeasurement=function(){clearInterval(this._measurementIntervalId);this._measurementIntervalId=null;this._volumeMeter.dispose();this._volumeMeter=null};q.prototype._isMeasurementActive=function(){return null!==this._measurementIntervalId};q.prototype._pauseMonitoringTrackBeforeReset=function(){h.prototype._pauseMonitoringTrackBeforeReset.call(this);
this._isMeasurementActive()&&this._stopMeasurement()};q.prototype._resumeMonitoringTrackAfterReset=function(){h.prototype._resumeMonitoringTrackAfterReset.call(this);this._startMeasurement()};q.prototype._disposeTrack=function(){this._isMeasurementActive()&&this._stopMeasurement();h.prototype._disposeTrack.call(this)};MeetingStarter$$module$extensions$MeetingStarter=function(p){this._onJoinCallback=p;this._joinMode=!1;this._micVolumePreview=this._cameraPreview=this._dialog=null;this._cameraPreviewHeight=
198;this._cameraPreviewWidth=264;this._micVolumePreviewHeight=4;this._micVolumePreviewWidth=40;this._onDevicesChangedBound=this._onDevicesChanged.bind(this);this._errorMessageActive=!0};MeetingStarter$$module$extensions$MeetingStarter.prototype.show=function(){var p=this;this._blurHelp();this._createDialog();this._cameraPreview=new k(this,this._cameraPreviewWidth,this._cameraPreviewHeight,"ext-meeting-join-camera-toggle","ext-meeting-join-camera-preview-container");this._micVolumePreview=new q(this,
this._micVolumePreviewWidth,this._micVolumePreviewHeight,"ext-meeting-join-mic-toggle","ext-meeting-join-mic-volume-container");this._errorMessageGenerator=new f("ext-meeting-join-first-error","ext-meeting-join-second-error",this._micVolumePreview,this._cameraPreview);this._setupDevicesSelection();this._checkPermissions().then(function(){p._runPreviewMode(!1);p._createMediaTracksSeparately(e,d,function(){return p._onMediaInitialized()})}).catch(function(r){void 0!==r&&WALK.log("Error checking audio/video devices permissions: "+
r.name+": "+r.message);p._runTestNeededMode()})};MeetingStarter$$module$extensions$MeetingStarter.prototype._checkPermissions=function(){return new Promise(function(p,r){return navigator.mediaDevices.enumerateDevices().then(function(n){var m=n.filter(function(l){return"audioinput"===l.kind&&""!==l.deviceId&&""!==l.label});n=n.filter(function(l){return"videoinput"===l.kind&&""!==l.deviceId&&""!==l.label});0<m.length||0<n.length?p():r()}).catch(function(n){r(n)})})};MeetingStarter$$module$extensions$MeetingStarter.prototype._setupDevicesSelection=
function(){var p=this;MeetingUiUtils$$module$extensions$MeetingUiUtils.addChangeHandler("ext-meeting-join-select-camera",function(r){p._cameraPreview.restartTrack({name:"camera",deviceId:{exact:r.currentTarget.value}})});MeetingUiUtils$$module$extensions$MeetingUiUtils.addChangeHandler("ext-meeting-join-select-microphone",function(r){p._micVolumePreview.restartTrack({name:"mic",deviceId:{exact:r.currentTarget.value}})});navigator.mediaDevices.addEventListener("devicechange",this._onDevicesChangedBound)};
MeetingStarter$$module$extensions$MeetingStarter.prototype._onDevicesChanged=function(){if(this._joinMode){var p=this._cameraPreview.device.error,r=this._micVolumePreview.device.error;p||r?this._createMediaTracksSeparately(p?e:null,r?d:null):this._fillDevicesSelectControls()}};MeetingStarter$$module$extensions$MeetingStarter.prototype._fillDevicesSelectControls=function(){var p=this;navigator.mediaDevices.enumerateDevices().then(function(r){p._cameraPreview.updateTrackDeviceId(r);p._micVolumePreview.updateTrackDeviceId(r);
var n=r.filter(function(m){return"audioinput"===m.kind});p._fillDevicesSelectControl(n,"ext-meeting-join-select-microphone-container","ext-meeting-join-select-microphone",p._micVolumePreview.device.getId());r=r.filter(function(m){return"videoinput"===m.kind});p._fillDevicesSelectControl(r,"ext-meeting-join-select-camera-container","ext-meeting-join-select-camera",p._cameraPreview.device.getId())})};MeetingStarter$$module$extensions$MeetingStarter.prototype._fillDevicesSelectControl=function(p,r,n,
m){r=document.getElementById(r);var l=document.getElementById(n);MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(r,1<p.length);MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(l);1<p.length&&(p.forEach(function(u){var v=document.createElement("option");v.value=""+u.deviceId;WALK.setTextContent(v,""+u.label);l.appendChild(v)}),l.value=m)};MeetingStarter$$module$extensions$MeetingStarter.prototype._createDialog=function(){var p=this;this._dialog=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup('\n        <h3 class="ext-meeting-dialog-title">Join 3D meeting</h3>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-name-label">\n            Name:\n          </div>\n          <input type="text" id="ext-meeting-join-name"\n                 class="ext-meeting-join-input"\n                 autocomplete="off">\n          </input>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div class="ext-meeting-join-main-container">\n            <div id="ext-meeting-join-error-container"\n                 class="absolute-vertical-center">\n              <div id="ext-meeting-join-first-error"></div>\n              <div id="ext-meeting-join-second-error"></div>\n            </div>\n            <div id="ext-meeting-join-camera-preview-container"></div>\n            <div id="ext-meeting-join-mic-volume-container"></div>\n            <div id="ext-meeting-join-preview-toggle-container"\n                 class="absolute-horizontal-center">\n              <button id="ext-meeting-join-mic-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-microphone" style="display: none"></span>\n                <span class="fa-microphone-slash"></span>\n              </button>\n              <button id="ext-meeting-join-camera-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-video" style="display: none"></span>\n                <span class="fa-video-slash"></span>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-select-camera-container"\n               style="display: none">\n            Camera:\n            <select id="ext-meeting-join-select-camera"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n          <div id="ext-meeting-join-select-microphone-container"\n               style="display: none">\n            Microphone:\n            <select id="ext-meeting-join-select-microphone"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n        </div>\n        <div id="ext-meeting-join-button-container"\n             class="ext-meeting-join-row">\n          <button id="ext-meeting-join-button"\n                  class="ext-meeting-button ext-meeting-dialog-buttons">\n                  Join\n          </button>\n        </div>\n        <div class="ext-meeting-join-footer">\n          By joining, you agree to the\n          <span id="terms-of-service-link" class="ext-meeting-terms-link"><u>\n            Terms of Service </u></span> and\n          <span id="privacy-policy-link" class="ext-meeting-terms-link"><u>\n            Privacy Policy</u></span>.\n        </div>\n      ');
this._dialog.showDismiss=!1;this._dialog.foremost=!0;this._dialog.open();document.getElementById("terms-of-service-link").onclick=function(){p._dialog.hide();MeetingUiUtils$$module$extensions$MeetingUiUtils.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Terms of Service","https://www.shapespark.com/terms#in-viewer",function(){return p._dialog.unhide()})};document.getElementById("privacy-policy-link").onclick=function(){p._dialog.hide();MeetingUiUtils$$module$extensions$MeetingUiUtils.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Privacy Policy",
"https://www.shapespark.com/privacy#in-viewer",function(){return p._dialog.unhide()})};this._initializeDisplayName()};MeetingStarter$$module$extensions$MeetingStarter.prototype._createMediaTracksSeparately=function(p,r,n){var m=this,l=function(){m._fillDevicesSelectControls();m._errorMessageActive=!0;m.updateErrorMessage();n&&n()};this._errorMessageActive=!1;p&&r?this._cameraPreview.createTrack(p).then(function(){return m._micVolumePreview.createTrack(r)}).then(function(){l()}):p?this._cameraPreview.createTrack(p).then(function(){l()}):
this._micVolumePreview.createTrack(r).then(function(){l()})};MeetingStarter$$module$extensions$MeetingStarter.prototype._runTestNeededMode=function(){this._setTestNeededMode();this._cameraPreview.showInTestNeededMode();this._micVolumePreview.showInTestNeededMode()};MeetingStarter$$module$extensions$MeetingStarter.prototype._runPreviewMode=function(p){this._setPreviewMode(p);p?(this._cameraPreview.setToggleButtonVisibility(!0),this._micVolumePreview.setToggleButtonVisibility(!0)):(this._cameraPreview.showInPreviewMode(),
this._micVolumePreview.showInPreviewMode())};MeetingStarter$$module$extensions$MeetingStarter.prototype._onCreateMediaTracks=function(p,r,n){var m=p.filter(function(l){return"audio"===l.kind});p=p.filter(function(l){return"video"===l.kind});this._errorMessageActive=!1;0<m.length?this._micVolumePreview.setTrack(m[0],r):this._micVolumePreview.setTrack(null,r,{name:"Unknown error",message:""});0<p.length?this._cameraPreview.setTrack(p[0],n):this._cameraPreview.setTrack(null,n,{name:"Unknown error",message:""});
this._errorMessageActive=!0;this.updateErrorMessage();this._fillDevicesSelectControls();this._runPreviewMode(!0)};MeetingStarter$$module$extensions$MeetingStarter.prototype._testCamera=function(){var p=this,r={audio:WALK.cloneObject(d),video:WALK.cloneObject(e)};Twilio.Video.createLocalTracks(r).then(function(n){p._onCreateMediaTracks(n)}).catch(function(n){p._createMediaTracksSeparately(e,d,function(){return p._runPreviewMode(!0)})})};MeetingStarter$$module$extensions$MeetingStarter.prototype._setTestNeededMode=
function(){var p=this;this._joinMode=!1;var r=document.getElementById("ext-meeting-join-button-container");MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(r);r.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-test-button">\n          Test camera\n        </button>\n      ';MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-test-button",function(){return p._testCamera()})};MeetingStarter$$module$extensions$MeetingStarter.prototype._setPreviewMode=
function(p){var r=this;if(!this._joinMode){this._joinMode=!0;var n=document.getElementById("ext-meeting-join-button-container");MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(n);n.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-join-button">\n          Join\n        </button>\n      ';MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-join-button",function(){return r._joinMeeting()});p||
this.setJoinButtonEnabled(!1)}};MeetingStarter$$module$extensions$MeetingStarter.prototype._onMediaInitialized=function(){this.setJoinButtonEnabled(!0)};MeetingStarter$$module$extensions$MeetingStarter.prototype.setJoinButtonEnabled=function(p){document.getElementById("ext-meeting-join-button").disabled=!p};MeetingStarter$$module$extensions$MeetingStarter.prototype._initializeDisplayName=function(){var p=document.getElementById("ext-meeting-join-name"),r=localStorage.getItem("extMtgDisplayName");
r&&(p.value=r);p.focus();p.select()};MeetingStarter$$module$extensions$MeetingStarter.prototype._checkDisplayName=function(){var p=document.getElementById("ext-meeting-join-name"),r=p.value.trim();if(r)return r;MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightInput(p)};MeetingStarter$$module$extensions$MeetingStarter.prototype._blurHelp=function(){document.getElementById("help-and-primary-progress").classList.add("ui-blur")};MeetingStarter$$module$extensions$MeetingStarter.prototype._unblurHelp=
function(){var p=document.getElementById("help-and-primary-progress");p.classList.remove("ui-blur");p.classList.add("ui-unblur")};MeetingStarter$$module$extensions$MeetingStarter.prototype._joinMeeting=function(){var p=this._checkDisplayName();if(void 0!==p){localStorage.setItem("extMtgDisplayName",p);var r=this._micVolumePreview.device,n=this._cameraPreview.device;this._dispose();this._onJoinCallback(p,r,n)}};MeetingStarter$$module$extensions$MeetingStarter.prototype.updateErrorMessage=function(){this._errorMessageActive&&
this._errorMessageGenerator.update()};MeetingStarter$$module$extensions$MeetingStarter.prototype._dispose=function(){this._dialog.close();this._unblurHelp();navigator.mediaDevices.removeEventListener("devicechange",this._onDevicesChangedBound);this._cameraPreview.dispose();this._micVolumePreview.dispose();this._micVolumePreview=this._cameraPreview=this._dialog=null}})();var module$extensions$MeetingStarter={get MeetingStarter(){return MeetingStarter$$module$extensions$MeetingStarter}};(function(){function a(){var y=window.location.hostname;return y.endsWith(".shapespark.com")?"https://cloud"+y.substr(y.indexOf(".")):y.endsWith(".shapespark.com.cn")?"https://cloud.shapespark.com.cn":WALK.DEVEL_MEETING_CLOUD_URL||"https://cloud.shapespark.com"}function b(y){y=new Date(y);var E=new Date;return E.getDate()===y.getDate()&&E.getMonth()===y.getMonth()&&E.getFullYear()===y.getFullYear()?y.toLocaleTimeString():y.toLocaleDateString()+" "+y.toLocaleTimeString()}function c(y,E,K,H){var G=
document.createElement("li");G.classList.add("ext-meeting-list-entry");var O=G.appendChild(document.createElement("span"));O.classList.add("ext-meeting-list-name");O.innerText=y;O.style.color=K;H&&(G.onclick=H,G.style.cursor="pointer");E&&(G.appendChild(document.createElement("br")),y=G.appendChild(document.createElement("small")),y.innerText=E,y.style.color="white");return G}function d(y,E,K){return{color:"#0775e8",icon:"edit",opacity:1,position:[y,E,K],radius:.07,type:"sphere"}}function e(y,E,K,
H){H=void 0===H?!0:H;var G=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup("<div>\n         "+y+'\n       </div>\n       <div class ="ext-meeting-dialog-buttons">\n         <button class="ext-meeting-dialog-ok ext-meeting-button">\n           '+E+"\n         </button>\n         "+(H?'<button class="ext-meeting-dialog-cancel ext-meeting-button">\n         Cancel\n        </button>':"")+"\n       </div>");G.showDismiss=!1;G.open();H&&(G.getElementsByClassName("ext-meeting-dialog-cancel")[0].onclick=
function(){return G.dismiss()});G.getElementsByClassName("ext-meeting-dialog-ok")[0].onclick=function(){G.close();K()}}function f(y,E){E=E.attach();y=y.createTextureFromHtmlVideo(E);y.play();return y}function g(y){y.detach().forEach(function(E){return E.remove()})}function h(y){return y&&y.isStarted&&y.isEnabled&&!y.isStopped}function k(y,E,K){this._viewer=y;this._uuid=E;y=parseInt(E.substring(2));this._color=WALK.AVATAR_COLORS[y%WALK.AVATAR_COLORS.length];this._twilioParticipant=this._avatar=this._displayName=
null;this._lastRenderedPosition=[];this._lastRenderedPositionLength=0;this._audioTrack=this._screenTrack=this._cameraTrack=this._micTrack=this._dataTrack=null;this._noSoundThreshold=80;this._soundVolumeUpdatesScheduler=K;this._volumeVisualizer=new SoundUtils$$module$extensions$SoundUtils.VolumeVisualizer(20,3,this._noSoundThreshold,3);this._volumeMeter=null}function q(y,E,K,H,G,O){k.call(this,y,E,H,!0);this._displayName=K;this._setUpAvatar();this._avatar.hideBody();this._isPublishingTracksDuringConnecting=
!1;this._dataTrack=new Twilio.Video.LocalDataTrack({name:"data",maxPacketLifeTime:1E3});this._isCreatingCameraTrack=this._isCreatingMicTrack=!1;this._micDevice=G;this._cameraDevice=O;this._micTrack=this._micDevice.track;null!==this._micTrack&&this._subscribeToMicEvents();this._updateSoundMeasurementState();this._cameraTrack=this._cameraDevice.track;null!==this._cameraTrack&&(console.assert(this._cameraDevice.active,"Got inactive camera track from MeetingStarter"),this._subscribeToCameraEvents());
this._lastPosition=null;this._positionMessage=[E,K,null];this._onCameraTrackStateChanged=this._onMicTrackStateChanged=this._resendInterval=null}function p(y,E,K,H){k.call(this,y,E,K,!1);this._onUiRefreshNeeded=H;this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=this._micTrackStateChangedBound=null;this._trackSubscribedBound=this._trackSubscribed.bind(this);this._trackUnsubscribedBound=this._trackUnsubscribed.bind(this);this._disposed=!1}function r(y,E,K,H,G,O){var Y=new PubNub({publishKey:E.publishKey,
subscribeKey:E.subscribeKey,authKey:E.authKey,uuid:y.uuid,ssl:!0}),W=E.channel;Y.subscribe({channels:[W],withPresence:!0});Y.addListener({message:function(ka){WALK.log("listener received message",ka);"SceneState"===ka.message.type&&G(ka.message.state)},presence:function(ka){ka.uuid!==y.uuid&&(WALK.log("listener presence event",ka),"join"===ka.action?K(ka.uuid):"leave"===ka.action&&H(ka.uuid))},status:function(ka){"PNAccessDeniedCategory"!==ka.category&&"PNNetworkIssuesCategory"!==ka.category&&"PNNetworkDownCategory"!==
ka.category&&"PNTimeoutCategory"!==ka.category||O(ka.category)}});Y.hereNow({channels:[W],includeUUIDs:!0,includeState:!0},function(ka,la){WALK.log("herenow",ka,la);la.channels[W].occupants.forEach(function(oa){oa.uuid!==y.uuid&&K(oa.uuid)})});this.dispose=function(){Y.unsubscribeAll()}}function n(y,E,K,H,G,O,Y){function W(R){var Z=R.identity.match(/^u-\d+/);Z=Z&&Z[0];return Z?Z:(WALK.warn("Unknown participant",R.identity),null)}function ka(R){WALK.log('Participant "%s" connected',R.identity);var Z=
W(R);Z&&K(Z,R)}function la(R){WALK.log('Participant "%s" disconnected',R.identity);var Z=W(R);Z&&H(Z,R)}var oa=E.avToken,ra=E.channel,Ba=["NotAllowedError","NotFoundError","NotReadableError","OverconstrainedError","TypeError"],ma=null,Ga=!1,aa=0,S=WALK.urlHashContains("av-turn");this.isConnected=function(){return Ga};this.disconnect=function(){Ga=!1;ma&&ma.disconnect();y.disconnectedFromTwilio()};this.dispose=function(){this.disconnect()};this.connect=function(){console.assert(!Ga);Ga=!0;y.startedConnectingToTwilio();
WALK.log('Connecting to room "%s"',ra);Twilio.Video.connect(oa,{name:ra,tracks:y.getAllTracks(),preferredVideoCodecs:["VP8"],iceTransportPolicy:S?"relay":"all",region:z||"gll"}).then(function(R){ma=R;WALK.log("Connected to room");ma.participants.forEach(ka);ma.on("participantConnected",ka);ma.on("participantDisconnected",la);ma.on("reconnecting",function(Z){aa+=1});ma.on("reconnected",function(Z){aa=0});ma.once("disconnected",function(Z){Ga&&(ma.participants.forEach(la),y.disconnectedFromTwilio(),
0<aa?O("TReconnectionDisconnected"+(Z.code?" "+Z.code:"")):Y())});y.connectedToTwilio(ma.localParticipant)}).catch(function(R){y.failedToConnectToTwilio();Ba.includes(R.name)?G(R):O("T"+R.code)})}}function m(y,E){function K(ka,la){var oa=document.createElement("span");oa.classList.add("ext-meeting-status-list-name");oa.innerText=ka;oa.style.color=la;return oa}function H(ka){var la=document.createElement("span");la.classList.add("ext-meeting-status-list-mic-indicator");ka?la.classList.add("fa-microphone"):
la.classList.add("fa-microphone-slash");return la}function G(){var ka=document.createElement("span");ka.classList.add("ext-meeting-status-list-mic-indicator");ka.classList.add("fa-file-audio-o");return ka}function O(ka){console.assert(null!==ka.volumeVisualizer,"volumeVisualizer not initialized");var la=document.createElement("span");ka.isSoundMeasurementActive()?la.innerHTML=ka.volumeVisualizer.getHTML():la.innerHTML=ka.volumeVisualizer.getEmptyHTML();return la}var Y=document.getElementById("ext-meeting-status"),
W=document.getElementById("ext-meeting-who-list");this.update=function(ka){MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(W);var la=W.appendChild,oa=document.createElement("li");oa.classList.add("ext-meeting-status-list-entry");oa.appendChild(O(y));oa.appendChild(K(y.displayName+" (me)",y.color));var ra=h(y.micTrack);oa.appendChild(H(ra));y.audioTrack&&oa.appendChild(G(ra));la.call(W,oa);ka=$jscomp.makeIterator(Object.values(ka));for(la=ka.next();!la.done;la=ka.next())if(ra=la.value,
ra.hasDisplayName){la=W;oa=la.appendChild;var Ba=document.createElement("li");Ba.classList.add("ext-meeting-status-list-entry");Ba.appendChild(O(ra));var ma=K(ra.displayName,ra.color);ma.onclick=ra.seeAvatar.bind(ra);ma.style.cursor="pointer";Ba.appendChild(ma);ma=ra.micTrack&&ra.micTrack.isEnabled;Ba.appendChild(H(ma));ra.audioTrack&&Ba.appendChild(G(ma));oa.call(la,Ba)}};this.show=function(){MeetingUiUtils$$module$extensions$MeetingUiUtils.show(Y)};this.hide=function(){MeetingUiUtils$$module$extensions$MeetingUiUtils.hide(Y)};
this.update([]);this.show()}function l(y){return'\n      <div>\n        <textarea id="ext-meeting-note-text"\n          class="ext-meeeting-note-edit"\n          placeholder="'+y+'"></textarea>\n      </div>\n      <button id="ext-meeting-note-publish"\n        class="ext-meeting-button ext-meeting-dialog-buttons">\n        Publish\n      </button>\n    '}function u(y,E){function K(G){var O=H;null!==G.location&&(O+=":"+G.location.join(":"));return O}var H="extMtg:"+y+":"+E+":";this.getTimeStampOfLastReadNoteAtLocation=
function(G){return localStorage.getItem(K(G))||-1};this.isNoteRead=function(G){return G.ts<=this.getTimeStampOfLastReadNoteAtLocation(G)||G.author===E};this.markAllNotesAtLocationAsRead=function(G){localStorage.setItem(K(G),G.ts)}}function v(y,E,K,H,G,O){function Y(ca){if(ca===E.displayName)return E.color;for(var na=$jscomp.makeIterator(Object.values(K)),Aa=na.next();!Aa.done;Aa=na.next())if(Aa=Aa.value,Aa.displayName===ca)return Aa.color;return"#ffffff"}function W(){Ba=!1;H.show();M.style.cursor=
"default";ma.dismiss();Ga.close()}function ka(ca){return ra.filter(function(na){na=na.location;var Aa=ca.location;na=null===na||null===Aa?!1:WALK.deepEqual(na,Aa);return na})}function la(ca,na){function Aa(va,sa){if(!Ba){fa.classList.remove("ext-meeting-note-list-unread");fa.classList.add("ext-meeting-note-list-selected");sa&&fa.scrollIntoView();va.material.highlightMix=.7;y.requestFrame();var Fa="";sa=new Map;for(var Ta=G.getTimeStampOfLastReadNoteAtLocation(ca),U=null,pa=$jscomp.makeIterator(ka(ca)),
Da=pa.next();!Da.done;Da=pa.next()){U=Da.value;Da="ext-meeting-note-text"+U.id;var wa="ext-meeting-note-author"+U.id,Ha="ext-meeting-note-entry";U.ts>Ta&&U.author!==E.displayName&&(Ha+=" ext-meeting-note-unread");Fa+='<div class="'+Ha+'">\n               <strong id="'+wa+'"\n                   style="color: '+Y(U.author)+'">\n               </strong> <span>'+b(U.ts)+'</span>\n               <div id="'+Da+'">\n               </div>\n             </div>';sa.set(Da,U.text);sa.set(wa,U.author)}Fa+=l("Type your response");
aa?aa.update(Fa):(aa=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup(Fa),aa.position=MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup.TOP,aa.onClose=function(){fa.classList.remove("ext-meeting-note-list-selected");va.material.highlightMix=0;y.requestFrame();aa=null});G.markAllNotesAtLocationAsRead(U);S=ca.location;aa.open();sa.forEach(function(Ia,Xa){document.getElementById(Xa).innerText=Ia});MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-note-publish",
function(){var Ia=document.getElementById("ext-meeting-note-text"),Xa=Ia.value.trim();if(Xa){var Ka=va.position;O(Xa,[Ka.x,Ka.y,Ka.z]);Ia.value=""}else MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightInput(Ia)})}}var Ca=y.addAnchor(d(ca.location[0],ca.location[1],ca.location[2],"#0775e8"),function(va){return Aa(va,!0)});Ca.material.highlight=T;Ca.material.setUniforms();oa.push(Ca);var qa=ca.author;var fa=c(qa,b(ca.ts),Y(qa),function(){y.seeItem(Ca);Aa(Ca,!1)});G.isNoteRead(ca)||fa.classList.add("ext-meeting-note-list-unread");
na.appendChild(fa);null!==aa&&WALK.deepEqual(S,ca.location)&&Aa(Ca,!0)}var oa=[],ra=[],Ba=!1,ma=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup("\n      <h2>\n        Click a place to leave a note there.\n      </h2>");ma.position=MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup.TOP;var Ga=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup(l("Type your note"));Ga.position=MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup.TOP;var aa=null,S=null;MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-add-note",
function(){Ba=!0;H.hide();M.style.cursor="pointer";aa&&aa.close();y.onNodeTypeClicked(Z);ma.onDismiss=function(){y.removeOnNodeTypeClicked(Z);W()};ma.open()});var R=new THREE.Vector3;var Z=function(ca,na,Aa){M.style.cursor="default";R.copy(na);WALK.movePointTowards(R,y.getCameraPosition(),.1);y.removeOnNodeTypeClicked(Z);var Ca=y.addAnchor(d(R.x,R.y,R.z));Ca.material.highlight=T;Ca.material.setUniforms();Ca.material.highlightMix=.7;ma.close();Ga.onClose=function(){y.removeAnchor(Ca);W()};Ga.open();
MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-note-publish",function(){var qa=document.getElementById("ext-meeting-note-text"),fa=qa.value.trim();fa?O(fa,[R.x,R.y,R.z]):MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightInput(qa)});return!0};y.onApiUserStateChanged("MeetingNotes",function(ca,na){console.assert("MeetingNotes"===ca);ra=na.sort(function(fa,va){var sa=G.isNoteRead(fa),Fa=G.isNoteRead(va);return sa!==Fa?sa?-1:1:fa.ts-va.ts});W();ca=$jscomp.makeIterator(oa);
for(na=ca.next();!na.done;na=ca.next())y.removeAnchor(na.value);oa.length=0;ca=document.getElementById("ext-meeting-note-list");MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(ca);na=new Map;for(var Aa=ra.length-1;0<=Aa;Aa--){var Ca=ra[Aa];if(null!==Ca.location){var qa=Ca.location.join("/");na.has(qa)||(na.set(qa,Aa),la(Ca,ca),ca.lastChild.scrollIntoView())}}})}function t(y,E){function K(){W=Y=null;O.pointerX=null;O.pointerY=null;O.pointerZ=null;y._enableControls()}function H(){O.isEnabled()?
(M.style.cursor="default",K(),la.disable(),ka.close(),E.show()):(M.style.cursor="pointer",ka.open(),la.enable(),ka.onDismiss=H,E.hide())}var G=this,O=this,Y=null,W=null,ka=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup("\n      <h2>\n        Point a place by clicking.\n      </h2>");ka.position=MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup.TOP;var la=y._createPointerEventHelper(0);la.disable();this.pointerZ=this.pointerY=this.pointerX=null;this.isEnabled=function(){return la.isEnabled()};
this.showPointer=function(){return null!==this.pointerX};y.onBeforeRender(function(){if(null!==Y){var oa=y._findIntersectionAtPosition(Y,W);Infinity!==oa.distance&&(G.pointerX=oa.point.x,G.pointerY=oa.point.y,G.pointerZ=oa.point.z)}});la.callbacks.onPointerDown=function(oa,ra){Y=oa;W=ra;y._disableControls();y.requestFrame();return!0};la.callbacks.onPointerMove=function(oa,ra){if(null===Y)return!1;Y=oa;W=ra;y.requestFrame();return!0};la.callbacks.onPointerUp=function(){K();y.requestFrame();return!0};
MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-pointer",function(){H()})}function B(){var y=[0,0,0,0,0],E=[0,0,0,0,0,0,0,0],K=null,H=!1;this.newUpdateWithPointer=function(){H=!1;K!==E&&(H=!0,K=E)};this.newUpdateNoPointer=function(){H=!1;K!==y&&(H=!0,K=y)};this.set=function(G,O){K[G]!==O&&(K[G]=O,H=!0)};this.getFilledArray=function(){return H?K:null}}function D(){function y(Y){MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(Y.children[0],!0);MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(Y.children[1],
!1)}function E(Y){MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(Y.children[0],!1);MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(Y.children[1],!0)}var K=document.getElementById("ext-meeting-mic-toggle"),H=document.getElementById("ext-meeting-camera-toggle"),G=document.getElementById("ext-meeting-camera-preview"),O=null;this.refreshMicControls=function(Y){h(Y)?(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(K,!1),y(K)):(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(K,
!0),E(K))};this.refreshCameraControls=function(Y){h(Y)?(O||(O=Y.attach(),G.appendChild(O)),MeetingUiUtils$$module$extensions$MeetingUiUtils.show(G),MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(H,!1),y(H)):(O&&(Y.detach(),O.remove(),O=null),MeetingUiUtils$$module$extensions$MeetingUiUtils.hide(G),MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(H,!0),E(H))};this.setToggleButtonHandlers=function(Y,W){K.onclick=Y;H.onclick=W}}function I(y,E,K,H){function G(sa){WALK.USER_MSG.error("Connection lost. Reload the page to rejoin the meeting.<br/>(Code:"+
sa+")")}function O(sa,Fa){sa={meetingKey:Aa,author:y,text:sa,location:Fa};WALK.ajaxPost(a()+"/meetings/"+na+"/notes","application/json",JSON.stringify(sa),function(){return WALK.log("Note added.")},function(){return WALK.log("Failed to add note")})}function Y(sa){Z.update(R)}function W(sa){var Fa=R[sa];Fa||(Fa=new p(ma,sa,aa,Y),R[sa]=Fa);return Fa}function ka(sa){sa in R&&(R[sa].dispose(),delete R[sa],Z.update(R),va.isConnected()&&0===Object.keys(R).length&&va.disconnect())}function la(sa){Ca=sa;
for(var Fa=$jscomp.makeIterator(Object.keys(sa)),Ta=Fa.next();!Ta.done;Ta=Fa.next())Ta=Ta.value,ma.apiUserChangeState(Ta,sa[Ta])}function oa(){S.dispose();va.dispose();fa.dispose();for(var sa in R)R.hasOwnProperty(sa)&&R[sa].dispose();aa.dispose()}function ra(sa){qa.showPointer()?(Ga.newUpdateWithPointer(),Ga.set(5,WALK.round(qa.pointerX,3)),Ga.set(6,WALK.round(qa.pointerY,3)),Ga.set(7,WALK.round(qa.pointerZ,3))):Ga.newUpdateNoPointer();sa=ma.getCameraPosition();var Fa=ma.getCameraRotation();Ga.set(0,
WALK.round(sa.x,3));Ga.set(1,WALK.round(sa.y,3));Ga.set(2,WALK.round(sa.z,3));Ga.set(3,WALK.round(Fa.yaw,1));Ga.set(4,WALK.round(Fa.pitch,1));(sa=Ga.getFilledArray())&&S.updatePosition(sa)}function Ba(){WALK.USER_MSG.error("The meeting has ended. Maximum duration of meeting reached.)");oa();Z.update({})}var ma=WALK.getViewer(),Ga=new B,aa=new A;this.myUuid=H.uuid;var S=new q(ma,this.myUuid,y,aa,E,K),R={},Z=new m(S,ma),ca=new D,na=H.id,Aa=H.meetingKey,Ca;ca.setToggleButtonHandlers(function(){S.toggleMic()},
function(){S.toggleCamera()});S.setAvTracksStateHandlers(function(sa){ca.refreshMicControls(sa);Z.update(R)},function(sa){ca.refreshCameraControls(sa)});ca.refreshMicControls(S.micTrack);ca.refreshCameraControls(S.cameraTrack);var qa=new t(ma,Z);WALK.urlHashContains("meeting-notes")&&(MeetingUiUtils$$module$extensions$MeetingUiUtils.show(document.getElementById("ext-meeting-notes-preview")),v(ma,S,R,Z,new u(na,y),O));null!==H.sceneState&&la(H.sceneState);var fa=new r(S,H,function(sa){W(sa);va.isConnected()||
va.connect()},ka,la,G);var va=new n(S,H,function(sa,Fa){W(sa).connectedToTwilio(Fa)},function(sa,Fa){ka(sa)},function(sa){WALK.USER_MSG.info("Failed to acquire media.<br/>"+sa.message,6E3)},G,function(){WALK.USER_MSG.error("The meeting has been ended.")});MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-leave",function(){e("Do you want to leave this meeting?","Leave meeting",function(){oa();document.body.innerHTML='<div id="cover-image"></div>';e("You have left the meeting.",
"Join again",function(){location.reload()},!1)})});ma.onBeforeRender(ra);ra();ma.onApiUserStateChanged(function(sa,Fa){Ca&&WALK.deepEqual(Fa,Ca[sa])||(sa={meetingKey:Aa,key:sa,state:Fa},WALK.ajaxPost(a()+"/meetings/"+na+"/scene-state","application/json",JSON.stringify(sa),function(){return WALK.log("State updated.")},function(){return WALK.log("Failed to update state.")}))});this.startShareScreen=function(sa,Fa,Ta){WALK.log("Screen share start requested");S.startShareScreen(sa,Fa,Ta,function(){return Z.update(R)})};
this.stopShareScreen=function(){WALK.log("Screen share stop requested");S.stopShareScreen()};null!==H.remainingTimeSeconds&&setTimeout(Ba,1E3*(H.remainingTimeSeconds+5))}function J(y){(new MeetingStarter$$module$extensions$MeetingStarter(function(E,K,H){E=new I(E,K,H,y);WALK.getViewer()._meetingJoined(E)})).show()}function Q(y){WALK.getViewer().onSceneLoadComplete(function(){var E=WALK.getViewerAssetUrl("3dassets/avatar.obj");WALK.loadGeometriesFromObj(E,function(K){WALK.setAvatarGeometries(K);y()},
function(){return WALK.USER_MSG.error("Failed to load the meeting")})})}if(WALK.urlHashContains("meeting-key")||WALK.urlHashContains("meeting")){WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeSolid");WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeRegular");var T=new THREE.Color(0,1,0),M=document.getElementById("walk-canvas"),z=WALK.urlHashGetArgument("av-region");k.prototype={constructor:k,_setUpAvatar:function(){console.assert(this._displayName,"Display name must be known to set up the avatar");WALK.log("Setting up avatar for %s:%s",
this._uuid,this._displayName);this._avatar=this._viewer.addAvatar(this._uuid,{displayName:this._displayName,color:this._color})},get uuid(){return this._uuid},get color(){return this._color},get displayName(){return this._displayName},get hasDisplayName(){return null!==this._displayName},_positionChanged:function(y){if(this._lastRenderedPositionLength!==y.length)return!0;for(var E=0;E<y.length;E++)if(1E-5<Math.abs(this._lastRenderedPosition[E]-y[E]))return!0;return!1},_setLastRenderedPosition:function(y){this._lastRenderedPositionLength=
y.length;for(var E=0;E<y.length;E++)this._lastRenderedPosition[E]=y[E]},get volumeVisualizer(){return this._volumeVisualizer},updatePosition:function(y){if(this.hasDisplayName&&this._positionChanged(y)){this._setLastRenderedPosition(y);var E=this._avatar;E.setPositionFromArray(y);E.rotate(y[3],y[4]);6<=y.length?E.placePointer(y[5],y[6],y[7]):E.hidePointer();E.visible&&(E.updateMatrixWorld(!0),this._viewer.requestFrame())}},updateSoundVolumeVisualization:function(){console.assert(null!==this._volumeMeter,
"this._voulmeMeter not created");var y=this._volumeMeter.measureSoundVolume();this._onSoundVolumeUpdated(y)},_onSoundVolumeUpdated:function(y){this._volumeVisualizer.update(y)},dispose:function(){this.isSoundMeasurementActive()&&this._stopSoundMeasurement();this._avatar&&(this._viewer.removeAvatar(this._avatar),this._avatar=null,this._viewer.requestFrame())},_updateSoundMeasurementState:function(){null!==this._micTrack&&this._micTrack.isEnabled?this._startSoundMeasurement():this._stopSoundMeasurement()},
isSoundMeasurementActive:function(){return null!==this._volumeMeter},_startSoundMeasurement:function(){this.isSoundMeasurementActive()||(this._volumeMeter=new SoundUtils$$module$extensions$SoundUtils.VolumeMeter(this._micTrack,512,this._noSoundThreshold),this._soundVolumeUpdatesScheduler.registerUser(this))},_stopSoundMeasurement:function(){this.isSoundMeasurementActive()&&(this._soundVolumeUpdatesScheduler.unregisterUser(this),this._volumeMeter.dispose(),this._volumeMeter=null,this._avatar.onSoundSwitchedOff())}};
Object.defineProperty(k.prototype,"micTrack",{get:function(){return this._micTrack}});Object.defineProperty(k.prototype,"cameraTrack",{get:function(){return this._cameraTrack}});Object.defineProperty(k.prototype,"audioTrack",{get:function(){return this._audioTrack}});q.prototype=Object.create(k.prototype);q.prototype.constructor=q;Object.defineProperty(q.prototype,"dataTrack",{get:function(){return this._dataTrack}});Object.defineProperty(q.prototype,"screenTrack",{get:function(){return this._screenTrack}});
q.prototype.getAllTracks=function(){var y=[this._dataTrack];this._micTrack&&y.push(this._micTrack);this._cameraTrack&&y.push(this._cameraTrack);this._screenTrack&&y.push(this._screenTrack);this._audioTrack&&y.push(this._audioTrack);return y};q.prototype._sendPosition=function(y){this._positionMessage[2]=y;this._dataTrack.send(JSON.stringify(this._positionMessage))};q.prototype._resendLastPosition=function(){null!==this._lastPosition&&this._sendPosition(this._lastPosition)};q.prototype.startedConnectingToTwilio=
function(){this._isPublishingTracksDuringConnecting=!0};q.prototype.failedToConnectToTwilio=function(){this._isPublishingTracksDuringConnecting=!1};q.prototype.connectedToTwilio=function(y){var E=this;this._twilioParticipant=y;y.publishTracks(this.getAllTracks()).finally(function(){E._isPublishingTracksDuringConnecting=!1});this._resendLastPosition();this._resendInterval=setInterval(function(){return E._resendLastPosition()},1E3)};q.prototype.disconnectedFromTwilio=function(){this._twilioParticipant=
null;clearInterval(this._resendInterval);this._resendInterval=null};Object.defineProperty(q.prototype,"isConnectedToTwilio",{get:function(){return null!==this._twilioParticipant}});q.prototype.updatePosition=function(y){k.prototype.updatePosition.call(this,y);this._lastPosition=y;this.isConnectedToTwilio&&this._sendPosition(y)};q.prototype.setAvTracksStateHandlers=function(y,E){this._onMicTrackStateChanged=y;this._onCameraTrackStateChanged=E};q.prototype._removeStoppedMicTrack=function(){console.assert(this._micTrack&&
this._micTrack.isStopped);WALK.log("Removing stopped local mic track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local mic track"),this._twilioParticipant.unpublishTrack(this._micTrack));this._micTrack=null};q.prototype._subscribeToMicEvents=function(){var y=this,E=function(){y._updateSoundMeasurementState();y._onMicTrackStateChanged&&y._onMicTrackStateChanged(y._micTrack)};this._micTrack.on("started",E);this._micTrack.on("enabled",E);this._micTrack.on("disabled",E);this._micTrack.on("stopped",
function(){E();y._removeStoppedMicTrack()})};q.prototype._createMicTrack=function(){var y=this;WALK.log("Creating local mic track");if(this._isCreatingMicTrack)WALK.log("Local mic track is already being created");else{this._isCreatingMicTrack=!0;var E=null;Twilio.Video.createLocalAudioTrack(this._micDevice.trackOptions).then(function(K){E=K;if(y.isConnectedToTwilio)return WALK.log("Publishing local mic track"),y._twilioParticipant.publishTrack(E)}).then(function(K){K?WALK.log("Local mic track created and published"):
WALK.log("Local mic track created but not yet published");y._micTrack=E;y._subscribeToMicEvents();y._onMicTrackStateChanged&&y._onMicTrackStateChanged(y._micTrack);y._isCreatingMicTrack=!1}).catch(function(K){E&&E.stop();y._micDevice.error=K;y._showCreateTrackError(y._micDevice);y._isCreatingMicTrack=!1})}};q.prototype.toggleMic=function(){this._micTrack?this._micTrack.isEnabled?(WALK.log("Disabling local mic track"),this._micTrack.disable()):(WALK.log("Enabling local mic track"),this._micTrack.enable()):
this._createMicTrack()};q.prototype._removeStoppedCameraTrack=function(){console.assert(this._cameraTrack&&this._cameraTrack.isStopped);WALK.log("Removing stopped local camera track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local camera track"),this._twilioParticipant.unpublishTrack(this._cameraTrack));this._cameraTrack=null};q.prototype._subscribeToCameraEvents=function(){var y=this,E=function(){y._onCameraTrackStateChanged&&y._onCameraTrackStateChanged(y._cameraTrack)};this._cameraTrack.on("started",
E);this._cameraTrack.on("enabled",E);this._cameraTrack.on("disabled",E);this._cameraTrack.on("stopped",function(){E();y._removeStoppedCameraTrack()})};q.prototype._createCameraTrack=function(){var y=this;WALK.log("Creating local camera track");if(this._isCreatingCameraTrack)WALK.log("Local camera track is already being created");else{this._isCreatingCameraTrack=!0;var E=null;Twilio.Video.createLocalVideoTrack(this._cameraDevice.trackOptions).then(function(K){E=K;if(y.isConnectedToTwilio)return WALK.log("Publishing local camera track"),
y._twilioParticipant.publishTrack(E)}).then(function(K){K?WALK.log("Local camera track created and published"):WALK.log("Local camera track created but not yet published");y._cameraTrack=E;y._subscribeToCameraEvents();y._onCameraTrackStateChanged&&y._onCameraTrackStateChanged(y._cameraTrack);y._isCreatingCameraTrack=!1}).catch(function(K){E&&E.stop();y._cameraDevice.error=K;y._showCreateTrackError(y._cameraDevice);y._isCreatingCameraTrack=!1})}};q.prototype._showCreateTrackError=function(y){y=y.getErrorMessageInfo();
MeetingUiUtils$$module$extensions$MeetingUiUtils.showMessage(y.description,y.title)};q.prototype.toggleCamera=function(){this._cameraTrack?this._isPublishingTracksDuringConnecting?WALK.log("Cannot disable the camera track during connection process"):this._cameraTrack.stop():this._createCameraTrack()};q.prototype.startShareScreen=function(y,E,K,H){var G=this;null!==this._screenTrack?y():(WALK.log("Share screen start"),navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then(function(O){WALK.log("share screen - stream:",
O);var Y=new Twilio.Video.LocalVideoTrack(O.getVideoTracks()[0],{name:"screen"});G._screenTrack=Y;O=O.getAudioTracks();var W=null;0<O.length?(W=new Twilio.Video.LocalAudioTrack(O[0],{name:"audio"}),G._audioTrack=W,H()):console.log("Audio track not available for sharing");O=f(G._viewer,Y);G._avatar.setVideoTexture1(O);G._viewer.requestFrame();G.isConnectedToTwilio&&(G._twilioParticipant.publishTrack(Y),W&&G._twilioParticipant.publishTrack(W));y();Y.once("stopped",function(){WALK.log("Screen track stopped");
G.isConnectedToTwilio&&(G._twilioParticipant.unpublishTrack(Y),null!==W&&G._twilioParticipant.unpublishTrack(W));G._avatar.setVideoTexture1(null);g(Y);null!==W&&g(W);G._screenTrack=null;G._audioTrack&&(G._audioTrack=null,H());G._viewer.requestFrame();E()})}).catch(function(O){K()}))};q.prototype.stopShareScreen=function(){null!==this._screenTrack&&(WALK.log("Share screen stop"),this._screenTrack.stop())};q.prototype.dispose=function(){this._micTrack&&this._micTrack.stop();this._cameraTrack&&this._cameraTrack.stop();
this._screenTrack&&this._screenTrack.stop();k.prototype.dispose.call(this)};p.prototype=Object.create(k.prototype);p.prototype.constructor=p;p.prototype._refreshUi=function(){this._onUiRefreshNeeded&&this._onUiRefreshNeeded(this)};p.prototype._setUpMicTrack=function(){var y=this;WALK.log("Setting up remote mic track for %s:%s",this._uuid,this._displayName);this._micTrackStateChangedBound=function(){y._updateSoundMeasurementState();y._refreshUi()};this._micTrack.on("enabled",this._micTrackStateChangedBound);
this._micTrack.on("disabled",this._micTrackStateChangedBound);this._updateSoundMeasurementState();this._micTrack.attach()};p.prototype._tearDownMicTrack=function(){WALK.log("Tearing down remote mic track for %s:%s",this._uuid,this._displayName);g(this._micTrack);this._micTrack.removeListener("enabled",this._micTrackStateChangedBound);this._micTrack.removeListener("disabled",this._micTrackStateChangedBound);this._micTrackStateChangedBound=null};p.prototype._setUpAudioTrack=function(){WALK.log("Setting up remote audio track for %s:%s",
this._uuid,this._displayName);this._audioTrack.attach()};p.prototype._tearDownAudioTrack=function(){WALK.log("Tearing down remote audio track for %s:%s",this._uuid,this._displayName);g(this._audioTrack)};p.prototype._setUpCameraTrack=function(){var y=this;WALK.log("Setting up remote camera track for %s:%s",this._uuid,this._displayName);var E=f(this._viewer,this._cameraTrack);this._cameraTrackEnabledBound=function(){y._avatar.setVideoTexture0(E)};this._cameraTrackDisabledBound=function(){y._avatar.setVideoTexture0(null)};
this._cameraTrack.on("enabled",this._cameraTrackEnabledBound);this._cameraTrack.on("disabled",this._cameraTrackDisabledBound);this._avatar.setVideoTexture0(E)};p.prototype._tearDownCameraTrack=function(){WALK.log("Tearing down remote camera track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture0(null);g(this._cameraTrack);this._cameraTrack.removeListener("enabled",this._cameraTrackEnabledBound);this._cameraTrack.removeListener("disabled",this._cameraTrackDisabledBound);this._cameraTrackDisabledBound=
this._cameraTrackEnabledBound=null};p.prototype._setUpScreenTrack=function(){WALK.log("Setting up remote screen track for %s:%s",this._uuid,this._displayName);var y=f(this._viewer,this._screenTrack);this._avatar.setVideoTexture1(y)};p.prototype._tearDownScreenTrack=function(){WALK.log("Tearing down remote screen track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture1(null);g(this._screenTrack)};p.prototype._setDisplayName=function(y){WALK.log("Remote display name known for %s:%s",
this._uuid,y);this._displayName=y;this._setUpAvatar();this._micTrack&&this._setUpMicTrack();this._cameraTrack&&this._setUpCameraTrack();this._screenTrack&&this._setUpScreenTrack();this._audioTrack&&this._setUpAudioTrack();this._refreshUi()};p.prototype._trackSubscribed=function(y){var E=this;WALK.log("Remote %s:%s track subscribed for %s:%s",y.kind,y.name,this._uuid,this._displayName);this._disposed||("data"===y.kind&&"data"===y.name?this._dataTrack?WALK.log("Ignoring duplicate data track"):(this._dataTrack=
y,y.on("message",function(K){K=JSON.parse(K);var H=K[1];K=K[2];E.hasDisplayName||E._setDisplayName(H);E.updatePosition(K)})):"audio"===y.kind&&"mic"===y.name?this._micTrack?WALK.log("Ignoring duplicate mic track"):(this._micTrack=y,this.hasDisplayName&&(this._setUpMicTrack(),this._refreshUi())):"video"===y.kind?"camera"===y.name?this._cameraTrack?WALK.log("Ignoring duplicate camera track"):(this._cameraTrack=y,this._avatar&&(this._setUpCameraTrack(),this._viewer.requestFrame())):"screen"===y.name&&
(this._screenTrack?WALK.log("Ignoring duplicate screen track"):(this._screenTrack=y,this._avatar&&(this._setUpScreenTrack(),this._viewer.requestFrame()))):"audio"===y.kind&&"audio"===y.name&&(this._audioTrack?WALK.log("Ignoring duplicate audio track"):(this._audioTrack=y,this.hasDisplayName&&(this._setUpAudioTrack(),this._refreshUi()))))};p.prototype._trackUnsubscribed=function(y){WALK.log("Remote %s:%s track unsubscribed for %s:%s",y.kind,y.name,this._uuid,this._displayName);this._disposed||(y===
this._dataTrack?this._dataTrack=null:y===this._micTrack?(this.hasDisplayName&&this._tearDownMicTrack(),this._micTrack=null,this._refreshUi()):y===this._cameraTrack?(this._avatar&&(this._tearDownCameraTrack(),this._viewer.requestFrame()),this._cameraTrack=null):y===this._screenTrack?(this._avatar&&(this._tearDownScreenTrack(),this._viewer.requestFrame()),this._screenTrack=null):y===this._audioTrack&&(this.hasDisplayName&&this._tearDownAudioTrack(),this._audioTrack=null,this._refreshUi()))};p.prototype.connectedToTwilio=
function(y){var E=this;this._twilioParticipant=y;y.on("trackSubscribed",this._trackSubscribedBound);y.on("trackUnsubscribed",this._trackUnsubscribedBound);y.tracks.forEach(function(K){K.isSubscribed&&E._trackSubscribed(K.track)})};p.prototype.seeAvatar=function(){this._avatar&&this._viewer.seeItem(this._avatar)};p.prototype._onSoundVolumeUpdated=function(y){k.prototype._onSoundVolumeUpdated.call(this,y);this._avatar.onSoundVolumeUpdated(y)};p.prototype.dispose=function(){this._onUiRefreshNeeded=null;
this._micTrack&&this._trackUnsubscribed(this._micTrack);this._cameraTrack&&this._trackUnsubscribed(this._cameraTrack);this._screenTrack&&this._trackUnsubscribed(this._screenTrack);this._audioTrack&&this._trackUnsubscribed(this._audioTrack);this.isConnectedToTwilio&&(this._twilioParticipant.removeListener("trackSubscribed",this._trackSubscribedBound),this._twilioParticipant.removeListener("trackUnsubscribed",this._trackUnsubscribedBound),this._twilioParticipant=null);k.prototype.dispose.call(this);
this._disposed=!0};var A=function(){var y=this;this._users=new Set;this._maxIntervalBetweenUpdates=100;this._idleCallback=new WALK.DeferringExecutorInterval(function(){return y._execute()},this._maxIntervalBetweenUpdates);WALK.getViewer().onBeforeRender(function(){return y._onBeforeRender()})};A.prototype.registerUser=function(y){this._users.add(y)};A.prototype.unregisterUser=function(y){this._users.delete(y)};A.prototype.dispose=function(){this._users.clear()};A.prototype._onBeforeRender=function(){this._execute();
this._idleCallback.deferRun()};A.prototype._execute=function(){this._users.forEach(function(y){return y.updateSoundVolumeVisualization()})};WALK.loadScriptsUrlAndExecute([WALK.getViewerAssetUrl("lib/pubnub.min.js"),WALK.getViewerAssetUrl("lib/twilio-video.min.js")],function(){var y=WALK.urlHashGetArgument("meeting"),E=WALK.urlHashGetArgument("meeting-key"),K=WALK.urlHashGetArgument("av-mode"),H={url:WALK.DEVEL_MEETING_SCENE_URL||window.location.href};y&&(H.meetingName=y);E&&(H.meetingKey=E);K&&(H.avMode=
K);z&&(H.avRegion=z);WALK.ajaxPost(a()+"/meetings/join","application/json",JSON.stringify(H),function(G){return Q(function(){return J(G)})},function(G,O){void 0!==O?WALK.USER_MSG.error(O):WALK.USER_MSG.error("Failed to join the meeting. Is your link valid?")})},function(){return WALK.USER_MSG.error("Cannot load required library")});WALK.play()}})();var module$extensions$meeting={};
